/*! For license information please see main.13a8c113.js.LICENSE.txt */
(()=>{var e={4(e,t,n){"use strict";var r=n(853),o=n(43),a=n(950);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function u(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function l(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function c(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function f(e){if(u(e)!==e)throw Error(i(188))}function d(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=d(e)))return t;e=e.sibling}return null}var p=Object.assign,h=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),w=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope");var _=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var I=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var N=Symbol.iterator;function T(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}var A=Symbol.for("react.client.reference");function D(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===A?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case b:return"Profiler";case y:return"StrictMode";case C:return"Suspense";case S:return"SuspenseList";case _:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case m:return"Portal";case w:return e.displayName||"Context";case x:return(e._context.displayName||"Context")+".Consumer";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:D(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return D(e(t))}catch(n){}}return null}var O=Array.isArray,F=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M={pending:!1,data:null,method:null,action:null},L=[],B=-1;function z(e){return{current:e}}function W(e){0>B||(e.current=L[B],L[B]=null,B--)}function U(e,t){B++,L[B]=e.current,e.current=t}var j,V,H=z(null),G=z(null),q=z(null),K=z(null);function $(e,t){switch(U(q,t),U(G,e),U(H,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?yf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=bf(t=yf(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(H),U(H,e)}function X(){W(H),W(G),W(q)}function Y(e){null!==e.memoizedState&&U(K,e);var t=H.current,n=bf(t,e.type);t!==n&&(U(G,e),U(H,n))}function Q(e){G.current===e&&(W(H),W(G)),K.current===e&&(W(K),fd._currentValue=M)}function J(e){if(void 0===j)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);j=t&&t[1]||"",V=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+j+e+V}var Z=!1;function ee(e,t){if(!e||Z)return"";Z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(o){var r=o}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(i){r=i}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"===typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),i=a[0],s=a[1];if(i&&s){var u=i.split("\n"),l=s.split("\n");for(o=r=0;r<u.length&&!u[r].includes("DetermineComponentFrameRoot");)r++;for(;o<l.length&&!l[o].includes("DetermineComponentFrameRoot");)o++;if(r===u.length||o===l.length)for(r=u.length-1,o=l.length-1;1<=r&&0<=o&&u[r]!==l[o];)o--;for(;1<=r&&0<=o;r--,o--)if(u[r]!==l[o]){if(1!==r||1!==o)do{if(r--,0>--o||u[r]!==l[o]){var c="\n"+u[r].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=r&&0<=o);break}}}finally{Z=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?J(n):""}function te(e,t){switch(e.tag){case 26:case 27:case 5:return J(e.type);case 16:return J("Lazy");case 13:return e.child!==t&&null!==t?J("Suspense Fallback"):J("Suspense");case 19:return J("SuspenseList");case 0:case 15:return ee(e.type,!1);case 11:return ee(e.type.render,!1);case 1:return ee(e.type,!0);case 31:return J("Activity");default:return""}}function ne(e){try{var t="",n=null;do{t+=te(e,n),n=e,e=e.return}while(e);return t}catch(r){return"\nError generating stack: "+r.message+"\n"+r.stack}}var re=Object.prototype.hasOwnProperty,oe=r.unstable_scheduleCallback,ae=r.unstable_cancelCallback,ie=r.unstable_shouldYield,se=r.unstable_requestPaint,ue=r.unstable_now,le=r.unstable_getCurrentPriorityLevel,ce=r.unstable_ImmediatePriority,fe=r.unstable_UserBlockingPriority,de=r.unstable_NormalPriority,pe=r.unstable_LowPriority,he=r.unstable_IdlePriority,ve=r.log,me=r.unstable_setDisableYieldValue,ge=null,ye=null;function be(e){if("function"===typeof ve&&me(e),ye&&"function"===typeof ye.setStrictMode)try{ye.setStrictMode(ge,e)}catch(t){}}var xe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(we(e)/Ee|0)|0},we=Math.log,Ee=Math.LN2;var Ce=256,Se=262144,ke=4194304;function Re(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function _e(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var o=0,a=e.suspendedLanes,i=e.pingedLanes;e=e.warmLanes;var s=134217727&r;return 0!==s?0!==(r=s&~a)?o=Re(r):0!==(i&=s)?o=Re(i):n||0!==(n=s&~e)&&(o=Re(n)):0!==(s=r&~a)?o=Re(s):0!==i?o=Re(i):n||0!==(n=r&~e)&&(o=Re(n)),0===o?0:0!==t&&t!==o&&0===(t&a)&&((a=o&-o)>=(n=t&-t)||32===a&&0!==(4194048&n))?t:o}function Ie(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ne(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Te(){var e=ke;return 0===(62914560&(ke<<=1))&&(ke=4194304),e}function Ae(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function De(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-xe(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|261930&n}function Fe(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-xe(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}function Pe(e,t){var n=t&-t;return 0!==((n=0!==(42&n)?1:Me(n))&(e.suspendedLanes|t))?0:n}function Me(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Le(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Be(){var e=P.p;return 0!==e?e:void 0===(e=window.event)?32:_d(e.type)}function ze(e,t){var n=P.p;try{return P.p=e,t()}finally{P.p=n}}var We=Math.random().toString(36).slice(2),Ue="__reactFiber$"+We,je="__reactProps$"+We,Ve="__reactContainer$"+We,He="__reactEvents$"+We,Ge="__reactListeners$"+We,qe="__reactHandles$"+We,Ke="__reactResources$"+We,$e="__reactMarker$"+We;function Xe(e){delete e[Ue],delete e[je],delete e[He],delete e[Ge],delete e[qe]}function Ye(e){var t=e[Ue];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ve]||n[Ue]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Lf(e);null!==e;){if(n=e[Ue])return n;e=Lf(e)}return t}n=(e=n).parentNode}return null}function Qe(e){if(e=e[Ue]||e[Ve]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Je(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(i(33))}function Ze(e){var t=e[Ke];return t||(t=e[Ke]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function et(e){e[$e]=!0}var tt=new Set,nt={};function rt(e,t){ot(e,t),ot(e+"Capture",t)}function ot(e,t){for(nt[e]=t,e=0;e<t.length;e++)tt.add(t[e])}var at=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),it={},st={};function ut(e,t,n){if(o=t,re.call(st,o)||!re.call(it,o)&&(at.test(o)?st[o]=!0:(it[o]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var o}function lt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ct(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function ft(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=dt(e)?"checked":"value";e._valueTracker=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var o=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){n=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=dt(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function vt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var mt=/[\n"\\]/g;function gt(e){return e.replace(mt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function yt(e,t,n,r,o,a,i,s){e.name="",null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i?e.type=i:e.removeAttribute("type"),null!=t?"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ft(t)):e.value!==""+ft(t)&&(e.value=""+ft(t)):"submit"!==i&&"reset"!==i||e.removeAttribute("value"),null!=t?xt(e,i,ft(t)):null!=n?xt(e,i,ft(n)):null!=r&&e.removeAttribute("value"),null==o&&null!=a&&(e.defaultChecked=!!a),null!=o&&(e.checked=o&&"function"!==typeof o&&"symbol"!==typeof o),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+ft(s):e.removeAttribute("name")}function bt(e,t,n,r,o,a,i,s){if(null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.type=a),null!=t||null!=n){if(!("submit"!==a&&"reset"!==a||void 0!==t&&null!==t))return void pt(e);n=null!=n?""+ft(n):"",t=null!=t?""+ft(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:o)&&"symbol"!==typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i&&(e.name=i),pt(e)}function xt(e,t,n){"number"===t&&vt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function wt(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ft(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function Et(e,t,n){null==t||((t=""+ft(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ft(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function Ct(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(i(92));if(O(r)){if(1<r.length)throw Error(i(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=ft(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r),pt(e)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var kt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Rt(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||kt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function _t(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(i(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var o in t)r=t[o],t.hasOwnProperty(o)&&n[o]!==r&&Rt(e,o,r)}else for(var a in t)t.hasOwnProperty(a)&&Rt(e,a,t[a])}function It(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function At(e){return Tt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Dt(){}var Ot=null;function Ft(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Pt=null,Mt=null;function Lt(e){var t=Qe(e);if(t&&(e=t.stateNode)){var n=e[je]||null;e:switch(e=t.stateNode,t.type){case"input":if(yt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+gt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=r[je]||null;if(!o)throw Error(i(90));yt(r,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ht(r)}break e;case"textarea":Et(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&wt(e,!!n.multiple,t,!1)}}}var Bt=!1;function zt(e,t,n){if(Bt)return e(t,n);Bt=!0;try{return e(t)}finally{if(Bt=!1,(null!==Pt||null!==Mt)&&(Zl(),Pt&&(t=Pt,e=Mt,Mt=Pt=null,Lt(t),e)))for(t=0;t<e.length;t++)Lt(e[t])}}function Wt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[je]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Ut=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),jt=!1;if(Ut)try{var Vt={};Object.defineProperty(Vt,"passive",{get:function(){jt=!0}}),window.addEventListener("test",Vt,Vt),window.removeEventListener("test",Vt,Vt)}catch(Jd){jt=!1}var Ht=null,Gt=null,qt=null;function Kt(){if(qt)return qt;var e,t,n=Gt,r=n.length,o="value"in Ht?Ht.value:Ht.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return qt=o.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Xt(){return!0}function Yt(){return!1}function Qt(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?Xt:Yt,this.isPropagationStopped=Yt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Xt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Xt)},persist:function(){},isPersistent:Xt}),t}var Jt,Zt,en,tn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nn=Qt(tn),rn=p({},tn,{view:0,detail:0}),on=Qt(rn),an=p({},rn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==en&&(en&&"mousemove"===e.type?(Jt=e.screenX-en.screenX,Zt=e.screenY-en.screenY):Zt=Jt=0,en=e),Jt)},movementY:function(e){return"movementY"in e?e.movementY:Zt}}),sn=Qt(an),un=Qt(p({},an,{dataTransfer:0})),ln=Qt(p({},rn,{relatedTarget:0})),cn=Qt(p({},tn,{animationName:0,elapsedTime:0,pseudoElement:0})),fn=Qt(p({},tn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),dn=Qt(p({},tn,{data:0})),pn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=vn[e])&&!!t[e]}function gn(){return mn}var yn=Qt(p({},rn,{key:function(e){if(e.key){var t=pn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gn,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),bn=Qt(p({},an,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),xn=Qt(p({},rn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gn})),wn=Qt(p({},tn,{propertyName:0,elapsedTime:0,pseudoElement:0})),En=Qt(p({},an,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Cn=Qt(p({},tn,{newState:0,oldState:0})),Sn=[9,13,27,32],kn=Ut&&"CompositionEvent"in window,Rn=null;Ut&&"documentMode"in document&&(Rn=document.documentMode);var _n=Ut&&"TextEvent"in window&&!Rn,In=Ut&&(!kn||Rn&&8<Rn&&11>=Rn),Nn=String.fromCharCode(32),Tn=!1;function An(e,t){switch(e){case"keyup":return-1!==Sn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var On=!1;var Fn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Fn[e.type]:"textarea"===t}function Mn(e,t,n,r){Pt?Mt?Mt.push(r):Mt=[r]:Pt=r,0<(t=rf(t,"onChange")).length&&(n=new nn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ln=null,Bn=null;function zn(e){Xc(e,0)}function Wn(e){if(ht(Je(e)))return e}function Un(e,t){if("change"===e)return t}var jn=!1;if(Ut){var Vn;if(Ut){var Hn="oninput"in document;if(!Hn){var Gn=document.createElement("div");Gn.setAttribute("oninput","return;"),Hn="function"===typeof Gn.oninput}Vn=Hn}else Vn=!1;jn=Vn&&(!document.documentMode||9<document.documentMode)}function qn(){Ln&&(Ln.detachEvent("onpropertychange",Kn),Bn=Ln=null)}function Kn(e){if("value"===e.propertyName&&Wn(Bn)){var t=[];Mn(t,Bn,e,Ft(e)),zt(zn,t)}}function $n(e,t,n){"focusin"===e?(qn(),Bn=n,(Ln=t).attachEvent("onpropertychange",Kn)):"focusout"===e&&qn()}function Xn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Wn(Bn)}function Yn(e,t){if("click"===e)return Wn(t)}function Qn(e,t){if("input"===e||"change"===e)return Wn(t)}var Jn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Zn(e,t){if(Jn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!re.call(t,o)||!Jn(e[o],t[o]))return!1}return!0}function er(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function tr(e,t){var n,r=er(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=er(r)}}function nr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?nr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function rr(e){for(var t=vt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=vt((e=t.contentWindow).document)}return t}function or(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ar=Ut&&"documentMode"in document&&11>=document.documentMode,ir=null,sr=null,ur=null,lr=!1;function cr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;lr||null==ir||ir!==vt(r)||("selectionStart"in(r=ir)&&or(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},ur&&Zn(ur,r)||(ur=r,0<(r=rf(sr,"onSelect")).length&&(t=new nn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ir)))}function fr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var dr={animationend:fr("Animation","AnimationEnd"),animationiteration:fr("Animation","AnimationIteration"),animationstart:fr("Animation","AnimationStart"),transitionrun:fr("Transition","TransitionRun"),transitionstart:fr("Transition","TransitionStart"),transitioncancel:fr("Transition","TransitionCancel"),transitionend:fr("Transition","TransitionEnd")},pr={},hr={};function vr(e){if(pr[e])return pr[e];if(!dr[e])return e;var t,n=dr[e];for(t in n)if(n.hasOwnProperty(t)&&t in hr)return pr[e]=n[t];return e}Ut&&(hr=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition);var mr=vr("animationend"),gr=vr("animationiteration"),yr=vr("animationstart"),br=vr("transitionrun"),xr=vr("transitionstart"),wr=vr("transitioncancel"),Er=vr("transitionend"),Cr=new Map,Sr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(e,t){Cr.set(e,t),rt(t,[e])}Sr.push("scrollEnd");var Rr="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},_r=[],Ir=0,Nr=0;function Tr(){for(var e=Ir,t=Nr=Ir=0;t<e;){var n=_r[t];_r[t++]=null;var r=_r[t];_r[t++]=null;var o=_r[t];_r[t++]=null;var a=_r[t];if(_r[t++]=null,null!==r&&null!==o){var i=r.pending;null===i?o.next=o:(o.next=i.next,i.next=o),r.pending=o}0!==a&&Fr(n,o,a)}}function Ar(e,t,n,r){_r[Ir++]=e,_r[Ir++]=t,_r[Ir++]=n,_r[Ir++]=r,Nr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Dr(e,t,n,r){return Ar(e,t,n,r),Pr(e)}function Or(e,t){return Ar(e,null,null,t),Pr(e)}function Fr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var o=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(o=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,o&&null!==t&&(o=31-xe(n),null===(r=(e=a.hiddenUpdates)[o])?e[o]=[t]:r.push(t),t.lane=536870912|n),a):null}function Pr(e){if(50<Hl)throw Hl=0,Gl=null,Error(i(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Mr={};function Lr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Br(e,t,n,r){return new Lr(e,t,n,r)}function zr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Wr(e,t){var n=e.alternate;return null===n?((n=Br(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Ur(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function jr(e,t,n,r,o,a){var s=0;if(r=e,"function"===typeof e)zr(e)&&(s=1);else if("string"===typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,H.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case _:return(e=Br(31,n,t,o)).elementType=_,e.lanes=a,e;case g:return Vr(n.children,o,a,t);case y:s=8,o|=24;break;case b:return(e=Br(12,n,t,2|o)).elementType=b,e.lanes=a,e;case C:return(e=Br(13,n,t,o)).elementType=C,e.lanes=a,e;case S:return(e=Br(19,n,t,o)).elementType=S,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case w:s=10;break e;case x:s=9;break e;case E:s=11;break e;case k:s=14;break e;case R:s=16,r=null;break e}s=29,n=Error(i(130,null===e?"null":typeof e,"")),r=null}return(t=Br(s,n,t,o)).elementType=e,t.type=r,t.lanes=a,t}function Vr(e,t,n,r){return(e=Br(7,e,r,t)).lanes=n,e}function Hr(e,t,n){return(e=Br(6,e,null,t)).lanes=n,e}function Gr(e){var t=Br(18,null,null,0);return t.stateNode=e,t}function qr(e,t,n){return(t=Br(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Kr=new WeakMap;function $r(e,t){if("object"===typeof e&&null!==e){var n=Kr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ne(t)},Kr.set(e,t),t)}return{value:e,source:t,stack:ne(t)}}var Xr=[],Yr=0,Qr=null,Jr=0,Zr=[],eo=0,to=null,no=1,ro="";function oo(e,t){Xr[Yr++]=Jr,Xr[Yr++]=Qr,Qr=e,Jr=t}function ao(e,t,n){Zr[eo++]=no,Zr[eo++]=ro,Zr[eo++]=to,to=e;var r=no;e=ro;var o=32-xe(r)-1;r&=~(1<<o),n+=1;var a=32-xe(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,no=1<<32-xe(t)+o|n<<o|r,ro=a+e}else no=1<<a|n<<o|r,ro=e}function io(e){null!==e.return&&(oo(e,1),ao(e,1,0))}function so(e){for(;e===Qr;)Qr=Xr[--Yr],Xr[Yr]=null,Jr=Xr[--Yr],Xr[Yr]=null;for(;e===to;)to=Zr[--eo],Zr[eo]=null,ro=Zr[--eo],Zr[eo]=null,no=Zr[--eo],Zr[eo]=null}function uo(e,t){Zr[eo++]=no,Zr[eo++]=ro,Zr[eo++]=to,no=t.id,ro=t.overflow,to=e}var lo=null,co=null,fo=!1,po=null,ho=!1,vo=Error(i(519));function mo(e){throw Eo($r(Error(i(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),vo}function go(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Ue]=e,t[je]=r,n){case"dialog":Yc("cancel",t),Yc("close",t);break;case"iframe":case"object":case"embed":Yc("load",t);break;case"video":case"audio":for(n=0;n<Kc.length;n++)Yc(Kc[n],t);break;case"source":Yc("error",t);break;case"img":case"image":case"link":Yc("error",t),Yc("load",t);break;case"details":Yc("toggle",t);break;case"input":Yc("invalid",t),bt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":Yc("invalid",t);break;case"textarea":Yc("invalid",t),Ct(t,r.value,r.defaultValue,r.children)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||cf(t.textContent,n)?(null!=r.popover&&(Yc("beforetoggle",t),Yc("toggle",t)),null!=r.onScroll&&Yc("scroll",t),null!=r.onScrollEnd&&Yc("scrollend",t),null!=r.onClick&&(t.onclick=Dt),t=!0):t=!1,t||mo(e,!0)}function yo(e){for(lo=e.return;lo;)switch(lo.tag){case 5:case 31:case 13:return void(ho=!1);case 27:case 3:return void(ho=!0);default:lo=lo.return}}function bo(e){if(e!==lo)return!1;if(!fo)return yo(e),fo=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||xf(e.type,e.memoizedProps)),t=!t),t&&co&&mo(e),yo(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));co=Mf(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));co=Mf(e)}else 27===n?(n=co,_f(e.type)?(e=Pf,Pf=null,co=e):co=n):co=lo?Ff(e.stateNode.nextSibling):null;return!0}function xo(){co=lo=null,fo=!1}function wo(){var e=po;return null!==e&&(null===Tl?Tl=e:Tl.push.apply(Tl,e),po=null),e}function Eo(e){null===po?po=[e]:po.push(e)}var Co=z(null),So=null,ko=null;function Ro(e,t,n){U(Co,t._currentValue),t._currentValue=n}function _o(e){e._currentValue=Co.current,W(Co)}function Io(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function No(e,t,n,r){var o=e.child;for(null!==o&&(o.return=e);null!==o;){var a=o.dependencies;if(null!==a){var s=o.child;a=a.firstContext;e:for(;null!==a;){var u=a;a=o;for(var l=0;l<t.length;l++)if(u.context===t[l]){a.lanes|=n,null!==(u=a.alternate)&&(u.lanes|=n),Io(a.return,n,e),r||(s=null);break e}a=u.next}}else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(a=s.alternate)&&(a.lanes|=n),Io(s,n,e),s=null}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===e){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}}function To(e,t,n,r){e=null;for(var o=t,a=!1;null!==o;){if(!a)if(0!==(524288&o.flags))a=!0;else if(0!==(262144&o.flags))break;if(10===o.tag){var s=o.alternate;if(null===s)throw Error(i(387));if(null!==(s=s.memoizedProps)){var u=o.type;Jn(o.pendingProps.value,s.value)||(null!==e?e.push(u):e=[u])}}else if(o===K.current){if(null===(s=o.alternate))throw Error(i(387));s.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(null!==e?e.push(fd):e=[fd])}o=o.return}null!==e&&No(t,e,n,r),t.flags|=262144}function Ao(e){for(e=e.firstContext;null!==e;){if(!Jn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Do(e){So=e,ko=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Oo(e){return Po(So,e)}function Fo(e,t){return null===So&&Do(e),Po(e,t)}function Po(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===ko){if(null===e)throw Error(i(308));ko=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ko=ko.next=t;return n}var Mo="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Lo=r.unstable_scheduleCallback,Bo=r.unstable_NormalPriority,zo={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wo(){return{controller:new Mo,data:new Map,refCount:0}}function Uo(e){e.refCount--,0===e.refCount&&Lo(Bo,function(){e.controller.abort()})}var jo=null,Vo=0,Ho=0,Go=null;function qo(){if(0===--Vo&&null!==jo){null!==Go&&(Go.status="fulfilled");var e=jo;jo=null,Ho=0,Go=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Ko=F.S;F.S=function(e,t){Ol=ue(),"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===jo){var n=jo=[];Vo=0,Ho=jc(),Go={status:"pending",value:void 0,then:function(e){n.push(e)}}}Vo++,t.then(qo,qo)}(0,t),null!==Ko&&Ko(e,t)};var $o=z(null);function Xo(){var e=$o.current;return null!==e?e:hl.pooledCache}function Yo(e,t){U($o,null===t?$o.current:t.pool)}function Qo(){var e=Xo();return null===e?null:{parent:zo._currentValue,pool:e}}var Jo=Error(i(460)),Zo=Error(i(474)),ea=Error(i(542)),ta={then:function(){}};function na(e){return"fulfilled"===(e=e.status)||"rejected"===e}function ra(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Dt,Dt),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw sa(e=t.reason),e;default:if("string"===typeof t.status)t.then(Dt,Dt);else{if(null!==(e=hl)&&100<e.shellSuspendCounter)throw Error(i(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw sa(e=t.reason),e}throw aa=t,Jo}}function oa(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"===typeof t&&"function"===typeof t.then)throw aa=t,Jo;throw t}}var aa=null;function ia(){if(null===aa)throw Error(i(459));var e=aa;return aa=null,e}function sa(e){if(e===Jo||e===ea)throw Error(i(483))}var ua=null,la=0;function ca(e){var t=la;return la+=1,null===ua&&(ua=[]),ra(ua,e,t)}function fa(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function da(e,t){if(t.$$typeof===h)throw Error(i(525));throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function o(e,t){return(e=Wr(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Hr(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===g?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===R&&oa(a)===t.type)?(fa(t=o(t,n.props),n),t.return=e,t):(fa(t=jr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=qr(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function f(e,t,n,r,a){return null===t||7!==t.tag?((t=Vr(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Hr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case v:return fa(n=jr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case m:return(t=qr(t,e.mode,n)).return=e,t;case R:return d(e,t=oa(t),n)}if(O(t)||T(t))return(t=Vr(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return d(e,ca(t),n);if(t.$$typeof===w)return d(e,Fo(e,t),n);da(e,t)}return null}function p(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==o?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case v:return n.key===o?l(e,t,n,r):null;case m:return n.key===o?c(e,t,n,r):null;case R:return p(e,t,n=oa(n),r)}if(O(n)||T(n))return null!==o?null:f(e,t,n,r,null);if("function"===typeof n.then)return p(e,t,ca(n),r);if(n.$$typeof===w)return p(e,t,Fo(e,n),r);da(e,n)}return null}function h(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return u(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case v:return l(t,e=e.get(null===r.key?n:r.key)||null,r,o);case m:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case R:return h(e,t,n,r=oa(r),o)}if(O(r)||T(r))return f(t,e=e.get(n)||null,r,o,null);if("function"===typeof r.then)return h(e,t,n,ca(r),o);if(r.$$typeof===w)return h(e,t,n,Fo(t,r),o);da(t,r)}return null}function y(u,l,c,f){if("object"===typeof c&&null!==c&&c.type===g&&null===c.key&&(c=c.props.children),"object"===typeof c&&null!==c){switch(c.$$typeof){case v:e:{for(var b=c.key;null!==l;){if(l.key===b){if((b=c.type)===g){if(7===l.tag){n(u,l.sibling),(f=o(l,c.props.children)).return=u,u=f;break e}}else if(l.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===R&&oa(b)===l.type){n(u,l.sibling),fa(f=o(l,c.props),c),f.return=u,u=f;break e}n(u,l);break}t(u,l),l=l.sibling}c.type===g?((f=Vr(c.props.children,u.mode,f,c.key)).return=u,u=f):(fa(f=jr(c.type,c.key,c.props,null,u.mode,f),c),f.return=u,u=f)}return s(u);case m:e:{for(b=c.key;null!==l;){if(l.key===b){if(4===l.tag&&l.stateNode.containerInfo===c.containerInfo&&l.stateNode.implementation===c.implementation){n(u,l.sibling),(f=o(l,c.children||[])).return=u,u=f;break e}n(u,l);break}t(u,l),l=l.sibling}(f=qr(c,u.mode,f)).return=u,u=f}return s(u);case R:return y(u,l,c=oa(c),f)}if(O(c))return function(o,i,s,u){for(var l=null,c=null,f=i,v=i=0,m=null;null!==f&&v<s.length;v++){f.index>v?(m=f,f=null):m=f.sibling;var g=p(o,f,s[v],u);if(null===g){null===f&&(f=m);break}e&&f&&null===g.alternate&&t(o,f),i=a(g,i,v),null===c?l=g:c.sibling=g,c=g,f=m}if(v===s.length)return n(o,f),fo&&oo(o,v),l;if(null===f){for(;v<s.length;v++)null!==(f=d(o,s[v],u))&&(i=a(f,i,v),null===c?l=f:c.sibling=f,c=f);return fo&&oo(o,v),l}for(f=r(f);v<s.length;v++)null!==(m=h(f,o,v,s[v],u))&&(e&&null!==m.alternate&&f.delete(null===m.key?v:m.key),i=a(m,i,v),null===c?l=m:c.sibling=m,c=m);return e&&f.forEach(function(e){return t(o,e)}),fo&&oo(o,v),l}(u,l,c,f);if(T(c)){if("function"!==typeof(b=T(c)))throw Error(i(150));return function(o,s,u,l){if(null==u)throw Error(i(151));for(var c=null,f=null,v=s,m=s=0,g=null,y=u.next();null!==v&&!y.done;m++,y=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var b=p(o,v,y.value,l);if(null===b){null===v&&(v=g);break}e&&v&&null===b.alternate&&t(o,v),s=a(b,s,m),null===f?c=b:f.sibling=b,f=b,v=g}if(y.done)return n(o,v),fo&&oo(o,m),c;if(null===v){for(;!y.done;m++,y=u.next())null!==(y=d(o,y.value,l))&&(s=a(y,s,m),null===f?c=y:f.sibling=y,f=y);return fo&&oo(o,m),c}for(v=r(v);!y.done;m++,y=u.next())null!==(y=h(v,o,m,y.value,l))&&(e&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=a(y,s,m),null===f?c=y:f.sibling=y,f=y);return e&&v.forEach(function(e){return t(o,e)}),fo&&oo(o,m),c}(u,l,c=b.call(c),f)}if("function"===typeof c.then)return y(u,l,ca(c),f);if(c.$$typeof===w)return y(u,l,Fo(u,c),f);da(u,c)}return"string"===typeof c&&""!==c||"number"===typeof c||"bigint"===typeof c?(c=""+c,null!==l&&6===l.tag?(n(u,l.sibling),(f=o(l,c)).return=u,u=f):(n(u,l),(f=Hr(c,u.mode,f)).return=u,u=f),s(u)):n(u,l)}return function(e,t,n,r){try{la=0;var o=y(e,t,n,r);return ua=null,o}catch(i){if(i===Jo||i===ea)throw i;var a=Br(29,i,null,e.mode);return a.lanes=r,a.return=e,a}}}var ha=pa(!0),va=pa(!1),ma=!1;function ga(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ya(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ba(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function xa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&pl)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,t=Pr(e),Fr(e,null,n),t}return Ar(e,r,t,n),Pr(e)}function wa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Fe(e,n)}}function Ea(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Ca=!1;function Sa(){if(Ca){if(null!==Go)throw Go}}function ka(e,t,n,r){Ca=!1;var o=e.updateQueue;ma=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var u=s,l=u.next;u.next=null,null===i?a=l:i.next=l,i=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==i&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==a){var f=o.baseState;for(i=0,c=l=u=null,s=a;;){var d=-536870913&s.lane,h=d!==s.lane;if(h?(ml&d)===d:(r&d)===d){0!==d&&d===Ho&&(Ca=!0),null!==c&&(c=c.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var v=e,m=s;d=t;var g=n;switch(m.tag){case 1:if("function"===typeof(v=m.payload)){f=v.call(g,f,d);break e}f=v;break e;case 3:v.flags=-65537&v.flags|128;case 0:if(null===(d="function"===typeof(v=m.payload)?v.call(g,f,d):v)||void 0===d)break e;f=p({},f,d);break e;case 2:ma=!0}}null!==(d=s.callback)&&(e.flags|=64,h&&(e.flags|=8192),null===(h=o.callbacks)?o.callbacks=[d]:h.push(d))}else h={lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=h,u=f):c=c.next=h,i|=d;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(h=s).next,h.next=null,o.lastBaseUpdate=h,o.shared.pending=null}}null===c&&(u=f),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,null===a&&(o.shared.lanes=0),Sl|=i,e.lanes=i,e.memoizedState=f}}function Ra(e,t){if("function"!==typeof e)throw Error(i(191,e));e.call(t)}function _a(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Ra(n[e],t)}var Ia=z(null),Na=z(0);function Ta(e,t){U(Na,e=El),U(Ia,t),El=e|t.baseLanes}function Aa(){U(Na,El),U(Ia,Ia.current)}function Da(){El=Na.current,W(Ia),W(Na)}var Oa=z(null),Fa=null;function Pa(e){var t=e.alternate;U(Wa,1&Wa.current),U(Oa,e),null===Fa&&(null===t||null!==Ia.current||null!==t.memoizedState)&&(Fa=e)}function Ma(e){U(Wa,Wa.current),U(Oa,e),null===Fa&&(Fa=e)}function La(e){22===e.tag?(U(Wa,Wa.current),U(Oa,e),null===Fa&&(Fa=e)):Ba()}function Ba(){U(Wa,Wa.current),U(Oa,Oa.current)}function za(e){W(Oa),Fa===e&&(Fa=null),W(Wa)}var Wa=z(0);function Ua(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Df(n)||Of(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(0!==(128&t.flags))return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ja=0,Va=null,Ha=null,Ga=null,qa=!1,Ka=!1,$a=!1,Xa=0,Ya=0,Qa=null,Ja=0;function Za(){throw Error(i(321))}function ei(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jn(e[n],t[n]))return!1;return!0}function ti(e,t,n,r,o,a){return ja=a,Va=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,F.H=null===e||null===e.memoizedState?ms:gs,$a=!1,a=n(r,o),$a=!1,Ka&&(a=ri(t,n,r,o)),ni(e),a}function ni(e){F.H=vs;var t=null!==Ha&&null!==Ha.next;if(ja=0,Ga=Ha=Va=null,qa=!1,Ya=0,Qa=null,t)throw Error(i(300));null===e||Os||null!==(e=e.dependencies)&&Ao(e)&&(Os=!0)}function ri(e,t,n,r){Va=e;var o=0;do{if(Ka&&(Qa=null),Ya=0,Ka=!1,25<=o)throw Error(i(301));if(o+=1,Ga=Ha=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}F.H=ys,a=t(n,r)}while(Ka);return a}function oi(){var e=F.H,t=e.useState()[0];return t="function"===typeof t.then?ci(t):t,e=e.useState()[0],(null!==Ha?Ha.memoizedState:null)!==e&&(Va.flags|=1024),t}function ai(){var e=0!==Xa;return Xa=0,e}function ii(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function si(e){if(qa){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}qa=!1}ja=0,Ga=Ha=Va=null,Ka=!1,Ya=Xa=0,Qa=null}function ui(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ga?Va.memoizedState=Ga=e:Ga=Ga.next=e,Ga}function li(){if(null===Ha){var e=Va.alternate;e=null!==e?e.memoizedState:null}else e=Ha.next;var t=null===Ga?Va.memoizedState:Ga.next;if(null!==t)Ga=t,Ha=e;else{if(null===e){if(null===Va.alternate)throw Error(i(467));throw Error(i(310))}e={memoizedState:(Ha=e).memoizedState,baseState:Ha.baseState,baseQueue:Ha.baseQueue,queue:Ha.queue,next:null},null===Ga?Va.memoizedState=Ga=e:Ga=Ga.next=e}return Ga}function ci(e){var t=Ya;return Ya+=1,null===Qa&&(Qa=[]),e=ra(Qa,e,t),t=Va,null===(null===Ga?t.memoizedState:Ga.next)&&(t=t.alternate,F.H=null===t||null===t.memoizedState?ms:gs),e}function fi(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return ci(e);if(e.$$typeof===w)return Oo(e)}throw Error(i(438,String(e)))}function di(e){var t=null,n=Va.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=Va.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Va.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=I;return t.index++,n}function pi(e,t){return"function"===typeof t?t(e):t}function hi(e){return vi(li(),Ha,e)}function vi(e,t,n){var r=e.queue;if(null===r)throw Error(i(311));r.lastRenderedReducer=n;var o=e.baseQueue,a=r.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}t.baseQueue=o=a,r.pending=null}if(a=e.baseState,null===o)e.memoizedState=a;else{var u=s=null,l=null,c=t=o.next,f=!1;do{var d=-536870913&c.lane;if(d!==c.lane?(ml&d)===d:(ja&d)===d){var p=c.revertLane;if(0===p)null!==l&&(l=l.next={lane:0,revertLane:0,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Ho&&(f=!0);else{if((ja&p)===p){c=c.next,p===Ho&&(f=!0);continue}d={lane:0,revertLane:c.revertLane,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(u=l=d,s=a):l=l.next=d,Va.lanes|=p,Sl|=p}d=c.action,$a&&n(a,d),a=c.hasEagerState?c.eagerState:n(a,d)}else p={lane:d,revertLane:c.revertLane,gesture:c.gesture,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(u=l=p,s=a):l=l.next=p,Va.lanes|=d,Sl|=d;c=c.next}while(null!==c&&c!==t);if(null===l?s=a:l.next=u,!Jn(a,e.memoizedState)&&(Os=!0,f&&null!==(n=Go)))throw n;e.memoizedState=a,e.baseState=s,e.baseQueue=l,r.lastRenderedState=a}return null===o&&(r.lanes=0),[e.memoizedState,r.dispatch]}function mi(e){var t=li(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,a=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{a=e(a,s.action),s=s.next}while(s!==o);Jn(a,t.memoizedState)||(Os=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function gi(e,t,n){var r=Va,o=li(),a=fo;if(a){if(void 0===n)throw Error(i(407));n=n()}else n=t();var s=!Jn((Ha||o).memoizedState,n);if(s&&(o.memoizedState=n,Os=!0),o=o.queue,ji(xi.bind(null,r,o,e),[e]),o.getSnapshot!==t||s||null!==Ga&&1&Ga.memoizedState.tag){if(r.flags|=2048,Li(9,{destroy:void 0},bi.bind(null,r,o,n,t),null),null===hl)throw Error(i(349));a||0!==(127&ja)||yi(r,t,n)}return n}function yi(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Va.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Va.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function bi(e,t,n,r){t.value=n,t.getSnapshot=r,wi(t)&&Ei(e)}function xi(e,t,n){return n(function(){wi(t)&&Ei(e)})}function wi(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Jn(e,n)}catch(r){return!0}}function Ei(e){var t=Or(e,2);null!==t&&$l(t,e,2)}function Ci(e){var t=ui();if("function"===typeof e){var n=e;if(e=n(),$a){be(!0);try{n()}finally{be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:e},t}function Si(e,t,n,r){return e.baseState=n,vi(e,Ha,"function"===typeof r?r:pi)}function ki(e,t,n,r,o){if(ds(e))throw Error(i(485));if(null!==(e=t.action)){var a={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==F.T?n(!0):a.isTransition=!1,r(a),null===(n=t.pending)?(a.next=t.pending=a,Ri(t,a)):(a.next=n.next,t.pending=n.next=a)}}function Ri(e,t){var n=t.action,r=t.payload,o=e.state;if(t.isTransition){var a=F.T,i={};F.T=i;try{var s=n(o,r),u=F.S;null!==u&&u(i,s),_i(e,t,s)}catch(l){Ni(e,t,l)}finally{null!==a&&null!==i.types&&(a.types=i.types),F.T=a}}else try{_i(e,t,a=n(o,r))}catch(c){Ni(e,t,c)}}function _i(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){Ii(e,t,n)},function(n){return Ni(e,t,n)}):Ii(e,t,n)}function Ii(e,t,n){t.status="fulfilled",t.value=n,Ti(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Ri(e,n)))}function Ni(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Ti(t),t=t.next}while(t!==r)}e.action=null}function Ti(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Ai(e,t){return t}function Di(e,t){if(fo){var n=hl.formState;if(null!==n){e:{var r=Va;if(fo){if(co){t:{for(var o=co,a=ho;8!==o.nodeType;){if(!a){o=null;break t}if(null===(o=Ff(o.nextSibling))){o=null;break t}}o="F!"===(a=o.data)||"F"===a?o:null}if(o){co=Ff(o.nextSibling),r="F!"===o.data;break e}}mo(r)}r=!1}r&&(t=n[0])}}return(n=ui()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ai,lastRenderedState:t},n.queue=r,n=ls.bind(null,Va,r),r.dispatch=n,r=Ci(!1),a=fs.bind(null,Va,!1,r.queue),o={state:t,dispatch:null,action:e,pending:null},(r=ui()).queue=o,n=ki.bind(null,Va,o,a,n),o.dispatch=n,r.memoizedState=e,[t,n,!1]}function Oi(e){return Fi(li(),Ha,e)}function Fi(e,t,n){if(t=vi(e,t,Ai)[0],e=hi(pi)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=ci(t)}catch(i){if(i===Jo)throw ea;throw i}else r=t;var o=(t=li()).queue,a=o.dispatch;return n!==t.memoizedState&&(Va.flags|=2048,Li(9,{destroy:void 0},Pi.bind(null,o,n),null)),[r,a,e]}function Pi(e,t){e.action=t}function Mi(e){var t=li(),n=Ha;if(null!==n)return Fi(t,n,e);li(),t=t.memoizedState;var r=(n=li()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function Li(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=Va.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Va.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bi(){return li().memoizedState}function zi(e,t,n,r){var o=ui();Va.flags|=e,o.memoizedState=Li(1|t,{destroy:void 0},n,void 0===r?null:r)}function Wi(e,t,n,r){var o=li();r=void 0===r?null:r;var a=o.memoizedState.inst;null!==Ha&&null!==r&&ei(r,Ha.memoizedState.deps)?o.memoizedState=Li(t,a,n,r):(Va.flags|=e,o.memoizedState=Li(1|t,a,n,r))}function Ui(e,t){zi(8390656,8,e,t)}function ji(e,t){Wi(2048,8,e,t)}function Vi(e){var t=li().memoizedState;return function(e){Va.flags|=4;var t=Va.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Va.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(0!==(2&pl))throw Error(i(440));return t.impl.apply(void 0,arguments)}}function Hi(e,t){return Wi(4,2,e,t)}function Gi(e,t){return Wi(4,4,e,t)}function qi(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ki(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Wi(4,4,qi.bind(null,t,e),n)}function $i(){}function Xi(e,t){var n=li();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&ei(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Yi(e,t){var n=li();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&ei(t,r[1]))return r[0];if(r=e(),$a){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[r,t],r}function Qi(e,t,n){return void 0===n||0!==(1073741824&ja)&&0===(261930&ml)?e.memoizedState=t:(e.memoizedState=n,e=Kl(),Va.lanes|=e,Sl|=e,n)}function Ji(e,t,n,r){return Jn(n,t)?n:null!==Ia.current?(e=Qi(e,n,r),Jn(e,t)||(Os=!0),e):0===(42&ja)||0!==(1073741824&ja)&&0===(261930&ml)?(Os=!0,e.memoizedState=n):(e=Kl(),Va.lanes|=e,Sl|=e,t)}function Zi(e,t,n,r,o){var a=P.p;P.p=0!==a&&8>a?a:8;var i=F.T,s={};F.T=s,fs(e,!1,t,n);try{var u=o(),l=F.S;if(null!==l&&l(s,u),null!==u&&"object"===typeof u&&"function"===typeof u.then)cs(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(u,r),ql());else cs(e,t,r,ql())}catch(c){cs(e,t,{then:function(){},status:"rejected",reason:c},ql())}finally{P.p=a,null!==i&&null!==s.types&&(i.types=s.types),F.T=i}}function es(){}function ts(e,t,n,r){if(5!==e.tag)throw Error(i(476));var o=ns(e).queue;Zi(e,o,t,M,null===n?es:function(){return rs(e),n(r)})}function ns(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:M},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function rs(e){var t=ns(e);null===t.next&&(t=e.alternate.memoizedState),cs(e,t.next.queue,{},ql())}function os(){return Oo(fd)}function as(){return li().memoizedState}function is(){return li().memoizedState}function ss(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=ql(),r=xa(t,e=ba(n),n);return null!==r&&($l(r,t,n),wa(r,t,n)),t={cache:Wo()},void(e.payload=t)}t=t.return}}function us(e,t,n){var r=ql();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ds(e)?ps(t,n):null!==(n=Dr(e,t,n,r))&&($l(n,e,r),hs(n,t,r))}function ls(e,t,n){cs(e,t,n,ql())}function cs(e,t,n,r){var o={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(ds(e))ps(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,Jn(s,i))return Ar(e,t,o,0),null===hl&&Tr(),!1}catch(u){}if(null!==(n=Dr(e,t,o,r)))return $l(n,e,r),hs(n,t,r),!0}return!1}function fs(e,t,n,r){if(r={lane:2,revertLane:jc(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},ds(e)){if(t)throw Error(i(479))}else null!==(t=Dr(e,n,r,2))&&$l(t,e,2)}function ds(e){var t=e.alternate;return e===Va||null!==t&&t===Va}function ps(e,t){Ka=qa=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function hs(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Fe(e,n)}}var vs={readContext:Oo,use:fi,useCallback:Za,useContext:Za,useEffect:Za,useImperativeHandle:Za,useLayoutEffect:Za,useInsertionEffect:Za,useMemo:Za,useReducer:Za,useRef:Za,useState:Za,useDebugValue:Za,useDeferredValue:Za,useTransition:Za,useSyncExternalStore:Za,useId:Za,useHostTransitionStatus:Za,useFormState:Za,useActionState:Za,useOptimistic:Za,useMemoCache:Za,useCacheRefresh:Za};vs.useEffectEvent=Za;var ms={readContext:Oo,use:fi,useCallback:function(e,t){return ui().memoizedState=[e,void 0===t?null:t],e},useContext:Oo,useEffect:Ui,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,zi(4194308,4,qi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return zi(4194308,4,e,t)},useInsertionEffect:function(e,t){zi(4,2,e,t)},useMemo:function(e,t){var n=ui();t=void 0===t?null:t;var r=e();if($a){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=ui();if(void 0!==n){var o=n(t);if($a){be(!0);try{n(t)}finally{be(!1)}}}else o=t;return r.memoizedState=r.baseState=o,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},r.queue=e,e=e.dispatch=us.bind(null,Va,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ui().memoizedState=e},useState:function(e){var t=(e=Ci(e)).queue,n=ls.bind(null,Va,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:$i,useDeferredValue:function(e,t){return Qi(ui(),e,t)},useTransition:function(){var e=Ci(!1);return e=Zi.bind(null,Va,e.queue,!0,!1),ui().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=Va,o=ui();if(fo){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===hl)throw Error(i(349));0!==(127&ml)||yi(r,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,Ui(xi.bind(null,r,a,e),[e]),r.flags|=2048,Li(9,{destroy:void 0},bi.bind(null,r,a,n,t),null),n},useId:function(){var e=ui(),t=hl.identifierPrefix;if(fo){var n=ro;t="_"+t+"R_"+(n=(no&~(1<<32-xe(no)-1)).toString(32)+n),0<(n=Xa++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Ja++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:os,useFormState:Di,useActionState:Di,useOptimistic:function(e){var t=ui();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=fs.bind(null,Va,!0,n),n.dispatch=t,[e,t]},useMemoCache:di,useCacheRefresh:function(){return ui().memoizedState=ss.bind(null,Va)},useEffectEvent:function(e){var t=ui(),n={impl:e};return t.memoizedState=n,function(){if(0!==(2&pl))throw Error(i(440));return n.impl.apply(void 0,arguments)}}},gs={readContext:Oo,use:fi,useCallback:Xi,useContext:Oo,useEffect:ji,useImperativeHandle:Ki,useInsertionEffect:Hi,useLayoutEffect:Gi,useMemo:Yi,useReducer:hi,useRef:Bi,useState:function(){return hi(pi)},useDebugValue:$i,useDeferredValue:function(e,t){return Ji(li(),Ha.memoizedState,e,t)},useTransition:function(){var e=hi(pi)[0],t=li().memoizedState;return["boolean"===typeof e?e:ci(e),t]},useSyncExternalStore:gi,useId:as,useHostTransitionStatus:os,useFormState:Oi,useActionState:Oi,useOptimistic:function(e,t){return Si(li(),0,e,t)},useMemoCache:di,useCacheRefresh:is};gs.useEffectEvent=Vi;var ys={readContext:Oo,use:fi,useCallback:Xi,useContext:Oo,useEffect:ji,useImperativeHandle:Ki,useInsertionEffect:Hi,useLayoutEffect:Gi,useMemo:Yi,useReducer:mi,useRef:Bi,useState:function(){return mi(pi)},useDebugValue:$i,useDeferredValue:function(e,t){var n=li();return null===Ha?Qi(n,e,t):Ji(n,Ha.memoizedState,e,t)},useTransition:function(){var e=mi(pi)[0],t=li().memoizedState;return["boolean"===typeof e?e:ci(e),t]},useSyncExternalStore:gi,useId:as,useHostTransitionStatus:os,useFormState:Mi,useActionState:Mi,useOptimistic:function(e,t){var n=li();return null!==Ha?Si(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:di,useCacheRefresh:is};function bs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:p({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}ys.useEffectEvent=Vi;var xs={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ql(),o=ba(r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=xa(e,o,r))&&($l(t,e,r),wa(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ql(),o=ba(r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=xa(e,o,r))&&($l(t,e,r),wa(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ql(),r=ba(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=xa(e,r,n))&&($l(t,e,n),wa(t,e,n))}};function ws(e,t,n,r,o,a,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!Zn(n,r)||!Zn(o,a))}function Es(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&xs.enqueueReplaceState(t,t.state,null)}function Cs(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var o in n===t&&(n=p({},n)),e)void 0===n[o]&&(n[o]=e[o]);return n}function Ss(e){Rr(e)}function ks(e){console.error(e)}function Rs(e){Rr(e)}function _s(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Is(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Ns(e,t,n){return(n=ba(n)).tag=3,n.payload={element:null},n.callback=function(){_s(e,t)},n}function Ts(e){return(e=ba(e)).tag=3,e}function As(e,t,n,r){var o=n.type.getDerivedStateFromError;if("function"===typeof o){var a=r.value;e.payload=function(){return o(a)},e.callback=function(){Is(t,n,r)}}var i=n.stateNode;null!==i&&"function"===typeof i.componentDidCatch&&(e.callback=function(){Is(t,n,r),"function"!==typeof o&&(null===Ml?Ml=new Set([this]):Ml.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Ds=Error(i(461)),Os=!1;function Fs(e,t,n,r){t.child=null===e?va(t,null,n,r):ha(t,e.child,n,r)}function Ps(e,t,n,r,o){n=n.render;var a=t.ref;if("ref"in r){var i={};for(var s in r)"ref"!==s&&(i[s]=r[s])}else i=r;return Do(t),r=ti(e,t,n,i,a,o),s=ai(),null===e||Os?(fo&&s&&io(t),t.flags|=1,Fs(e,t,r,o),t.child):(ii(e,t,o),ou(e,t,o))}function Ms(e,t,n,r,o){if(null===e){var a=n.type;return"function"!==typeof a||zr(a)||void 0!==a.defaultProps||null!==n.compare?((e=jr(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ls(e,t,a,r,o))}if(a=e.child,!au(e,o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:Zn)(i,r)&&e.ref===t.ref)return ou(e,t,o)}return t.flags|=1,(e=Wr(a,r)).ref=t.ref,e.return=t,t.child=e}function Ls(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(Zn(a,r)&&e.ref===t.ref){if(Os=!1,t.pendingProps=r=a,!au(e,o))return t.lanes=e.lanes,ou(e,t,o);0!==(131072&e.flags)&&(Os=!0)}}return Hs(e,t,n,r,o)}function Bs(e,t,n,r){var o=r.children,a=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===r.mode){if(0!==(128&t.flags)){if(a=null!==a?a.baseLanes|n:n,null!==e){for(r=t.child=e.child,o=0;null!==r;)o=o|r.lanes|r.childLanes,r=r.sibling;r=o&~a}else r=0,t.child=null;return Ws(e,t,a,n,r)}if(0===(536870912&n))return r=t.lanes=536870912,Ws(e,t,null!==a?a.baseLanes|n:n,n,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Yo(0,null!==a?a.cachePool:null),null!==a?Ta(t,a):Aa(),La(t)}else null!==a?(Yo(0,a.cachePool),Ta(t,a),Ba(),t.memoizedState=null):(null!==e&&Yo(0,null),Aa(),Ba());return Fs(e,t,o,n),t.child}function zs(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Ws(e,t,n,r,o){var a=Xo();return a=null===a?null:{parent:zo._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&Yo(0,null),Aa(),La(t),null!==e&&To(e,t,r,!0),t.childLanes=o,null}function Us(e,t){return(t=Zs({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function js(e,t,n){return ha(t,e.child,null,n),(e=Us(t,t.pendingProps)).flags|=2,za(t),t.memoizedState=null,e}function Vs(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(i(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Hs(e,t,n,r,o){return Do(t),n=ti(e,t,n,r,void 0,o),r=ai(),null===e||Os?(fo&&r&&io(t),t.flags|=1,Fs(e,t,n,o),t.child):(ii(e,t,o),ou(e,t,o))}function Gs(e,t,n,r,o,a){return Do(t),t.updateQueue=null,n=ri(t,r,n,o),ni(e),r=ai(),null===e||Os?(fo&&r&&io(t),t.flags|=1,Fs(e,t,n,a),t.child):(ii(e,t,a),ou(e,t,a))}function qs(e,t,n,r,o){if(Do(t),null===t.stateNode){var a=Mr,i=n.contextType;"object"===typeof i&&null!==i&&(a=Oo(i)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=xs,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},ga(t),i=n.contextType,a.context="object"===typeof i&&null!==i?Oo(i):Mr,a.state=t.memoizedState,"function"===typeof(i=n.getDerivedStateFromProps)&&(bs(t,n,i,r),a.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(i=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),i!==a.state&&xs.enqueueReplaceState(a,a.state,null),ka(t,r,a,o),Sa(),a.state=t.memoizedState),"function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,u=Cs(n,s);a.props=u;var l=a.context,c=n.contextType;i=Mr,"object"===typeof c&&null!==c&&(i=Oo(c));var f=n.getDerivedStateFromProps;c="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,c||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s||l!==i)&&Es(t,a,r,i),ma=!1;var d=t.memoizedState;a.state=d,ka(t,r,a,o),Sa(),l=t.memoizedState,s||d!==l||ma?("function"===typeof f&&(bs(t,n,f,r),l=t.memoizedState),(u=ma||ws(t,n,u,r,d,l,i))?(c||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=i,r=u):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,ya(e,t),c=Cs(n,i=t.memoizedProps),a.props=c,f=t.pendingProps,d=a.context,l=n.contextType,u=Mr,"object"===typeof l&&null!==l&&(u=Oo(l)),(l="function"===typeof(s=n.getDerivedStateFromProps)||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(i!==f||d!==u)&&Es(t,a,r,u),ma=!1,d=t.memoizedState,a.state=d,ka(t,r,a,o),Sa();var p=t.memoizedState;i!==f||d!==p||ma||null!==e&&null!==e.dependencies&&Ao(e.dependencies)?("function"===typeof s&&(bs(t,n,s,r),p=t.memoizedState),(c=ma||ws(t,n,c,r,d,p,u)||null!==e&&null!==e.dependencies&&Ao(e.dependencies))?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,u),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||i===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||i===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=u,r=c):("function"!==typeof a.componentDidUpdate||i===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||i===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Vs(e,t),r=0!==(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=ha(t,e.child,null,o),t.child=ha(t,null,n,o)):Fs(e,t,n,o),t.memoizedState=a.state,e=t.child):e=ou(e,t,o),e}function Ks(e,t,n,r){return xo(),t.flags|=256,Fs(e,t,n,r),t.child}var $s={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xs(e){return{baseLanes:e,cachePool:Qo()}}function Ys(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=_l),e}function Qs(e,t,n){var r,o=t.pendingProps,a=!1,s=0!==(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&0!==(2&Wa.current)),r&&(a=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(fo){if(a?Pa(t):Ba(),(e=co)?null!==(e=null!==(e=Af(e,ho))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==to?{id:no,overflow:ro}:null,retryLane:536870912,hydrationErrors:null},(n=Gr(e)).return=t,t.child=n,lo=t,co=null):e=null,null===e)throw mo(t);return Of(e)?t.lanes=32:t.lanes=536870912,null}var u=o.children;return o=o.fallback,a?(Ba(),u=Zs({mode:"hidden",children:u},a=t.mode),o=Vr(o,a,n,null),u.return=t,o.return=t,u.sibling=o,t.child=u,(o=t.child).memoizedState=Xs(n),o.childLanes=Ys(e,r,n),t.memoizedState=$s,zs(null,o)):(Pa(t),Js(t,u))}var l=e.memoizedState;if(null!==l&&null!==(u=l.dehydrated)){if(s)256&t.flags?(Pa(t),t.flags&=-257,t=eu(e,t,n)):null!==t.memoizedState?(Ba(),t.child=e.child,t.flags|=128,t=null):(Ba(),u=o.fallback,a=t.mode,o=Zs({mode:"visible",children:o.children},a),(u=Vr(u,a,n,null)).flags|=2,o.return=t,u.return=t,o.sibling=u,t.child=o,ha(t,e.child,null,n),(o=t.child).memoizedState=Xs(n),o.childLanes=Ys(e,r,n),t.memoizedState=$s,t=zs(null,o));else if(Pa(t),Of(u)){if(r=u.nextSibling&&u.nextSibling.dataset)var c=r.dgst;r=c,(o=Error(i(419))).stack="",o.digest=r,Eo({value:o,source:null,stack:null}),t=eu(e,t,n)}else if(Os||To(e,t,n,!1),r=0!==(n&e.childLanes),Os||r){if(null!==(r=hl)&&(0!==(o=Pe(r,n))&&o!==l.retryLane))throw l.retryLane=o,Or(e,o),$l(r,e,o),Ds;Df(u)||ic(),t=eu(e,t,n)}else Df(u)?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,co=Ff(u.nextSibling),lo=t,fo=!0,po=null,ho=!1,null!==e&&uo(t,e),(t=Js(t,o.children)).flags|=4096);return t}return a?(Ba(),u=o.fallback,a=t.mode,c=(l=e.child).sibling,(o=Wr(l,{mode:"hidden",children:o.children})).subtreeFlags=65011712&l.subtreeFlags,null!==c?u=Wr(c,u):(u=Vr(u,a,n,null)).flags|=2,u.return=t,o.return=t,o.sibling=u,t.child=o,zs(null,o),o=t.child,null===(u=e.child.memoizedState)?u=Xs(n):(null!==(a=u.cachePool)?(l=zo._currentValue,a=a.parent!==l?{parent:l,pool:l}:a):a=Qo(),u={baseLanes:u.baseLanes|n,cachePool:a}),o.memoizedState=u,o.childLanes=Ys(e,r,n),t.memoizedState=$s,zs(e.child,o)):(Pa(t),e=(n=e.child).sibling,(n=Wr(n,{mode:"visible",children:o.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Js(e,t){return(t=Zs({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Zs(e,t){return(e=Br(22,e,null,t)).lanes=0,e}function eu(e,t,n){return ha(t,e.child,null,n),(e=Js(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function tu(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Io(e.return,t,n)}function nu(e,t,n,r,o,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o,treeForkCount:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o,i.treeForkCount=a)}function ru(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;r=r.children;var i=Wa.current,s=0!==(2&i);if(s?(i=1&i|2,t.flags|=128):i&=1,U(Wa,i),Fs(e,t,r,n),r=fo?Jr:0,!s&&null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&tu(e,n,t);else if(19===e.tag)tu(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===Ua(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),nu(t,!1,o,n,a,r);break;case"backwards":case"unstable_legacy-backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===Ua(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}nu(t,!0,n,null,a,r);break;case"together":nu(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function ou(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Sl|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(To(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Wr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Wr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function au(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ao(e))}function iu(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Os=!0;else{if(!au(e,n)&&0===(128&t.flags))return Os=!1,function(e,t,n){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),Ro(0,zo,e.memoizedState.cache),xo();break;case 27:case 5:Y(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:Ro(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Ma(t),null;break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(Pa(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Qs(e,t,n):(Pa(t),null!==(e=ou(e,t,n))?e.sibling:null);Pa(t);break;case 19:var o=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(To(e,t,n,!1),r=0!==(n&t.childLanes)),o){if(r)return ru(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),U(Wa,Wa.current),r)break;return null;case 22:return t.lanes=0,Bs(e,t,n,t.pendingProps);case 24:Ro(0,zo,e.memoizedState.cache)}return ou(e,t,n)}(e,t,n);Os=0!==(131072&e.flags)}else Os=!1,fo&&0!==(1048576&t.flags)&&ao(t,Jr,t.index);switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps;if(e=oa(t.elementType),t.type=e,"function"!==typeof e){if(void 0!==e&&null!==e){var o=e.$$typeof;if(o===E){t.tag=11,t=Ps(null,t,e,r,n);break e}if(o===k){t.tag=14,t=Ms(null,t,e,r,n);break e}}throw t=D(e)||e,Error(i(306,t,""))}zr(e)?(r=Cs(e,r),t.tag=1,t=qs(null,t,e,r,n)):(t.tag=0,t=Hs(null,t,e,r,n))}return t;case 0:return Hs(e,t,t.type,t.pendingProps,n);case 1:return qs(e,t,r=t.type,o=Cs(r,t.pendingProps),n);case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(i(387));r=t.pendingProps;var a=t.memoizedState;o=a.element,ya(e,t),ka(t,r,null,n);var s=t.memoizedState;if(r=s.cache,Ro(0,zo,r),r!==a.cache&&No(t,[zo],n,!0),Sa(),r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ks(e,t,r,n);break e}if(r!==o){Eo(o=$r(Error(i(424)),t)),t=Ks(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(co=Ff(e.firstChild),lo=t,fo=!0,po=null,ho=!0,n=va(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(xo(),r===o){t=ou(e,t,n);break e}Fs(e,t,r,n)}t=t.child}return t;case 26:return Vs(e,t),null===e?(n=qf(t.type,null,t.pendingProps,null))?t.memoizedState=n:fo||(n=t.type,e=t.pendingProps,(r=gf(q.current).createElement(n))[Ue]=t,r[je]=e,pf(r,n,e),et(r),t.stateNode=r):t.memoizedState=qf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Y(t),null===e&&fo&&(r=t.stateNode=Bf(t.type,t.pendingProps,q.current),lo=t,ho=!0,o=co,_f(t.type)?(Pf=o,co=Ff(r.firstChild)):co=o),Fs(e,t,t.pendingProps.children,n),Vs(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&fo&&((o=r=co)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var o=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[$e])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==o.rel||e.getAttribute("href")!==(null==o.href||""===o.href?null:o.href)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin)||e.getAttribute("title")!==(null==o.title?null:o.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==o.src?null:o.src)||e.getAttribute("type")!==(null==o.type?null:o.type)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==o.name?null:""+o.name;if("hidden"===o.type&&e.getAttribute("name")===a)return e}if(null===(e=Ff(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,ho))?(t.stateNode=r,lo=t,co=Ff(r.firstChild),ho=!1,o=!0):o=!1),o||mo(t)),Y(t),o=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,r=a.children,xf(o,a)?r=null:null!==s&&xf(o,s)&&(t.flags|=32),null!==t.memoizedState&&(o=ti(e,t,oi,null,null,n),fd._currentValue=o),Vs(e,t),Fs(e,t,r,n),t.child;case 6:return null===e&&fo&&((e=n=co)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Ff(e.nextSibling)))return null}return e}(n,t.pendingProps,ho))?(t.stateNode=n,lo=t,co=null,e=!0):e=!1),e||mo(t)),null;case 13:return Qs(e,t,n);case 4:return $(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ha(t,null,r,n):Fs(e,t,r,n),t.child;case 11:return Ps(e,t,t.type,t.pendingProps,n);case 7:return Fs(e,t,t.pendingProps,n),t.child;case 8:case 12:return Fs(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,Ro(0,t.type,r.value),Fs(e,t,r.children,n),t.child;case 9:return o=t.type._context,r=t.pendingProps.children,Do(t),r=r(o=Oo(o)),t.flags|=1,Fs(e,t,r,n),t.child;case 14:return Ms(e,t,t.type,t.pendingProps,n);case 15:return Ls(e,t,t.type,t.pendingProps,n);case 19:return ru(e,t,n);case 31:return function(e,t,n){var r=t.pendingProps,o=0!==(128&t.flags);if(t.flags&=-129,null===e){if(fo){if("hidden"===r.mode)return e=Us(t,r),t.lanes=536870912,zs(null,e);if(Ma(t),(e=co)?null!==(e=null!==(e=Af(e,ho))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==to?{id:no,overflow:ro}:null,retryLane:536870912,hydrationErrors:null},(n=Gr(e)).return=t,t.child=n,lo=t,co=null):e=null,null===e)throw mo(t);return t.lanes=536870912,null}return Us(t,r)}var a=e.memoizedState;if(null!==a){var s=a.dehydrated;if(Ma(t),o)if(256&t.flags)t.flags&=-257,t=js(e,t,n);else{if(null===t.memoizedState)throw Error(i(558));t.child=e.child,t.flags|=128,t=null}else if(Os||To(e,t,n,!1),o=0!==(n&e.childLanes),Os||o){if(null!==(r=hl)&&0!==(s=Pe(r,n))&&s!==a.retryLane)throw a.retryLane=s,Or(e,s),$l(r,e,s),Ds;ic(),t=js(e,t,n)}else e=a.treeContext,co=Ff(s.nextSibling),lo=t,fo=!0,po=null,ho=!1,null!==e&&uo(t,e),(t=Us(t,r)).flags|=4096;return t}return(e=Wr(e.child,{mode:r.mode,children:r.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Bs(e,t,n,t.pendingProps);case 24:return Do(t),r=Oo(zo),null===e?(null===(o=Xo())&&(o=hl,a=Wo(),o.pooledCache=a,a.refCount++,null!==a&&(o.pooledCacheLanes|=n),o=a),t.memoizedState={parent:r,cache:o},ga(t),Ro(0,zo,o)):(0!==(e.lanes&n)&&(ya(e,t),ka(t,null,null,n),Sa()),o=e.memoizedState,a=t.memoizedState,o.parent!==r?(o={parent:r,cache:r},t.memoizedState=o,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=o),Ro(0,zo,r)):(r=a.cache,Ro(0,zo,r),r!==o.cache&&No(t,[zo],n,!0))),Fs(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function su(e){e.flags|=4}function uu(e,t,n,r,o){if((t=0!==(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&o)===o)if(e.stateNode.complete)e.flags|=8192;else{if(!rc())throw aa=ta,Zo;e.flags|=8192}}else e.flags&=-16777217}function lu(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!ad(t)){if(!rc())throw aa=ta,Zo;e.flags|=8192}}function cu(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Te():536870912,e.lanes|=t,Il|=t)}function fu(e,t){if(!fo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function du(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=65011712&o.subtreeFlags,r|=65011712&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function pu(e,t,n){var r=t.pendingProps;switch(so(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return du(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),_o(zo),X(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(bo(t)?su(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,wo())),du(t),null;case 26:var o=t.type,a=t.memoizedState;return null===e?(su(t),null!==a?(du(t),lu(t,a)):(du(t),uu(t,o,0,0,n))):a?a!==e.memoizedState?(su(t),du(t),lu(t,a)):(du(t),t.flags&=-16777217):((e=e.memoizedProps)!==r&&su(t),du(t),uu(t,o,0,0,n)),null;case 27:if(Q(t),n=q.current,o=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&su(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return du(t),null}e=H.current,bo(t)?go(t):(e=Bf(o,r,n),t.stateNode=e,su(t))}return du(t),null;case 5:if(Q(t),o=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&su(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return du(t),null}if(a=H.current,bo(t))go(t);else{var s=gf(q.current);switch(a){case 1:a=s.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:a=s.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":a=s.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":a=s.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":(a=s.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a="string"===typeof r.is?s.createElement("select",{is:r.is}):s.createElement("select"),r.multiple?a.multiple=!0:r.size&&(a.size=r.size);break;default:a="string"===typeof r.is?s.createElement(o,{is:r.is}):s.createElement(o)}}a[Ue]=t,a[je]=r;e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)a.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;null===s.sibling;){if(null===s.return||s.return===t)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=a;e:switch(pf(a,o,r),o){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&su(t)}}return du(t),uu(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&su(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(e=q.current,bo(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(o=lo))switch(o.tag){case 27:case 5:r=o.memoizedProps}e[Ue]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||cf(e.nodeValue,n)))||mo(t,!0)}else(e=gf(e).createTextNode(r))[Ue]=t,t.stateNode=e}return du(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(r=bo(t),null!==n){if(null===e){if(!r)throw Error(i(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(i(557));e[Ue]=t}else xo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;du(t),e=!1}else n=wo(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(za(t),t):(za(t),null);if(0!==(128&t.flags))throw Error(i(558))}return du(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(o=bo(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[Ue]=t}else xo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;du(t),o=!1}else o=wo(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return 256&t.flags?(za(t),t):(za(t),null)}return za(t),0!==(128&t.flags)?(t.lanes=n,t):(n=null!==r,e=null!==e&&null!==e.memoizedState,n&&(o=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(o=r.alternate.memoizedState.cachePool.pool),a=null,null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(a=r.memoizedState.cachePool.pool),a!==o&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),cu(t,t.updateQueue),du(t),null);case 4:return X(),null===e&&Zc(t.stateNode.containerInfo),du(t),null;case 10:return _o(t.type),du(t),null;case 19:if(W(Wa),null===(r=t.memoizedState))return du(t),null;if(o=0!==(128&t.flags),null===(a=r.rendering))if(o)fu(r,!1);else{if(0!==Cl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=Ua(e))){for(t.flags|=128,fu(r,!1),e=a.updateQueue,t.updateQueue=e,cu(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ur(n,e),n=n.sibling;return U(Wa,1&Wa.current|2),fo&&oo(t,r.treeForkCount),t.child}e=e.sibling}null!==r.tail&&ue()>Fl&&(t.flags|=128,o=!0,fu(r,!1),t.lanes=4194304)}else{if(!o)if(null!==(e=Ua(a))){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,cu(t,e),fu(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!fo)return du(t),null}else 2*ue()-r.renderingStartTime>Fl&&536870912!==n&&(t.flags|=128,o=!0,fu(r,!1),t.lanes=4194304);r.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=r.last)?e.sibling=a:t.child=a,r.last=a)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=ue(),e.sibling=null,n=Wa.current,U(Wa,o?1&n|2:1&n),fo&&oo(t,r.treeForkCount),e):(du(t),null);case 22:case 23:return za(t),Da(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(du(t),6&t.subtreeFlags&&(t.flags|=8192)):du(t),null!==(n=t.updateQueue)&&cu(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&W($o),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),_o(zo),du(t),null;case 25:case 30:return null}throw Error(i(156,t.tag))}function hu(e,t){switch(so(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return _o(zo),X(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Q(t),null;case 31:if(null!==t.memoizedState){if(za(t),null===t.alternate)throw Error(i(340));xo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(za(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));xo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return W(Wa),null;case 4:return X(),null;case 10:return _o(t.type),null;case 22:case 23:return za(t),Da(),null!==e&&W($o),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return _o(zo),null;default:return null}}function vu(e,t){switch(so(t),t.tag){case 3:_o(zo),X();break;case 26:case 27:case 5:Q(t);break;case 4:X();break;case 31:null!==t.memoizedState&&za(t);break;case 13:za(t);break;case 19:W(Wa);break;case 10:_o(t.type);break;case 22:case 23:za(t),Da(),null!==e&&W($o);break;case 24:_o(zo)}}function mu(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var o=r.next;n=o;do{if((n.tag&e)===e){r=void 0;var a=n.create,i=n.inst;r=a(),i.destroy=r}n=n.next}while(n!==o)}}catch(s){Cc(t,t.return,s)}}function gu(e,t,n){try{var r=t.updateQueue,o=null!==r?r.lastEffect:null;if(null!==o){var a=o.next;r=a;do{if((r.tag&e)===e){var i=r.inst,s=i.destroy;if(void 0!==s){i.destroy=void 0,o=t;var u=n,l=s;try{l()}catch(c){Cc(o,u,c)}}}r=r.next}while(r!==a)}}catch(c){Cc(t,t.return,c)}}function yu(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{_a(t,n)}catch(r){Cc(e,e.return,r)}}}function bu(e,t,n){n.props=Cs(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){Cc(e,t,r)}}function xu(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(o){Cc(e,t,o)}}function wu(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(o){Cc(e,t,o)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(a){Cc(e,t,a)}else n.current=null}function Eu(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(o){Cc(e,e.return,o)}}function Cu(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,a=null,s=null,u=null,l=null,c=null,f=null;for(h in n){var d=n[h];if(n.hasOwnProperty(h)&&null!=d)switch(h){case"checked":case"value":break;case"defaultValue":l=d;default:r.hasOwnProperty(h)||ff(e,t,h,null,r,d)}}for(var p in r){var h=r[p];if(d=n[p],r.hasOwnProperty(p)&&(null!=h||null!=d))switch(p){case"type":a=h;break;case"name":o=h;break;case"checked":c=h;break;case"defaultChecked":f=h;break;case"value":s=h;break;case"defaultValue":u=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(i(137,t));break;default:h!==d&&ff(e,t,p,h,r,d)}}return void yt(e,s,u,l,c,f,a,o);case"select":for(a in h=s=u=p=null,n)if(l=n[a],n.hasOwnProperty(a)&&null!=l)switch(a){case"value":break;case"multiple":h=l;default:r.hasOwnProperty(a)||ff(e,t,a,null,r,l)}for(o in r)if(a=r[o],l=n[o],r.hasOwnProperty(o)&&(null!=a||null!=l))switch(o){case"value":p=a;break;case"defaultValue":u=a;break;case"multiple":s=a;default:a!==l&&ff(e,t,o,a,r,l)}return t=u,n=s,r=h,void(null!=p?wt(e,!!n,p,!1):!!r!==!!n&&(null!=t?wt(e,!!n,t,!0):wt(e,!!n,n?[]:"",!1)));case"textarea":for(u in h=p=null,n)if(o=n[u],n.hasOwnProperty(u)&&null!=o&&!r.hasOwnProperty(u))switch(u){case"value":case"children":break;default:ff(e,t,u,null,r,o)}for(s in r)if(o=r[s],a=n[s],r.hasOwnProperty(s)&&(null!=o||null!=a))switch(s){case"value":p=o;break;case"defaultValue":h=o;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(i(91));break;default:o!==a&&ff(e,t,s,o,r,a)}return void Et(e,p,h);case"option":for(var v in n)if(p=n[v],n.hasOwnProperty(v)&&null!=p&&!r.hasOwnProperty(v))if("selected"===v)e.selected=!1;else ff(e,t,v,null,r,p);for(l in r)if(p=r[l],h=n[l],r.hasOwnProperty(l)&&p!==h&&(null!=p||null!=h))if("selected"===l)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else ff(e,t,l,p,r,h);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)p=n[m],n.hasOwnProperty(m)&&null!=p&&!r.hasOwnProperty(m)&&ff(e,t,m,null,r,p);for(c in r)if(p=r[c],h=n[c],r.hasOwnProperty(c)&&p!==h&&(null!=p||null!=h))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(i(137,t));break;default:ff(e,t,c,p,r,h)}return;default:if(It(t)){for(var g in n)p=n[g],n.hasOwnProperty(g)&&void 0!==p&&!r.hasOwnProperty(g)&&df(e,t,g,void 0,r,p);for(f in r)p=r[f],h=n[f],!r.hasOwnProperty(f)||p===h||void 0===p&&void 0===h||df(e,t,f,p,r,h);return}}for(var y in n)p=n[y],n.hasOwnProperty(y)&&null!=p&&!r.hasOwnProperty(y)&&ff(e,t,y,null,r,p);for(d in r)p=r[d],h=n[d],!r.hasOwnProperty(d)||p===h||null==p&&null==h||ff(e,t,d,p,r,h)}(r,e.type,n,t),r[je]=t}catch(o){Cc(e,e.return,o)}}function Su(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&_f(e.type)||4===e.tag}function ku(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Su(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&_f(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Ru(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Dt));else if(4!==r&&(27===r&&_f(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Ru(e,t,n),e=e.sibling;null!==e;)Ru(e,t,n),e=e.sibling}function _u(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&_f(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(_u(e,t,n),e=e.sibling;null!==e;)_u(e,t,n),e=e.sibling}function Iu(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,o=t.attributes;o.length;)t.removeAttributeNode(o[0]);pf(t,r,n),t[Ue]=e,t[je]=n}catch(a){Cc(e,e.return,a)}}var Nu=!1,Tu=!1,Au=!1,Du="function"===typeof WeakSet?WeakSet:Set,Ou=null;function Fu(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:$u(e,n),4&r&&mu(5,n);break;case 1:if($u(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(i){Cc(n,n.return,i)}else{var o=Cs(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(o,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){Cc(n,n.return,s)}}64&r&&yu(n),512&r&&xu(n,n.return);break;case 3:if($u(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{_a(e,t)}catch(i){Cc(n,n.return,i)}}break;case 27:null===t&&4&r&&Iu(n);case 26:case 5:$u(e,n),null===t&&4&r&&Eu(n),512&r&&xu(n,n.return);break;case 12:$u(e,n);break;case 31:$u(e,n),4&r&&Wu(e,n);break;case 13:$u(e,n),4&r&&Uu(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=_c.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||Nu)){t=null!==t&&null!==t.memoizedState||Tu,o=Nu;var a=Tu;Nu=r,(Tu=t)&&!a?Yu(e,n,0!==(8772&n.subtreeFlags)):$u(e,n),Nu=o,Tu=a}break;case 30:break;default:$u(e,n)}}function Pu(e){var t=e.alternate;null!==t&&(e.alternate=null,Pu(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Xe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Mu=null,Lu=!1;function Bu(e,t,n){for(n=n.child;null!==n;)zu(e,t,n),n=n.sibling}function zu(e,t,n){if(ye&&"function"===typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(ge,n)}catch(a){}switch(n.tag){case 26:Tu||wu(n,t),Bu(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Tu||wu(n,t);var r=Mu,o=Lu;_f(n.type)&&(Mu=n.stateNode,Lu=!1),Bu(e,t,n),zf(n.stateNode),Mu=r,Lu=o;break;case 5:Tu||wu(n,t);case 6:if(r=Mu,o=Lu,Mu=null,Bu(e,t,n),Lu=o,null!==(Mu=r))if(Lu)try{(9===Mu.nodeType?Mu.body:"HTML"===Mu.nodeName?Mu.ownerDocument.body:Mu).removeChild(n.stateNode)}catch(i){Cc(n,t,i)}else try{Mu.removeChild(n.stateNode)}catch(i){Cc(n,t,i)}break;case 18:null!==Mu&&(Lu?(If(9===(e=Mu).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Gd(e)):If(Mu,n.stateNode));break;case 4:r=Mu,o=Lu,Mu=n.stateNode.containerInfo,Lu=!0,Bu(e,t,n),Mu=r,Lu=o;break;case 0:case 11:case 14:case 15:gu(2,n,t),Tu||gu(4,n,t),Bu(e,t,n);break;case 1:Tu||(wu(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&bu(n,t,r)),Bu(e,t,n);break;case 21:Bu(e,t,n);break;case 22:Tu=(r=Tu)||null!==n.memoizedState,Bu(e,t,n),Tu=r;break;default:Bu(e,t,n)}}function Wu(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Gd(e)}catch(n){Cc(t,t.return,n)}}}function Uu(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Gd(e)}catch(n){Cc(t,t.return,n)}}function ju(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Du),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Du),t;default:throw Error(i(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=Ic.bind(null,e,t);t.then(r,r)}})}function Vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r],a=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 27:if(_f(u.type)){Mu=u.stateNode,Lu=!1;break e}break;case 5:Mu=u.stateNode,Lu=!1;break e;case 3:case 4:Mu=u.stateNode.containerInfo,Lu=!0;break e}u=u.return}if(null===Mu)throw Error(i(160));zu(a,s,o),Mu=null,Lu=!1,null!==(a=o.alternate)&&(a.return=null),o.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Gu(t,e),t=t.sibling}var Hu=null;function Gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Vu(t,e),qu(e),4&r&&(gu(3,e,e.return),mu(3,e),gu(5,e,e.return));break;case 1:Vu(t,e),qu(e),512&r&&(Tu||null===n||wu(n,n.return)),64&r&&Nu&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var o=Hu;if(Vu(t,e),qu(e),512&r&&(Tu||null===n||wu(n,n.return)),4&r){var a=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,o=o.ownerDocument||o;t:switch(r){case"title":(!(a=o.getElementsByTagName("title")[0])||a[$e]||a[Ue]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=o.createElement(r),o.head.insertBefore(a,o.querySelector("head > title"))),pf(a,r,n),a[Ue]=e,et(a),r=a;break e;case"link":var s=rd("link","href",o).get(r+(n.href||""));if(s)for(var u=0;u<s.length;u++)if((a=s[u]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(u,1);break t}pf(a=o.createElement(r),r,n),o.head.appendChild(a);break;case"meta":if(s=rd("meta","content",o).get(r+(n.content||"")))for(u=0;u<s.length;u++)if((a=s[u]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(u,1);break t}pf(a=o.createElement(r),r,n),o.head.appendChild(a);break;default:throw Error(i(468,r))}a[Ue]=e,et(a),r=a}e.stateNode=r}else od(o,e.type,e.stateNode);else e.stateNode=Jf(o,r,e.memoizedProps);else a!==r?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===r?od(o,e.type,e.stateNode):Jf(o,r,e.memoizedProps)):null===r&&null!==e.stateNode&&Cu(e,e.memoizedProps,n.memoizedProps)}break;case 27:Vu(t,e),qu(e),512&r&&(Tu||null===n||wu(n,n.return)),null!==n&&4&r&&Cu(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Vu(t,e),qu(e),512&r&&(Tu||null===n||wu(n,n.return)),32&e.flags){o=e.stateNode;try{St(o,"")}catch(v){Cc(e,e.return,v)}}4&r&&null!=e.stateNode&&Cu(e,o=e.memoizedProps,null!==n?n.memoizedProps:o),1024&r&&(Au=!0);break;case 6:if(Vu(t,e),qu(e),4&r){if(null===e.stateNode)throw Error(i(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(v){Cc(e,e.return,v)}}break;case 3:if(nd=null,o=Hu,Hu=jf(t.containerInfo),Vu(t,e),Hu=o,qu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Gd(t.containerInfo)}catch(v){Cc(e,e.return,v)}Au&&(Au=!1,Ku(e));break;case 4:r=Hu,Hu=jf(e.stateNode.containerInfo),Vu(t,e),qu(e),Hu=r;break;case 12:default:Vu(t,e),qu(e);break;case 31:case 19:Vu(t,e),qu(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,ju(e,r)));break;case 13:Vu(t,e),qu(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(Dl=ue()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,ju(e,r)));break;case 22:o=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,c=Nu,f=Tu;if(Nu=c||o,Tu=f||l,Vu(t,e),Tu=f,Nu=c,qu(e),8192&r)e:for(t=e.stateNode,t._visibility=o?-2&t._visibility:1|t._visibility,o&&(null===n||l||Nu||Tu||Xu(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(a=l.stateNode,o)"function"===typeof(s=a.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{u=l.stateNode;var d=l.memoizedProps.style,p=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;u.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(v){Cc(l,l.return,v)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=o?"":l.memoizedProps}catch(v){Cc(l,l.return,v)}}}else if(18===t.tag){if(null===n){l=t;try{var h=l.stateNode;o?Nf(h,!0):Nf(l.stateNode,!1)}catch(v){Cc(l,l.return,v)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,ju(e,n))));case 30:case 21:}}function qu(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(Su(r)){n=r;break}r=r.return}if(null==n)throw Error(i(160));switch(n.tag){case 27:var o=n.stateNode;_u(e,ku(e),o);break;case 5:var a=n.stateNode;32&n.flags&&(St(a,""),n.flags&=-33),_u(e,ku(e),a);break;case 3:case 4:var s=n.stateNode.containerInfo;Ru(e,ku(e),s);break;default:throw Error(i(161))}}catch(u){Cc(e,e.return,u)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ku(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ku(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function $u(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Fu(e,t.alternate,t),t=t.sibling}function Xu(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:gu(4,t,t.return),Xu(t);break;case 1:wu(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&bu(t,t.return,n),Xu(t);break;case 27:zf(t.stateNode);case 26:case 5:wu(t,t.return),Xu(t);break;case 22:null===t.memoizedState&&Xu(t);break;default:Xu(t)}e=e.sibling}}function Yu(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,o=e,a=t,i=a.flags;switch(a.tag){case 0:case 11:case 15:Yu(o,a,n),mu(4,a);break;case 1:if(Yu(o,a,n),"function"===typeof(o=(r=a).stateNode).componentDidMount)try{o.componentDidMount()}catch(l){Cc(r,r.return,l)}if(null!==(o=(r=a).updateQueue)){var s=r.stateNode;try{var u=o.shared.hiddenCallbacks;if(null!==u)for(o.shared.hiddenCallbacks=null,o=0;o<u.length;o++)Ra(u[o],s)}catch(l){Cc(r,r.return,l)}}n&&64&i&&yu(a),xu(a,a.return);break;case 27:Iu(a);case 26:case 5:Yu(o,a,n),n&&null===r&&4&i&&Eu(a),xu(a,a.return);break;case 12:Yu(o,a,n);break;case 31:Yu(o,a,n),n&&4&i&&Wu(o,a);break;case 13:Yu(o,a,n),n&&4&i&&Uu(o,a);break;case 22:null===a.memoizedState&&Yu(o,a,n),xu(a,a.return);break;case 30:break;default:Yu(o,a,n)}t=t.sibling}}function Qu(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Uo(n))}function Ju(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Uo(e))}function Zu(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)el(e,t,n,r),t=t.sibling}function el(e,t,n,r){var o=t.flags;switch(t.tag){case 0:case 11:case 15:Zu(e,t,n,r),2048&o&&mu(9,t);break;case 1:case 31:case 13:default:Zu(e,t,n,r);break;case 3:Zu(e,t,n,r),2048&o&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Uo(e)));break;case 12:if(2048&o){Zu(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,i=a.id,s=a.onPostCommit;"function"===typeof s&&s(i,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(u){Cc(t,t.return,u)}}else Zu(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,i=t.alternate,null!==t.memoizedState?2&a._visibility?Zu(e,t,n,r):nl(e,t):2&a._visibility?Zu(e,t,n,r):(a._visibility|=2,tl(e,t,n,r,0!==(10256&t.subtreeFlags)||!1)),2048&o&&Qu(i,t);break;case 24:Zu(e,t,n,r),2048&o&&Ju(t.alternate,t)}}function tl(e,t,n,r,o){for(o=o&&(0!==(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var a=e,i=t,s=n,u=r,l=i.flags;switch(i.tag){case 0:case 11:case 15:tl(a,i,s,u,o),mu(8,i);break;case 23:break;case 22:var c=i.stateNode;null!==i.memoizedState?2&c._visibility?tl(a,i,s,u,o):nl(a,i):(c._visibility|=2,tl(a,i,s,u,o)),o&&2048&l&&Qu(i.alternate,i);break;case 24:tl(a,i,s,u,o),o&&2048&l&&Ju(i.alternate,i);break;default:tl(a,i,s,u,o)}t=t.sibling}}function nl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,o=r.flags;switch(r.tag){case 22:nl(n,r),2048&o&&Qu(r.alternate,r);break;case 24:nl(n,r),2048&o&&Ju(r.alternate,r);break;default:nl(n,r)}t=t.sibling}}var rl=8192;function ol(e,t,n){if(e.subtreeFlags&rl)for(e=e.child;null!==e;)al(e,t,n),e=e.sibling}function al(e,t,n){switch(e.tag){case 26:ol(e,t,n),e.flags&rl&&null!==e.memoizedState&&function(e,t,n,r){if("stylesheet"===n.type&&("string"!==typeof r.media||!1!==matchMedia(r.media).matches)&&0===(4&n.state.loading)){if(null===n.instance){var o=Kf(r.href),a=t.querySelector($f(o));if(a)return null!==(t=a._p)&&"object"===typeof t&&"function"===typeof t.then&&(e.count++,e=sd.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=a,void et(a);a=t.ownerDocument||t,r=Xf(r),(o=Wf.get(o))&&ed(r,o),et(a=a.createElement("link"));var i=a;i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),pf(a,"link",r),n.instance=a}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&0===(3&n.state.loading)&&(e.count++,n=sd.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,Hu,e.memoizedState,e.memoizedProps);break;case 5:default:ol(e,t,n);break;case 3:case 4:var r=Hu;Hu=jf(e.stateNode.containerInfo),ol(e,t,n),Hu=r;break;case 22:null===e.memoizedState&&(null!==(r=e.alternate)&&null!==r.memoizedState?(r=rl,rl=16777216,ol(e,t,n),rl=r):ol(e,t,n))}}function il(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function sl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Ou=r,cl(r,e)}il(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)ul(e),e=e.sibling}function ul(e){switch(e.tag){case 0:case 11:case 15:sl(e),2048&e.flags&&gu(9,e,e.return);break;case 3:case 12:default:sl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,ll(e)):sl(e)}}function ll(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Ou=r,cl(r,e)}il(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:gu(8,t,t.return),ll(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,ll(t));break;default:ll(t)}e=e.sibling}}function cl(e,t){for(;null!==Ou;){var n=Ou;switch(n.tag){case 0:case 11:case 15:gu(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Uo(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Ou=r;else e:for(n=e;null!==Ou;){var o=(r=Ou).sibling,a=r.return;if(Pu(r),r===n){Ou=null;break e}if(null!==o){o.return=a,Ou=o;break e}Ou=a}}}var fl={getCacheForType:function(e){var t=Oo(zo),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Oo(zo).controller.signal}},dl="function"===typeof WeakMap?WeakMap:Map,pl=0,hl=null,vl=null,ml=0,gl=0,yl=null,bl=!1,xl=!1,wl=!1,El=0,Cl=0,Sl=0,kl=0,Rl=0,_l=0,Il=0,Nl=null,Tl=null,Al=!1,Dl=0,Ol=0,Fl=1/0,Pl=null,Ml=null,Ll=0,Bl=null,zl=null,Wl=0,Ul=0,jl=null,Vl=null,Hl=0,Gl=null;function ql(){return 0!==(2&pl)&&0!==ml?ml&-ml:null!==F.T?jc():Be()}function Kl(){if(0===_l)if(0===(536870912&ml)||fo){var e=Se;0===(3932160&(Se<<=1))&&(Se=262144),_l=e}else _l=536870912;return null!==(e=Oa.current)&&(e.flags|=32),_l}function $l(e,t,n){(e!==hl||2!==gl&&9!==gl)&&null===e.cancelPendingCommit||(tc(e,0),Jl(e,ml,_l,!1)),De(e,n),0!==(2&pl)&&e===hl||(e===hl&&(0===(2&pl)&&(kl|=n),4===Cl&&Jl(e,ml,_l,!1)),Pc(e))}function Xl(e,t,n){if(0!==(6&pl))throw Error(i(327));for(var r=!n&&0===(127&t)&&0===(t&e.expiredLanes)||Ie(e,t),o=r?function(e,t){var n=pl;pl|=2;var r=oc(),o=ac();hl!==e||ml!==t?(Pl=null,Fl=ue()+500,tc(e,t)):xl=Ie(e,t);e:for(;;)try{if(0!==gl&&null!==vl){t=vl;var a=yl;t:switch(gl){case 1:gl=0,yl=null,dc(e,t,a,1);break;case 2:case 9:if(na(a)){gl=0,yl=null,fc(t);break}t=function(){2!==gl&&9!==gl||hl!==e||(gl=7),Pc(e)},a.then(t,t);break e;case 3:gl=7;break e;case 4:gl=5;break e;case 7:na(a)?(gl=0,yl=null,fc(t)):(gl=0,yl=null,dc(e,t,a,7));break;case 5:var s=null;switch(vl.tag){case 26:s=vl.memoizedState;case 5:case 27:var u=vl;if(s?ad(s):u.stateNode.complete){gl=0,yl=null;var l=u.sibling;if(null!==l)vl=l;else{var c=u.return;null!==c?(vl=c,pc(c)):vl=null}break t}}gl=0,yl=null,dc(e,t,a,5);break;case 6:gl=0,yl=null,dc(e,t,a,6);break;case 8:ec(),Cl=6;break e;default:throw Error(i(462))}}lc();break}catch(f){nc(e,f)}return ko=So=null,F.H=r,F.A=o,pl=n,null!==vl?0:(hl=null,ml=0,Tr(),Cl)}(e,t):sc(e,t,!0),a=r;;){if(0===o){xl&&!r&&Jl(e,t,0,!1);break}if(n=e.current.alternate,!a||Ql(n)){if(2===o){if(a=t,e.errorRecoveryDisabledLanes&a)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var u=e;o=Nl;var l=u.current.memoizedState.isDehydrated;if(l&&(tc(u,s).flags|=256),2!==(s=sc(u,s,!1))){if(wl&&!l){u.errorRecoveryDisabledLanes|=a,kl|=a,o=4;break e}a=Tl,Tl=o,null!==a&&(null===Tl?Tl=a:Tl.push.apply(Tl,a))}o=s}if(a=!1,2!==o)continue}}if(1===o){tc(e,0),Jl(e,t,0,!0);break}e:{switch(r=e,a=o){case 0:case 1:throw Error(i(345));case 4:if((4194048&t)!==t)break;case 6:Jl(r,t,_l,!bl);break e;case 2:Tl=null;break;case 3:case 5:break;default:throw Error(i(329))}if((62914560&t)===t&&10<(o=Dl+300-ue())){if(Jl(r,t,_l,!bl),0!==_e(r,0,!0))break e;Wl=t,r.timeoutHandle=Ef(Yl.bind(null,r,n,Tl,Pl,Al,t,_l,kl,Il,bl,a,"Throttled",-0,0),o)}else Yl(r,n,Tl,Pl,Al,t,_l,kl,Il,bl,a,null,-0,0)}break}o=sc(e,t,!1),a=!1}Pc(e)}function Yl(e,t,n,r,o,a,i,s,u,l,c,f,d,p){if(e.timeoutHandle=-1,8192&(f=t.subtreeFlags)||16785408===(16785408&f)){al(t,a,f={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Dt});var h=(62914560&a)===a?Dl-ue():(4194048&a)===a?Ol-ue():0;if(null!==(h=function(e,t){return e.stylesheets&&0===e.count&&ld(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&ld(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===id&&(id=62500*function(){if("function"===typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),r=0;r<n.length;r++){var o=n[r],a=o.transferSize,i=o.initiatorType,s=o.duration;if(a&&s&&hf(i)){for(i=0,s=o.responseEnd,r+=1;r<n.length;r++){var u=n[r],l=u.startTime;if(l>s)break;var c=u.transferSize,f=u.initiatorType;c&&hf(f)&&(i+=c*((u=u.responseEnd)<s?1:(s-l)/(u-l)))}if(--r,t+=8*(a+i)/(o.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"===typeof(e=navigator.connection.downlink)?e:5}());var o=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&ld(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>id?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(o)}}:null}(f,h)))return Wl=a,e.cancelPendingCommit=h(vc.bind(null,e,t,a,n,r,o,i,s,u,c,f,null,d,p)),void Jl(e,a,i,!l)}vc(e,t,a,n,r,o,i,s,u)}function Ql(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!Jn(a(),o))return!1}catch(i){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Jl(e,t,n,r){t&=~Rl,t&=~kl,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var o=t;0<o;){var a=31-xe(o),i=1<<a;r[a]=-1,o&=~i}0!==n&&Oe(e,n,t)}function Zl(){return 0!==(6&pl)||(Mc(0,!1),!1)}function ec(){if(null!==vl){if(0===gl)var e=vl.return;else ko=So=null,si(e=vl),ua=null,la=0,e=vl;for(;null!==e;)vu(e.alternate,e),e=e.return;vl=null}}function tc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Cf(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Wl=0,ec(),hl=e,vl=n=Wr(e.current,null),ml=t,gl=0,yl=null,bl=!1,xl=Ie(e,t),wl=!1,Il=_l=Rl=kl=Sl=Cl=0,Tl=Nl=null,Al=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var o=31-xe(r),a=1<<o;t|=e[o],r&=~a}return El=t,Tr(),n}function nc(e,t){Va=null,F.H=vs,t===Jo||t===ea?(t=ia(),gl=3):t===Zo?(t=ia(),gl=4):gl=t===Ds?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,yl=t,null===vl&&(Cl=1,_s(e,$r(t,e.current)))}function rc(){var e=Oa.current;return null===e||((4194048&ml)===ml?null===Fa:((62914560&ml)===ml||0!==(536870912&ml))&&e===Fa)}function oc(){var e=F.H;return F.H=vs,null===e?vs:e}function ac(){var e=F.A;return F.A=fl,e}function ic(){Cl=4,bl||(4194048&ml)!==ml&&null!==Oa.current||(xl=!0),0===(134217727&Sl)&&0===(134217727&kl)||null===hl||Jl(hl,ml,_l,!1)}function sc(e,t,n){var r=pl;pl|=2;var o=oc(),a=ac();hl===e&&ml===t||(Pl=null,tc(e,t)),t=!1;var i=Cl;e:for(;;)try{if(0!==gl&&null!==vl){var s=vl,u=yl;switch(gl){case 8:ec(),i=6;break e;case 3:case 2:case 9:case 6:null===Oa.current&&(t=!0);var l=gl;if(gl=0,yl=null,dc(e,s,u,l),n&&xl){i=0;break e}break;default:l=gl,gl=0,yl=null,dc(e,s,u,l)}}uc(),i=Cl;break}catch(c){nc(e,c)}return t&&e.shellSuspendCounter++,ko=So=null,pl=r,F.H=o,F.A=a,null===vl&&(hl=null,ml=0,Tr()),i}function uc(){for(;null!==vl;)cc(vl)}function lc(){for(;null!==vl&&!ie();)cc(vl)}function cc(e){var t=iu(e.alternate,e,El);e.memoizedProps=e.pendingProps,null===t?pc(e):vl=t}function fc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Gs(n,t,t.pendingProps,t.type,void 0,ml);break;case 11:t=Gs(n,t,t.pendingProps,t.type.render,t.ref,ml);break;case 5:si(t);default:vu(n,t),t=iu(n,t=vl=Ur(t,El),El)}e.memoizedProps=e.pendingProps,null===t?pc(e):vl=t}function dc(e,t,n,r){ko=So=null,si(t),ua=null,la=0;var o=t.return;try{if(function(e,t,n,r,o){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&To(t,n,o,!0),null!==(n=Oa.current)){switch(n.tag){case 31:case 13:return null===Fa?ic():null===n.alternate&&0===Cl&&(Cl=3),n.flags&=-257,n.flags|=65536,n.lanes=o,r===ta?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),Sc(e,r,o)),!1;case 22:return n.flags|=65536,r===ta?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),Sc(e,r,o)),!1}throw Error(i(435,n.tag))}return Sc(e,r,o),ic(),!1}if(fo)return null!==(t=Oa.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=o,r!==vo&&Eo($r(e=Error(i(422),{cause:r}),n))):(r!==vo&&Eo($r(t=Error(i(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,o&=-o,e.lanes|=o,r=$r(r,n),Ea(e,o=Ns(e.stateNode,r,o)),4!==Cl&&(Cl=2)),!1;var a=Error(i(520),{cause:r});if(a=$r(a,n),null===Nl?Nl=[a]:Nl.push(a),4!==Cl&&(Cl=2),null===t)return!0;r=$r(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=o&-o,n.lanes|=e,Ea(n,e=Ns(n.stateNode,r,e)),!1;case 1:if(t=n.type,a=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==a&&"function"===typeof a.componentDidCatch&&(null===Ml||!Ml.has(a))))return n.flags|=65536,o&=-o,n.lanes|=o,As(o=Ts(o),e,n,r),Ea(n,o),!1}n=n.return}while(null!==n);return!1}(e,o,t,n,ml))return Cl=1,_s(e,$r(n,e.current)),void(vl=null)}catch(a){if(null!==o)throw vl=o,a;return Cl=1,_s(e,$r(n,e.current)),void(vl=null)}32768&t.flags?(fo||1===r?e=!0:xl||0!==(536870912&ml)?e=!1:(bl=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=Oa.current)&&13===r.tag&&(r.flags|=16384))),hc(t,e)):pc(t)}function pc(e){var t=e;do{if(0!==(32768&t.flags))return void hc(t,bl);e=t.return;var n=pu(t.alternate,t,El);if(null!==n)return void(vl=n);if(null!==(t=t.sibling))return void(vl=t);vl=t=e}while(null!==t);0===Cl&&(Cl=5)}function hc(e,t){do{var n=hu(e.alternate,e);if(null!==n)return n.flags&=32767,void(vl=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(vl=e);vl=e=n}while(null!==e);Cl=6,vl=null}function vc(e,t,n,r,o,a,s,u,l){e.cancelPendingCommit=null;do{xc()}while(0!==Ll);if(0!==(6&pl))throw Error(i(327));if(null!==t){if(t===e.current)throw Error(i(177));if(a=t.lanes|t.childLanes,function(e,t,n,r,o,a){var i=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,u=e.expirationTimes,l=e.hiddenUpdates;for(n=i&~n;0<n;){var c=31-xe(n),f=1<<c;s[c]=0,u[c]=-1;var d=l[c];if(null!==d)for(l[c]=null,c=0;c<d.length;c++){var p=d[c];null!==p&&(p.lane&=-536870913)}n&=~f}0!==r&&Oe(e,r,0),0!==a&&0===o&&0!==e.tag&&(e.suspendedLanes|=a&~(i&~t))}(e,n,a|=Nr,s,u,l),e===hl&&(vl=hl=null,ml=0),zl=t,Bl=e,Wl=n,Ul=a,jl=o,Vl=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,oe(de,function(){return wc(),null})):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=F.T,F.T=null,o=P.p,P.p=2,s=pl,pl|=4;try{!function(e,t){if(e=e.containerInfo,vf=xd,or(e=rr(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(m){n=null;break e}var s=0,u=-1,l=-1,c=0,f=0,d=e,p=null;t:for(;;){for(var h;d!==n||0!==o&&3!==d.nodeType||(u=s+o),d!==a||0!==r&&3!==d.nodeType||(l=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(h=d.firstChild);)p=d,d=h;for(;;){if(d===e)break t;if(p===n&&++c===o&&(u=s),p===a&&++f===r&&(l=s),null!==(h=d.nextSibling))break;p=(d=p).parentNode}d=h}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(mf={focusedElem:e,selectionRange:n},xd=!1,Ou=t;null!==Ou;)if(e=(t=Ou).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ou=e;else for(;null!==Ou;){switch(a=(t=Ou).alternate,e=t.flags,t.tag){case 0:if(0!==(4&e)&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(o=e[n]).ref.impl=o.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==a){e=void 0,n=t,o=a.memoizedProps,a=a.memoizedState,r=n.stateNode;try{var v=Cs(n.type,o);e=r.getSnapshotBeforeUpdate(v,a),r.__reactInternalSnapshotBeforeUpdate=e}catch(g){Cc(n,n.return,g)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))Tf(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Tf(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(i(163))}if(null!==(e=t.sibling)){e.return=t.return,Ou=e;break}Ou=t.return}}(e,t)}finally{pl=s,P.p=o,F.T=r}}Ll=1,mc(),gc(),yc()}}function mc(){if(1===Ll){Ll=0;var e=Bl,t=zl,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=F.T,F.T=null;var r=P.p;P.p=2;var o=pl;pl|=4;try{Gu(t,e);var a=mf,i=rr(e.containerInfo),s=a.focusedElem,u=a.selectionRange;if(i!==s&&s&&s.ownerDocument&&nr(s.ownerDocument.documentElement,s)){if(null!==u&&or(s)){var l=u.start,c=u.end;if(void 0===c&&(c=l),"selectionStart"in s)s.selectionStart=l,s.selectionEnd=Math.min(c,s.value.length);else{var f=s.ownerDocument||document,d=f&&f.defaultView||window;if(d.getSelection){var p=d.getSelection(),h=s.textContent.length,v=Math.min(u.start,h),m=void 0===u.end?v:Math.min(u.end,h);!p.extend&&v>m&&(i=m,m=v,v=i);var g=tr(s,v),y=tr(s,m);if(g&&y&&(1!==p.rangeCount||p.anchorNode!==g.node||p.anchorOffset!==g.offset||p.focusNode!==y.node||p.focusOffset!==y.offset)){var b=f.createRange();b.setStart(g.node,g.offset),p.removeAllRanges(),v>m?(p.addRange(b),p.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),p.addRange(b))}}}}for(f=[],p=s;p=p.parentNode;)1===p.nodeType&&f.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<f.length;s++){var x=f[s];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}xd=!!vf,mf=vf=null}finally{pl=o,P.p=r,F.T=n}}e.current=t,Ll=2}}function gc(){if(2===Ll){Ll=0;var e=Bl,t=zl,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=F.T,F.T=null;var r=P.p;P.p=2;var o=pl;pl|=4;try{Fu(e,t.alternate,t)}finally{pl=o,P.p=r,F.T=n}}Ll=3}}function yc(){if(4===Ll||3===Ll){Ll=0,se();var e=Bl,t=zl,n=Wl,r=Vl;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Ll=5:(Ll=0,zl=Bl=null,bc(e,e.pendingLanes));var o=e.pendingLanes;if(0===o&&(Ml=null),Le(n),t=t.stateNode,ye&&"function"===typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(ge,t,void 0,128===(128&t.current.flags))}catch(u){}if(null!==r){t=F.T,o=P.p,P.p=2,F.T=null;try{for(var a=e.onRecoverableError,i=0;i<r.length;i++){var s=r[i];a(s.value,{componentStack:s.stack})}}finally{F.T=t,P.p=o}}0!==(3&Wl)&&xc(),Pc(e),o=e.pendingLanes,0!==(261930&n)&&0!==(42&o)?e===Gl?Hl++:(Hl=0,Gl=e):Hl=0,Mc(0,!1)}}function bc(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Uo(t)))}function xc(){return mc(),gc(),yc(),wc()}function wc(){if(5!==Ll)return!1;var e=Bl,t=Ul;Ul=0;var n=Le(Wl),r=F.T,o=P.p;try{P.p=32>n?32:n,F.T=null,n=jl,jl=null;var a=Bl,s=Wl;if(Ll=0,zl=Bl=null,Wl=0,0!==(6&pl))throw Error(i(331));var u=pl;if(pl|=4,ul(a.current),el(a,a.current,s,n),pl=u,Mc(0,!1),ye&&"function"===typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(ge,a)}catch(l){}return!0}finally{P.p=o,F.T=r,bc(e,t)}}function Ec(e,t,n){t=$r(n,t),null!==(e=xa(e,t=Ns(e.stateNode,t,2),2))&&(De(e,2),Pc(e))}function Cc(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ml||!Ml.has(r))){e=$r(n,e),null!==(r=xa(t,n=Ts(2),2))&&(As(n,r,t,e),De(r,2),Pc(r));break}}t=t.return}}function Sc(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new dl;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(wl=!0,o.add(n),e=kc.bind(null,e,t,n),t.then(e,e))}function kc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,hl===e&&(ml&n)===n&&(4===Cl||3===Cl&&(62914560&ml)===ml&&300>ue()-Dl?0===(2&pl)&&tc(e,0):Rl|=n,Il===ml&&(Il=0)),Pc(e)}function Rc(e,t){0===t&&(t=Te()),null!==(e=Or(e,t))&&(De(e,t),Pc(e))}function _c(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Rc(e,n)}function Ic(e,t){var n=0;switch(e.tag){case 31:case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(i(314))}null!==r&&r.delete(t),Rc(e,n)}var Nc=null,Tc=null,Ac=!1,Dc=!1,Oc=!1,Fc=0;function Pc(e){e!==Tc&&null===e.next&&(null===Tc?Nc=Tc=e:Tc=Tc.next=e),Dc=!0,Ac||(Ac=!0,kf(function(){0!==(6&pl)?oe(ce,Lc):Bc()}))}function Mc(e,t){if(!Oc&&Dc){Oc=!0;do{for(var n=!1,r=Nc;null!==r;){if(!t)if(0!==e){var o=r.pendingLanes;if(0===o)var a=0;else{var i=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-xe(42|e)+1)-1,a=201326741&(a&=o&~(i&~s))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,Uc(r,a))}else a=ml,0===(3&(a=_e(r,r===hl?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||Ie(r,a)||(n=!0,Uc(r,a));r=r.next}}while(n);Oc=!1}}function Lc(){Bc()}function Bc(){Dc=Ac=!1;var e=0;0!==Fc&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==wf&&(wf=e,!0);return wf=null,!1}()&&(e=Fc);for(var t=ue(),n=null,r=Nc;null!==r;){var o=r.next,a=zc(r,t);0===a?(r.next=null,null===n?Nc=o:n.next=o,null===o&&(Tc=n)):(n=r,(0!==e||0!==(3&a))&&(Dc=!0)),r=o}0!==Ll&&5!==Ll||Mc(e,!1),0!==Fc&&(Fc=0)}function zc(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var i=31-xe(a),s=1<<i,u=o[i];-1===u?0!==(s&n)&&0===(s&r)||(o[i]=Ne(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}if(n=ml,n=_e(e,e===(t=hl)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===gl||9===gl)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&ae(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||Ie(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&ae(r),Le(n)){case 2:case 8:n=fe;break;case 32:default:n=de;break;case 268435456:n=he}return r=Wc.bind(null,e),n=oe(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&ae(r),e.callbackPriority=2,e.callbackNode=null,2}function Wc(e,t){if(0!==Ll&&5!==Ll)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(xc()&&e.callbackNode!==n)return null;var r=ml;return 0===(r=_e(e,e===hl?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Xl(e,r,t),zc(e,ue()),null!=e.callbackNode&&e.callbackNode===n?Wc.bind(null,e):null)}function Uc(e,t){if(xc())return null;Xl(e,t,!0)}function jc(){if(0===Fc){var e=Ho;0===e&&(e=Ce,0===(261888&(Ce<<=1))&&(Ce=256)),Fc=e}return Fc}function Vc(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:At(""+e)}function Hc(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Gc=0;Gc<Sr.length;Gc++){var qc=Sr[Gc];kr(qc.toLowerCase(),"on"+(qc[0].toUpperCase()+qc.slice(1)))}kr(mr,"onAnimationEnd"),kr(gr,"onAnimationIteration"),kr(yr,"onAnimationStart"),kr("dblclick","onDoubleClick"),kr("focusin","onFocus"),kr("focusout","onBlur"),kr(br,"onTransitionRun"),kr(xr,"onTransitionStart"),kr(wr,"onTransitionCancel"),kr(Er,"onTransitionEnd"),ot("onMouseEnter",["mouseout","mouseover"]),ot("onMouseLeave",["mouseout","mouseover"]),ot("onPointerEnter",["pointerout","pointerover"]),ot("onPointerLeave",["pointerout","pointerover"]),rt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rt("onBeforeInput",["compositionend","keypress","textInput","paste"]),rt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$c=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Kc));function Xc(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&o.isPropagationStopped())break e;a=s,o.currentTarget=l;try{a(o)}catch(c){Rr(c)}o.currentTarget=null,a=u}else for(i=0;i<r.length;i++){if(u=(s=r[i]).instance,l=s.currentTarget,s=s.listener,u!==a&&o.isPropagationStopped())break e;a=s,o.currentTarget=l;try{a(o)}catch(c){Rr(c)}o.currentTarget=null,a=u}}}}function Yc(e,t){var n=t[He];void 0===n&&(n=t[He]=new Set);var r=e+"__bubble";n.has(r)||(ef(t,e,2,!1),n.add(r))}function Qc(e,t,n){var r=0;t&&(r|=4),ef(n,e,r,t)}var Jc="_reactListening"+Math.random().toString(36).slice(2);function Zc(e){if(!e[Jc]){e[Jc]=!0,tt.forEach(function(t){"selectionchange"!==t&&($c.has(t)||Qc(t,!1,e),Qc(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Jc]||(t[Jc]=!0,Qc("selectionchange",!1,t))}}function ef(e,t,n,r){switch(_d(t)){case 2:var o=wd;break;case 8:o=Ed;break;default:o=Cd}n=o.bind(null,t,n,e),o=void 0,!jt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function tf(e,t,n,r,o){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o)break;if(4===i)for(i=r.return;null!==i;){var l=i.tag;if((3===l||4===l)&&i.stateNode.containerInfo===o)return;i=i.return}for(;null!==s;){if(null===(i=Ye(s)))return;if(5===(l=i.tag)||6===l||26===l||27===l){r=a=i;continue e}s=s.parentNode}}r=r.return}zt(function(){var r=a,o=Ft(n),i=[];e:{var s=Cr.get(e);if(void 0!==s){var l=nn,c=e;switch(e){case"keypress":if(0===$t(n))break e;case"keydown":case"keyup":l=yn;break;case"focusin":c="focus",l=ln;break;case"focusout":c="blur",l=ln;break;case"beforeblur":case"afterblur":l=ln;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=sn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=un;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=xn;break;case mr:case gr:case yr:l=cn;break;case Er:l=wn;break;case"scroll":case"scrollend":l=on;break;case"wheel":l=En;break;case"copy":case"cut":case"paste":l=fn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=bn;break;case"toggle":case"beforetoggle":l=Cn}var f=0!==(4&t),d=!f&&("scroll"===e||"scrollend"===e),p=f?null!==s?s+"Capture":null:s;f=[];for(var h,v=r;null!==v;){var m=v;if(h=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===h||null===p||null!=(m=Wt(v,p))&&f.push(nf(v,m,h)),d)break;v=v.return}0<f.length&&(s=new l(s,c,null,n,o),i.push({event:s,listeners:f}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Ot||!(c=n.relatedTarget||n.fromElement)||!Ye(c)&&!c[Ve])&&(l||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?Ye(c):null)&&(d=u(c),f=c.tag,c!==d||5!==f&&27!==f&&6!==f)&&(c=null)):(l=null,c=r),l!==c)){if(f=sn,m="onMouseLeave",p="onMouseEnter",v="mouse","pointerout"!==e&&"pointerover"!==e||(f=bn,m="onPointerLeave",p="onPointerEnter",v="pointer"),d=null==l?s:Je(l),h=null==c?s:Je(c),(s=new f(m,v+"leave",l,n,o)).target=d,s.relatedTarget=h,m=null,Ye(o)===r&&((f=new f(p,v+"enter",c,n,o)).target=h,f.relatedTarget=d,m=f),d=m,l&&c)e:{for(f=of,v=c,h=0,m=p=l;m;m=f(m))h++;m=0;for(var g=v;g;g=f(g))m++;for(;0<h-m;)p=f(p),h--;for(;0<m-h;)v=f(v),m--;for(;h--;){if(p===v||null!==v&&p===v.alternate){f=p;break e}p=f(p),v=f(v)}f=null}else f=null;null!==l&&af(i,s,l,f,!1),null!==c&&null!==d&&af(i,d,c,f,!0)}if("select"===(l=(s=r?Je(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var y=Un;else if(Pn(s))if(jn)y=Qn;else{y=Xn;var b=$n}else!(l=s.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?r&&It(r.elementType)&&(y=Un):y=Yn;switch(y&&(y=y(e,r))?Mn(i,y,n,o):(b&&b(e,s,r),"focusout"===e&&r&&"number"===s.type&&null!=r.memoizedProps.value&&xt(s,"number",s.value)),b=r?Je(r):window,e){case"focusin":(Pn(b)||"true"===b.contentEditable)&&(ir=b,sr=r,ur=null);break;case"focusout":ur=sr=ir=null;break;case"mousedown":lr=!0;break;case"contextmenu":case"mouseup":case"dragend":lr=!1,cr(i,n,o);break;case"selectionchange":if(ar)break;case"keydown":case"keyup":cr(i,n,o)}var x;if(kn)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else On?An(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(In&&"ko"!==n.locale&&(On||"onCompositionStart"!==w?"onCompositionEnd"===w&&On&&(x=Kt()):(Gt="value"in(Ht=o)?Ht.value:Ht.textContent,On=!0)),0<(b=rf(r,w)).length&&(w=new dn(w,e,null,n,o),i.push({event:w,listeners:b}),x?w.data=x:null!==(x=Dn(n))&&(w.data=x))),(x=_n?function(e,t){switch(e){case"compositionend":return Dn(t);case"keypress":return 32!==t.which?null:(Tn=!0,Nn);case"textInput":return(e=t.data)===Nn&&Tn?null:e;default:return null}}(e,n):function(e,t){if(On)return"compositionend"===e||!kn&&An(e,t)?(e=Kt(),qt=Gt=Ht=null,On=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return In&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(w=rf(r,"onBeforeInput")).length&&(b=new dn("onBeforeInput","beforeinput",null,n,o),i.push({event:b,listeners:w}),b.data=x)),function(e,t,n,r,o){if("submit"===t&&n&&n.stateNode===o){var a=Vc((o[je]||null).action),i=r.submitter;i&&null!==(t=(t=i[je]||null)?Vc(t.formAction):i.getAttribute("formAction"))&&(a=t,i=null);var s=new nn("action","action",null,r,o);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==Fc){var e=i?Hc(o,i):new FormData(o);ts(n,{pending:!0,data:e,method:o.method,action:a},null,e)}}else"function"===typeof a&&(s.preventDefault(),e=i?Hc(o,i):new FormData(o),ts(n,{pending:!0,data:e,method:o.method,action:a},a,e))},currentTarget:o}]})}}(i,e,r,n,o)}Xc(i,t)})}function nf(e,t,n){return{instance:e,listener:t,currentTarget:n}}function rf(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;if(5!==(o=o.tag)&&26!==o&&27!==o||null===a||(null!=(o=Wt(e,n))&&r.unshift(nf(e,o,a)),null!=(o=Wt(e,t))&&r.push(nf(e,o,a))),3===e.tag)return r;e=e.return}return[]}function of(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function af(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(s=s.tag,null!==u&&u===r)break;5!==s&&26!==s&&27!==s||null===l||(u=l,o?null!=(l=Wt(n,a))&&i.unshift(nf(n,l,u)):o||null!=(l=Wt(n,a))&&i.push(nf(n,l,u))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var sf=/\r\n?/g,uf=/\u0000|\uFFFD/g;function lf(e){return("string"===typeof e?e:""+e).replace(sf,"\n").replace(uf,"")}function cf(e,t){return t=lf(t),lf(e)===t}function ff(e,t,n,r,o,a){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||St(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&St(e,""+r);break;case"className":lt(e,"class",r);break;case"tabIndex":lt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":lt(e,n,r);break;case"style":_t(e,r,a);break;case"data":if("object"!==t){lt(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=At(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof a&&("formAction"===n?("input"!==t&&ff(e,t,"name",o.name,o,null),ff(e,t,"formEncType",o.formEncType,o,null),ff(e,t,"formMethod",o.formMethod,o,null),ff(e,t,"formTarget",o.formTarget,o,null)):(ff(e,t,"encType",o.encType,o,null),ff(e,t,"method",o.method,o,null),ff(e,t,"target",o.target,o,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=At(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Dt);break;case"onScroll":null!=r&&Yc("scroll",e);break;case"onScrollEnd":null!=r&&Yc("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(i(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=At(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Yc("beforetoggle",e),Yc("toggle",e),ut(e,"popover",r);break;case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":ut(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&ut(e,n=Nt.get(n)||n,r)}}function df(e,t,n,r,o,a){switch(n){case"style":_t(e,r,a);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(i(60));e.innerHTML=n}}break;case"children":"string"===typeof r?St(e,r):("number"===typeof r||"bigint"===typeof r)&&St(e,""+r);break;case"onScroll":null!=r&&Yc("scroll",e);break;case"onScrollEnd":null!=r&&Yc("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Dt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:nt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(o=n.endsWith("Capture"),t=n.slice(2,o?n.length-7:void 0),"function"===typeof(a=null!=(a=e[je]||null)?a[n]:null)&&e.removeEventListener(t,a,o),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):ut(e,n,r):("function"!==typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,o)))}}function pf(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Yc("error",e),Yc("load",e);var r,o=!1,a=!1;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(null!=s)switch(r){case"src":o=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:ff(e,t,r,s,n,null)}}return a&&ff(e,t,"srcSet",n.srcSet,n,null),void(o&&ff(e,t,"src",n.src,n,null));case"input":Yc("invalid",e);var u=r=s=a=null,l=null,c=null;for(o in n)if(n.hasOwnProperty(o)){var f=n[o];if(null!=f)switch(o){case"name":a=f;break;case"type":s=f;break;case"checked":l=f;break;case"defaultChecked":c=f;break;case"value":r=f;break;case"defaultValue":u=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(i(137,t));break;default:ff(e,t,o,f,n,null)}}return void bt(e,r,u,l,c,s,a,!1);case"select":for(a in Yc("invalid",e),o=s=r=null,n)if(n.hasOwnProperty(a)&&null!=(u=n[a]))switch(a){case"value":r=u;break;case"defaultValue":s=u;break;case"multiple":o=u;default:ff(e,t,a,u,n,null)}return t=r,n=s,e.multiple=!!o,void(null!=t?wt(e,!!o,t,!1):null!=n&&wt(e,!!o,n,!0));case"textarea":for(s in Yc("invalid",e),r=a=o=null,n)if(n.hasOwnProperty(s)&&null!=(u=n[s]))switch(s){case"value":o=u;break;case"defaultValue":a=u;break;case"children":r=u;break;case"dangerouslySetInnerHTML":if(null!=u)throw Error(i(91));break;default:ff(e,t,s,u,n,null)}return void Ct(e,o,a,r);case"option":for(l in n)if(n.hasOwnProperty(l)&&null!=(o=n[l]))if("selected"===l)e.selected=o&&"function"!==typeof o&&"symbol"!==typeof o;else ff(e,t,l,o,n,null);return;case"dialog":Yc("beforetoggle",e),Yc("toggle",e),Yc("cancel",e),Yc("close",e);break;case"iframe":case"object":Yc("load",e);break;case"video":case"audio":for(o=0;o<Kc.length;o++)Yc(Kc[o],e);break;case"image":Yc("error",e),Yc("load",e);break;case"details":Yc("toggle",e);break;case"embed":case"source":case"link":Yc("error",e),Yc("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&null!=(o=n[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:ff(e,t,c,o,n,null)}return;default:if(It(t)){for(f in n)n.hasOwnProperty(f)&&(void 0!==(o=n[f])&&df(e,t,f,o,n,void 0));return}}for(u in n)n.hasOwnProperty(u)&&(null!=(o=n[u])&&ff(e,t,u,o,n,null))}function hf(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var vf=null,mf=null;function gf(e){return 9===e.nodeType?e:e.ownerDocument}function yf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function bf(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function xf(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var wf=null;var Ef="function"===typeof setTimeout?setTimeout:void 0,Cf="function"===typeof clearTimeout?clearTimeout:void 0,Sf="function"===typeof Promise?Promise:void 0,kf="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof Sf?function(e){return Sf.resolve(null).then(e).catch(Rf)}:Ef;function Rf(e){setTimeout(function(){throw e})}function _f(e){return"head"===e}function If(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)||"/&"===n){if(0===r)return e.removeChild(o),void Gd(t);r--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)r++;else if("html"===n)zf(e.ownerDocument.documentElement);else if("head"===n){zf(n=e.ownerDocument.head);for(var a=n.firstChild;a;){var i=a.nextSibling,s=a.nodeName;a[$e]||"SCRIPT"===s||"STYLE"===s||"LINK"===s&&"stylesheet"===a.rel.toLowerCase()||n.removeChild(a),a=i}}else"body"===n&&zf(e.ownerDocument.body);n=o}while(n);Gd(t)}function Nf(e,t){var n=e;e=0;do{var r=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=r}while(n)}function Tf(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Tf(n),Xe(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Af(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Ff(e.nextSibling)))return null}return e}function Df(e){return"$?"===e.data||"$~"===e.data}function Of(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Ff(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Pf=null;function Mf(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Ff(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function Lf(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Bf(e,t,n){switch(t=gf(n),e){case"html":if(!(e=t.documentElement))throw Error(i(452));return e;case"head":if(!(e=t.head))throw Error(i(453));return e;case"body":if(!(e=t.body))throw Error(i(454));return e;default:throw Error(i(451))}}function zf(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Xe(e)}var Wf=new Map,Uf=new Set;function jf(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Vf=P.d;P.d={f:function(){var e=Vf.f(),t=Zl();return e||t},r:function(e){var t=Qe(e);null!==t&&5===t.tag&&"form"===t.type?rs(t):Vf.r(e)},D:function(e){Vf.D(e),Gf("dns-prefetch",e,null)},C:function(e,t){Vf.C(e,t),Gf("preconnect",e,t)},L:function(e,t,n){Vf.L(e,t,n);var r=Hf;if(r&&e&&t){var o='link[rel="preload"][as="'+gt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(o+='[imagesrcset="'+gt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(o+='[imagesizes="'+gt(n.imageSizes)+'"]')):o+='[href="'+gt(e)+'"]';var a=o;switch(t){case"style":a=Kf(e);break;case"script":a=Yf(e)}Wf.has(a)||(e=p({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Wf.set(a,e),null!==r.querySelector(o)||"style"===t&&r.querySelector($f(a))||"script"===t&&r.querySelector(Qf(a))||(pf(t=r.createElement("link"),"link",e),et(t),r.head.appendChild(t)))}},m:function(e,t){Vf.m(e,t);var n=Hf;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",o='link[rel="modulepreload"][as="'+gt(r)+'"][href="'+gt(e)+'"]',a=o;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=Yf(e)}if(!Wf.has(a)&&(e=p({rel:"modulepreload",href:e},t),Wf.set(a,e),null===n.querySelector(o))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Qf(a)))return}pf(r=n.createElement("link"),"link",e),et(r),n.head.appendChild(r)}}},X:function(e,t){Vf.X(e,t);var n=Hf;if(n&&e){var r=Ze(n).hoistableScripts,o=Yf(e),a=r.get(o);a||((a=n.querySelector(Qf(o)))||(e=p({src:e,async:!0},t),(t=Wf.get(o))&&td(e,t),et(a=n.createElement("script")),pf(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}},S:function(e,t,n){Vf.S(e,t,n);var r=Hf;if(r&&e){var o=Ze(r).hoistableStyles,a=Kf(e);t=t||"default";var i=o.get(a);if(!i){var s={loading:0,preload:null};if(i=r.querySelector($f(a)))s.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Wf.get(a))&&ed(e,n);var u=i=r.createElement("link");et(u),pf(u,"link",e),u._p=new Promise(function(e,t){u.onload=e,u.onerror=t}),u.addEventListener("load",function(){s.loading|=1}),u.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Zf(i,t,r)}i={type:"stylesheet",instance:i,count:1,state:s},o.set(a,i)}}},M:function(e,t){Vf.M(e,t);var n=Hf;if(n&&e){var r=Ze(n).hoistableScripts,o=Yf(e),a=r.get(o);a||((a=n.querySelector(Qf(o)))||(e=p({src:e,async:!0,type:"module"},t),(t=Wf.get(o))&&td(e,t),et(a=n.createElement("script")),pf(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}}};var Hf="undefined"===typeof document?null:document;function Gf(e,t,n){var r=Hf;if(r&&"string"===typeof t&&t){var o=gt(t);o='link[rel="'+e+'"][href="'+o+'"]',"string"===typeof n&&(o+='[crossorigin="'+n+'"]'),Uf.has(o)||(Uf.add(o),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(o)&&(pf(t=r.createElement("link"),"link",e),et(t),r.head.appendChild(t)))}}function qf(e,t,n,r){var o,a,s,u,l=(l=q.current)?jf(l):null;if(!l)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Kf(n.href),(r=(n=Ze(l).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Kf(n.href);var c=Ze(l).hoistableStyles,f=c.get(e);if(f||(l=l.ownerDocument||l,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,f),(c=l.querySelector($f(e)))&&!c._p&&(f.instance=c,f.state.loading=5),Wf.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Wf.set(e,n),c||(o=l,a=e,s=n,u=f.state,o.querySelector('link[rel="preload"][as="style"]['+a+"]")?u.loading=1:(a=o.createElement("link"),u.preload=a,a.addEventListener("load",function(){return u.loading|=1}),a.addEventListener("error",function(){return u.loading|=2}),pf(a,"link",s),et(a),o.head.appendChild(a))))),t&&null===r)throw Error(i(528,""));return f}if(t&&null!==r)throw Error(i(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Yf(n),(r=(n=Ze(l).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Kf(e){return'href="'+gt(e)+'"'}function $f(e){return'link[rel="stylesheet"]['+e+"]"}function Xf(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Yf(e){return'[src="'+gt(e)+'"]'}function Qf(e){return"script[async]"+e}function Jf(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+gt(n.href)+'"]');if(r)return t.instance=r,et(r),r;var o=p({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return et(r=(e.ownerDocument||e).createElement("style")),pf(r,"style",o),Zf(r,n.precedence,e),t.instance=r;case"stylesheet":o=Kf(n.href);var a=e.querySelector($f(o));if(a)return t.state.loading|=4,t.instance=a,et(a),a;r=Xf(n),(o=Wf.get(o))&&ed(r,o),et(a=(e.ownerDocument||e).createElement("link"));var s=a;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),pf(a,"link",r),t.state.loading|=4,Zf(a,n.precedence,e),t.instance=a;case"script":return a=Yf(n.src),(o=e.querySelector(Qf(a)))?(t.instance=o,et(o),o):(r=n,(o=Wf.get(a))&&td(r=p({},n),o),et(o=(e=e.ownerDocument||e).createElement("script")),pf(o,"link",r),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(i(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Zf(r,n.precedence,e));return t.instance}function Zf(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=r.length?r[r.length-1]:null,a=o,i=0;i<r.length;i++){var s=r[i];if(s.dataset.precedence===t)a=s;else if(a!==o)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function ed(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function td(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var nd=null;function rd(e,t,n){if(null===nd){var r=new Map,o=nd=new Map;o.set(n,r)}else(r=(o=nd).get(n))||(r=new Map,o.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),o=0;o<n.length;o++){var a=n[o];if(!(a[$e]||a[Ue]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var i=a.getAttribute(t)||"";i=e+i;var s=r.get(i);s?s.push(a):r.set(i,[a])}}return r}function od(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function ad(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var id=0;function sd(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)ld(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var ud=null;function ld(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,ud=new Map,t.forEach(cd,e),ud=null,sd.call(e))}function cd(e,t){if(!(4&t.state.loading)){var n=ud.get(e);if(n)var r=n.get(null);else{n=new Map,ud.set(e,n);for(var o=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<o.length;a++){var i=o[a];"LINK"!==i.nodeName&&"not all"===i.getAttribute("media")||(n.set(i.dataset.precedence,i),r=i)}r&&n.set(null,r)}i=(o=t.instance).getAttribute("data-precedence"),(a=n.get(i)||r)===r&&n.set(null,o),n.set(i,o),this.count++,r=sd.bind(this),o.addEventListener("load",r),o.addEventListener("error",r),a?a.parentNode.insertBefore(o,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(o,e.firstChild),t.state.loading|=4}}var fd={$$typeof:w,Provider:null,Consumer:null,_currentValue:M,_currentValue2:M,_threadCount:0};function dd(e,t,n,r,o,a,i,s,u){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ae(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ae(0),this.hiddenUpdates=Ae(null),this.identifierPrefix=r,this.onUncaughtError=o,this.onCaughtError=a,this.onRecoverableError=i,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=u,this.incompleteTransitions=new Map}function pd(e,t,n,r,o,a,i,s,u,l,c,f){return e=new dd(e,t,n,i,u,l,c,f,s),t=1,!0===a&&(t|=24),a=Br(3,null,null,t),e.current=a,a.stateNode=e,(t=Wo()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},ga(a),e}function hd(e){return e?e=Mr:Mr}function vd(e,t,n,r,o,a){o=hd(o),null===r.context?r.context=o:r.pendingContext=o,(r=ba(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=xa(e,r,t))&&($l(n,0,t),wa(n,e,t))}function md(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function gd(e,t){md(e,t),(e=e.alternate)&&md(e,t)}function yd(e){if(13===e.tag||31===e.tag){var t=Or(e,67108864);null!==t&&$l(t,0,67108864),gd(e,67108864)}}function bd(e){if(13===e.tag||31===e.tag){var t=ql(),n=Or(e,t=Me(t));null!==n&&$l(n,0,t),gd(e,t)}}var xd=!0;function wd(e,t,n,r){var o=F.T;F.T=null;var a=P.p;try{P.p=2,Cd(e,t,n,r)}finally{P.p=a,F.T=o}}function Ed(e,t,n,r){var o=F.T;F.T=null;var a=P.p;try{P.p=8,Cd(e,t,n,r)}finally{P.p=a,F.T=o}}function Cd(e,t,n,r){if(xd){var o=Sd(r);if(null===o)tf(e,t,r,kd,n),Md(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return Nd=Ld(Nd,e,t,n,r,o),!0;case"dragenter":return Td=Ld(Td,e,t,n,r,o),!0;case"mouseover":return Ad=Ld(Ad,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return Dd.set(a,Ld(Dd.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Od.set(a,Ld(Od.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Md(e,r),4&t&&-1<Pd.indexOf(e)){for(;null!==o;){var a=Qe(o);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var i=Re(a.pendingLanes);if(0!==i){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;i;){var u=1<<31-xe(i);s.entanglements[1]|=u,i&=~u}Pc(a),0===(6&pl)&&(Fl=ue()+500,Mc(0,!1))}}break;case 31:case 13:null!==(s=Or(a,2))&&$l(s,0,2),Zl(),gd(a,2)}if(null===(a=Sd(r))&&tf(e,t,r,kd,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else tf(e,t,r,null,n)}}function Sd(e){return Rd(e=Ft(e))}var kd=null;function Rd(e){if(kd=null,null!==(e=Ye(e))){var t=u(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=l(t)))return e;e=null}else if(31===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return kd=e,null}function _d(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(le()){case ce:return 2;case fe:return 8;case de:case pe:return 32;case he:return 268435456;default:return 32}default:return 32}}var Id=!1,Nd=null,Td=null,Ad=null,Dd=new Map,Od=new Map,Fd=[],Pd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Md(e,t){switch(e){case"focusin":case"focusout":Nd=null;break;case"dragenter":case"dragleave":Td=null;break;case"mouseover":case"mouseout":Ad=null;break;case"pointerover":case"pointerout":Dd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Od.delete(t.pointerId)}}function Ld(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=Qe(t))&&yd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Bd(e){var t=Ye(e.target);if(null!==t){var n=u(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=l(n)))return e.blockedOn=t,void ze(e.priority,function(){bd(n)})}else if(31===t){if(null!==(t=c(n)))return e.blockedOn=t,void ze(e.priority,function(){bd(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Sd(e.nativeEvent);if(null!==n)return null!==(t=Qe(n))&&yd(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ot=r,n.target.dispatchEvent(r),Ot=null,t.shift()}return!0}function Wd(e,t,n){zd(e)&&n.delete(t)}function Ud(){Id=!1,null!==Nd&&zd(Nd)&&(Nd=null),null!==Td&&zd(Td)&&(Td=null),null!==Ad&&zd(Ad)&&(Ad=null),Dd.forEach(Wd),Od.forEach(Wd)}function jd(e,t){e.blockedOn===t&&(e.blockedOn=null,Id||(Id=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ud)))}var Vd=null;function Hd(e){Vd!==e&&(Vd=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Vd===e&&(Vd=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],o=e[t+2];if("function"!==typeof r){if(null===Rd(r||n))continue;break}var a=Qe(n);null!==a&&(e.splice(t,3),t-=3,ts(a,{pending:!0,data:o,method:n.method,action:r},r,o))}}))}function Gd(e){function t(t){return jd(t,e)}null!==Nd&&jd(Nd,e),null!==Td&&jd(Td,e),null!==Ad&&jd(Ad,e),Dd.forEach(t),Od.forEach(t);for(var n=0;n<Fd.length;n++){var r=Fd[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Fd.length&&null===(n=Fd[0]).blockedOn;)Bd(n),null===n.blockedOn&&Fd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var o=n[r],a=n[r+1],i=o[je]||null;if("function"===typeof a)i||Hd(n);else if(i){var s=null;if(a&&a.hasAttribute("formAction")){if(o=a,i=a[je]||null)s=i.formAction;else if(null!==Rd(o))continue}else s=i.action;"function"===typeof s?n[r+1]=s:(n.splice(r,3),r-=3),Hd(n)}}}function qd(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return o=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==o&&(o(),o=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"===typeof navigation){var r=!1,o=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==o&&(o(),o=null)}}}function Kd(e){this._internalRoot=e}function $d(e){this._internalRoot=e}$d.prototype.render=Kd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));vd(t.current,ql(),e,t,null,null)},$d.prototype.unmount=Kd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;vd(e.current,2,null,e,null,null),Zl(),t[Ve]=null}},$d.prototype.unstable_scheduleHydration=function(e){if(e){var t=Be();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Fd.length&&0!==t&&t<Fd[n].priority;n++);Fd.splice(n,0,e),0===n&&Bd(e)}};var Xd=o.version;if("19.2.3"!==Xd)throw Error(i(527,Xd,"19.2.3"));P.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=u(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return f(o),e;if(a===r)return f(o),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=o,r=a;else{for(var s=!1,l=o.child;l;){if(l===n){s=!0,n=o,r=a;break}if(l===r){s=!0,r=o,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,r=o;break}if(l===r){s=!0,r=a,n=o;break}l=l.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?d(e):null)?null:e.stateNode};var Yd={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.3"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Qd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qd.isDisabled&&Qd.supportsFiber)try{ge=Qd.inject(Yd),ye=Qd}catch(Zd){}}t.createRoot=function(e,t){if(!s(e))throw Error(i(299));var n=!1,r="",o=Ss,a=ks,u=Rs;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(u=t.onRecoverableError)),t=pd(e,1,!1,null,0,n,r,null,o,a,u,qd),e[Ve]=t.current,Zc(e),new Kd(t)},t.hydrateRoot=function(e,t,n){if(!s(e))throw Error(i(299));var r=!1,o="",a=Ss,u=ks,l=Rs,c=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(u=n.onCaughtError),void 0!==n.onRecoverableError&&(l=n.onRecoverableError),void 0!==n.formState&&(c=n.formState)),(t=pd(e,1,!0,t,0,r,o,c,a,u,l,qd)).context=hd(null),n=t.current,(o=ba(r=Me(r=ql()))).callback=null,xa(n,o,r),n=r,t.current.lanes=n,De(t,n),Pc(t),e[Ve]=t.current,Zc(e),new $d(t)},t.version="19.2.3"},12(){},43(e,t,n){"use strict";e.exports=n(288)},233(e,t,n){"use strict";e.exports=n(382)},288(e,t){"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),h=Symbol.iterator;var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||v}function b(){}function x(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||v}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var w=x.prototype=new b;w.constructor=x,m(w,y.prototype),w.isPureReactComponent=!0;var E=Array.isArray;function C(){}var S={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function R(e,t,r){var o=r.ref;return{$$typeof:n,type:e,key:t,ref:void 0!==o?o:null,props:r}}function _(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function N(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u,l,c=!1;if(null===e)c=!0;else switch(s){case"bigint":case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0;break;case d:return T((c=e._init)(e._payload),t,o,a,i)}}if(c)return i=i(e),c=""===a?"."+N(e,0):a,E(i)?(o="",null!=c&&(o=c.replace(I,"$&/")+"/"),T(i,t,o,"",function(e){return e})):null!=i&&(_(i)&&(u=i,l=o+(null==i.key||e&&e.key===i.key?"":(""+i.key).replace(I,"$&/")+"/")+c,i=R(u.type,l,u.props)),t.push(i)),1;c=0;var f,p=""===a?".":a+":";if(E(e))for(var v=0;v<e.length;v++)c+=T(a=e[v],t,o,s=p+N(a,v),i);else if("function"===typeof(v=null===(f=e)||"object"!==typeof f?null:"function"===typeof(f=h&&f[h]||f["@@iterator"])?f:null))for(e=v.call(e),v=0;!(a=e.next()).done;)c+=T(a=a.value,t,o,s=p+N(a,v++),i);else if("object"===s){if("function"===typeof e.then)return T(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(C,C):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,o,a,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return c}function A(e,t,n){if(null==e)return e;var r=[],o=0;return T(e,r,"","",function(e){return t.call(n,e,o++)}),r}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},F={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!_(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t.Activity=p,t.Children=F,t.Component=y,t.Fragment=o,t.Profiler=i,t.PureComponent=x,t.StrictMode=a,t.Suspense=c,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return S.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key;if(null!=t)for(a in void 0!==t.key&&(o=""+t.key),t)!k.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var i=Array(a),s=0;s<a;s++)i[s]=arguments[s+2];r.children=i}return R(e.type,o,r)},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var r,o={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)k.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(o[r]=t[r]);var i=arguments.length-2;if(1===i)o.children=n;else if(1<i){for(var s=Array(i),u=0;u<i;u++)s[u]=arguments[u+2];o.children=s}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===o[r]&&(o[r]=i[r]);return R(e,a,o)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=_,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var r=e(),o=S.S;null!==o&&o(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(C,O)}catch(a){O(a)}finally{null!==t&&null!==n.types&&(t.types=n.types),S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return S.H.useEffect(e,t)},t.useEffectEvent=function(e){return S.H.useEffectEvent(e)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.2.3"},382(e,t){"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),h=Symbol.iterator;var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||v}function b(){}function x(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||v}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var w=x.prototype=new b;w.constructor=x,m(w,y.prototype),w.isPureReactComponent=!0;var E=Array.isArray;function C(){}var S={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function R(e,t,r){var o=r.ref;return{$$typeof:n,type:e,key:t,ref:void 0!==o?o:null,props:r}}function _(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function N(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u,l,c=!1;if(null===e)c=!0;else switch(s){case"bigint":case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0;break;case d:return T((c=e._init)(e._payload),t,o,a,i)}}if(c)return i=i(e),c=""===a?"."+N(e,0):a,E(i)?(o="",null!=c&&(o=c.replace(I,"$&/")+"/"),T(i,t,o,"",function(e){return e})):null!=i&&(_(i)&&(u=i,l=o+(null==i.key||e&&e.key===i.key?"":(""+i.key).replace(I,"$&/")+"/")+c,i=R(u.type,l,u.props)),t.push(i)),1;c=0;var f,p=""===a?".":a+":";if(E(e))for(var v=0;v<e.length;v++)c+=T(a=e[v],t,o,s=p+N(a,v),i);else if("function"===typeof(v=null===(f=e)||"object"!==typeof f?null:"function"===typeof(f=h&&f[h]||f["@@iterator"])?f:null))for(e=v.call(e),v=0;!(a=e.next()).done;)c+=T(a=a.value,t,o,s=p+N(a,v++),i);else if("object"===s){if("function"===typeof e.then)return T(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(C,C):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,o,a,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return c}function A(e,t,n){if(null==e)return e;var r=[],o=0;return T(e,r,"","",function(e){return t.call(n,e,o++)}),r}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},F={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!_(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t.Activity=p,t.Children=F,t.Component=y,t.Fragment=o,t.Profiler=i,t.PureComponent=x,t.StrictMode=a,t.Suspense=c,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return S.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key;if(null!=t)for(a in void 0!==t.key&&(o=""+t.key),t)!k.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var i=Array(a),s=0;s<a;s++)i[s]=arguments[s+2];r.children=i}return R(e.type,o,r)},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var r,o={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)k.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(o[r]=t[r]);var i=arguments.length-2;if(1===i)o.children=n;else if(1<i){for(var s=Array(i),u=0;u<i;u++)s[u]=arguments[u+2];o.children=s}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===o[r]&&(o[r]=i[r]);return R(e,a,o)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=_,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var r=e(),o=S.S;null!==o&&o(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(C,O)}catch(a){O(a)}finally{null!==t&&null!==n.types&&(t.types=n.types),S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return S.H.useEffect(e,t)},t.useEffectEvent=function(e){return S.H.useEffectEvent(e)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.2.1"},391(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},475(){},519(){},579(e,t,n){"use strict";e.exports=n(799)},672(e,t,n){"use strict";var r=n(43);function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var i={d:{f:a,r:function(){throw Error(o(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},s=Symbol.for("react.portal");var u=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(o(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=u.T,n=i.p;try{if(u.T=null,i.p=2,e)return e()}finally{u.T=t,i.p=n,i.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,i.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&i.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin),o="string"===typeof t.integrity?t.integrity:void 0,a="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?i.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:o,fetchPriority:a}):"script"===n&&i.d.X(e,{crossOrigin:r,integrity:o,fetchPriority:a,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);i.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&i.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin);i.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=l(t.as,t.crossOrigin);i.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else i.d.m(e)},t.requestFormReset=function(e){i.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return u.H.useFormState(e,t,n)},t.useFormStatus=function(){return u.H.useHostTransitionStatus()},t.version="19.2.3"},799(e,t){"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function o(e,t,r){var o=null;if(void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),"key"in t)for(var a in r={},t)"key"!==a&&(r[a]=t[a]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:o,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=o,t.jsxs=o},853(e,t,n){"use strict";e.exports=n(896)},896(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>a(u,n))l<o&&0>a(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<o&&0>a(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],f=1,d=null,p=3,h=!1,v=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(c);null!==t;){if(null===t.callback)o(c);else{if(!(t.startTime<=e))break;o(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function E(e){if(m=!1,w(e),!v)if(null!==r(l))v=!0,S||(S=!0,C());else{var t=r(c);null!==t&&D(E,t.startTime-e)}}var C,S=!1,k=-1,R=5,_=-1;function I(){return!!g||!(t.unstable_now()-_<R)}function N(){if(g=!1,S){var e=t.unstable_now();_=e;var n=!0;try{e:{v=!1,m&&(m=!1,b(k),k=-1),h=!0;var a=p;try{t:{for(w(e),d=r(l);null!==d&&!(d.expirationTime>e&&I());){var i=d.callback;if("function"===typeof i){d.callback=null,p=d.priorityLevel;var s=i(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){d.callback=s,w(e),n=!0;break t}d===r(l)&&o(l),w(e)}else o(l);d=r(l)}if(null!==d)n=!0;else{var u=r(c);null!==u&&D(E,u.startTime-e),n=!1}}break e}finally{d=null,p=a,h=!1}n=void 0}}finally{n?C():S=!1}}}if("function"===typeof x)C=function(){x(N)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,A=T.port2;T.port1.onmessage=N,C=function(){A.postMessage(null)}}else C=function(){y(N,0)};function D(e,n){k=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_requestPaint=function(){g=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:f++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(c,e),null===r(l)&&e===r(c)&&(m?(b(k),k=-1):m=!0,D(E,a-i))):(e.sortIndex=s,n(l,e),v||h||(v=!0,S||(S=!0,C()))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},950(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o)return r;if("object"===typeof r&&r){if(4&o&&r.__esModule)return r;if(16&o&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&r;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>i[e]=()=>r[e]);return i.default=()=>r,n.d(a,i),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/LinkX/",(()=>{"use strict";var e={};n.r(e),n.d(e,{hasBrowserEnv:()=>qr,hasStandardBrowserEnv:()=>$r,hasStandardBrowserWebWorkerEnv:()=>Xr,navigator:()=>Kr,origin:()=>Yr});var t={};n.r(t),n.d(t,{AnchorPosition:()=>gA,DrawBox:()=>SA,DrawBoxOptions:()=>CA,DrawTextField:()=>EA,DrawTextFieldOptions:()=>wA});var r={};n.r(r),n.d(r,{DrawFaceLandmarks:()=>AD,DrawFaceLandmarksOptions:()=>TD,drawContour:()=>iD,drawDetections:()=>cD,drawFaceExpressions:()=>kD,drawFaceLandmarks:()=>DD});var o=n(43),a=n.t(o,2),i=n(391);function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}function c(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const p=["sri"],h=["page"],v=["page","matches"],m=["onClick","discover","prefetch","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"],g=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],y=["discover","fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"];var b="popstate";function x(){return _(function(e,t){let{pathname:n="/",search:r="",hash:o=""}=R(e.location.hash.substring(1));return n.startsWith("/")||n.startsWith(".")||(n="/"+n),S("",{pathname:n,search:r,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){let n=e.document.querySelector("base"),r="";if(n&&n.getAttribute("href")){let t=e.location.href,n=t.indexOf("#");r=-1===n?t:t.slice(0,n)}return r+"#"+("string"===typeof t?t:k(t))},function(e,t){E("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push(".concat(JSON.stringify(t),")"))},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function w(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function E(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(yg){}}}function C(e,t){return{usr:e.state,key:e.key,idx:t}}function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return d(d({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?R(t):t),{},{state:n,key:t&&t.key||r||Math.random().toString(36).substring(2,10)})}function k(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function R(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function _(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:o=document.defaultView,v5Compat:a=!1}=r,i=o.history,s="POP",u=null,l=c();function c(){return(i.state||{idx:null}).idx}function f(){s="POP";let e=c(),t=null==e?null:e-l;l=e,u&&u({action:s,location:h.location,delta:t})}function p(e){return I(e)}null==l&&(l=0,i.replaceState(d(d({},i.state),{},{idx:l}),""));let h={get action(){return s},get location(){return e(o,i)},listen(e){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener(b,f),u=e,()=>{o.removeEventListener(b,f),u=null}},createHref:e=>t(o,e),createURL:p,encodeLocation(e){let t=p(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){s="PUSH";let r=S(h.location,e,t);n&&n(r,e),l=c()+1;let f=C(r,l),d=h.createHref(r);try{i.pushState(f,"",d)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;o.location.assign(d)}a&&u&&u({action:s,location:h.location,delta:1})},replace:function(e,t){s="REPLACE";let r=S(h.location,e,t);n&&n(r,e),l=c();let o=C(r,l),f=h.createHref(r);i.replaceState(o,"",f),a&&u&&u({action:s,location:h.location,delta:0})},go:e=>i.go(e)};return h}function I(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="http://localhost";"undefined"!==typeof window&&(n="null"!==window.location.origin?window.location.origin:window.location.href),w(n,"No window.location.(origin|href) available to create URL");let r="string"===typeof e?e:k(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=n+r),new URL(r,n)}new WeakMap;function N(e,t){return T(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function T(e,t,n,r){let o=G(("string"===typeof t?R(t):t).pathname||"/",n);if(null==o)return null;let a=A(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(a);let i=null;for(let s=0;null==i&&s<a.length;++s){let e=H(o);i=U(a[s],e,r)}return i}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(e,a){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,s=arguments.length>3?arguments[3]:void 0,u={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(r)&&i)return;w(u.relativePath.startsWith(r),'Absolute route path "'.concat(u.relativePath,'" nested under path "').concat(r,'" is not valid. An absolute child route path must start with the combined path of all its parent routes.')),u.relativePath=u.relativePath.slice(r.length)}let l=Z([r,u.relativePath]),c=n.concat(u);e.children&&e.children.length>0&&(w(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'.concat(l,'".')),A(e.children,t,c,l,i)),(null!=e.path||e.index)&&t.push({path:l,score:W(l,e.index),routesMeta:c})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!==(n=e.path)&&void 0!==n&&n.includes("?"))for(let r of D(e.path))a(e,t,!0,r);else a(e,t)}),t}function D(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,o=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===r.length)return o?[a,""]:[a];let i=D(r.join("/")),s=[];return s.push(...i.map(e=>""===e?a:[a,e].join("/"))),o&&s.push(...i),s.map(t=>e.startsWith("/")&&""===t?"/":t)}var O=/^:[\w-]+$/,F=3,P=2,M=1,L=10,B=-2,z=e=>"*"===e;function W(e,t){let n=e.split("/"),r=n.length;return n.some(z)&&(r+=B),t&&(r+=P),n.filter(e=>!z(e)).reduce((e,t)=>e+(O.test(t)?F:""===t?M:L),r)}function U(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:r}=e,o={},a="/",i=[];for(let s=0;s<r.length;++s){let e=r[s],u=s===r.length-1,l="/"===a?t:t.slice(a.length)||"/",c=j({path:e.relativePath,caseSensitive:e.caseSensitive,end:u},l),f=e.route;if(!c&&u&&n&&!r[r.length-1].route.index&&(c=j({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!c)return null;Object.assign(o,c.params),i.push({params:o,pathname:Z([a,c.pathname]),pathnameBase:ee(Z([a,c.pathnameBase])),route:f}),"/"!==c.pathnameBase&&(a=Z([a,c.pathnameBase]))}return i}function j(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=V(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let a=o[0],i=a.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:o}=t;if("*"===r){let e=s[n]||"";i=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const u=s[n];return e[r]=o&&!u?void 0:(u||"").replace(/%2F/g,"/"),e},{}),pathname:a,pathnameBase:i,pattern:e}}function V(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];E("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'.concat(e,'" will be treated as if it were "').concat(e.replace(/\*$/,"/*"),'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "').concat(e.replace(/\*$/,"/*"),'".'));let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(r.push({paramName:"*"}),o+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==e&&"/"!==e&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function H(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return E(!1,'The URL path "'.concat(e,'" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (').concat(t,").")),e}}function G(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}var q=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,K=e=>q.test(e);function $(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function X(e,t,n,r){return"Cannot include a '".concat(e,"' character in a manually specified `to.").concat(t,"` field [").concat(JSON.stringify(r),"].  Please separate it out to the `to.").concat(n,'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.')}function Y(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function Q(e){let t=Y(e);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function J(e,t,n){let r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?r=R(e):(r=d({},e),w(!r.pathname||!r.pathname.includes("?"),X("?","pathname","search",r)),w(!r.pathname||!r.pathname.includes("#"),X("#","pathname","hash",r)),w(!r.search||!r.search.includes("#"),X("#","search","hash",r)));let a,i=""===e||""===r.pathname,s=i?"/":r.pathname;if(null==s)a=n;else{let e=t.length-1;if(!o&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}a=e>=0?t[e]:"/"}let u=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:r,search:o="",hash:a=""}="string"===typeof e?R(e):e;if(r)if(K(r))t=r;else{if(r.includes("//")){let e=r;r=r.replace(/\/\/+/g,"/"),E(!1,"Pathnames cannot have embedded double slashes - normalizing ".concat(e," -> ").concat(r))}t=r.startsWith("/")?$(r.substring(1),"/"):$(r,n)}else t=n;return{pathname:t,search:te(o),hash:ne(a)}}(r,a),l=s&&"/"!==s&&s.endsWith("/"),c=(i||"."===s)&&n.endsWith("/");return u.pathname.endsWith("/")||!l&&!c||(u.pathname+="/"),u}var Z=e=>e.join("/").replace(/\/\/+/g,"/"),ee=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),te=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",ne=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";var re=class{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.status=e,this.statusText=t||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function oe(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}function ae(e){return e.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var ie="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;function se(e,t){let n=e;if("string"!==typeof n||!q.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,o=!1;if(ie)try{let e=new URL(window.location.href),r=n.startsWith("//")?new URL(e.protocol+n):new URL(n),a=G(r.pathname,t);r.origin===e.origin&&null!=a?n=a+r.search+r.hash:o=!0}catch(yg){E(!1,'<Link to="'.concat(n,'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.'))}return{absoluteURL:r,isExternal:o,to:n}}Symbol("Uninstrumented");Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var ue=["POST","PUT","PATCH","DELETE"],le=(new Set(ue),["GET",...ue]);new Set(le),Symbol("ResetLoaderData");var ce=o.createContext(null);ce.displayName="DataRouter";var fe=o.createContext(null);fe.displayName="DataRouterState";var de=o.createContext(!1);function pe(){return o.useContext(de)}var he=o.createContext({isTransitioning:!1});he.displayName="ViewTransition";var ve=o.createContext(new Map);ve.displayName="Fetchers";var me=o.createContext(null);me.displayName="Await";var ge=o.createContext(null);ge.displayName="Navigation";var ye=o.createContext(null);ye.displayName="Location";var be=o.createContext({outlet:null,matches:[],isDataRoute:!1});be.displayName="Route";var xe=o.createContext(null);xe.displayName="RouteError";var we="REACT_ROUTER_ERROR";function Ee(){return null!=o.useContext(ye)}function Ce(){return w(Ee(),"useLocation() may be used only in the context of a <Router> component."),o.useContext(ye).location}var Se="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function ke(e){o.useContext(ge).static||o.useLayoutEffect(e)}function Re(){let{isDataRoute:e}=o.useContext(be);return e?function(){let{router:e}=ze("useNavigate"),t=Ue("useNavigate"),n=o.useRef(!1);ke(()=>{n.current=!0});let r=o.useCallback(async function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};E(n.current,Se),n.current&&("number"===typeof r?await e.navigate(r):await e.navigate(r,d({fromRouteId:t},o)))},[e,t]);return r}():function(){w(Ee(),"useNavigate() may be used only in the context of a <Router> component.");let e=o.useContext(ce),{basename:t,navigator:n}=o.useContext(ge),{matches:r}=o.useContext(be),{pathname:a}=Ce(),i=JSON.stringify(Q(r)),s=o.useRef(!1);ke(()=>{s.current=!0});let u=o.useCallback(function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(E(s.current,Se),!s.current)return;if("number"===typeof r)return void n.go(r);let u=J(r,JSON.parse(i),a,"path"===o.relative);null==e&&"/"!==t&&(u.pathname="/"===u.pathname?t:Z([t,u.pathname])),(o.replace?n.replace:n.push)(u,o.state,o)},[t,n,i,a,e]);return u}()}var _e=o.createContext(null);function Ie(){let{matches:e}=o.useContext(be),t=e[e.length-1];return t?t.params:{}}function Ne(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:n}=o.useContext(be),{pathname:r}=Ce(),a=JSON.stringify(Q(n));return o.useMemo(()=>J(e,JSON.parse(a),r,"path"===t),[e,a,r,t])}function Te(e,t,n,r,a){w(Ee(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=o.useContext(ge),{matches:s}=o.useContext(be),u=s[s.length-1],l=u?u.params:{},c=u?u.pathname:"/",f=u?u.pathnameBase:"/",p=u&&u.route;{let e=p&&p.path||"";He(c,!p||e.endsWith("*")||e.endsWith("*?"),'You rendered descendant <Routes> (or called `useRoutes()`) at "'.concat(c,'" (under <Route path="').concat(e,'">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won\'t match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="').concat(e,'"> to <Route path="').concat("/"===e?"*":"".concat(e,"/*"),'">.'))}let h,v=Ce();if(t){var m;let e="string"===typeof t?R(t):t;w("/"===f||(null===(m=e.pathname)||void 0===m?void 0:m.startsWith(f)),'When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "'.concat(f,'" but pathname "').concat(e.pathname,'" was given in the `location` prop.')),h=e}else h=v;let g=h.pathname||"/",y=g;if("/"!==f){let e=f.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=N(e,{pathname:y});E(p||null!=b,'No routes matched location "'.concat(h.pathname).concat(h.search).concat(h.hash,'" ')),E(null==b||void 0!==b[b.length-1].route.element||void 0!==b[b.length-1].route.Component||void 0!==b[b.length-1].route.lazy,'Matched leaf route at location "'.concat(h.pathname).concat(h.search).concat(h.hash,'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.'));let x=Le(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:Z([f,i.encodeLocation?i.encodeLocation(e.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?f:Z([f,i.encodeLocation?i.encodeLocation(e.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathnameBase])})),s,n,r,a);return t&&x?o.createElement(ye.Provider,{value:{location:d({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:"POP"}},x):x}function Ae(){let e=je(),t=oe(e)?"".concat(e.status," ").concat(e.statusText):e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},s=null;return console.error("Error handled by React Router default ErrorBoundary:",e),s=o.createElement(o.Fragment,null,o.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),o.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",o.createElement("code",{style:i},"ErrorBoundary")," or"," ",o.createElement("code",{style:i},"errorElement")," prop on your route.")),o.createElement(o.Fragment,null,o.createElement("h2",null,"Unexpected Application Error!"),o.createElement("h3",{style:{fontStyle:"italic"}},t),n?o.createElement("pre",{style:a},n):null,s)}var De=o.createElement(Ae,null),Oe=class extends o.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&"object"===typeof e&&e&&"digest"in e&&"string"===typeof e.digest){const t=function(e){if(e.startsWith("".concat(we,":").concat("ROUTE_ERROR_RESPONSE",":{")))try{let t=JSON.parse(e.slice(40));if("object"===typeof t&&t&&"number"===typeof t.status&&"string"===typeof t.statusText)return new re(t.status,t.statusText,t.data)}catch(t){}}(e.digest);t&&(e=t)}let t=void 0!==e?o.createElement(be.Provider,{value:this.props.routeContext},o.createElement(xe.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?o.createElement(Pe,{error:e},t):t}};Oe.contextType=de;var Fe=new WeakMap;function Pe(e){let{children:t,error:n}=e,{basename:r}=o.useContext(ge);if("object"===typeof n&&n&&"digest"in n&&"string"===typeof n.digest){let e=function(e){if(e.startsWith("".concat(we,":").concat("REDIRECT",":{")))try{let t=JSON.parse(e.slice(28));if("object"===typeof t&&t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"string"===typeof t.location&&"boolean"===typeof t.reloadDocument&&"boolean"===typeof t.replace)return t}catch(t){}}(n.digest);if(e){let t=Fe.get(n);if(t)throw t;let a=se(e.location,r);if(ie&&!Fe.get(n)){if(!a.isExternal&&!e.reloadDocument){const t=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(a.to,{replace:e.replace}));throw Fe.set(n,t),t}window.location.href=a.absoluteURL||a.to}return o.createElement("meta",{httpEquiv:"refresh",content:"0;url=".concat(a.absoluteURL||a.to)})}}return t}function Me(e){let{routeContext:t,match:n,children:r}=e,a=o.useContext(ce);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),o.createElement(be.Provider,{value:t},r)}function Le(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let a=e,i=null===n||void 0===n?void 0:n.errors;if(null!=i){let e=a.findIndex(e=>e.route.id&&void 0!==(null===i||void 0===i?void 0:i[e.route.id]));w(e>=0,"Could not find a matching route for errors on route IDs: ".concat(Object.keys(i).join(","))),a=a.slice(0,Math.min(a.length,e+1))}let s=!1,u=-1;if(n)for(let o=0;o<a.length;o++){let e=a[o];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=o),e.route.id){let{loaderData:t,errors:r}=n,o=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!r||void 0===r[e.route.id]);if(e.route.lazy||o){s=!0,a=u>=0?a.slice(0,u+1):[a[0]];break}}}let l=n&&r?(e,t)=>{var o,a;r(e,{location:n.location,params:null!==(o=null===(a=n.matches)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.params)&&void 0!==o?o:{},unstable_pattern:ae(n.matches),errorInfo:t})}:void 0;return a.reduceRight((e,r,c)=>{let f,d=!1,p=null,h=null;n&&(f=i&&r.route.id?i[r.route.id]:void 0,p=r.route.errorElement||De,s&&(u<0&&0===c?(He("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,h=null):u===c&&(d=!0,h=r.route.hydrateFallbackElement||null)));let v=t.concat(a.slice(0,c+1)),m=()=>{let t;return t=f?p:d?h:r.route.Component?o.createElement(r.route.Component,null):r.route.element?r.route.element:e,o.createElement(Me,{match:r,routeContext:{outlet:e,matches:v,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===c)?o.createElement(Oe,{location:n.location,revalidation:n.revalidation,component:p,error:f,children:m(),routeContext:{outlet:null,matches:v,isDataRoute:!0},onError:l}):m()},null)}function Be(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function ze(e){let t=o.useContext(ce);return w(t,Be(e)),t}function We(e){let t=o.useContext(fe);return w(t,Be(e)),t}function Ue(e){let t=function(e){let t=o.useContext(be);return w(t,Be(e)),t}(e),n=t.matches[t.matches.length-1];return w(n.route.id,"".concat(e,' can only be used on routes that contain a unique "id"')),n.route.id}function je(){var e;let t=o.useContext(xe),n=We("useRouteError"),r=Ue("useRouteError");return void 0!==t?t:null===(e=n.errors)||void 0===e?void 0:e[r]}var Ve={};function He(e,t,n){t||Ve[e]||(Ve[e]=!0,E(!1,n))}var Ge={};function qe(e,t){e||Ge[t]||(Ge[t]=!0,console.warn(t))}a.useOptimistic;o.memo(function(e){let{routes:t,future:n,state:r,onError:o}=e;return Te(t,void 0,r,o,n)});function Ke(e){return function(e){let t=o.useContext(be).outlet;return o.useMemo(()=>t&&o.createElement(_e.Provider,{value:e},t),[t,e])}(e.context)}function $e(e){w(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Xe(e){let{basename:t="/",children:n=null,location:r,navigationType:a="POP",navigator:i,static:s=!1,unstable_useTransitions:u}=e;w(!Ee(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=t.replace(/^\/*/,"/"),c=o.useMemo(()=>({basename:l,navigator:i,static:s,unstable_useTransitions:u,future:{}}),[l,i,s,u]);"string"===typeof r&&(r=R(r));let{pathname:f="/",search:d="",hash:p="",state:h=null,key:v="default"}=r,m=o.useMemo(()=>{let e=G(f,l);return null==e?null:{location:{pathname:e,search:d,hash:p,state:h,key:v},navigationType:a}},[l,f,d,p,h,v,a]);return E(null!=m,'<Router basename="'.concat(l,'"> is not able to match the URL "').concat(f).concat(d).concat(p,"\" because it does not start with the basename, so the <Router> won't render anything.")),null==m?null:o.createElement(ge.Provider,{value:c},o.createElement(ye.Provider,{children:n,value:m}))}function Ye(e){let{children:t,location:n}=e;return Te(Qe(t),n)}o.Component;function Qe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return o.Children.forEach(e,(e,r)=>{if(!o.isValidElement(e))return;let a=[...t,r];if(e.type===o.Fragment)return void n.push.apply(n,Qe(e.props.children,a));w(e.type===$e,"[".concat("string"===typeof e.type?e.type:e.type.name,"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>")),w(!e.props.index||!e.props.children,"An index route cannot have child routes.");let i={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,middleware:e.props.middleware,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=Qe(e.props.children,a)),n.push(i)}),n}var Je="get",Ze="application/x-www-form-urlencoded";function et(e){return"undefined"!==typeof HTMLElement&&e instanceof HTMLElement}var tt=null;var nt=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function rt(e){return null==e||nt.has(e)?e:(E(!1,'"'.concat(e,'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` and will default to "').concat(Ze,'"')),null)}function ot(e,t){let n,r,o,a,i;if(et(s=e)&&"form"===s.tagName.toLowerCase()){let i=e.getAttribute("action");r=i?G(i,t):null,n=e.getAttribute("method")||Je,o=rt(e.getAttribute("enctype"))||Ze,a=new FormData(e)}else if(function(e){return et(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return et(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let i=e.form;if(null==i)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let s=e.getAttribute("formaction")||i.getAttribute("action");if(r=s?G(s,t):null,n=e.getAttribute("formmethod")||i.getAttribute("method")||Je,o=rt(e.getAttribute("formenctype"))||rt(i.getAttribute("enctype"))||Ze,a=new FormData(i,e),!function(){if(null===tt)try{new FormData(document.createElement("form"),0),tt=!1}catch(yg){tt=!0}return tt}()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?"".concat(t,"."):"";a.append("".concat(e,"x"),"0"),a.append("".concat(e,"y"),"0")}else t&&a.append(t,r)}}else{if(et(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Je,r=null,o=Ze,i=e}var s;return a&&"text/plain"===o&&(i=a,a=void 0),{action:r,method:n.toLowerCase(),encType:o,formData:a,body:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;function at(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}Symbol("SingleFetchRedirect");function it(e,t,n){let r="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===r.pathname?r.pathname="_root.".concat(n):t&&"/"===G(r.pathname,t)?r.pathname="".concat(t.replace(/\/$/,""),"/_root.").concat(n):r.pathname="".concat(r.pathname.replace(/\/$/,""),".").concat(n),r}async function st(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error("Error loading route module `".concat(e.module,"`, reloading page...")),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ut(e){return null!=e&&"string"===typeof e.page}function lt(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function ct(e,t,n,r,o,a){let i=(e,t)=>!n[t]||e.route.id!==n[t].route.id,s=(e,t)=>{var r;return n[t].pathname!==e.pathname||(null===(r=n[t].route.path)||void 0===r?void 0:r.endsWith("*"))&&n[t].params["*"]!==e.params["*"]};return"assets"===a?t.filter((e,t)=>i(e,t)||s(e,t)):"data"===a?t.filter((t,a)=>{let u=r.routes[t.route.id];if(!u||!u.hasLoader)return!1;if(i(t,a)||s(t,a))return!0;if(t.route.shouldRevalidate){var l;let r=t.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:(null===(l=n[0])||void 0===l?void 0:l.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof r)return r}return!0}):[]}function ft(e,t){let{includeHydrateFallback:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=e.map(e=>{let r=t.routes[e.route.id];if(!r)return[];let o=[r.module];return r.clientActionModule&&(o=o.concat(r.clientActionModule)),r.clientLoaderModule&&(o=o.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(o=o.concat(r.hydrateFallbackModule)),r.imports&&(o=o.concat(r.imports)),o}).flat(1),[...new Set(r)];var r}function dt(e,t){let n=new Set,r=new Set(t);return e.reduce((e,o)=>{if(t&&!ut(o)&&"script"===o.as&&o.href&&r.has(o.href))return e;let a=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}(o));return n.has(a)||(n.add(a),e.push({key:a,link:o})),e},[])}function pt(e,t){return"lazy"===e.mode&&!0===t}function ht(){let e=o.useContext(ce);return at(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function vt(){let e=o.useContext(fe);return at(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var mt=o.createContext(void 0);function gt(){let e=o.useContext(mt);return at(e,"You must render this element inside a <HydratedRouter> element"),e}function yt(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function bt(e,t,n){if(n&&!Ct)return[e[0]];if(t){let n=e.findIndex(e=>void 0!==t[e.route.id]);return e.slice(0,n+1)}return e}mt.displayName="FrameworkContext";function xt(e){let{page:t}=e,n=s(e,h),{router:r}=ht(),a=o.useMemo(()=>N(r.routes,t,r.basename),[r.routes,t,r.basename]);return a?o.createElement(Et,d({page:t,matches:a},n)):null}function wt(e){let{manifest:t,routeModules:n}=gt(),[r,a]=o.useState([]);return o.useEffect(()=>{let r=!1;return async function(e,t,n){let r=await Promise.all(e.map(async e=>{let r=t.routes[e.route.id];if(r){let e=await st(r,n);return e.links?e.links():[]}return[]}));return dt(r.flat(1).filter(lt).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?d(d({},e),{},{rel:"prefetch",as:"style"}):d(d({},e),{},{rel:"prefetch"})))}(e,t,n).then(e=>{r||a(e)}),()=>{r=!0}},[e,t,n]),r}function Et(e){let{page:t,matches:n}=e,r=s(e,v),a=Ce(),{manifest:i,routeModules:u}=gt(),{basename:l}=ht(),{loaderData:c,matches:f}=vt(),p=o.useMemo(()=>ct(t,n,f,i,a,"data"),[t,n,f,i,a]),h=o.useMemo(()=>ct(t,n,f,i,a,"assets"),[t,n,f,i,a]),m=o.useMemo(()=>{if(t===a.pathname+a.search+a.hash)return[];let e=new Set,r=!1;if(n.forEach(t=>{var n;let o=i.routes[t.route.id];o&&o.hasLoader&&(!p.some(e=>e.route.id===t.route.id)&&t.route.id in c&&null!==(n=u[t.route.id])&&void 0!==n&&n.shouldRevalidate||o.hasClientLoader?r=!0:e.add(t.route.id))}),0===e.size)return[];let o=it(t,l,"data");return r&&e.size>0&&o.searchParams.set("_routes",n.filter(t=>e.has(t.route.id)).map(e=>e.route.id).join(",")),[o.pathname+o.search]},[l,c,a,i,p,n,t,u]),g=o.useMemo(()=>ft(h,i),[h,i]),y=wt(h);return o.createElement(o.Fragment,null,m.map(e=>o.createElement("link",d({key:e,rel:"prefetch",as:"fetch",href:e},r))),g.map(e=>o.createElement("link",d({key:e,rel:"modulepreload",href:e},r))),y.map(e=>{let{key:t,link:n}=e;return o.createElement("link",d({key:t,nonce:r.nonce},n))}))}var Ct=!1;function St(e){let{manifest:t,serverHandoffString:n,isSpaMode:r,renderMeta:a,routeDiscovery:i,ssr:u}=gt(),{router:l,static:c,staticContext:f}=ht(),{matches:h}=vt(),v=pe(),m=pt(i,u);a&&(a.didRenderScripts=!0);let g=bt(h,null,r);o.useEffect(()=>{0},[]);let y=o.useMemo(()=>{var r;if(v)return null;let a=f?"window.__reactRouterContext = ".concat(n,";").concat("window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());"):" ",i=c?"".concat(null!==t.hmr&&void 0!==r&&r.runtime?"import ".concat(JSON.stringify(t.hmr.runtime),";"):"").concat(m?"":"import ".concat(JSON.stringify(t.url)),";\n").concat(g.map((e,n)=>{let r="route".concat(n),o=t.routes[e.route.id];at(o,"Route ".concat(e.route.id," not found in manifest"));let{clientActionModule:a,clientLoaderModule:i,clientMiddlewareModule:s,hydrateFallbackModule:u,module:l}=o,c=[...a?[{module:a,varName:"".concat(r,"_clientAction")}]:[],...i?[{module:i,varName:"".concat(r,"_clientLoader")}]:[],...s?[{module:s,varName:"".concat(r,"_clientMiddleware")}]:[],...u?[{module:u,varName:"".concat(r,"_HydrateFallback")}]:[],{module:l,varName:"".concat(r,"_main")}];return 1===c.length?"import * as ".concat(r," from ").concat(JSON.stringify(l),";"):[c.map(e=>"import * as ".concat(e.varName,' from "').concat(e.module,'";')).join("\n"),"const ".concat(r," = {").concat(c.map(e=>"...".concat(e.varName)).join(","),"};")].join("\n")}).join("\n"),"\n  ").concat(m?"window.__reactRouterManifest = ".concat(JSON.stringify(function(e,t){let{sri:n}=e,r=s(e,p),o=new Set(t.state.matches.map(e=>e.route.id)),a=t.state.location.pathname.split("/").filter(Boolean),i=["/"];for(a.pop();a.length>0;)i.push("/".concat(a.join("/"))),a.pop();i.forEach(e=>{let n=N(t.routes,e,t.basename);n&&n.forEach(e=>o.add(e.route.id))});let u=[...o].reduce((e,t)=>Object.assign(e,{[t]:r.routes[t]}),{});return d(d({},r),{},{routes:u,sri:!!n||void 0})}(t,l),null,2),";"):"","\n  window.__reactRouterRouteModules = {").concat(g.map((e,t)=>"".concat(JSON.stringify(e.route.id),":route").concat(t)).join(","),"};\n\nimport(").concat(JSON.stringify(t.entry.module),");"):" ";return o.createElement(o.Fragment,null,o.createElement("script",d(d({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:a},type:void 0})),o.createElement("script",d(d({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:i},type:"module",async:!0})))},[]),b=Ct||v?[]:(t.entry.imports.concat(ft(g,t,{includeHydrateFallback:!0})),[...new Set(x)]);var x;let w="object"===typeof t.sri?t.sri:{};return qe(!v,"The <Scripts /> element is a no-op when using RSC and can be safely removed."),Ct||v?null:o.createElement(o.Fragment,null,"object"===typeof t.sri?o.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:w})}}):null,m?null:o.createElement("link",{rel:"modulepreload",href:t.url,crossOrigin:e.crossOrigin,integrity:w[t.url],suppressHydrationWarning:!0}),o.createElement("link",{rel:"modulepreload",href:t.entry.module,crossOrigin:e.crossOrigin,integrity:w[t.entry.module],suppressHydrationWarning:!0}),b.map(t=>o.createElement("link",{key:t,rel:"modulepreload",href:t,crossOrigin:e.crossOrigin,integrity:w[t],suppressHydrationWarning:!0})),y)}function kt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{t.forEach(t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)})}}o.Component;function Rt(e){let{error:t,isOutsideRemixApp:n}=e;console.error(t);let r,a=o.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if(oe(t))return o.createElement(_t,{title:"Unhandled Thrown Response!"},o.createElement("h1",{style:{fontSize:"24px"}},t.status," ",t.statusText),a);if(t instanceof Error)0;else{let e=null==t?"Unknown Error":"object"===typeof t&&"toString"in t?t.toString():JSON.stringify(t);new Error(e)}return o.createElement(_t,{title:"Application Error!",isOutsideRemixApp:n},o.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),o.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},r.stack),a)}function _t(e){var t;let{title:n,renderScripts:r,isOutsideRemixApp:a,children:i}=e,{routeModules:s}=gt();return null!==s.root&&void 0!==t&&t.Layout&&!a?i:o.createElement("html",{lang:"en"},o.createElement("head",null,o.createElement("meta",{charSet:"utf-8"}),o.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),o.createElement("title",null,n)),o.createElement("body",null,o.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},i,r?o.createElement(St,null):null)))}var It="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{It&&(window.__reactRouterVersion="7.11.0")}catch(yg){}function Nt(e){let{basename:t,children:n,unstable_useTransitions:r,window:a}=e,i=o.useRef();null==i.current&&(i.current=x({window:a,v5Compat:!0}));let s=i.current,[u,l]=o.useState({action:s.action,location:s.location}),c=o.useCallback(e=>{!1===r?l(e):o.startTransition(()=>l(e))},[r]);return o.useLayoutEffect(()=>s.listen(c),[s,c]),o.createElement(Xe,{basename:t,children:n,location:u.location,navigationType:u.action,navigator:s,unstable_useTransitions:r})}var Tt=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,At=o.forwardRef(function(e,t){let{onClick:n,discover:r="render",prefetch:a="none",relative:i,reloadDocument:u,replace:l,state:c,target:f,to:p,preventScrollReset:h,viewTransition:v,unstable_defaultShouldRevalidate:g}=e,y=s(e,m),{basename:b,unstable_useTransitions:x}=o.useContext(ge),E="string"===typeof p&&Tt.test(p),C=se(p,b);p=C.to;let S=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(Ee(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=o.useContext(ge),{hash:a,pathname:i,search:s}=Ne(e,{relative:t}),u=i;return"/"!==n&&(u="/"===i?n:Z([n,i])),r.createHref({pathname:u,search:s,hash:a})}(p,{relative:i}),[R,_,I]=function(e,t){let n=o.useContext(mt),[r,a]=o.useState(!1),[i,s]=o.useState(!1),{onFocus:u,onBlur:l,onMouseEnter:c,onMouseLeave:f,onTouchStart:d}=t,p=o.useRef(null);o.useEffect(()=>{if("render"===e&&s(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{s(e.isIntersecting)})},{threshold:.5});return p.current&&e.observe(p.current),()=>{e.disconnect()}}},[e]),o.useEffect(()=>{if(r){let e=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(e)}}},[r]);let h=()=>{a(!0)},v=()=>{a(!1),s(!1)};return n?"intent"!==e?[i,p,{}]:[i,p,{onFocus:yt(u,h),onBlur:yt(l,v),onMouseEnter:yt(c,h),onMouseLeave:yt(f,v),onTouchStart:yt(d,h)}]:[!1,p,{}]}(a,y),N=function(e){let{target:t,replace:n,state:r,preventScrollReset:a,relative:i,viewTransition:s,unstable_defaultShouldRevalidate:u,unstable_useTransitions:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=Re(),f=Ce(),d=Ne(e,{relative:i});return o.useCallback(p=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(p,t)){p.preventDefault();let t=void 0!==n?n:k(f)===k(d),h=()=>c(e,{replace:t,state:r,preventScrollReset:a,relative:i,viewTransition:s,unstable_defaultShouldRevalidate:u});l?o.startTransition(()=>h()):h()}},[f,c,d,n,r,t,e,a,i,s,u,l])}(p,{replace:l,state:c,target:f,preventScrollReset:h,relative:i,viewTransition:v,unstable_defaultShouldRevalidate:g,unstable_useTransitions:x});let T=o.createElement("a",d(d(d({},y),I),{},{href:C.absoluteURL||S,onClick:C.isExternal||u?n:function(e){n&&n(e),e.defaultPrevented||N(e)},ref:kt(t,_),target:f,"data-discover":E||"render"!==r?void 0:"true"}));return R&&!E?o.createElement(o.Fragment,null,T,o.createElement(xt,{page:S})):T});At.displayName="Link";var Dt=o.forwardRef(function(e,t){let{"aria-current":n="page",caseSensitive:r=!1,className:a="",end:i=!1,style:u,to:l,viewTransition:c,children:f}=e,p=s(e,g),h=Ne(l,{relative:p.relative}),v=Ce(),m=o.useContext(fe),{navigator:y,basename:b}=o.useContext(ge),x=null!=m&&function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.useContext(he);w(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Pt("useViewTransitionState"),a=Ne(e,{relative:t});if(!n.isTransitioning)return!1;let i=G(n.currentLocation.pathname,r)||n.currentLocation.pathname,s=G(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=j(a.pathname,s)||null!=j(a.pathname,i)}(h)&&!0===c,E=y.encodeLocation?y.encodeLocation(h).pathname:h.pathname,C=v.pathname,S=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;r||(C=C.toLowerCase(),S=S?S.toLowerCase():null,E=E.toLowerCase()),S&&b&&(S=G(S,b)||S);const k="/"!==E&&E.endsWith("/")?E.length-1:E.length;let R,_=C===E||!i&&C.startsWith(E)&&"/"===C.charAt(k),I=null!=S&&(S===E||!i&&S.startsWith(E)&&"/"===S.charAt(E.length)),N={isActive:_,isPending:I,isTransitioning:x},T=_?n:void 0;R="function"===typeof a?a(N):[a,_?"active":null,I?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let A="function"===typeof u?u(N):u;return o.createElement(At,d(d({},p),{},{"aria-current":T,className:R,ref:t,style:A,to:l,viewTransition:c}),"function"===typeof f?f(N):f)});Dt.displayName="NavLink";var Ot=o.forwardRef((e,t)=>{let{discover:n="render",fetcherKey:r,navigate:a,reloadDocument:i,replace:u,state:l,method:c=Je,action:f,onSubmit:p,relative:h,preventScrollReset:v,viewTransition:m,unstable_defaultShouldRevalidate:g}=e,b=s(e,y),{unstable_useTransitions:x}=o.useContext(ge),E=Bt(),C=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:n}=o.useContext(ge),r=o.useContext(be);w(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),i=d({},Ne(e||".",{relative:t})),s=Ce();if(null==e){i.search=s.search;let e=new URLSearchParams(i.search),t=e.getAll("index"),n=t.some(e=>""===e);if(n){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let n=e.toString();i.search=n?"?".concat(n):""}}e&&"."!==e||!a.route.index||(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index");"/"!==n&&(i.pathname="/"===i.pathname?n:Z([n,i.pathname]));return k(i)}(f,{relative:h}),S="get"===c.toLowerCase()?"get":"post",R="string"===typeof f&&Tt.test(f);return o.createElement("form",d(d({ref:t,method:S,action:C,onSubmit:i?p:e=>{if(p&&p(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,n=(null===t||void 0===t?void 0:t.getAttribute("formmethod"))||c,i=()=>E(t||e.currentTarget,{fetcherKey:r,method:n,navigate:a,replace:u,state:l,relative:h,preventScrollReset:v,viewTransition:m,unstable_defaultShouldRevalidate:g});x&&!1!==a?o.startTransition(()=>i()):i()}},b),{},{"data-discover":R||"render"!==n?void 0:"true"}))});function Ft(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function Pt(e){let t=o.useContext(ce);return w(t,Ft(e)),t}Ot.displayName="Form";var Mt=0,Lt=()=>"__".concat(String(++Mt),"__");function Bt(){let{router:e}=Pt("useSubmit"),{basename:t}=o.useContext(ge),n=Ue("useRouteId"),r=e.fetch,a=e.navigate;return o.useCallback(async function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:i,method:s,encType:u,formData:l,body:c}=ot(e,t);if(!1===o.navigate){let e=o.fetcherKey||Lt();await r(e,n,o.action||i,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:l,body:c,formMethod:o.method||s,formEncType:o.encType||u,flushSync:o.flushSync})}else await a(o.action||i,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:l,body:c,formMethod:o.method||s,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,a,t,n])}var zt=n(233),Wt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ut=zt.createContext&&zt.createContext(Wt),jt=["attr","size","title"];function Vt(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Ht(){return Ht=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ht.apply(this,arguments)}function Gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(n),!0).forEach(function(t){Kt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Kt(e,t,n){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $t(e){return e&&e.map((e,t)=>zt.createElement(e.tag,qt({key:t},e.attr),$t(e.child)))}function Xt(e){return t=>zt.createElement(Yt,Ht({attr:qt({},e.attr)},t),$t(e.child))}function Yt(e){var t=t=>{var n,{attr:r,size:o,title:a}=e,i=Vt(e,jt),s=o||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),zt.createElement("svg",Ht({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,i,{className:n,style:qt(qt({color:e.color||t.color},t.style),e.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),a&&zt.createElement("title",null,a),e.children)};return void 0!==Ut?zt.createElement(Ut.Consumer,null,e=>t(e)):t(Wt)}function Qt(e){return Xt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 19 5 12 12 5"},child:[]}]})(e)}function Jt(e){return Xt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"},child:[]}]})(e)}function Zt(e){return Xt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"},child:[]},{tag:"polyline",attr:{points:"9 22 9 12 15 12 15 22"},child:[]}]})(e)}function en(e){return Xt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"},child:[]},{tag:"polyline",attr:{points:"21 15 16 10 5 21"},child:[]}]})(e)}function tn(e){return Xt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"},child:[]},{tag:"polyline",attr:{points:"22,6 12,13 2,6"},child:[]}]})(e)}function nn(e){return Xt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}function rn(e){return Xt({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"},child:[]}]})(e)}var on=n(579);function an(){const e=Ce();return(0,on.jsxs)("div",{style:sn.nav,children:[(0,on.jsx)(At,{to:"/",children:(0,on.jsx)(Zt,{size:24,color:"/"===e.pathname?"#000":"#aaa"})}),(0,on.jsx)(At,{to:"/upload",children:(0,on.jsx)("div",{style:sn.plus,children:(0,on.jsx)(nn,{size:28,color:"/upload"===e.pathname?"#000":"#aaa"})})}),(0,on.jsx)(At,{to:"/profile",children:(0,on.jsx)(rn,{size:24,color:"/profile"===e.pathname?"#000":"#aaa"})})]})}const sn={nav:{display:"flex",justifyContent:"space-around",alignItems:"center",padding:"10px 0",borderTop:"1px solid #ddd",position:"fixed",bottom:0,width:"100%",backgroundColor:"#fff"},plus:{backgroundColor:"#eee",borderRadius:"50%",padding:10,display:"flex",justifyContent:"center",alignItems:"center",marginTop:-20}};function un(){return(0,on.jsxs)("div",{style:{minHeight:"100vh"},children:[(0,on.jsx)(Ke,{}),(0,on.jsx)(an,{})]})}function ln(){const e=Re(),t=sessionStorage.getItem("resetEmail"),[n,r]=(0,o.useState)(["","","",""]),[a,i]=(0,o.useState)(""),s=(0,o.useRef)([]);(0,o.useEffect)(()=>{t||e("/login")},[t,e]);const u=n.every(e=>""!==e);return(0,on.jsx)("div",{className:"otp-wrapper",children:(0,on.jsxs)("div",{className:"otp-card",children:[(0,on.jsx)("h2",{children:"Enter OTP"}),(0,on.jsx)("p",{children:t}),(0,on.jsx)("div",{className:"otp-inputs",children:n.map((e,t)=>(0,on.jsx)("input",{ref:e=>s.current[t]=e,value:e,onChange:e=>((e,t)=>{if(!/^\d?$/.test(e))return;const o=[...n];o[t]=e,r(o),e&&t<3&&s.current[t+1].focus()})(e.target.value,t),onKeyDown:e=>((e,t)=>{"Backspace"===e.key&&!n[t]&&t>0&&s.current[t-1].focus()})(e,t),maxLength:"1"},t))}),a&&(0,on.jsx)("p",{className:"error",children:a}),(0,on.jsx)("button",{onClick:async()=>{i("");try{const r=await fetch("/api/auth/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,otp:n.join("")})}),o=await r.json();if(!r.ok)return void i(o.message||"Invalid OTP");e("/reset-password")}catch(r){i("Server error")}},disabled:!u,className:u?"active":"",children:"Verify OTP"})]})})}function cn(){const e=Re(),t=sessionStorage.getItem("resetUsername"),n=sessionStorage.getItem("resetToken"),[r,a]=(0,o.useState)(""),[i,s]=(0,o.useState)(""),[u,l]=(0,o.useState)(""),[c,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{n&&t||e("/login")},[e,n,t]);return(0,on.jsx)("div",{className:"reset-wrapper",children:(0,on.jsxs)("div",{className:"reset-card",children:[(0,on.jsx)("h2",{children:t}),(0,on.jsx)("input",{type:"password",placeholder:"new password",value:r,onChange:e=>a(e.target.value)}),(0,on.jsx)("input",{type:"password",placeholder:"confirm password",value:i,onChange:e=>s(e.target.value)}),u&&(0,on.jsx)("p",{className:"error",children:u}),(0,on.jsx)("button",{onClick:async()=>{if(l(""),r.length<8)l("Password must be at least 8 characters");else if(r===i){f(!0);try{const t=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reset_token:n,new_password:r})}),o=await t.json();if(!t.ok)return l(o.message||"Reset failed"),void f(!1);sessionStorage.removeItem("resetToken"),sessionStorage.removeItem("resetEmail"),sessionStorage.removeItem("resetUsername"),e("/login")}catch(t){l("Server error. Try again.")}f(!1)}else l("Passwords do not match")},disabled:c,children:c?"Please wait...":"login"})]})})}function fn(){const e=Re(),[t,n]=(0,o.useState)(""),[r,a]=(0,o.useState)(""),[i,s]=(0,o.useState)(""),[u,l]=(0,o.useState)(!1);return(0,on.jsx)("div",{className:"login-wrapper",children:(0,on.jsxs)("div",{className:"login-card",children:[(0,on.jsx)("h2",{children:"Login to continue using LinkX"}),(0,on.jsx)("input",{type:"email",placeholder:"Email",value:t,onChange:e=>n(e.target.value)}),(0,on.jsx)("input",{type:"password",placeholder:"Password",value:r,onChange:e=>a(e.target.value)}),i&&(0,on.jsx)("p",{className:"error",children:i}),(0,on.jsxs)("div",{className:"links",children:[(0,on.jsx)("span",{onClick:async()=>{if(t){s(""),l(!0);try{const n=await fetch("/api/auth/forgot-password/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}),r=await n.json();if(!n.ok)return s(r.message||"User does not exist"),void l(!1);sessionStorage.setItem("resetEmail",t),e("/forgot-password")}catch(n){s("Something went wrong")}l(!1)}else s("Enter email first")},children:"forgot password"}),(0,on.jsx)("span",{onClick:()=>e("/signup"),children:"i don't have an account signup"})]}),(0,on.jsx)("button",{onClick:async()=>{s(""),l(!0);try{const n=await fetch("/api/auth/login/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}),o=await n.json();if(!n.ok)return s(o.message||"Invalid credentials"),void l(!1);localStorage.setItem("accessToken",o.access),localStorage.setItem("username",o.username),e("/home")}catch(n){s("Server error. Try again.")}l(!1)},disabled:u,children:u?"Please wait...":"Login"})]})})}function dn(e){let{open:t,onClose:n}=e;const r=Re();return t?(0,on.jsx)("div",{style:pn.overlay,onClick:n,children:(0,on.jsxs)("div",{style:pn.menu,onClick:e=>e.stopPropagation(),children:[(0,on.jsxs)("div",{style:pn.header,children:[(0,on.jsx)("div",{style:pn.logo,children:"LinkX"}),(0,on.jsx)("div",{style:pn.cancel,onClick:n,children:"|||"})]}),(0,on.jsx)("div",{style:pn.menuItem,onClick:()=>{r("/inbox"),n()},children:"inbox"}),(0,on.jsx)("div",{style:pn.menuItem,onClick:()=>{r("/top-gigs"),n()},children:"top gigs"}),(0,on.jsx)("div",{style:pn.menuItem,onClick:()=>{r("/chatbot"),n()},children:"chatbot"}),(0,on.jsx)("div",{style:pn.menuItem,onClick:()=>{r("/dashboard"),n()},children:"dashboard"}),(0,on.jsx)("div",{style:pn.footer,children:"\u2699"})]})}):null}const pn={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.15)",zIndex:5e3},menu:{width:"75%",height:"100%",background:"#fff",paddingTop:10},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",borderBottom:"1px solid #eee"},logo:{fontSize:22,fontWeight:"bold"},cancel:{fontSize:22,fontWeight:"bold",cursor:"pointer"},menuItem:{padding:"16px 14px",borderBottom:"1px solid #eee",fontSize:16,cursor:"pointer"},footer:{position:"absolute",bottom:20,left:14,fontSize:20}},hn=n.p+"static/media/black.b76b2a99959eb9b836fd.jpg";function vn(e){let{gig:t}=e;const n=Re(),r="number"===typeof(null===t||void 0===t?void 0:t.price)?"\u20b9".concat(t.price):"Price not set",o="number"===typeof(null===t||void 0===t?void 0:t.delivery_days)?"".concat(t.delivery_days," days"):"Delivery time not set",a=Array.isArray(null===t||void 0===t?void 0:t.images)&&t.images.length>0?t.images:[hn,hn];return(0,on.jsxs)("div",{className:"gig-post",children:[(0,on.jsxs)("div",{className:"gig-post-header",children:[(0,on.jsxs)("div",{className:"gig-user",children:[(0,on.jsx)("img",{src:(null===t||void 0===t?void 0:t.user_avatar)||hn,alt:"user",className:"gig-avatar"}),(0,on.jsx)("span",{className:"gig-username",children:(null===t||void 0===t?void 0:t.username)||"freelancer"}),(0,on.jsx)(tn,{className:"gig-dm-icon",onClick:()=>n("/chat/1")})]}),(0,on.jsx)("span",{className:"gig-menu",children:"\u22ef"})]}),(0,on.jsx)("div",{className:"gig-title",children:(null===t||void 0===t?void 0:t.title)||"Untitled gig"}),(0,on.jsx)("div",{className:"gig-media",children:a.map((e,t)=>(0,on.jsx)("div",{className:"gig-media-item",children:(0,on.jsx)("img",{src:e,alt:"gig"})},t))}),(0,on.jsxs)("div",{className:"gig-footer",children:[(0,on.jsxs)("div",{children:[(0,on.jsx)("div",{className:"label",children:"Price"}),(0,on.jsx)("div",{className:"value",children:r})]}),(0,on.jsxs)("div",{children:[(0,on.jsx)("div",{className:"label",children:"Delivery time"}),(0,on.jsx)("div",{className:"value",children:o})]}),(0,on.jsx)("div",{className:"gig-rating",children:"\u2b50 0"})]})]})}function mn(e){let{gigs:t,hasMore:n,loadMore:r}=e;const a=(0,o.useRef)(null),i=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{if(!n)return;const e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting&&!i.current&&(i.current=!0,r(),setTimeout(()=>{i.current=!1},400))},{rootMargin:"100px"}),t=a.current;return t&&e.observe(t),()=>{t&&e.unobserve(t),e.disconnect()}},[t.length,n,r]),(0,on.jsxs)("div",{className:"gigs-grid",children:[t.map(e=>(0,on.jsx)(vn,{gig:e},e.id)),n&&(0,on.jsx)("div",{ref:a,className:"observer"})]})}function gn(){const[e,t]=(0,o.useState)(!1),[n,r]=(0,o.useState)([]),[a,i]=(0,o.useState)(1),[s,u]=(0,o.useState)(!0),l=Re();(0,o.useEffect)(()=>{const e=localStorage.getItem("accessToken");e?fetch("/api/auth/me/",{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{e.ok||(localStorage.removeItem("accessToken"),l("/login"))}).catch(()=>{localStorage.removeItem("accessToken"),l("/login")}):l("/login")},[l]),(0,o.useEffect)(()=>{c()},[]);const c=()=>{if(!s)return;const e=Array.from({length:5},(e,t)=>({id:"".concat(a,"-").concat(t),username:"freelancer",price_level:3,delivery_level:3,cover_image:"/placeholder.png"}));r(t=>[...t,...e]),i(e=>e+1),a>=5&&u(!1)};return(0,on.jsxs)(on.Fragment,{children:[(0,on.jsx)(dn,{open:e,onClose:()=>t(!1)}),(0,on.jsxs)("div",{style:yn.container,children:[(0,on.jsxs)("div",{style:yn.topBar,children:[(0,on.jsxs)("div",{style:yn.menu,onClick:()=>t(!0),children:[(0,on.jsx)("div",{style:yn.line}),(0,on.jsx)("div",{style:yn.line}),(0,on.jsx)("div",{style:yn.line})]}),(0,on.jsxs)("div",{style:yn.search,onClick:()=>l("/search"),children:[(0,on.jsx)("div",{style:yn.searchCircle}),(0,on.jsx)("div",{style:yn.searchHandle})]})]}),(0,on.jsxs)("div",{style:yn.uploadRow,onClick:()=>l("/upload"),children:[(0,on.jsx)("div",{style:yn.avatar}),(0,on.jsxs)("div",{children:[(0,on.jsx)("div",{style:yn.name,children:"freelancer"}),(0,on.jsx)("div",{style:yn.uploadText,children:"upload gig"})]})]}),(0,on.jsx)("div",{style:yn.divider}),(0,on.jsx)("div",{style:yn.feed,children:(0,on.jsx)(mn,{gigs:n,hasMore:s,loadMore:c})})]})]})}const yn={container:{paddingBottom:90},topBar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 14px",position:"sticky",top:0,zIndex:2e3,background:"#fff"},menu:{cursor:"pointer"},line:{width:22,height:2,background:"black",marginBottom:4},search:{position:"relative",width:18,height:18,cursor:"pointer",position:"sticky",top:0,zIndex:1e3,background:"#fff"},searchCircle:{width:12,height:12,border:"2px solid black",borderRadius:"50%",position:"absolute",top:0,left:0},searchHandle:{width:2,height:6,background:"black",position:"absolute",bottom:0,right:0,transform:"rotate(45deg)"},uploadRow:{display:"flex",alignItems:"center",padding:"10px 14px",cursor:"pointer"},avatar:{width:44,height:44,borderRadius:"50%",background:"black",marginRight:10},name:{fontWeight:"600",fontSize:15},uploadText:{fontSize:14,color:"#bbb"},divider:{height:1,background:"#eee",marginTop:6},feed:{minHeight:"100vh",display:"flex",justifyContent:"center"}};function bn(){const e=Re(),[t,n]=(0,o.useState)("gigs");return(0,on.jsxs)("div",{style:wn.container,children:[(0,on.jsx)("div",{style:wn.cover}),(0,on.jsxs)("div",{style:wn.profileSection,children:[(0,on.jsx)("div",{style:wn.avatar}),(0,on.jsxs)("div",{style:wn.buttons,children:[(0,on.jsx)("button",{style:wn.editBtn,onClick:()=>e("/edit-profile"),children:"Edit profile"}),(0,on.jsx)("button",{style:wn.subBtn,children:"subscribe"})]}),(0,on.jsxs)("div",{style:wn.text,children:[(0,on.jsx)("div",{style:wn.name,children:"freelancer"}),(0,on.jsx)("div",{style:wn.handle,children:"@freelancerX11"})]})]}),(0,on.jsx)("p",{style:wn.bio,children:"i'm fullstack developer i help solo devs startup founders and agencies increase productivity and time for them to rest Thank you!"}),(0,on.jsxs)("div",{style:wn.tabs,children:[(0,on.jsx)("div",{style:"gigs"===t?wn.activeTab:wn.inactiveTab,onClick:()=>n("gigs"),children:"gigs"}),(0,on.jsx)("div",{style:"about"===t?wn.activeTab:wn.inactiveTab,onClick:()=>n("about"),children:"about"})]}),"gigs"===t&&(0,on.jsxs)(on.Fragment,{children:[(0,on.jsx)(xn,{title:"i will build landing page",price:"\u20b91500-3000"}),(0,on.jsx)(xn,{title:"i will debug your python code",price:"\u20b9500-3000"})]}),"about"===t&&(0,on.jsx)("div",{style:wn.about,children:(0,on.jsx)("p",{children:"Full-stack developer focused on building clean, scalable products for startups, solo founders, and agencies."})})]})}function xn(e){let{title:t,price:n}=e;return(0,on.jsxs)("div",{style:wn.gig,children:[(0,on.jsx)("div",{style:wn.gigAvatar}),(0,on.jsxs)("div",{style:{flex:1},children:[(0,on.jsx)("div",{style:wn.gigName,children:"freelancer"}),(0,on.jsx)("div",{children:t}),(0,on.jsx)("div",{style:wn.price,children:n})]}),(0,on.jsx)("div",{style:wn.inbox,children:"\u2709"})]})}const wn={container:{paddingBottom:90,fontFamily:"sans-serif"},cover:{height:150,background:"#000"},profileSection:{padding:"0 16px",marginTop:-40},avatar:{width:80,height:80,borderRadius:"50%",background:"#ddd",border:"4px solid white"},buttons:{display:"flex",gap:10,marginTop:10},editBtn:{padding:"6px 14px",borderRadius:20,border:"1px solid #ccc",background:"white"},subBtn:{padding:"6px 14px",borderRadius:20,border:"none",background:"black",color:"white"},text:{marginTop:10},name:{fontSize:18,fontWeight:"bold"},handle:{color:"#777"},bio:{padding:"14px 16px",lineHeight:1.4},tabs:{display:"flex",gap:20,padding:"0 16px",borderBottom:"1px solid #eee"},activeTab:{fontWeight:"bold",borderBottom:"2px solid black",paddingBottom:6,cursor:"pointer"},inactiveTab:{color:"#999",paddingBottom:6,cursor:"pointer"},gig:{display:"flex",padding:16,borderBottom:"1px solid #eee",alignItems:"center"},gigAvatar:{width:50,height:50,borderRadius:"50%",background:"#ddd",marginRight:12},gigName:{fontWeight:"bold"},price:{marginTop:4},inbox:{fontSize:22},about:{padding:16,lineHeight:1.5}};function En(){const e=Re(),[t,n]=(0,o.useState)(""),[r,a]=(0,o.useState)(""),[i,s]=(0,o.useState)(""),[u,l]=(0,o.useState)(""),[c,f]=(0,o.useState)([]),[p,h]=(0,o.useState)([]),v=e=>{const t=e.trim().toLowerCase();!t||c.includes(t)||c.length>=10||f(e=>[...e,t])},m=t.trim()&&r.trim()&&i.trim()&&c.length>=2;return(0,on.jsxs)("div",{style:Cn.container,children:[(0,on.jsxs)("div",{style:Cn.header,children:[(0,on.jsx)("button",{style:Cn.close,onClick:()=>e(-1),children:"\u2715"}),(0,on.jsx)("h3",{style:Cn.headerTitle,children:"New gig"}),(0,on.jsx)("button",{disabled:!m,style:d(d({},Cn.publish),{},{background:m?"#000":"#bdbdbd",cursor:m?"pointer":"not-allowed"}),children:"Publish"})]}),(0,on.jsx)("textarea",{placeholder:"What's new gig",value:t,onChange:e=>n(e.target.value),style:Cn.textarea}),(0,on.jsxs)("div",{style:Cn.imageRow,children:[p.map((e,t)=>(0,on.jsxs)("div",{style:Cn.imagePreview,children:[(0,on.jsx)("img",{src:e.preview,alt:"preview",style:Cn.previewImg}),(0,on.jsx)("span",{style:Cn.removeImg,onClick:()=>(e=>{h(p.filter((t,n)=>n!==e))})(t),children:"\xd7"})]},t)),p.length<2&&(0,on.jsxs)("label",{style:Cn.imageAdd,children:[(0,on.jsx)(en,{size:24,color:"#666"}),(0,on.jsx)("input",{type:"file",accept:"image/*",hidden:!0,onChange:e=>{var t;!(t=e.target.files[0])||p.length>=2||h(e=>[...e,{file:t,preview:URL.createObjectURL(t)}])}})]})]}),(0,on.jsxs)("div",{style:Cn.row,children:[(0,on.jsx)("input",{placeholder:"Price (\u20b9, $, \u20ac)",value:r,onChange:e=>a(e.target.value),style:Cn.input}),(0,on.jsx)("input",{placeholder:"delivery time",value:i,onChange:e=>s(e.target.value),style:Cn.input}),(0,on.jsx)("input",{placeholder:"add tags",value:u,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key&&","!==e.key||(e.preventDefault(),v(u),l(""))},onBlur:()=>{v(u),l("")},style:Cn.input})]}),(0,on.jsx)("div",{style:Cn.tagsContainer,children:c.map((e,t)=>(0,on.jsxs)("div",{style:Cn.tag,children:[e,(0,on.jsx)("span",{style:Cn.remove,onClick:()=>(e=>{f(c.filter((t,n)=>n!==e))})(t),children:"\xd7"})]},t))}),c.length>0&&c.length<2&&(0,on.jsx)("p",{style:Cn.error,children:"Minimum 2 tags required"}),10===c.length&&(0,on.jsx)("p",{style:Cn.error,children:"Maximum 10 tags allowed"})]})}const Cn={container:{padding:16,maxWidth:360,margin:"0 auto",fontFamily:"sans-serif"},header:{height:48,display:"flex",alignItems:"center",justifyContent:"space-between",position:"relative",marginBottom:12},headerTitle:{position:"absolute",left:"50%",transform:"translateX(-50%)",margin:0,fontSize:16,fontWeight:600},close:{background:"none",border:"none",fontSize:22,padding:4},publish:{color:"white",border:"none",padding:"6px 16px",borderRadius:20,fontSize:14},textarea:{width:"100%",minHeight:60,border:"none",outline:"none",fontSize:16,marginBottom:14},imageRow:{display:"flex",gap:12,marginBottom:18},imagePreview:{width:100,height:100,borderRadius:18,background:"#f5f5f5",position:"relative",overflow:"hidden"},previewImg:{width:"100%",height:"100%",objectFit:"contain"},removeImg:{position:"absolute",top:4,right:6,background:"rgba(0,0,0,0.6)",color:"white",borderRadius:"50%",padding:"2px 6px",cursor:"pointer",fontSize:13},imageAdd:{width:100,height:100,borderRadius:18,border:"1px dashed #ccc",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},row:{display:"flex",gap:8,justifyContent:"center",marginBottom:14},input:{width:88,height:32,padding:"0 6px",borderRadius:999,border:"1px solid #9e9e9e",outline:"none",fontSize:12,textAlign:"center",background:"white",boxSizing:"border-box"},tagsContainer:{display:"flex",flexWrap:"wrap",gap:8,marginTop:8},tag:{background:"#f1f1f1",padding:"6px 12px",borderRadius:20,display:"flex",alignItems:"center",gap:6,fontSize:13},remove:{cursor:"pointer",fontWeight:"bold"},error:{color:"red",fontSize:12,marginTop:6}};function Sn(){const[e,t]=(0,o.useState)("chats"),n=Re();return(0,on.jsxs)("div",{style:Rn.page,children:[(0,on.jsxs)("div",{style:Rn.header,children:[(0,on.jsx)("h2",{style:{margin:0},children:"Inbox"}),(0,on.jsx)("div",{style:Rn.back,onClick:()=>n("/"),children:">"})]}),(0,on.jsxs)("div",{style:Rn.tabs,children:[(0,on.jsx)("span",{style:"notifications"===e?Rn.active:Rn.inactive,onClick:()=>t("notifications"),children:"Notifications"}),(0,on.jsx)("span",{style:"chats"===e?Rn.active:Rn.inactive,onClick:()=>t("chats"),children:"Chats"})]}),"chats"===e?(0,on.jsxs)("div",{children:[(0,on.jsx)(kn,{name:"client_1",msg:"What copy pasting",time:"12:37 PM",onClick:()=>n("/chat/client_1")}),(0,on.jsx)(kn,{name:"client_2",msg:"Portfolio link",time:"yesterday",onClick:()=>n("/chat/client_2")})]}):(0,on.jsx)("div",{style:{height:"60vh",background:"#eee"}})]})}function kn(e){let{name:t,msg:n,time:r,onClick:o}=e;return(0,on.jsxs)("div",{style:Rn.chatItem,onClick:o,children:[(0,on.jsx)("div",{style:Rn.avatar}),(0,on.jsxs)("div",{style:{flex:1},children:[(0,on.jsx)("div",{style:Rn.name,children:t}),(0,on.jsxs)("div",{style:Rn.msg,children:["You: ",n]})]}),(0,on.jsx)("div",{style:Rn.time,children:r})]})}const Rn={page:{background:"#fff",minHeight:"100vh"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:12,borderBottom:"1px solid #ddd"},back:{fontSize:24,cursor:"pointer"},tabs:{display:"flex",gap:20,padding:"10px 12px",borderBottom:"1px solid #ddd"},active:{fontWeight:"bold",borderBottom:"2px solid black",cursor:"pointer"},inactive:{color:"#aaa",cursor:"pointer"},chatItem:{display:"flex",alignItems:"center",padding:12,borderBottom:"1px solid #eee",cursor:"pointer"},avatar:{width:40,height:40,borderRadius:"50%",background:"#ccc",marginRight:10},name:{fontWeight:"bold"},msg:{color:"#777",fontSize:14},time:{fontSize:12,color:"#999"}};function _n(){const e=Re();return(0,on.jsxs)("div",{style:In.page,children:[(0,on.jsxs)("div",{style:In.header,children:[(0,on.jsx)("div",{style:In.back,onClick:()=>e(-1),children:"\u2039"}),(0,on.jsx)("div",{style:In.title,children:"Inbox"})]}),(0,on.jsxs)("div",{style:In.tabs,children:[(0,on.jsx)("div",{style:In.tabInactive,children:"Notifications"}),(0,on.jsx)("div",{style:In.tabInactive,children:"Chats"})]}),(0,on.jsx)("div",{style:In.body})]})}const In={page:{height:"100vh",background:"#fff",display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",padding:"12px",borderBottom:"1px solid #ddd"},back:{fontSize:26,marginRight:10,cursor:"pointer"},title:{fontSize:22,fontWeight:"600"},tabs:{display:"flex",borderBottom:"1px solid #eee"},tabInactive:{flex:1,textAlign:"center",padding:"12px 0",fontSize:16,color:"#aaa"},body:{flex:1,background:"#f1f1f1"}};function Nn(){const{clientId:e}=Ie(),t=Re();return(0,on.jsxs)("div",{style:Tn.page,children:[(0,on.jsxs)("div",{style:Tn.header,children:[(0,on.jsx)("div",{style:Tn.back,onClick:()=>t(-1),children:"\u276e"}),(0,on.jsxs)("div",{style:Tn.user,children:[(0,on.jsx)("div",{style:Tn.avatar}),(0,on.jsxs)("div",{children:[(0,on.jsx)("div",{style:Tn.name,children:e}),(0,on.jsxs)("div",{style:Tn.username,children:["@",e,"xyz"]})]})]}),(0,on.jsx)("button",{style:Tn.pay,children:"pay"})]}),(0,on.jsx)("div",{style:Tn.body}),(0,on.jsxs)("div",{style:Tn.inputBar,children:[(0,on.jsx)("div",{style:Tn.plus,children:"+"}),(0,on.jsx)("input",{placeholder:"",style:Tn.input}),(0,on.jsx)("div",{style:Tn.send,children:"^"})]})]})}const Tn={page:{height:"100vh",background:"#fff",display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",padding:"10px",borderBottom:"1px solid #ddd"},back:{fontSize:28,marginRight:8,cursor:"pointer"},user:{display:"flex",alignItems:"center",flex:1},avatar:{width:42,height:42,borderRadius:"50%",background:"#ccc",marginRight:10},name:{fontWeight:"bold",fontSize:16},username:{fontSize:12,color:"#999"},pay:{background:"#000",color:"#fff",border:"none",padding:"6px 14px",borderRadius:20,cursor:"pointer"},body:{flex:1},inputBar:{display:"flex",alignItems:"center",padding:10,borderTop:"1px solid #ddd"},plus:{fontSize:26,marginRight:8,cursor:"pointer"},input:{flex:1,padding:"10px 14px",borderRadius:25,border:"1px solid #ccc",outline:"none"},send:{width:38,height:38,borderRadius:"50%",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:8,cursor:"pointer",fontSize:18}};function An(){const e=Re();return(0,on.jsxs)("div",{style:Dn.page,children:[(0,on.jsxs)("div",{style:Dn.header,children:[(0,on.jsx)("div",{style:Dn.back,onClick:()=>e("/"),children:(0,on.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,on.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,on.jsx)("div",{style:Dn.title,children:"LinkBot"}),(0,on.jsx)("div",{style:Dn.avatar})]}),(0,on.jsx)("div",{style:Dn.messages}),(0,on.jsxs)("div",{style:Dn.inputBar,children:[(0,on.jsx)("input",{placeholder:"start finding",style:Dn.input}),(0,on.jsx)("div",{style:Dn.send,children:"^"})]})]})}const Dn={page:{height:"100vh",background:"#fff"},header:{position:"fixed",top:0,left:0,right:0,height:56,display:"flex",alignItems:"center",padding:"0 14px",borderBottom:"1px solid #eee",background:"#fff",zIndex:10},back:{display:"flex",alignItems:"center",justifyContent:"center",marginRight:12,cursor:"pointer"},title:{flex:1,fontSize:18,fontWeight:"bold"},avatar:{width:32,height:32,borderRadius:"50%",background:"#000"},messages:{position:"absolute",top:56,bottom:60,left:0,right:0,overflowY:"auto",padding:14},inputBar:{position:"fixed",bottom:0,left:0,right:0,height:60,display:"flex",alignItems:"center",padding:"0 12px",borderTop:"1px solid #eee",background:"#fff"},input:{flex:1,height:40,borderRadius:20,border:"1px solid #ddd",padding:"0 14px",fontSize:16,outline:"none"},send:{width:40,height:40,marginLeft:10,borderRadius:"50%",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"}};function On(e){return Xt({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"},child:[]}]})(e)}function Fn(e){return Xt({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M308 96c6.627 0 12-5.373 12-12V44c0-6.627-5.373-12-12-12H12C5.373 32 0 37.373 0 44v44.748c0 6.627 5.373 12 12 12h85.28c27.308 0 48.261 9.958 60.97 27.252H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h158.757c-6.217 36.086-32.961 58.632-74.757 58.632H12c-6.627 0-12 5.373-12 12v53.012c0 3.349 1.4 6.546 3.861 8.818l165.052 152.356a12.001 12.001 0 0 0 8.139 3.182h82.562c10.924 0 16.166-13.408 8.139-20.818L116.871 319.906c76.499-2.34 131.144-53.395 138.318-127.906H308c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-58.69c-3.486-11.541-8.28-22.246-14.252-32H308z"},child:[]}]})(e)}function Pn(e){return Xt({tag:"svg",attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M22.436 0l-11.91 7.773-1.174 4.276 6.625-4.297L11.65 24h4.391l6.395-24zM14.26 10.098L3.389 17.166 1.564 24h9.008l3.688-13.902Z"},child:[]}]})(e)}function Mn(e){return Xt({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"},child:[]},{tag:"path",attr:{d:"M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"},child:[]}]})(e)}function Ln(){const e=Re(),t=(0,o.useRef)(null),n=(0,o.useRef)(null),[r,a]=(0,o.useState)(null),[i,s]=(0,o.useState)(null),[u,l]=(0,o.useState)(""),[c,f]=(0,o.useState)(""),[p,h]=(0,o.useState)(""),[v,m]=(0,o.useState)([]),[g,y]=(0,o.useState)(!1),[b,x]=(0,o.useState)({razorpay:"",instamojo:"",upi:"",custom:"",qr:null}),w=[];b.razorpay&&w.push("razorpay"),b.instamojo&&w.push("instamojo"),b.upi&&w.push("upi"),b.custom&&w.push("custom"),b.qr&&w.push("qr");const E=(e,t)=>{const n=new FileReader;n.onload=()=>t(n.result),n.readAsDataURL(e)};return(0,on.jsxs)("div",{style:Bn.page,children:[(0,on.jsxs)("div",{style:Bn.header,children:[(0,on.jsx)(Qt,{size:20,onClick:()=>e(-1)}),(0,on.jsx)("div",{children:"Edit Profile"}),(0,on.jsx)("button",{style:Bn.save,children:"Save"})]}),(0,on.jsxs)("div",{style:d(d({},Bn.banner),{},{backgroundImage:r?"url(".concat(r,")"):"none"}),children:[(0,on.jsx)("button",{type:"button",style:Bn.bannerBtn,onClick:()=>t.current.click(),children:(0,on.jsx)(Jt,{})}),(0,on.jsx)("input",{ref:t,type:"file",accept:"image/*",hidden:!0,onChange:e=>e.target.files[0]&&E(e.target.files[0],a)})]}),(0,on.jsxs)("div",{style:Bn.avatarWrap,children:[(0,on.jsx)("div",{style:d(d({},Bn.avatar),{},{backgroundImage:i?"url(".concat(i,")"):"none"})}),(0,on.jsx)("button",{type:"button",style:Bn.avatarBtn,onClick:()=>n.current.click(),children:(0,on.jsx)(Jt,{size:14})}),(0,on.jsx)("input",{ref:n,type:"file",accept:"image/*",hidden:!0,onChange:e=>e.target.files[0]&&E(e.target.files[0],s)})]}),(0,on.jsx)("input",{style:Bn.input,placeholder:"name --optional",value:u,onChange:e=>l(e.target.value)}),(0,on.jsx)("p",{style:Bn.hint,children:"this will be displayed to clients and does not change your username"}),(0,on.jsxs)("div",{style:Bn.keywordBox,children:[v.map(e=>(0,on.jsxs)("span",{style:Bn.pill,children:[e,(0,on.jsx)("span",{onClick:()=>(e=>m(v.filter(t=>t!==e)))(e),children:"\xd7"})]},e)),(0,on.jsx)("input",{style:Bn.keywordInput,placeholder:"add keywords",value:p,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&p.trim()&&(e.preventDefault(),v.includes(p.trim())||m([...v,p.trim()]),h(""))}})]}),(0,on.jsx)("h4",{children:"Payments method (max 5)"}),(0,on.jsx)("p",{style:Bn.hint,children:"client can pay using these methods"}),(0,on.jsxs)("div",{style:Bn.paymentRow,children:[(0,on.jsx)("button",{style:Bn.addPayBtn,onClick:()=>y(!0),children:"+ add payment"}),w.map(e=>(0,on.jsxs)("span",{style:Bn.payIcon,children:["razorpay"===e&&(0,on.jsx)(Pn,{}),"instamojo"===e&&(0,on.jsx)("img",{src:"/instamojo/instamojo.svg",alt:"instamojo",style:{height:18}}),"upi"===e&&(0,on.jsx)(Fn,{}),"custom"===e&&(0,on.jsx)(Mn,{}),"qr"===e&&(0,on.jsx)(On,{})]},e))]}),(0,on.jsx)("textarea",{style:Bn.desc,placeholder:"description --optional",value:c,onChange:e=>f(e.target.value)}),g&&(0,on.jsxs)("div",{style:Bn.sheet,children:[(0,on.jsx)("h3",{children:"Add payment method"}),(0,on.jsx)("input",{style:Bn.input,placeholder:"Razorpay link",onChange:e=>x(d(d({},b),{},{razorpay:e.target.value}))}),(0,on.jsx)("input",{style:Bn.input,placeholder:"Instamojo link",onChange:e=>x(d(d({},b),{},{instamojo:e.target.value}))}),(0,on.jsx)("input",{style:Bn.input,placeholder:"UPI ID",onChange:e=>x(d(d({},b),{},{upi:e.target.value}))}),(0,on.jsx)("input",{style:Bn.input,placeholder:"Custom payment",onChange:e=>x(d(d({},b),{},{custom:e.target.value}))}),(0,on.jsxs)("label",{style:Bn.qrBox,children:[(0,on.jsx)(On,{size:34}),(0,on.jsx)("div",{style:{fontWeight:600},children:"Upload QR code"}),(0,on.jsx)("span",{style:{fontSize:12,color:"#666"},children:"PNG or JPG"}),(0,on.jsx)("input",{type:"file",hidden:!0,onChange:e=>e.target.files[0]&&x(d(d({},b),{},{qr:e.target.files[0]}))})]}),(0,on.jsx)("button",{style:Bn.close,onClick:()=>y(!1),children:"Done"})]})]})}const Bn={page:{paddingBottom:140,paddingLeft:16,paddingRight:16},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:14,fontWeight:"bold"},save:{border:"none",padding:"6px 14px",borderRadius:20,background:"#eee"},banner:{height:140,background:"#000",backgroundSize:"cover",backgroundPosition:"center",position:"relative"},bannerBtn:{position:"absolute",right:12,bottom:12,background:"#fff",borderRadius:"50%",padding:8,border:"none"},avatarWrap:{position:"relative",width:90,margin:"-45px auto 10px"},avatar:{width:90,height:90,borderRadius:"50%",background:"#ddd",backgroundSize:"cover",border:"4px solid white"},avatarBtn:{position:"absolute",right:0,bottom:0,background:"#fff",borderRadius:"50%",padding:6,border:"none"},input:{width:"100%",marginTop:10,padding:7,borderRadius:20,background:"#f1f1f1",fontSize:16,border:"none"},desc:{width:"100%",height:120,marginTop:10,padding:7,border:"none",background:"#f1f1f1",fontSize:16,borderRadius:20},hint:{fontSize:12,color:"#777",marginTop:6},keywordBox:{width:"100%",marginTop:10,background:"#f1f1f1",borderRadius:20,padding:7,display:"flex",flexWrap:"wrap",gap:8},pill:{background:"#ddd",padding:"6px 12px",borderRadius:20,display:"flex",gap:6,alignItems:"center"},keywordInput:{border:"none",background:"transparent",flex:1,minWidth:120,outline:"none"},paymentRow:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap",marginTop:10},addPayBtn:{border:"none",padding:"6px 14px",borderRadius:20,background:"#eee"},payIcon:{background:"#eee",padding:8,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},sheet:{position:"fixed",bottom:0,left:0,right:0,background:"#fff",borderTopLeftRadius:20,borderTopRightRadius:20,padding:20,maxHeight:"80vh",overflowY:"auto",zIndex:1e3,paddingBottom:120,border:"2px solid #000",boxShadow:"0 -8px 20px rgba(0,0,0,0.15)"},qrBox:{border:"2px dashed #000",borderRadius:16,padding:24,marginTop:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,background:"#fafafa"},close:{width:"100%",marginTop:16,padding:12,borderRadius:20,border:"none",background:"#000",color:"#fff"}};function zn(){const e=Re();return(0,on.jsxs)("div",{style:Wn.page,children:[(0,on.jsxs)("div",{style:Wn.header,children:[(0,on.jsx)("span",{style:Wn.back,onClick:()=>e(-1),children:"\u3008"}),(0,on.jsx)("h2",{style:Wn.title,children:"Search"})]}),(0,on.jsxs)("div",{style:Wn.searchBox,children:[(0,on.jsx)("span",{style:Wn.icon,children:"\ud83d\udd0d"}),(0,on.jsx)("input",{placeholder:"Search gigs",style:Wn.input})]})]})}const Wn={page:{padding:16,fontFamily:"sans-serif",background:"#fff",minHeight:"100vh"},header:{display:"flex",alignItems:"center",gap:10,marginBottom:14},back:{fontSize:22,cursor:"pointer"},title:{margin:0,fontSize:22},searchBox:{display:"flex",alignItems:"center",gap:10,background:"#f2f2f2",padding:"12px 14px",borderRadius:20},icon:{fontSize:16,opacity:.6},input:{border:"none",outline:"none",background:"transparent",width:"100%",fontSize:16}};function Un(e,t){return function(){return e.apply(t,arguments)}}const{toString:jn}=Object.prototype,{getPrototypeOf:Vn}=Object,{iterator:Hn,toStringTag:Gn}=Symbol,qn=(Kn=Object.create(null),e=>{const t=jn.call(e);return Kn[t]||(Kn[t]=t.slice(8,-1).toLowerCase())});var Kn;const $n=e=>(e=e.toLowerCase(),t=>qn(t)===e),Xn=e=>t=>typeof t===e,{isArray:Yn}=Array,Qn=Xn("undefined");function Jn(e){return null!==e&&!Qn(e)&&null!==e.constructor&&!Qn(e.constructor)&&tr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Zn=$n("ArrayBuffer");const er=Xn("string"),tr=Xn("function"),nr=Xn("number"),rr=e=>null!==e&&"object"===typeof e,or=e=>{if("object"!==qn(e))return!1;const t=Vn(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Gn in e)&&!(Hn in e)},ar=$n("Date"),ir=$n("File"),sr=$n("Blob"),ur=$n("FileList"),lr=$n("URLSearchParams"),[cr,fr,dr,pr]=["ReadableStream","Request","Response","Headers"].map($n);function hr(e,t){let n,r,{allOwnKeys:o=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Yn(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{if(Jn(e))return;const r=o?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let i;for(n=0;n<a;n++)i=r[n],t.call(null,e[i],i,e)}}function vr(e,t){if(Jn(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}const mr="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:n.g,gr=e=>!Qn(e)&&e!==mr;const yr=(br="undefined"!==typeof Uint8Array&&Vn(Uint8Array),e=>br&&e instanceof br);var br;const xr=$n("HTMLFormElement"),wr=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),Er=$n("RegExp"),Cr=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};hr(n,(n,o)=>{let a;!1!==(a=t(n,o,e))&&(r[o]=a||n)}),Object.defineProperties(e,r)};const Sr=$n("AsyncFunction"),kr=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),r=[],mr.addEventListener("message",e=>{let{source:t,data:o}=e;t===mr&&o===n&&r.length&&r.shift()()},!1),e=>{r.push(e),mr.postMessage(n,"*")}):e=>setTimeout(e);var n,r})("function"===typeof setImmediate,tr(mr.postMessage)),Rr="undefined"!==typeof queueMicrotask?queueMicrotask.bind(mr):"undefined"!==typeof process&&process.nextTick||kr,_r={isArray:Yn,isArrayBuffer:Zn,isBuffer:Jn,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||tr(e.append)&&("formdata"===(t=qn(e))||"object"===t&&tr(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Zn(e.buffer),t},isString:er,isNumber:nr,isBoolean:e=>!0===e||!1===e,isObject:rr,isPlainObject:or,isEmptyObject:e=>{if(!rr(e)||Jn(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(yg){return!1}},isReadableStream:cr,isRequest:fr,isResponse:dr,isHeaders:pr,isUndefined:Qn,isDate:ar,isFile:ir,isBlob:sr,isRegExp:Er,isFunction:tr,isStream:e=>rr(e)&&tr(e.pipe),isURLSearchParams:lr,isTypedArray:yr,isFileList:ur,forEach:hr,merge:function e(){const{caseless:t,skipUndefined:n}=gr(this)&&this||{},r={},o=(o,a)=>{const i=t&&vr(r,a)||a;or(r[i])&&or(o)?r[i]=e(r[i],o):or(o)?r[i]=e({},o):Yn(o)?r[i]=o.slice():n&&Qn(o)||(r[i]=o)};for(let a=0,i=arguments.length;a<i;a++)arguments[a]&&hr(arguments[a],o);return r},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return hr(t,(t,r)=>{n&&tr(t)?e[r]=Un(t,n):e[r]=t},{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let o,a,i;const s={};if(t=t||{},null==e)return t;do{for(o=Object.getOwnPropertyNames(e),a=o.length;a-- >0;)i=o[a],r&&!r(i,e,t)||s[i]||(t[i]=e[i],s[i]=!0);e=!1!==n&&Vn(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:qn,kindOfTest:$n,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Yn(e))return e;let t=e.length;if(!nr(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Hn]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:xr,hasOwnProperty:wr,hasOwnProp:wr,reduceDescriptors:Cr,freezeMethods:e=>{Cr(e,(t,n)=>{if(tr(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];tr(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return Yn(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:vr,global:mr,isContextDefined:gr,isSpecCompliantForm:function(e){return!!(e&&tr(e.append)&&"FormData"===e[Gn]&&e[Hn])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(rr(e)){if(t.indexOf(e)>=0)return;if(Jn(e))return e;if(!("toJSON"in e)){t[r]=e;const o=Yn(e)?[]:{};return hr(e,(e,t)=>{const a=n(e,r+1);!Qn(a)&&(o[t]=a)}),t[r]=void 0,o}}return e};return n(e,0)},isAsyncFn:Sr,isThenable:e=>e&&(rr(e)||tr(e))&&tr(e.then)&&tr(e.catch),setImmediate:kr,asap:Rr,isIterable:e=>null!=e&&tr(e[Hn])};function Ir(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}_r.inherits(Ir,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_r.toJSONObject(this.config),code:this.code,status:this.status}}});const Nr=Ir.prototype,Tr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Tr[e]={value:e}}),Object.defineProperties(Ir,Tr),Object.defineProperty(Nr,"isAxiosError",{value:!0}),Ir.from=(e,t,n,r,o,a)=>{const i=Object.create(Nr);_r.toFlatObject(e,i,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const s=e&&e.message?e.message:"Error",u=null==t&&e?e.code:t;return Ir.call(i,s,u,n,r,o),e&&null==i.cause&&Object.defineProperty(i,"cause",{value:e,configurable:!0}),i.name=e&&e.name||"Error",a&&Object.assign(i,a),i};const Ar=Ir;function Dr(e){return _r.isPlainObject(e)||_r.isArray(e)}function Or(e){return _r.endsWith(e,"[]")?e.slice(0,-2):e}function Fr(e,t,n){return e?e.concat(t).map(function(e,t){return e=Or(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const Pr=_r.toFlatObject(_r,{},null,function(e){return/^is[A-Z]/.test(e)});const Mr=function(e,t,n){if(!_r.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=_r.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!_r.isUndefined(t[e])})).metaTokens,o=n.visitor||l,a=n.dots,i=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&_r.isSpecCompliantForm(t);if(!_r.isFunction(o))throw new TypeError("visitor must be a function");function u(e){if(null===e)return"";if(_r.isDate(e))return e.toISOString();if(_r.isBoolean(e))return e.toString();if(!s&&_r.isBlob(e))throw new Ar("Blob is not supported. Use a Buffer instead.");return _r.isArrayBuffer(e)||_r.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,o){let s=e;if(e&&!o&&"object"===typeof e)if(_r.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(_r.isArray(e)&&function(e){return _r.isArray(e)&&!e.some(Dr)}(e)||(_r.isFileList(e)||_r.endsWith(n,"[]"))&&(s=_r.toArray(e)))return n=Or(n),s.forEach(function(e,r){!_r.isUndefined(e)&&null!==e&&t.append(!0===i?Fr([n],r,a):null===i?n:n+"[]",u(e))}),!1;return!!Dr(e)||(t.append(Fr(o,n,a),u(e)),!1)}const c=[],f=Object.assign(Pr,{defaultVisitor:l,convertValue:u,isVisitable:Dr});if(!_r.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!_r.isUndefined(n)){if(-1!==c.indexOf(n))throw Error("Circular reference detected in "+r.join("."));c.push(n),_r.forEach(n,function(n,a){!0===(!(_r.isUndefined(n)||null===n)&&o.call(t,n,_r.isString(a)?a.trim():a,r,f))&&e(n,r?r.concat(a):[a])}),c.pop()}}(e),t};function Lr(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Br(e,t){this._pairs=[],e&&Mr(e,this,t)}const zr=Br.prototype;zr.append=function(e,t){this._pairs.push([e,t])},zr.toString=function(e){const t=e?function(t){return e.call(this,t,Lr)}:Lr;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const Wr=Br;function Ur(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function jr(e,t,n){if(!t)return e;const r=n&&n.encode||Ur;_r.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let a;if(a=o?o(t,n):_r.isURLSearchParams(t)?t.toString():new Wr(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const Vr=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){_r.forEach(this.handlers,function(t){null!==t&&e(t)})}},Hr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Gr={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Wr,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},qr="undefined"!==typeof window&&"undefined"!==typeof document,Kr="object"===typeof navigator&&navigator||void 0,$r=qr&&(!Kr||["ReactNative","NativeScript","NS"].indexOf(Kr.product)<0),Xr="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Yr=qr&&window.location.href||"http://localhost",Qr=d(d({},e),Gr);const Jr=function(e){function t(e,n,r,o){let a=e[o++];if("__proto__"===a)return!0;const i=Number.isFinite(+a),s=o>=e.length;if(a=!a&&_r.isArray(r)?r.length:a,s)return _r.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!i;r[a]&&_r.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],o)&&_r.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const o=n.length;let a;for(r=0;r<o;r++)a=n[r],t[a]=e[a];return t}(r[a])),!i}if(_r.isFormData(e)&&_r.isFunction(e.entries)){const n={};return _r.forEachEntry(e,(e,r)=>{t(function(e){return _r.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null};const Zr={transitional:Hr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=_r.isObject(e);o&&_r.isHTMLForm(e)&&(e=new FormData(e));if(_r.isFormData(e))return r?JSON.stringify(Jr(e)):e;if(_r.isArrayBuffer(e)||_r.isBuffer(e)||_r.isStream(e)||_r.isFile(e)||_r.isBlob(e)||_r.isReadableStream(e))return e;if(_r.isArrayBufferView(e))return e.buffer;if(_r.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Mr(e,new Qr.classes.URLSearchParams,d({visitor:function(e,t,n,r){return Qr.isNode&&_r.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=_r.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Mr(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),function(e,t,n){if(_r.isString(e))try{return(t||JSON.parse)(e),_r.trim(e)}catch(yg){if("SyntaxError"!==yg.name)throw yg}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Zr.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(_r.isResponse(e)||_r.isReadableStream(e))return e;if(e&&_r.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(yg){if(n){if("SyntaxError"===yg.name)throw Ar.from(yg,Ar.ERR_BAD_RESPONSE,this,null,this.response);throw yg}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qr.classes.FormData,Blob:Qr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_r.forEach(["delete","get","head","post","put","patch"],e=>{Zr.headers[e]={}});const eo=Zr,to=_r.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),no=Symbol("internals");function ro(e){return e&&String(e).trim().toLowerCase()}function oo(e){return!1===e||null==e?e:_r.isArray(e)?e.map(oo):String(e)}function ao(e,t,n,r,o){return _r.isFunction(r)?r.call(this,t,n):(o&&(t=n),_r.isString(t)?_r.isString(r)?-1!==t.indexOf(r):_r.isRegExp(r)?r.test(t):void 0:void 0)}class io{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function o(e,t,n){const o=ro(t);if(!o)throw new Error("header name must be a non-empty string");const a=_r.findKey(r,o);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=oo(e))}const a=(e,t)=>_r.forEach(e,(e,n)=>o(e,n,t));if(_r.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(_r.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let n,r,o;return e&&e.split("\n").forEach(function(e){o=e.indexOf(":"),n=e.substring(0,o).trim().toLowerCase(),r=e.substring(o+1).trim(),!n||t[n]&&to[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(_r.isObject(e)&&_r.isIterable(e)){let n,r,o={};for(const t of e){if(!_r.isArray(t))throw TypeError("Object iterator must return a key-value pair");o[r=t[0]]=(n=o[r])?_r.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}a(o,t)}else null!=e&&o(t,e,n);return this}get(e,t){if(e=ro(e)){const n=_r.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(_r.isFunction(t))return t.call(this,e,n);if(_r.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ro(e)){const n=_r.findKey(this,e);return!(!n||void 0===this[n]||t&&!ao(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function o(e){if(e=ro(e)){const o=_r.findKey(n,e);!o||t&&!ao(0,n[o],o,t)||(delete n[o],r=!0)}}return _r.isArray(e)?e.forEach(o):o(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const o=t[n];e&&!ao(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const t=this,n={};return _r.forEach(this,(r,o)=>{const a=_r.findKey(n,o);if(a)return t[a]=oo(r),void delete t[o];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(o):String(o).trim();i!==o&&delete t[o],t[i]=oo(r),n[i]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return _r.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&_r.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[no]=this[no]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ro(e);t[r]||(!function(e,t){const n=_r.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,o){return this[r].call(this,t,e,n,o)},configurable:!0})})}(n,e),t[r]=!0)}return _r.isArray(e)?e.forEach(r):r(e),this}}io.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),_r.reduceDescriptors(io.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}}),_r.freezeMethods(io);const so=io;function uo(e,t){const n=this||eo,r=t||n,o=so.from(r.headers);let a=r.data;return _r.forEach(e,function(e){a=e.call(n,a,o.normalize(),t?t.status:void 0)}),o.normalize(),a}function lo(e){return!(!e||!e.__CANCEL__)}function co(e,t,n){Ar.call(this,null==e?"canceled":e,Ar.ERR_CANCELED,t,n),this.name="CanceledError"}_r.inherits(co,Ar,{__CANCEL__:!0});const fo=co;function po(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Ar("Request failed with status code "+n.status,[Ar.ERR_BAD_REQUEST,Ar.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const ho=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let o,a=0,i=0;return t=void 0!==t?t:1e3,function(s){const u=Date.now(),l=r[i];o||(o=u),n[a]=s,r[a]=u;let c=i,f=0;for(;c!==a;)f+=n[c++],c%=e;if(a=(a+1)%e,a===i&&(i=(i+1)%e),u-o<t)return;const d=l&&u-l;return d?Math.round(1e3*f/d):void 0}};const vo=function(e,t){let n,r,o=0,a=1e3/t;const i=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();o=a,n=null,r&&(clearTimeout(r),r=null),e(...t)};return[function(){const e=Date.now(),t=e-o;for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];t>=a?i(u,e):(n=u,r||(r=setTimeout(()=>{r=null,i(n)},a-t)))},()=>n&&i(n)]},mo=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const o=ho(50,250);return vo(n=>{const a=n.loaded,i=n.lengthComputable?n.total:void 0,s=a-r,u=o(s);r=a;e({loaded:a,total:i,progress:i?a/i:void 0,bytes:s,rate:u||void 0,estimated:u&&i&&a<=i?(i-a)/u:void 0,event:n,lengthComputable:null!=i,[t?"download":"upload"]:!0})},n)},go=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},yo=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return _r.asap(()=>e(...n))},bo=Qr.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Qr.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Qr.origin),Qr.navigator&&/(msie|trident)/i.test(Qr.navigator.userAgent)):()=>!0,xo=Qr.hasStandardBrowserEnv?{write(e,t,n,r,o,a,i){if("undefined"===typeof document)return;const s=["".concat(e,"=").concat(encodeURIComponent(t))];_r.isNumber(n)&&s.push("expires=".concat(new Date(n).toUTCString())),_r.isString(r)&&s.push("path=".concat(r)),_r.isString(o)&&s.push("domain=".concat(o)),!0===a&&s.push("secure"),_r.isString(i)&&s.push("SameSite=".concat(i)),document.cookie=s.join("; ")},read(e){if("undefined"===typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function wo(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Eo=e=>e instanceof so?d({},e):e;function Co(e,t){t=t||{};const n={};function r(e,t,n,r){return _r.isPlainObject(e)&&_r.isPlainObject(t)?_r.merge.call({caseless:r},e,t):_r.isPlainObject(t)?_r.merge({},t):_r.isArray(t)?t.slice():t}function o(e,t,n,o){return _r.isUndefined(t)?_r.isUndefined(e)?void 0:r(void 0,e,0,o):r(e,t,0,o)}function a(e,t){if(!_r.isUndefined(t))return r(void 0,t)}function i(e,t){return _r.isUndefined(t)?_r.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,o,a){return a in t?r(n,o):a in e?r(void 0,n):void 0}const u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(e,t,n)=>o(Eo(e),Eo(t),0,!0)};return _r.forEach(Object.keys(d(d({},e),t)),function(r){const a=u[r]||o,i=a(e[r],t[r],r);_r.isUndefined(i)&&a!==s||(n[r]=i)}),n}const So=e=>{const t=Co({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:a,headers:i,auth:s}=t;if(t.headers=i=so.from(i),t.url=jr(wo(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&i.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),_r.isFormData(n))if(Qr.hasStandardBrowserEnv||Qr.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(_r.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[n,r]=e;t.includes(n.toLowerCase())&&i.set(n,r)})}if(Qr.hasStandardBrowserEnv&&(r&&_r.isFunction(r)&&(r=r(t)),r||!1!==r&&bo(t.url))){const e=o&&a&&xo.read(a);e&&i.set(o,e)}return t},ko="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=So(e);let o=r.data;const a=so.from(r.headers).normalize();let i,s,u,l,c,{responseType:f,onUploadProgress:d,onDownloadProgress:p}=r;function h(){l&&l(),c&&c(),r.cancelToken&&r.cancelToken.unsubscribe(i),r.signal&&r.signal.removeEventListener("abort",i)}let v=new XMLHttpRequest;function m(){if(!v)return;const r=so.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders());po(function(e){t(e),h()},function(e){n(e),h()},{data:f&&"text"!==f&&"json"!==f?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:r,config:e,request:v}),v=null}v.open(r.method.toUpperCase(),r.url,!0),v.timeout=r.timeout,"onloadend"in v?v.onloadend=m:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(m)},v.onabort=function(){v&&(n(new Ar("Request aborted",Ar.ECONNABORTED,e,v)),v=null)},v.onerror=function(t){const r=t&&t.message?t.message:"Network Error",o=new Ar(r,Ar.ERR_NETWORK,e,v);o.event=t||null,n(o),v=null},v.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const o=r.transitional||Hr;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new Ar(t,o.clarifyTimeoutError?Ar.ETIMEDOUT:Ar.ECONNABORTED,e,v)),v=null},void 0===o&&a.setContentType(null),"setRequestHeader"in v&&_r.forEach(a.toJSON(),function(e,t){v.setRequestHeader(t,e)}),_r.isUndefined(r.withCredentials)||(v.withCredentials=!!r.withCredentials),f&&"json"!==f&&(v.responseType=r.responseType),p&&([u,c]=mo(p,!0),v.addEventListener("progress",u)),d&&v.upload&&([s,l]=mo(d),v.upload.addEventListener("progress",s),v.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(i=t=>{v&&(n(!t||t.type?new fo(null,e,v):t),v.abort(),v=null)},r.cancelToken&&r.cancelToken.subscribe(i),r.signal&&(r.signal.aborted?i():r.signal.addEventListener("abort",i)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);g&&-1===Qr.protocols.indexOf(g)?n(new Ar("Unsupported protocol "+g+":",Ar.ERR_BAD_REQUEST,e)):v.send(o||null)})},Ro=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const o=function(e){if(!n){n=!0,i();const t=e instanceof Error?e:this.reason;r.abort(t instanceof Ar?t:new fo(t instanceof Error?t.message:t))}};let a=t&&setTimeout(()=>{a=null,o(new Ar("timeout ".concat(t," of ms exceeded"),Ar.ETIMEDOUT))},t);const i=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(o):e.removeEventListener("abort",o)}),e=null)};e.forEach(e=>e.addEventListener("abort",o));const{signal:s}=r;return s.unsubscribe=()=>_r.asap(i),s}};function _o(e,t){this.v=e,this.k=t}function Io(e){return function(){return new No(e.apply(this,arguments))}}function No(e){var t,n;function r(t,n){try{var a=e[t](n),i=a.value,s=i instanceof _o;Promise.resolve(s?i.v:i).then(function(n){if(s){var u="return"===t?"return":"next";if(!i.k||n.done)return r(u,n);n=e[u](n).value}o(a.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){o("throw",e)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,o){return new Promise(function(a,i){var s={key:e,arg:o,resolve:a,reject:i,next:null};n?n=n.next=s:(t=n=s,r(e,o))})},"function"!=typeof e.return&&(this.return=void 0)}function To(e){return new _o(e,0)}function Ao(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise(function(n){n(e[t](r))}),{done:!1,value:new _o(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function Do(e){var t,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Oo(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Oo(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Oo=function(e){this.s=e,this.n=e.next},Oo.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Oo(e)}No.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},No.prototype.next=function(e){return this._invoke("next",e)},No.prototype.throw=function(e){return this._invoke("throw",e)},No.prototype.return=function(e){return this._invoke("return",e)};const Fo=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,o=0;for(;o<n;)r=o+t,yield e.slice(o,r),o=r},Po=function(){var e=Io(function*(e,t){var n,r=!1,o=!1;try{for(var a,i=Do(Mo(e));r=!(a=yield To(i.next())).done;r=!1){const e=a.value;yield*Ao(Do(Fo(e,t)))}}catch(s){o=!0,n=s}finally{try{r&&null!=i.return&&(yield To(i.return()))}finally{if(o)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),Mo=function(){var e=Io(function*(e){if(e[Symbol.asyncIterator])return void(yield*Ao(Do(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield To(t.read());if(e)break;yield n}}finally{yield To(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Lo=(e,t,n,r)=>{const o=Po(e,t);let a,i=0,s=e=>{a||(a=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await o.next();if(t)return s(),void e.close();let a=r.byteLength;if(n){let e=i+=a;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw s(t),t}},cancel:e=>(s(e),o.return())},{highWaterMark:2})},{isFunction:Bo}=_r,zo=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(_r.global),{ReadableStream:Wo,TextEncoder:Uo}=_r.global,jo=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(yg){return!1}},Vo=e=>{e=_r.merge.call({skipUndefined:!0},zo,e);const{fetch:t,Request:n,Response:r}=e,o=t?Bo(t):"function"===typeof fetch,a=Bo(n),i=Bo(r);if(!o)return!1;const s=o&&Bo(Wo),u=o&&("function"===typeof Uo?(l=new Uo,e=>l.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var l;const c=a&&s&&jo(()=>{let e=!1;const t=new n(Qr.origin,{body:new Wo,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),f=i&&s&&jo(()=>_r.isReadableStream(new r("").body)),p={stream:f&&(e=>e.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!p[e]&&(p[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new Ar("Response type '".concat(e,"' is not supported"),Ar.ERR_NOT_SUPPORT,n)})});const h=async(e,t)=>{const r=_r.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(_r.isBlob(e))return e.size;if(_r.isSpecCompliantForm(e)){const t=new n(Qr.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return _r.isArrayBufferView(e)||_r.isArrayBuffer(e)?e.byteLength:(_r.isURLSearchParams(e)&&(e+=""),_r.isString(e)?(await u(e)).byteLength:void 0)})(t):r};return async e=>{let{url:o,method:i,data:s,signal:u,cancelToken:l,timeout:v,onDownloadProgress:m,onUploadProgress:g,responseType:y,headers:b,withCredentials:x="same-origin",fetchOptions:w}=So(e),E=t||fetch;y=y?(y+"").toLowerCase():"text";let C=Ro([u,l&&l.toAbortSignal()],v),S=null;const k=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let R;try{if(g&&c&&"get"!==i&&"head"!==i&&0!==(R=await h(b,s))){let e,t=new n(o,{method:"POST",body:s,duplex:"half"});if(_r.isFormData(s)&&(e=t.headers.get("content-type"))&&b.setContentType(e),t.body){const[e,n]=go(R,mo(yo(g)));s=Lo(t.body,65536,e,n)}}_r.isString(x)||(x=x?"include":"omit");const t=a&&"credentials"in n.prototype,u=d(d({},w),{},{signal:C,method:i.toUpperCase(),headers:b.normalize().toJSON(),body:s,duplex:"half",credentials:t?x:void 0});S=a&&new n(o,u);let l=await(a?E(S,w):E(o,u));const v=f&&("stream"===y||"response"===y);if(f&&(m||v&&k)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=l[t]});const t=_r.toFiniteNumber(l.headers.get("content-length")),[n,o]=m&&go(t,mo(yo(m),!0))||[];l=new r(Lo(l.body,65536,n,()=>{o&&o(),k&&k()}),e)}y=y||"text";let _=await p[_r.findKey(p,y)||"text"](l,e);return!v&&k&&k(),await new Promise((t,n)=>{po(t,n,{data:_,headers:so.from(l.headers),status:l.status,statusText:l.statusText,config:e,request:S})})}catch(_){if(k&&k(),_&&"TypeError"===_.name&&/Load failed|fetch/i.test(_.message))throw Object.assign(new Ar("Network Error",Ar.ERR_NETWORK,e,S),{cause:_.cause||_});throw Ar.from(_,_&&_.code,e,S)}}},Ho=new Map,Go=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:o}=t,a=[r,o,n];let i,s,u=a.length,l=Ho;for(;u--;)i=a[u],s=l.get(i),void 0===s&&l.set(i,s=u?new Map:Vo(t)),l=s;return s},qo=(Go(),{http:null,xhr:ko,fetch:{get:Go}});_r.forEach(qo,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(yg){}Object.defineProperty(e,"adapterName",{value:t})}});const Ko=e=>"- ".concat(e),$o=e=>_r.isFunction(e)||null===e||!1===e;const Xo={getAdapter:function(e,t){e=_r.isArray(e)?e:[e];const{length:n}=e;let r,o;const a={};for(let i=0;i<n;i++){let n;if(r=e[i],o=r,!$o(r)&&(o=qo[(n=String(r)).toLowerCase()],void 0===o))throw new Ar("Unknown adapter '".concat(n,"'"));if(o&&(_r.isFunction(o)||(o=o.get(t))))break;a[n||"#"+i]=o}if(!o){const e=Object.entries(a).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});let t=n?e.length>1?"since :\n"+e.map(Ko).join("\n"):" "+Ko(e[0]):"as no adapter specified";throw new Ar("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return o},adapters:qo};function Yo(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new fo(null,e)}function Qo(e){Yo(e),e.headers=so.from(e.headers),e.data=uo.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Xo.getAdapter(e.adapter||eo.adapter,e)(e).then(function(t){return Yo(e),t.data=uo.call(e,e.transformResponse,t),t.headers=so.from(t.headers),t},function(t){return lo(t)||(Yo(e),t&&t.response&&(t.response.data=uo.call(e,e.transformResponse,t.response),t.response.headers=so.from(t.response.headers))),Promise.reject(t)})}const Jo="1.13.2",Zo={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Zo[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const ea={};Zo.transitional=function(e,t,n){function r(e,t){return"[Axios v"+Jo+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,o,a)=>{if(!1===e)throw new Ar(r(o," has been removed"+(t?" in "+t:"")),Ar.ERR_DEPRECATED);return t&&!ea[o]&&(ea[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}},Zo.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const ta={assertOptions:function(e,t,n){if("object"!==typeof e)throw new Ar("options must be an object",Ar.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const a=r[o],i=t[a];if(i){const t=e[a],n=void 0===t||i(t,a,e);if(!0!==n)throw new Ar("option "+a+" must be "+n,Ar.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new Ar("Unknown option "+a,Ar.ERR_BAD_OPTION)}},validators:Zo},na=ta.validators;class ra{constructor(e){this.defaults=e||{},this.interceptors={request:new Vr,response:new Vr}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(yg){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=Co(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;void 0!==n&&ta.assertOptions(n,{silentJSONParsing:na.transitional(na.boolean),forcedJSONParsing:na.transitional(na.boolean),clarifyTimeoutError:na.transitional(na.boolean)},!1),null!=r&&(_r.isFunction(r)?t.paramsSerializer={serialize:r}:ta.assertOptions(r,{encode:na.function,serialize:na.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ta.assertOptions(t,{baseUrl:na.spelling("baseURL"),withXsrfToken:na.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&_r.merge(o.common,o[t.method]);o&&_r.forEach(["delete","get","head","post","put","patch","common"],e=>{delete o[e]}),t.headers=so.concat(a,o);const i=[];let s=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});const u=[];let l;this.interceptors.response.forEach(function(e){u.push(e.fulfilled,e.rejected)});let c,f=0;if(!s){const e=[Qo.bind(this),void 0];for(e.unshift(...i),e.push(...u),c=e.length,l=Promise.resolve(t);f<c;)l=l.then(e[f++],e[f++]);return l}c=i.length;let d=t;for(;f<c;){const e=i[f++],t=i[f++];try{d=e(d)}catch(p){t.call(this,p);break}}try{l=Qo.call(this,d)}catch(p){return Promise.reject(p)}for(f=0,c=u.length;f<c;)l=l.then(u[f++],u[f++]);return l}getUri(e){return jr(wo((e=Co(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}_r.forEach(["delete","get","head","options"],function(e){ra.prototype[e]=function(t,n){return this.request(Co(n||{},{method:e,url:t,data:(n||{}).data}))}}),_r.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,o){return this.request(Co(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ra.prototype[e]=t(),ra.prototype[e+"Form"]=t(!0)});const oa=ra;class aa{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,o){n.reason||(n.reason=new fo(e,r,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new aa(function(t){e=t});return{token:t,cancel:e}}}const ia=aa;const sa={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(sa).forEach(e=>{let[t,n]=e;sa[n]=t});const ua=sa;const la=function e(t){const n=new oa(t),r=Un(oa.prototype.request,n);return _r.extend(r,oa.prototype,n,{allOwnKeys:!0}),_r.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(Co(t,n))},r}(eo);la.Axios=oa,la.CanceledError=fo,la.CancelToken=ia,la.isCancel=lo,la.VERSION=Jo,la.toFormData=Mr,la.AxiosError=Ar,la.Cancel=la.CanceledError,la.all=function(e){return Promise.all(e)},la.spread=function(e){return function(t){return e.apply(null,t)}},la.isAxiosError=function(e){return _r.isObject(e)&&!0===e.isAxiosError},la.mergeConfig=Co,la.AxiosHeaders=so,la.formToJSON=e=>Jr(_r.isHTMLForm(e)?new FormData(e):e),la.getAdapter=Xo.getAdapter,la.HttpStatusCode=ua,la.default=la;const ca=la,fa=()=>{const e=Re(),[t,n]=(0,o.useState)({username:"",email:"",password:"",agree:!1}),r=e=>{const{name:r,value:o,type:a,checked:i}=e.target;n(d(d({},t),{},{[r]:"checkbox"===a?i:o}))};return(0,on.jsx)("div",{className:"signup-wrapper",children:(0,on.jsxs)("div",{className:"signup-card",children:[(0,on.jsx)("div",{className:"logo",children:"\u2716"}),(0,on.jsx)("h2",{className:"title",children:"Sign up"}),(0,on.jsx)("input",{className:"input",name:"username",placeholder:"Username",onChange:r}),(0,on.jsx)("input",{className:"input",name:"email",placeholder:"Email",onChange:r}),(0,on.jsx)("input",{className:"input",name:"password",type:"password",placeholder:"Create a password",onChange:r}),(0,on.jsxs)("div",{className:"checkbox-row",children:[(0,on.jsx)("input",{type:"checkbox",name:"agree",onChange:r}),(0,on.jsxs)("span",{children:["I agree to the",(0,on.jsx)("span",{className:"purple",children:" LinkX User Agreement"})]})]}),(0,on.jsx)("button",{className:"signup-btn",onClick:async()=>{if(t.username&&t.email&&t.password)if(t.agree){ca.defaults.baseURL="http://127.0.0.1:8001/";try{await ca.post("/api/accounts/send-signup-otp/",{email:t.email,username:t.username}),sessionStorage.setItem("signup_email",t.email),sessionStorage.setItem("signup_username",t.username),sessionStorage.setItem("signup_password",t.password),e("/verify-otp")}catch(o){var n,r;alert((null===(n=o.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.error)||"Signup failed")}}else alert("You must agree to LinkX user agreement");else alert("All fields are required")},children:"Sign up"}),(0,on.jsxs)("p",{className:"login-text",children:["Already have an account?",(0,on.jsxs)("span",{className:"purple",onClick:()=>e("/login"),children:[" ","Login"]})]})]})})},da=()=>{const e=Re(),t=sessionStorage.getItem("signup_email"),[n,r]=(0,o.useState)(["","","",""]),a=(0,o.useRef)([]);return(0,on.jsxs)("div",{children:[(0,on.jsxs)("p",{children:["OTP sent to ",t]}),(0,on.jsx)("div",{style:{display:"flex",gap:"10px"},children:n.map((e,t)=>(0,on.jsx)("input",{ref:e=>a.current[t]=e,value:e,onChange:e=>((e,t)=>{if(!/^\d?$/.test(e))return;const o=[...n];var i;o[t]=e,r(o),e&&t<3&&(null===(i=a.current[t+1])||void 0===i||i.focus())})(e.target.value,t),maxLength:1,style:{width:"50px",height:"50px",textAlign:"center"}},t))}),(0,on.jsx)("button",{onClick:async()=>{const r=n.join("");if(4===r.length){ca.defaults.baseURL="http://127.0.0.1:8001/";try{await ca.post("/api/accounts/verify-signup-otp/",{email:t,otp:r}),e("/FaceVerification")}catch(i){var o,a;alert((null===(o=i.response)||void 0===o||null===(a=o.data)||void 0===a?void 0:a.error)||"OTP verification failed")}}else alert("Enter complete OTP")},children:"Verify OTP"})]})};var pa=function(e,t){return pa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},pa(e,t)};function ha(e,t){function n(){this.constructor=e}pa(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var va=function(){return va=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},va.apply(this,arguments)};function ma(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(yg){a(yg)}}function s(e){try{u(r.throw(e))}catch(yg){a(yg)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})}function ga(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(yg){a=[6,yg],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var ya=function(e,t){return(ya=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function ba(e,t){function n(){this.constructor=e}ya(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var xa=function(){return(xa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function wa(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function Ea(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var Ca={},Sa={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ka(e){e in Ca||(Ca[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Ca[e]},!1),1===e?t.getContext("webgl",Sa)||t.getContext("experimental-webgl",Sa):t.getContext("webgl2",Sa)}(e));var t=Ca[e];return t.isContextLost()?(delete Ca[e],ka(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ca[e])}function Ra(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function _a(e,t,n){return Math.max(e,Math.min(t,n))}function Ia(e){return e%2==0?e:e+1}function Na(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function Ta(e,t){var n=Math.random();return t*n+(1-n)*e}function Aa(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Da(e,t,n){void 0===n&&(n=""),Aa(Ma(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function Oa(e){Aa(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function Fa(e,t){if(void 0===t&&(t=[]),null==t&&(t=[]),Array.isArray(e)||Ya(e))for(var n=0;n<e.length;++n)Fa(e[n],t);else t.push(e);return t}function Pa(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Ma(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function La(e){return e%1==0}function Ba(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function za(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Wa(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ua(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{var s=t(++a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function ja(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function Va(e,t){var n=t.length;return Aa((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),Aa(e.every(function(e){return La(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function Ha(e,t){for(var n=[],r=[],o=null==t?null:Va(t,e).sort(),a=0,i=0;i<e.length;++i){if(null!=o){if(o[a]===i&&1!==e[i])throw new Error("Can't squeeze axis "+i+" since its dim '"+e[i]+"' is not 1");(null==o[a]||o[a]>i)&&1===e[i]&&(n.push(e[i]),r.push(i)),o[a]<=i&&a++}1!==e[i]&&(n.push(e[i]),r.push(i))}return{newShape:n,keptDims:r}}function Ga(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function qa(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Ka(e,t,n){if("float32"===t)for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+n+"' is "+o+".")}}function $a(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Xa(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function Ya(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Qa(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Ja(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=2*e.length}),t}function Za(e){return"string"==typeof e||e instanceof String}function ei(e){return"boolean"==typeof e}function ti(e){return"number"==typeof e}function ni(e){return Array.isArray(e)?ni(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":ti(e)?"float32":Za(e)?"string":ei(e)?"bool":"float32"}function ri(e){return!!(e&&e.constructor&&e.call&&e.apply)}function oi(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function ai(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function ii(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Fa(e)),n&&$a(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function si(e,t,n){var r=new Array;if(1===t.length)for(var o=t[0],a=0;a<o;a++)r[a]=n[e+a];else{o=t[0];var i=t.slice(1),s=i.reduce(function(e,t){return e*t});for(a=0;a<o;a++)r[a]=si(e+a*s,i,n)}return r}function ui(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return si(0,e,t)}function li(e,t){for(var n=ci(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ci(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function fi(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof process){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function di(e){e.forEach(function(t){Aa(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}Object.freeze({shuffle:Ra,clamp:_a,nearestLargerEven:Ia,sum:Na,randUniform:Ta,distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:Aa,assertShapesMatch:Da,assertNonNull:Oa,flatten:Fa,sizeFromShape:Pa,isScalarShape:function(e){return 0===e.length},arraysEqual:Ma,isInt:La,tanh:Ba,sizeToSquarishShape:za,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return Ra(t),t},rightPad:Wa,repeatedTry:Ua,inferFromImplicitShape:ja,parseAxisParam:Va,squeezeShape:Ha,getTypedArrayFromDType:Ga,getArrayFromDType:qa,checkComputationForErrors:Ka,checkConversionForErrors:$a,hasEncodingLoss:Xa,isTypedArray:Ya,bytesPerElement:Qa,bytesFromStringArray:Ja,isString:Za,isBoolean:ei,isNumber:ti,inferDtype:ni,isFunction:ri,nearestDivisor:oi,computeStrides:ai,toTypedArray:ii,toNestedArray:ui,makeOnesTypedArray:li,makeZerosTypedArray:ci,now:fi,assertNonNegativeIntegerDimensions:di});var pi=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new hi)}return e.prototype.profileKernel=function(e,t){var n,r=this,o=this.backendTimer.time(function(){n=t()});return(Array.isArray(n)?n:[n]).forEach(function(t){var n=t.dataSync();Ka(n,t.dtype,e),o.then(function(o){var a="";null!=o.getExtraProfileInfo&&(a=o.getExtraProfileInfo()),r.logger.logKernelProfile(e,t,n,o.kernelMs,a)})}),n},e}(),hi=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o){var a=Wa(r+"ms",9),i=Wa(e,25),s=t.rank,u=t.size,l=Wa(t.shape.toString(),14);console.log("%c"+i+"\t%c"+a+"\t%c"+s+"D "+l+"\t%c"+u+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},e}();function vi(e,t,n,r){var o=ai(t),a=function(e,t,n,r){var o=Pa(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?bi(e):e;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,f=0;f<a;f++)i[f]=Math.max(i[f],mi(u[c+f],0,n).length);return i}(e,t,n,o),i=t.length,s=yi(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}function mi(e,t,n){return Wa(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Za(e)?"'"+e+"'":"bool"===n?gi(e):parseFloat(e.toFixed(7)).toString(),t)}function gi(e){return 0===e?"false":"true"}function yi(e,t,n,r,o,a){void 0===a&&(a=!0);var i="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[mi(bi(e)[0],0,n)]:"bool"===n?[gi(e[0])]:[e[0].toString()];if(1===u){if(s>20){var l=3*i,c=Array.from(e.slice(0,l)),f=Array.from(e.slice(s-3*i,s));return"complex64"===n&&(c=bi(c),f=bi(f)),["["+c.map(function(e,t){return mi(e,o[t],n)}).join(", ")+", ..., "+f.map(function(e,t){return mi(e,o[s-3+t],n)}).join(", ")+"]"]}return["["+("complex64"===n?bi(e):Array.from(e)).map(function(e,t){return mi(e,o[t],n)}).join(", ")+"]"]}var d=t.slice(1),p=r.slice(1),h=r[0]*i,v=[];if(s>20){for(var m=0;m<3;m++){var g=(y=m*h)+h;v.push.apply(v,yi(e.slice(y,g),d,n,p,o,!1))}for(v.push("..."),m=s-3;m<s;m++)g=(y=m*h)+h,v.push.apply(v,yi(e.slice(y,g),d,n,p,o,m===s-1))}else for(m=0;m<s;m++){var y;g=(y=m*h)+h,v.push.apply(v,yi(e.slice(y,g),d,n,p,o,m===s-1))}var b=2===u?",":"";for(v[0]="["+v[0]+b,m=1;m<v.length-1;m++)v[m]=" "+v[m]+b;var x=",\n";for(m=2;m<u;m++)x+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(a?"":x),v}function bi(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var xi=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=Pa(e),null!=n){var o=n.length;Aa(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||qa(t,this.size),this.strides=ai(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Aa(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Si.make(this.shape,{values:this.values},this.dtype)},e}(),wi=null,Ei=null,Ci=null;var Si=function(){function e(e,t,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Pa(e),this.strides=ai(e),this.dataId=null!=r?r:{},this.id=wi().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",wi().registerTensor(this,o),null!=n&&wi().write(this.dataId,n)}return e.make=function(t,n,r,o){return new e(t,r,n.values,n.dataId,o)},e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),Aa(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),Ei.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return wa(this,void 0,void 0,function(){var e;return Ea(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Ei.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return Ei.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return wa(this,void 0,void 0,function(){var e;return Ea(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ui(this.shape,e)]}})})},e.prototype.arraySync=function(){return ui(this.shape,this.dataSync())},e.prototype.data=function(){return wa(this,void 0,void 0,function(){return Ea(this,function(e){return this.throwIfDisposed(),[2,wi().read(this.dataId)]})})},e.prototype.dataSync=function(){return this.throwIfDisposed(),wi().readSync(this.dataId)},e.prototype.dispose=function(){this.isDisposed||(wi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),Ei.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),Ei.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),Ei.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),Ei.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),Ei.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),Ei.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),Ei.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),vi(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),Ei.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Ei.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),Ei.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),Ei.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),Ei.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),Ei.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),Ei.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),Ei.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Ei.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),Ei.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),Ei.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),Ei.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),Ci("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.batchNorm=function(e,t,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),Ei.batchNorm(this,e,t,n,r,o)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ei.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Ei.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Ei.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),Ei.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),Ei.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),Ei.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),Ei.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),Ei.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),Ei.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),Ei.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),Ei.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),Ei.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),Ei.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),Ei.div(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),Ei.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),Ei.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),Ei.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Ei.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),Ei.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Ei.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),Ei.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),Ei.modStrict(this,e)},e.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Ei.squaredDifference(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Ei.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),Ei.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),Ei.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Ei.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),Ei.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),Ei.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),Ei.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),Ei.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),Ei.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Ei.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),Ei.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Ei.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Ei.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Ei.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ei.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),Ei.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),Ei.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),Ei.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),Ei.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),Ei.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),Ei.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),Ei.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),Ei.sign(this)},e.prototype.exp=function(){return this.throwIfDisposed(),Ei.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),Ei.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),Ei.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),Ei.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),Ei.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),Ei.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),Ei.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),Ei.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),Ei.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ei.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),Ei.relu(this)},e.prototype.elu=function(){return this.throwIfDisposed(),Ei.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),Ei.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),Ei.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),Ei.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),Ei.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ei.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),Ei.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),Ei.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),Ei.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),Ei.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),Ei.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),Ei.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),Ei.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),Ei.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),Ei.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),Ei.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),Ei.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),Ei.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),Ei.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),Ei.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),Ei.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),Ei.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),Ei.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),Ei.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Ei.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Ei.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Ei.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Ei.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),Ei.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Ei.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),Ei.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Ei.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),Ei.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Ei.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Ei.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),Ei.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),Ei.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),ki.variable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Ei.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Ei.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Ei.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),Ei.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),Ei.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Ei.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),Ei.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),Ei.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),Ei.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),Ei.spectral.irfft(this)},e}();Object.defineProperty(Si,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var ki=function(e){function t(t,n,r){void 0===n&&(n=!0);var o=e.call(this,t.shape,t.dtype,null,t.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=wi().nextVariableId().toString());try{wi().registerVariable(o)}catch(e){throw wi().disposeTensor(o),e}return o}return ba(t,e),t.variable=function(e,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==e.dtype&&(e=e.asType(o)),new t(e,n,r)},t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ma(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");wi().disposeTensor(this),this.dataId=e.dataId,wi().registerTensor(this)},t}(Si);Object.defineProperty(ki,Symbol.hasInstance,{value:function(e){return e instanceof Si&&null!=e.assign&&e.assign instanceof Function}});var Ri,_i,Ii,Ni,Ti;ki.variable;!function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ri||(Ri={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(_i||(_i={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Ii||(Ii={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Ni||(Ni={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ti||(Ti={}));var Ai={float32:Ni,int32:_i,bool:Ii,complex64:Ti};function Di(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Ai[e][t]}function Oi(e){return Di(e,"int32")}function Fi(e,t){if(e.dtype===t.dtype)return[e,t];var n=Di(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Pi(e,t){Aa(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function Mi(e){var t=[];return Li(e,t,new Set),t}function Li(e,t,n){if(null!=e)if(e instanceof Si)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var o in r){var a=r[o];n.has(a)||(n.add(a),Li(a,t,n))}}}Object.freeze({makeTypesMatch:Fi,assertTypesMatch:Pi,isTensorInList:function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1},getTensorsInContainer:Mi});var Bi,zi=function(){function e(e,t,n){this.backend=e,this.safeMode=t,this.debugMode=n,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new pi(e),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.moveData=function(e){this.write(e,this.readSync(e))},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=Si.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(e){return[e.toFloat()]}),t},e.prototype.runKernel=function(e,t,n){var r,o=this,a=[],i=this.isTapeOn(),s=null!=this.activeScope?this.activeScope.name:"",u=function(e){i&&(a=e.map(function(e){return o.keep(o.clone(e))}))},l=this.numBytes,c=this.numTensors;if(this.scopedRun(function(){return o.kernelDepth++},function(){return o.kernelDepth--},function(){r=o.debugMode()?o.profiler.profileKernel(s,function(){return e(o.backend,u)}):e(o.backend,u)}),i){var f={id:this.nextTapeNodeId++,name:s,inputs:t,outputs:Array.isArray(r)?r:[r],saved:a};null!=n&&(f.gradient=function(e){return n(e,a)}),this.activeTape.push(f)}return this.profiling&&this.activeProfile.kernels.push({name:s,bytesAdded:this.numBytes-l,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-c,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShape:Array.isArray(r)?r.map(function(e){return e.shape}):r.shape}),r},e.prototype.registerTensor=function(e,t){var n=this.tensorInfo.has(e.dataId)?this.tensorInfo.get(e.dataId).refCount:0;if(this.numTensors++,"string"===e.dtype&&this.numStringTensors++,0===n){this.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Qa(e.dtype)),this.tensorInfo.set(e.dataId,{backend:null!=t?t:this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.numBytes+=r,null!=t?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.tensorInfo.get(e.dataId).refCount++,e instanceof ki||this.track(e)},e.prototype.registerVariable=function(e){if(null!=this.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},e.prototype.disposeTensor=function(e){if(this.tensorInfo.has(e.dataId)){this.numTensors--,"string"===e.dtype&&this.numStringTensors--;var t=this.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.numBytes-=t.bytes),this.numDataBuffers--,t.backend.disposeData(e.dataId),this.tensorInfo.delete(e.dataId)):this.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.registeredVariables){var t=this.registeredVariables[e];this.disposeTensor(t),delete this.registeredVariables[e]}},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,this.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return wa(this,void 0,void 0,function(){var t,n;return Ea(this,function(r){return this.profiling=!0,t=this.numBytes,n=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=e(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-t,this.activeProfile.newTensors=this.numTensors-n,[2,this.activeProfile]})})},e.prototype.isTapeOn=function(){return this.gradientDepth>0&&0===this.kernelDepth},e.prototype.addTapeNode=function(e,t,n){var r={};e.forEach(function(e,t){r[t]=e});var o={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,outputs:[t],gradient:function(e){var t={};return n(e).forEach(function(e,n){t[n]=function(){return e}}),t}};this.activeTape.push(o)},e.prototype.keep=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return e.kept=!0,e},e.prototype.startTape=function(){0===this.gradientDepth&&(this.activeTape=[]),this.gradientDepth++},e.prototype.endTape=function(){this.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.nextScopeId++};e&&(t.name=e),this.scopeStack.push(t),this.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Mi(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.activeScope.track.length;o++){var a=this.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?null:this.scopeStack[this.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==i.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),Aa(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});Aa(a instanceof Si,function(){return"The result y returned by f() must be a tensor."});var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(h=e[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){h.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,o[h.id]=!0;break}if(l)break}}var f={};f[n.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(i=(h=e[a]).inputs,c=0;c<h.outputs.length;c++)if(f[h.outputs[c].id]){for(var s in i)f[i[s].id]=!0,d[h.id]=!0;break}var p=[];for(a=0;a<e.length;a++){var h;if(o[(h=e[a]).id]&&d[h.id]){var v={};for(var s in h.inputs){var m=h.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},h);g.inputs=v,g.outputs=h.outputs,p.push(g)}}return p}(this.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e={};e[a.id]=null==n?function(e){var t=li(Pa(e),"float32");return Si.make(e,{values:t})}(a.shape):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach(function(t){var n=e[t.id];if(null!=n)a.push(n);else{var r=Si.make(t.shape,{values:ci(t.size,t.dtype)},t.dtype);a.push(r)}}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var i=o.gradient(1===o.outputs.length?a[0]:a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n(function(){return i[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.name+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!Ma(r.shape,a.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(e,i,function(e){return o.tidy(e)});var r=t.map(function(t){return e[t.id]});return 0===o.gradientDepth&&(o.activeTape.forEach(function(e){for(var t in e.saved)e.saved[t].dispose()}),o.activeTape=null),{value:a,grads:r}})},e.prototype.customGrad=function(e){var t=this;return Aa(ri(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Aa(r.every(function(e){return e instanceof Si}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return r.forEach(function(e,t){a[t]=e}),t.runKernel(function(t,o){return Aa((n=e.apply(void 0,r.concat([o]))).value instanceof Si,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Aa(ri(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];Aa(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Aa(a.every(function(e){return e instanceof Si}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(e,t){i[t]=function(){return e}}),i})}},e.prototype.write=function(e,t){var n=this.tensorInfo.get(e);if("string"===n.dtype){var r=Ja(t);this.numBytes+=r-n.bytes,n.bytes=r}this.backend!==n.backend&&(n.backend.disposeData(e),n.backend=this.backend,this.backend.register(e,n.shape,n.dtype)),this.backend.write(e,t)},e.prototype.readSync=function(e){return this.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.tensorInfo.get(e).backend.read(e)},e.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},e.prototype.time=function(e){return wa(this,void 0,void 0,function(){var t,n;return Ea(this,function(r){switch(r.label){case 0:return t=fi(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=fi()-t,[2,n]}})})},e.prototype.track=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return null!=this.activeScope&&(e.scopeId=this.activeScope.id,this.activeScope.track.push(e)),e},e.nextTensorId=0,e.nextVariableId=0,e}();!function(e){e[e.NUMBER=0]="NUMBER",e[e.BOOLEAN=1]="BOOLEAN",e[e.STRING=2]="STRING"}(Bi||(Bi={}));var Wi,Ui,ji=[{name:"DEBUG",type:Bi.BOOLEAN},{name:"IS_BROWSER",type:Bi.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:Bi.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:Bi.BOOLEAN},{name:"WEBGL_PACK",type:Bi.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:Bi.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:Bi.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:Bi.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:Bi.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:Bi.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:Bi.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:Bi.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:Bi.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:Bi.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:Bi.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:Bi.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Bi.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Bi.BOOLEAN},{name:"WEBGL_VERSION",type:Bi.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:Bi.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:Bi.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:Bi.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:Bi.NUMBER},{name:"BACKEND",type:Bi.STRING},{name:"EPSILON",type:Bi.NUMBER},{name:"PROD",type:Bi.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:Bi.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:Bi.BOOLEAN}];function Vi(e){try{if(null!=ka(e))return!0}catch(e){return!1}return!1}var Hi="tfjsflags";function Gi(){var e={};if("undefined"==typeof window||void 0===window.location||void 0===window.location.search)return e;var t=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")}),t}(window.location.search);if(Hi in t){var n={};t[Hi].split(",").forEach(function(e){var t=e.split(":"),r=t[0],o=t[1];n[r]=o}),ji.forEach(function(t){t.name in n&&(console.log("Setting feature override from URL "+t.name+": "+n[t.name]),t.type===Bi.NUMBER?e[t.name]=+n[t.name]:t.type===Bi.BOOLEAN?e[t.name]="true"===n[t.name]:t.type===Bi.STRING?e[t.name]=n[t.name]:console.warn("Unknown URL param: "+t.name+"."))})}return e}function qi(e,t){return null!=e.getExtension(t)}function Ki(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var o=2===t?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,o,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(n),a}var $i,Xi=1e-4,Yi=function(){function e(e){this.features={},this.registry={},this.registryFactory={},null!=e&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(e,t){if(void 0===t&&(t=!1),!(e in Zi.registry))throw new Error("Backend name '"+e+"' not found in registry");Zi.engine.backend=Zi.findBackend(e),Zi.backendName=e},e.getBackend=function(){return Zi.initEngine(),Zi.backendName},e.disposeVariables=function(){Zi.engine.disposeVariables()},e.memory=function(){return Zi.engine.memory()},e.profile=function(e){return Zi.engine.profile(e)},e.tidy=function(e,t){return Zi.engine.tidy(e,t)},e.dispose=function(e){Mi(e).forEach(function(e){return e.dispose()})},e.keep=function(e){return Zi.engine.keep(e)},e.time=function(e){return Zi.engine.time(e)},e.prototype.get=function(e){return e in this.features||(this.features[e]=this.evaluateFeature(e)),this.features[e]},e.prototype.getFeatures=function(){return this.features},e.prototype.set=function(e,t){this.features[e]=t},e.prototype.getBestBackendName=function(){var e=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(t){return{name:t,entry:e.registry[t]}}).sort(function(e,t){return t.entry.priority-e.entry.priority})[0].name},e.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("IS_BROWSER"===e)return"undefined"!=typeof window;if("IS_NODE"===e)return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node;if("IS_CHROME"===e)return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if("WEBGL_CPU_FORWARD"===e)return!0;if("WEBGL_PACK"===e)return 0!==this.get("WEBGL_VERSION");if("WEBGL_PACK_BATCHNORMALIZATION"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_CLIP"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_DEPTHWISECONV"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_BINARY_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_ARRAY_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_IMAGE_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_REDUCE"===e)return this.get("WEBGL_PACK");if("WEBGL_LAZILY_UNPACK"===e)return this.get("WEBGL_PACK");if("WEBGL_CONV_IM2COL"===e)return this.get("WEBGL_PACK");if("WEBGL_NUM_MB_BEFORE_PAGING"===e)return this.get("PROD")||!this.get("IS_BROWSER")?Number.POSITIVE_INFINITY:window.screen.height*window.screen.width*window.devicePixelRatio*600/1024;if("WEBGL_MAX_TEXTURE_SIZE"===e)return function(e){if(null==Wi){var t=ka(e);Wi=t.getParameter(t.MAX_TEXTURE_SIZE)}return Wi}(this.get("WEBGL_VERSION"));if("WEBGL_MAX_TEXTURES_IN_SHADER"===e)return function(e){if(null==Ui){var t=ka(e);Ui=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ui)}(this.get("WEBGL_VERSION"));if("IS_TEST"===e)return!1;if("BACKEND"===e)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var t=this.get("WEBGL_VERSION");return 0===t?0:function(e){if(0===e)return 0;var t=ka(e);return qi(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:qi(t,"EXT_disjoint_timer_query")?1:0}(t)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}();if("HAS_WEBGL"===e)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===e)return Vi(2)?2:Vi(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===e)return function(e){if(0===e)return!1;var t=ka(e);if(1===e){if(!qi(t,"OES_texture_float"))return!1}else if(!qi(t,"EXT_color_buffer_float"))return!1;return Ki(t,e)}(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===e)return function(e){if(0===e)return!1;var t=ka(e);if(1===e){if(!qi(t,"OES_texture_float"))return!1;if(!qi(t,"WEBGL_color_buffer_float"))return!1}else if(!qi(t,"EXT_color_buffer_float"))return!1;return Ki(t,e)}(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===e)return function(e){return 2===e&&null!=ka(e).fenceSync}(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===e)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if("TEST_EPSILON"===e)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===e)return 32===this.backend.floatPrecision()?1e-7:Xi;if("PROD"===e)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===e)return!this.get("PROD");if("DEPRECATION_WARNINGS_ENABLED"===e)return!0;throw new Error("Unknown feature "+e+".")},e.prototype.setFeatures=function(e){this.features=Object.assign({},e)},e.prototype.reset=function(){this.features=Gi(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(e.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),e.prototype.findBackend=function(e){return e in this.registry?this.registry[e].backend:null},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e]:null},e.prototype.registerBackend=function(e,t,n){var r=this;if(void 0===n&&(n=1),e in this.registry)return console.warn(e+" backend was already registered. Reusing existing backend"),!1;try{var o=t();return o.setDataMover({moveData:function(e){return r.engine.moveData(e)}}),this.registry[e]={backend:o,priority:n},this.registryFactory[e]=t,!0}catch(t){return console.warn("Registration of backend "+e+" failed"),console.warn(t.stack||t.message),!1}},e.prototype.removeBackend=function(e){if(!(e in this.registry))throw new Error(e+" backend not found in registry");this.registry[e].backend.dispose(),delete this.registry[e]},Object.defineProperty(e.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initEngine=function(){var e=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var t=this.findBackend(this.backendName);this.globalEngine=new zi(t,!1,function(){return e.get("DEBUG")})}},Object.defineProperty(e.prototype,"global",{get:function(){return Qi()},enumerable:!0,configurable:!0}),e}();function Qi(){if(null==$i){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else{if("undefined"==typeof process)throw new Error("Could not find a global object");e=process}$i=e}return $i}function Ji(e){Zi.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}!function(e){Ci=e}(Ji);var Zi=function(){var e=Qi();return null==e.ENV&&(e.ENV=new Yi(Gi())),function(e){wi=e}(function(){return e.ENV.engine}),e.ENV}();Object.freeze({EPSILON_FLOAT16:Xi,EPSILON_FLOAT32:1e-7,Environment:Yi,enableProdMode:function(){Zi.set("PROD",!0)},enableDebugMode:function(){Zi.set("DEBUG",!0)},disableDeprecationWarnings:function(){Zi.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:Ji,ENV:Zi});function es(e){var t=e;if(Ya(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];Array.isArray(t)||Ya(t);)n.push(t.length),t=t[0];return Array.isArray(e)&&Zi.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&ts(e,n,[]),n}function ts(e,t,n){if(n=n||[],Array.isArray(e)||Ya(e)){Aa(t.length>0,function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),Aa(e.length===t[0],function(){return"Element arr["+n.join("][")+"] should have "+t[0]+" elements, but has "+e.length+" elements"});for(var r=t.slice(1),o=0;o<e.length;++o)ts(e[o],r,n.concat(o))}else Aa(0===t.length,function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"})}function ns(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function rs(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Si)return ns(r,e.dtype,t,n),e;var o=ni(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),ns(r,o,t,n),null==e||!Ya(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=es(e);Ya(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?ii(e,o,Zi.get("DEBUG")):Fa(e);return Si.make(i,{values:s},o)}function os(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return rs(e,t+"["+r+"]",n)},r)}function as(e){return Zi.engine.customGrad(e)}var is=Yi.tidy,ss=Yi.keep,us=Yi.dispose;Yi.time,Yi.profile;function ls(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Zi.get("IS_TEST")||console.warn.apply(console,e)}function cs(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function fs(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function ds(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function ps(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function hs(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function vs(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function ms(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function gs(e,t){return function(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}(e,t.map(function(e){return 1}),t)}function ys(e,t,n){Aa(vs(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function bs(e,t){if(vs(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function xs(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function ws(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Es(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Cs(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=ai(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,l]}function Ss(e){return e<=30?e:oi(e,Math.floor(Math.sqrt(e)))}function ks(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}(n,t,e)}function Rs(e,t,n){for(var r=t.rank>1?t.shape[t.rank-1]:1,o=n.length,a=1,i=r;i<o;++i)a*=n[i];var s=r<1?1:r;return{sliceRank:r,numUpdates:t.size/s,sliceSize:a,strides:ai(n.slice(0,r)).concat([1]),outputSize:Pa(n)}}function _s(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==i)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],f=[],d=0;d<e.length;d++)l[d]=Is(o,t,r,e,d),c[d]=Ns(a,n,r,e,d),u&1<<d&&(c[d]=l[d]+1,f.push(d));var p=new Array(e.length).fill(0);return p=p.map(function(e,t){for(var n=0,o=r[t]||1,a=l[t];!(o>0?a>=c[t]:a<=c[t]);a+=o)n+=1;return n}),[l,p,f]}function Is(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),_a(0,a,s-1)}function Ns(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?_a(0,a,s):_a(-1,a,s-1)}function Ts(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function As(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Ds(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Zi.engine.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Zi.engine.endScope(o),o}catch(e){throw Zi.engine.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}var Os=Ds({softmax_:function(e,t){void 0===t&&(t=-1);var n=rs(e,"logits","softmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return as(function(e,n){var r=e.logSumExp([t],!0),o=e.toFloat().sub(r).exp();return n([o]),{value:o,gradFunc:function(e,n){var r=n[0],o=e.mul(r);return o.sub(o.sum([t],!0).mul(r))}}})(n)}}),Fs=Ds({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=rs(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return as(function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}});var Ps=Ds({complex_:function(e,t){var n=rs(e,"real","complex"),r=rs(t,"imag","complex");return Da(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Zi.engine.runKernel(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),Ms=Ds({real_:function(e){var t=rs(e,"input","real");return Zi.engine.runKernel(function(e){return e.real(t)},{$input:t})}}),Ls=Ds({imag_:function(e){var t=rs(e,"input","imag");return Zi.engine.runKernel(function(e){return e.imag(t)},{$input:t})}});function Bs(e,t,n){if(null==n&&(n=ni(e)),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ya(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=es(e);if(null!=t){di(t);var o=Pa(t),a=Pa(r);Aa(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<r.length;++i){var s=r[i],u=i!==r.length-1||s!==Pa(t.slice(i));Aa(r[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "})}}return Ya(e)||Array.isArray(e)||(e=[e]),t=t||r,e="string"!==n?ii(e,n,Zi.get("DEBUG")):Fa(e),Si.make(t,{values:e},n)}function zs(e,t){if((Ya(e)||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return Bs(e,[],t)}function Ws(e,t){Oa(e);var n=es(e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Bs(e,n,t)}function Us(e,t,n){if(Oa(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=es(e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Bs(e,t=t||r,n)}function js(e,t,n){if(Oa(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=es(e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Bs(e,t=t||r,n)}function Vs(e,t,n){if(Oa(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=es(e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Bs(e,t=t||r,n)}function Hs(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Hs(e,"float32"),r=Hs(e,"float32");return Ps(n,r)}var o=li(Pa(e),t);return Si.make(e,{values:o},t)}function Gs(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Gs(e,"float32"),r=Gs(e,"float32");return Ps(n,r)}var o=ci(Pa(e),t);return Si.make(e,{values:o},t)}function qs(e,t,n){return Zi.engine.runKernel(function(r){return r.fill(e,t,n)},{})}function Ks(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Gs([0],r);var o=ci(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return Ws(o,r)}var $s=Ds({onesLike_:function(e){var t=rs(e,"x","onesLike");if("complex64"===t.dtype){var n=$s(Ms(t)),r=Xs(Ls(t));return Ps(n,r)}return Zi.engine.runKernel(function(e){return e.onesLike(t)},{$x:t},null)}}),Xs=Ds({zerosLike_:function(e){var t=rs(e,"x","zerosLike");return Zi.engine.runKernel(function(e){return e.zerosLike(t)},{$x:t},null)}}),Ys=function(){function e(e){this.dataMover=e,this.data=new WeakMap}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(e),this.data.get(e)},e.prototype.set=function(e,t){this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.data.delete(e)},e}();!function(){function e(){}e.prototype.time=function(e){throw new Error("Not yet implemented.")},e.prototype.read=function(e){throw new Error("Not yet implemented.")},e.prototype.readSync=function(e){throw new Error("Not yet implemented.")},e.prototype.disposeData=function(e){throw new Error("Not yet implemented.")},e.prototype.write=function(e,t){throw new Error("Not yet implemented.")},e.prototype.fromPixels=function(e,t){throw new Error("Not yet implemented.")},e.prototype.register=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.memory=function(){throw new Error("Not yet implemented.")},e.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},e.prototype.batchMatMul=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.slice=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){throw new Error("Not yet implemented")},e.prototype.unstack=function(e,t){throw new Error("Not yet implemented")},e.prototype.reverse=function(e,t){throw new Error("Not yet implemented")},e.prototype.concat=function(e,t){throw new Error("Not yet implemented")},e.prototype.neg=function(e){throw new Error("Not yet implemented")},e.prototype.add=function(e,t){throw new Error("Not yet implemented")},e.prototype.addN=function(e){throw new Error("Not yet implemented")},e.prototype.subtract=function(e,t){throw new Error("Not yet implemented")},e.prototype.multiply=function(e,t){throw new Error("Not yet implemented")},e.prototype.realDivide=function(e,t){throw new Error("Not yet implemented")},e.prototype.floorDiv=function(e,t){throw new Error("Not yet implemented")},e.prototype.sum=function(e,t){throw new Error("Not yet implemented")},e.prototype.prod=function(e,t){throw new Error("Not yet implemented")},e.prototype.unsortedSegmentSum=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.argMin=function(e,t){throw new Error("Not yet implemented")},e.prototype.argMax=function(e,t){throw new Error("Not yet implemented")},e.prototype.equal=function(e,t){throw new Error("Not yet implemented")},e.prototype.notEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.less=function(e,t){throw new Error("Not yet implemented")},e.prototype.lessEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.greater=function(e,t){throw new Error("Not yet implemented")},e.prototype.greaterEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalNot=function(e){throw new Error("Not yet implemented")},e.prototype.logicalAnd=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalOr=function(e,t){throw new Error("Not yet implemented")},e.prototype.where=function(e){throw new Error("Not yet implemented")},e.prototype.select=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.topk=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.min=function(e,t){throw new Error("Not yet implemented")},e.prototype.minimum=function(e,t){throw new Error("Not yet implemented")},e.prototype.mod=function(e,t){throw new Error("Not yet implemented")},e.prototype.max=function(e,t){throw new Error("Not yet implemented")},e.prototype.maximum=function(e,t){throw new Error("Not yet implemented")},e.prototype.all=function(e,t){throw new Error("Not yet implemented")},e.prototype.any=function(e,t){throw new Error("Not yet implemented")},e.prototype.squaredDifference=function(e,t){throw new Error("Not yet implemented")},e.prototype.ceil=function(e){throw new Error("Not yet implemented")},e.prototype.floor=function(e){throw new Error("Not yet implemented")},e.prototype.round=function(e){throw new Error("Not yet implemented")},e.prototype.sign=function(e){throw new Error("Not yet implemented")},e.prototype.isNaN=function(e){throw new Error("Not yet implemented")},e.prototype.isInf=function(e){throw new Error("Not yet implemented")},e.prototype.isFinite=function(e){throw new Error("Not yet implemented")},e.prototype.pow=function(e,t){throw new Error("Not yet implemented")},e.prototype.exp=function(e){throw new Error("Not yet implemented")},e.prototype.expm1=function(e){throw new Error("Not yet implemented")},e.prototype.log=function(e){throw new Error("Not yet implemented")},e.prototype.log1p=function(e){throw new Error("Not yet implemented")},e.prototype.sqrt=function(e){throw new Error("Not yet implemented")},e.prototype.rsqrt=function(e){throw new Error("Not yet implemented")},e.prototype.square=function(e){throw new Error("Not yet implemented")},e.prototype.reciprocal=function(e){throw new Error("Not yet implemented")},e.prototype.relu=function(e){throw new Error("Not yet implemented")},e.prototype.prelu=function(e,t){throw new Error("Not yet implemented")},e.prototype.elu=function(e){throw new Error("Not yet implemented")},e.prototype.eluDer=function(e,t){throw new Error("Not yet implemented")},e.prototype.selu=function(e){throw new Error("Not yet implemented")},e.prototype.int=function(e){throw new Error("Not yet implemented")},e.prototype.clip=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.abs=function(e){throw new Error("Not yet implemented")},e.prototype.complexAbs=function(e){throw new Error("Not yet implemented")},e.prototype.sigmoid=function(e){throw new Error("Not yet implemented")},e.prototype.softplus=function(e){throw new Error("Not yet implemented")},e.prototype.sin=function(e){throw new Error("Not yet implemented")},e.prototype.cos=function(e){throw new Error("Not yet implemented")},e.prototype.tan=function(e){throw new Error("Not yet implemented")},e.prototype.asin=function(e){throw new Error("Not yet implemented")},e.prototype.acos=function(e){throw new Error("Not yet implemented")},e.prototype.atan=function(e){throw new Error("Not yet implemented")},e.prototype.atan2=function(e,t){throw new Error("Not yet implemented")},e.prototype.sinh=function(e){throw new Error("Not yet implemented")},e.prototype.cosh=function(e){throw new Error("Not yet implemented")},e.prototype.tanh=function(e){throw new Error("Not yet implemented")},e.prototype.asinh=function(e){throw new Error("Not yet implemented")},e.prototype.acosh=function(e){throw new Error("Not yet implemented")},e.prototype.atanh=function(e){throw new Error("Not yet implemented")},e.prototype.erf=function(e){throw new Error("Not yet implemented")},e.prototype.step=function(e,t){throw new Error("Not yet implemented")},e.prototype.conv2d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2D=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.maxPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.maxPoolBackprop=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.avgPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.avgPoolBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.reshape=function(e,t){throw new Error("Not yet implemented")},e.prototype.cast=function(e,t){throw new Error("Not yet implemented")},e.prototype.tile=function(e,t){throw new Error("Not yet implemented")},e.prototype.pad=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.transpose=function(e,t){throw new Error("Not yet implemented")},e.prototype.gather=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.gatherND=function(e,t){throw new Error("Not yet implemented")},e.prototype.scatterND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchToSpaceND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.spaceToBatchND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeBilinear=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeBilinearBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchNormalization=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){throw new Error("Not yet implemented")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){throw new Error("Not yet implemented")},e.prototype.multinomial=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.oneHot=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.cumsum=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){throw new Error("Not yet implemented")},e.prototype.fft=function(e){throw new Error("Not yet implemented")},e.prototype.ifft=function(e){throw new Error("Not yet implemented")},e.prototype.complex=function(e,t){throw new Error("Not yet implemented")},e.prototype.real=function(e){throw new Error("Not yet implemented")},e.prototype.imag=function(e){throw new Error("Not yet implemented")},e.prototype.cropAndResize=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.depthToSpace=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.split=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.sparseToDense=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fill=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.onesLike=function(e){throw new Error("Not yet implemented")},e.prototype.zerosLike=function(e){throw new Error("Not yet implemented")},e.prototype.setDataMover=function(e){throw new Error("Not yet implemented")},e.prototype.dispose=function(){throw new Error("Not yet implemented")}}();function Qs(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Gs(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!Xa(e.dtype,t))return Si.make(e.shape,{dataId:e.dataId},t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=zs(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: unknown dtype argument ("+t+")")}function Js(e,t){return Si.make(t,{dataId:e.dataId},e.dtype)}function Zs(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function eu(e,t){return{real:e[2*t],imag:e[2*t+1]}}function tu(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function nu(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function ru(e,t,n,r,o){for(var a=Array.from(t).map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),i=[],s=0;s<a.length;s++){var u=a[s],l=u.score,c=u.boxIndex;if(l<o)break;for(var f=!1,d=i.length-1;d>=0;--d)if(ou(e,c,i[d])>=r){f=!0;break}if(!f&&(i.push(c),i.length>=n))break}return Ws(i,"int32")}function ou(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),p=(s-a)*(u-i),h=(f-l)*(d-c);if(p<=0||h<=0)return 0;var v=Math.max(a,l),m=Math.max(i,c),g=Math.min(s,f),y=Math.min(u,d),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(p+h-b)}function au(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a})}function iu(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=Ga(n,s*r),c=Ga("int32",s*r),f=0;f<s;f++){for(var d=f*u,p=e.subarray(d,d+u),h=[],v=0;v<p.length;v++)h.push({value:p[v],index:v});h.sort(function(e,t){return t.value-e.value});var m=f*r,g=l.subarray(m,m+r),y=c.subarray(m,m+r);for(v=0;v<r;v++)g[v]=h[v].value,y[v]=h[v].index}var b=t.slice();return b[b.length-1]=r,[Bs(l,b,n),Bs(c,b,"int32")]}var su=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function uu(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function lu(e,t){return 1===t?[e]:uu(e,t)}function cu(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function fu(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function du(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function pu(){var e,t,n,r,o,a,i,s,u,l;return 2===Zi.get("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      const float NAN = uintBitsToFloat(uint(0x7fc00000));\n    ",u="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      uniform float NAN;\n\n      bool isnan(float val) {\n        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n      }\n      bvec4 isnan(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function hu(e,t,n){void 0===n&&(n="index");var r=ai(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function vu(e){return 1===e.length?""+e[0]:"vec"+e.length+"("+e.join(",")+")"}function mu(e,t,n,r){var o=[];e.forEach(function(e){var t=Pa(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var a,i,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?yu(e):gu(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=cu(e.shapeInfo.logicalShape,t.logicalShape),l=ku(s),c=s-i,f=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+f[e+c]+" = 0;"}).join("\n");var d="";d=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+c]}).join(", ");var p="return outputValue;";if(1===i&&s>1)p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";else if(0===i&&s>0)p=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var h=i-2,v=i-1;u.indexOf(h)>-1&&u.indexOf(v)>-1?p="return vec4(outputValue.x);":u.indexOf(h)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(v)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+p+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Ma(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l=ku(u),c=cu(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,d=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&c.length>=1?"coords = 0;":c.map(function(e){return"coords."+d[e+f]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+d[t+f]}).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,c=pu(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+bu+"\n    "+xu+"\n    "+wu+"\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ma(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}}(t.logicalShape,l),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return Ma(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return function(e,t){var n=hu(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec3(r, c, d);\n    }\n  "}(e,t);case 4:return function(e,t){var n=hu(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=hu(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=hu(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}}(t.logicalShape,l),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(d+=Eu),[d,f,i,s,a,u,n].join("\n")}function gu(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+Cu(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Su(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=Cu(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&Ma(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=Ha(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n      "+gu(Ru(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+_u(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+Su(e)+"\n      }\n    ";var c=o[0],f=o[1],d=Cu(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+c+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=Ha(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n        "+gu(Ru(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+_u(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+Su(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,f=c[0],d=c[1],p=e.shapeInfo.flatOffset;return d===o&&null==p?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===a&&null==p?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+Cu(n)+";\n        vec2 uv = uvFromFlat("+f+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=Ha(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return"\n      "+gu(Ru(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+_u(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+Su(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],p=f[1];return p===i&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+p+", index + "+Cu(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=Ha(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return"\n      "+gu(Ru(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+_u(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+Su(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],h=d[1];return h===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+Cu(n)+";\n      vec2 uv = uvFromFlat("+p+", "+h+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Ha(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+gu(Ru(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+_u(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,f=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+c+", "+l+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+Su(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,h=p[0],v=p[1];return v===f&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+l+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":v===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+Cu(n)+";\n      vec2 uv = uvFromFlat("+h+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function yu(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name;return"\n    vec4 get"+t.charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+pu().texture2D+"("+t+", halfCR);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=pu();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=pu();if(null!=o&&Ma(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+yu(Ru(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+_u(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+pu().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),f="int b, int row, int col",d="b * "+c+" + (row / 2) * "+l+" + (col / 2)",p=2;p<n-1;p++)f="int b"+p+", "+f,d="b"+p+" * "+(c*=t[n-p-1])+" + "+d;return"\n    vec4 "+o+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+pu().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var bu="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",xu="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",wu="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Eu="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Cu(e){return"offset"+e}function Su(e){var t=e.name,n=Pa(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function ku(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Ru(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function _u(e,t){return t.map(function(t){return e[t]}).join(", ")}var Iu=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,Aa(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=ku(l),f=lu("coords",l);if(1===a){var d=ku(s=l+1);i="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[l-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[l-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[l-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+f[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+f[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+f[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+f[l-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),h="."+p[s-1],v=p.map(function(e){return"int "+e}),m=lu("sourceLocR",s-1).concat("inIdx.r"),g=lu("sourceLocG",s-1).concat("inIdx.g"),y=lu("sourceLocB",s-1).concat("inIdx.b"),b=lu("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+f[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+f[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+h+", sourceLocG"+h+",\n          sourceLocB"+h+", sourceLocA"+h+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Nu=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Tu=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],du(e,t),du(e,n);var i="0.0";null!=r&&(du(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(du(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Au=function(e,t,n,r,o,a){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],du(e,t),du(e,n);var i="vec4(0.0)";null!=r&&(du(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(du(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Du="return areal * breal - aimag * bimag;",Ou="return areal * bimag + aimag * breal;",Fu=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=du(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Pu="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",Mu="return a + b;",Lu="return a - b;",Bu="return a * b;",zu="return (a - b) * (a - b);",Wu=Pu+"\n  return max(a, b);\n",Uu=Pu+"\n  return min(a, b);\n",ju=Pu+"\n  return atan(a, b);\n",Vu=function(e,t,n){this.variableNames=["A","B"],this.outputShape=du(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Hu="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n",Gu="\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+Hu+"\n  return result;\n",qu="\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Hu+"\n  return result;\n",Ku="\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Hu+"\n  return result;\n",$u="\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Hu+"\n  return result;\n",Xu="\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+Hu+"\n  return result;\n",Yu=function(e,t,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=du(t,n),this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Qu=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Ju=function(){function e(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Zu=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},el=function(e){this.outputShape=[],this.outputShape=Es(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},tl=function(e,t){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Es(e,t);var n=this.outputShape,r=n.length,o=ku(r),a=lu("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c="vec2("+i.slice(-2).join()+")",f=i.join(),d="if ("+l+" < "+s[0]+")\n          return getChannel(getT0("+f+"), "+c+");";for(u=1;u<s.length;u++){var p=s[u-1];d+="\n        else if ("+l+" < "+s[u]+") {\n          "+l+" -= "+p+";\n          return getChannel(getT"+u+"("+f+"), "+c+");\n        }"}var h=s.length;d+="\n        else {\n          "+l+" -= "+s[s.length-1]+";\n          return getChannel(getT"+h+"("+f+"), "+c+");\n        }",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n        if (++"+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n        if (++"+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            --"+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "},nl=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},rl=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ol=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},al=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},il=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sl=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ul=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.filterHeight,u=e.filterWidth,l=4*Math.floor(e.inChannels/4),c=e.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+t+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+a+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+i+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ll=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,f=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),h=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===h)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+p+") *\n                  getW(wF, wR, wC, "+p+", d2);\n              } else if ("+(2===h)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===h)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1),\n                  getX(batch, xF, xR, xC, "+p+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2),\n                  getW(wF, wR, wC, "+p+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},cl=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fl=function(e){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=e.outShape;for(var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=c,d="int xR; int xC; int xCOffset;",p=0;p<l;p++)for(var h=0;h<c;h++)d+="\n          vec4 xTexelR"+p+"C"+2*h+" = vec4(0.);\n          vec4 wR"+p+"C"+h+" = vec4(0.);\n          vec4 xR"+p+"C"+h+" = vec4(0.);";for(p=0;p<l;p++)for(var v=0;v<f;v++){if(d+="\n          xR = xRCorner + "+p*s+";\n          xC = xCCorner + "+(h=2*v)*u+";\n        ",1===i){if(h<c&&(d+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+p+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+p+"C"+h+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+p+"C"+h+" = vec4(previous.zw, xTexelR"+p+"C"+h+".xy);\n                } else {\n                  xR"+p+"C"+h+" = vec4(0, 0, xTexelR"+p+"C"+h+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+t+" && xC >= 0 && xC < "+n+") {\n                  xTexelR"+p+"C"+h+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+p+"C"+h+" = vec4(0.);\n                }\n\n                xR"+p+"C"+h+" = xTexelR"+p+"C"+h+";\n              ",h+1<c)){var m=o%2==0?Ia(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(d+="\n                  xCOffset = xC + "+o%2+" + "+m+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+p+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",u>1&&(d+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+t+" &&\n                      xCOffset >= 0 && xCOffset < "+n+") {\n                      xTexelR"+p+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+p+"C"+h+" = vec4(0.);\n                    }\n                  "),d+="\n                  xR"+p+"C"+(h+1)+" = vec4(\n                    xTexelR"+p+"C"+h+".zw, xTexelR"+p+"C"+(h+2)+".xy);\n                "):d+="\n                  xCOffset = xC + "+m+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+p+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+p+"C"+(h+1)+" = xTexelR"+p+"C"+(h+2)+";\n                "}}else h<c&&(d+="\n              if(xR >= 0 && xR < "+t+") {\n            ",o%2==1?(d+="\n                xCOffset = xC + 1 - "+i+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+p+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+p+"C"+h+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+n+") {\n                  xTexelR"+p+"C"+(h+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+p+"C"+(h+2)+" = vec4(0.);\n                }\n\n                xR"+p+"C"+h+" = vec4(\n                  xTexelR"+p+"C"+h+".zw, xTexelR"+p+"C"+(h+2)+".zw);\n              ",h+1<c&&(d+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+i+";\n                  if(xCOffset >= 0 && xCOffset < "+n+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+p+"C"+(h+1)+" = vec4(xTexelR"+p+"C"+(h+2)+".xy, final.xy);\n                ")):(d+="\n                if(xC >= 0 && xC < "+n+") {\n                  xTexelR"+p+"C"+h+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+p+"C"+h+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+i+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+p+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+p+"C"+(h+2)+" = vec4(0.);\n                }\n\n                xR"+p+"C"+h+" = vec4(\n                  xTexelR"+p+"C"+h+".xy, xTexelR"+p+"C"+(h+2)+".xy);\n              ",h+1<c&&(d+="\n                  xR"+p+"C"+(h+1)+" = vec4(\n                    xTexelR"+p+"C"+h+".zw, xTexelR"+p+"C"+(h+2)+".zw);\n                ")),d+="}");h<c&&(d+="\n            vec4 wTexelR"+p+"C"+h+" = getW("+p+", "+h+", d1, q);\n            wR"+p+"C"+h+" = vec4(wTexelR"+p+"C"+h+".xz, wTexelR"+p+"C"+h+".xz);\n          ",h+1<c&&(d+="\n              vec4 wTexelR"+p+"C"+(h+1)+" = getW("+p+", "+(h+1)+", d1, q);\n              wR"+p+"C"+(h+1)+" =\n                vec4(wTexelR"+p+"C"+(h+1)+".xz, wTexelR"+p+"C"+(h+1)+".xz);"))}for(p=0;p<l;p++)for(h=0;h<c;h++)d+="result += xR"+p+"C"+h+" * wR"+p+"C"+h+";";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},dl=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],f=n[1];this.outputShape=[l,c,f,u];var d="bilinear"===r?1:0,p=[i-1+".0",s-1+".0"],h=p[0],v=p[1],m=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],g=m[0],y=m[1],b=m[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=x[0],E=x[1],C=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+h+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+C+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},pl=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ku(r)+" coords = getOutputCoords();\n        int end = "+hl(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+hl(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function hl(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var vl=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),ml=function(e){this.variableNames=["A"];var t=pu();this.outputShape=e,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isnan(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},gl="return real * expR - imag * expI;",yl="return real * expI + imag * expR;",bl=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},xl=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),wl=function(e){this.variableNames=["A"];var t=pu(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},El=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=ku(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "};var Cl,Sl,kl=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=ku(t.length),o=ku(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Rl(e,t){return[t,e]}function _l(e,t){return e*t}function Il(e,t,n){var r=function(e,t){if(e%t!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+t);return e/t}(e.length,n);if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var o=0,a=0;a<e.length;a+=n)t[o++]=e[a]}function Nl(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Tl(e,t){var n=Nl(e,t);return n[0]*n[1]*4}function Al(e,t,n,r,o){var a=n*r;if(o.length<a)throw new Error("matrix length ("+o.length+") must be >= "+a);for(var i=r%2==1,s=n%2==1,u=Math.floor(r/2),l=Math.floor(n/2),c=Math.ceil(r/2),f=c*Math.ceil(n/2),d=Ia(n)*Ia(r),p=0;p<t;p++){for(var h=p*n*r,v=p*d,m=i?4:0,g=r+(i?1:0),y=v,b=h,x=h+r,w=0;w<l;++w){for(var E=0;E<u;++E)o[b++]=e[y++],o[b++]=e[y++],o[x++]=e[y++],o[x++]=e[y++];y+=m,b+=g,x+=g}if(i){y=v+4*(c-1);var C=h+r-1;for(m=4*c,g=2*r,w=0;w<l;++w)o[C]=e[y],o[C+r]=e[y+2],y+=m,C+=g}if(s){for(y=v+4*(f-c),C=h+(n-1)*r,E=0;E<u;++E)o[C++]=e[y++],o[C++]=e[y++],y+=2;i&&(o[h+n*r-1]=e[y])}}return o}function Dl(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Fl(e,t))}(e),r}!function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Cl||(Cl={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Sl||(Sl={}));function Ol(e){return!!(Zi.get("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Fl(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Pl(e,t,n){return rc(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Ml(e,t,n){var r=rc(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Dl(e,t,function(){return e.shaderSource(r,n)}),Dl(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Ll(e,t,n){var r=rc(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Dl(e,t,function(){return e.shaderSource(r,n)}),Dl(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=Bl.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map(function(e,t){return Wa((t+1).toString(),a)+e}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),f=i.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+Wa(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Bl=/ERROR: [0-9]+:([0-9]+):/g;function zl(e,t){return rc(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function Wl(e,t,n){if(Dl(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Ul(e,t,n){if(Dl(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function jl(e,t,n){var r=rc(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Dl(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Dl(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Vl(e,t,n){var r=rc(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Dl(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),Dl(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Hl(){return 2===Zi.get("WEBGL_VERSION")?1:4}function Gl(e,t){return rc(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function ql(e,t){var n=Zi.get("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Kl(e,t){return rc(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function $l(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Dl(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),Dl(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),Dl(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function Xl(e,t,n,r){oc(e,r),Dl(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),Dl(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function Yl(e,t,n,r){return rc(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function Ql(e,t,n){return e.getUniformLocation(t,n)}function Jl(e,t,n,r,o,a){Dl(e,t,function(){return Xl(e,t,r,a)}),Dl(e,t,function(){return e.uniform1i(o,a)})}function Zl(e,t,n,r){Dl(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),Dl(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function ec(e,t,n){Dl(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),Dl(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function tc(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+nc(e,t))}function nc(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function rc(e,t,n,r){var o=Dl(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function oc(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function ac(e,t){return void 0===t&&(t=2),Pa(e.slice(0,e.length-t))}function ic(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function sc(e,t){var n;void 0===t&&(t=!1);var r=Zi.get("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?Ia(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=Ha(e);e=o.newShape}var a=Pa(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=ac(e),s=2,u=2;return e.length&&(s=(n=ic(e))[0],u=n[1]),za(a=i*(s/2)*(u/2)).map(function(e){return 2*e})}return za(a)}function uc(e){return e%2==0}function lc(e,t){if(Ma(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(uc(n)&&uc(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&uc(e[0])&&uc(t[0])}var cc=Object.freeze({callAndCheck:Dl,canBeRepresented:Ol,getWebGLErrorMessage:Fl,getExtensionOrThrow:Pl,createVertexShader:Ml,createFragmentShader:Ll,createProgram:zl,linkProgram:Wl,validateProgram:Ul,createStaticVertexBuffer:jl,createStaticIndexBuffer:Vl,getNumChannels:Hl,createTexture:Gl,validateTextureSize:ql,createFramebuffer:Kl,bindVertexBufferToProgramAttribute:$l,bindTextureUnit:Xl,unbindTextureUnit:function(e,t,n){oc(e,n),Dl(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),Dl(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Yl,getProgramUniformLocation:Ql,bindTextureToProgramUniformSampler:Jl,bindCanvasToFramebuffer:function(e,t){Dl(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Dl(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),Dl(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:Zl,unbindColorTextureFromFramebuffer:ec,validateFramebuffer:tc,getFramebufferErrorMessage:nc,getBatchDim:ac,getRowsCols:ic,getTextureShapeFromLogicalShape:sc,isReshapeFree:lc});function fc(e,t){var n=pu();return Ml(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function dc(e,t){return jl(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function pc(e,t){return Vl(e,t,new Uint16Array([0,1,2,2,1,3]))}function hc(e,t){var n,r,o,a,i,s,u,l,c=e;return 2===Zi.get("WEBGL_VERSION")?(n=c.R32F,r=c.R16F,o=c.RGBA16F,a=c.RGBA32F,i=c.RED,s=4,u=1,l=c.HALF_FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=c.RGBA,i=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function vc(e,t,n,r,o,a,i){ql(n,r);var s=Gl(e,t),u=e.TEXTURE_2D;return Dl(e,t,function(){return e.bindTexture(u,s)}),Dl(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),Dl(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),Dl(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),Dl(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),Dl(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),Dl(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function mc(e,t,n,r,o){var a=Rl(n,r);return vc(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function gc(e,t,n,r,o){var a=Rl(n,r);return vc(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function yc(e,t,n,r,o){var a=Rl(n,r);return vc(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function bc(e,t,n,r,o){var a=Nl(n,r);return vc(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function xc(e,t,n,r,o){var a=Nl(n,r);return vc(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function wc(e,t,n,r){return Dl(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),$l(e,t,n,"clipSpacePos",r,3,20,0)&&$l(e,t,n,"uv",r,2,20,12)}function Ec(e,t,n,r){Dl(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),Dl(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),Dl(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function Cc(e,t,n,r,o,a,i){ql(r,o),Dl(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),Dl(e,t,function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,o,i,e.FLOAT,a)}),Dl(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function Sc(e,t,n,r,o,a,i,s){var u,l=Rl(r,o),c=l[0],f=l[1],d=r*o;1===s.defaultNumChannels&&d===a.length?u=a:function(e,t,n){var r=_l(e.length,n);if(t.length<r)throw new Error("unpackedArray length ("+t.length+") must be >= "+r);for(var o=0,a=0;a<e.length;++a)t[o]=e[a],o+=n}(a,u=new Float32Array(d*i),i),Cc(e,t,n,c,f,u,s.textureFormatFloat)}function kc(e,t,n,r,o,a,i,s,u,l){var c=Nl(i,s),f=c[0],d=c[1],p=new Float32Array(Tl(i,s));(function(e,t,n,r,o){for(var a=r%2==1,i=n%2==1,s=Math.floor(r/2),u=Math.floor(n/2),l=Math.ceil(r/2),c=l*Math.ceil(n/2),f=Ia(n)*Ia(r),d=0;d<t;d++){for(var p=d*n*r,h=d*f,v=a?4:0,m=r,g=h,y=0;y<u;++y){for(var b=2*y*r,x=0;x<s;++x){var w=p+b+2*x;o[g]=e[w],o[g+1]=e[w+1],o[g+2]=e[w+m],o[g+3]=e[w+m+1],g+=4}g+=v}if(a){w=p+r-1,g=h+4*(l-1);var E=2*r;for(v=4*l,y=0;y<u;++y)o[g]=e[w],o[g+2]=e[w+r],w+=E,g+=v}if(i){for(w=p+(n-1)*r,g=h+4*(c-l),x=0;x<s;++x)o[g++]=e[w++],o[g++]=e[w++],g+=2;a&&i&&(o[h+f-4]=e[w])}}})(u,r,o,a,p),Cc(e,t,n,f,d,p,e.RGBA)}function Rc(e,t,n,r,o,a){var i=n;if(2===Zi.get("WEBGL_VERSION")){var s=e,u=s.createBuffer();Dl(e,t,function(){return e.bindBuffer(s.PIXEL_PACK_BUFFER,u)});var l=4*_l(r*o,a.downloadUnpackNumChannels);Dl(e,t,function(){return e.bufferData(s.PIXEL_PACK_BUFFER,l,s.STREAM_READ)}),Dl(e,t,function(){return s.readPixels(0,0,o,r,e.RGBA,e.FLOAT,0)}),Dl(e,t,function(){return e.bindBuffer(s.PIXEL_PACK_BUFFER,null)}),i=u}return i}function _c(e,t,n,r,o){var a=e,i=new Float32Array(_l(n*r,o.downloadUnpackNumChannels));a.bindBuffer(a.PIXEL_PACK_BUFFER,t),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,i),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var s=new Float32Array(n*r);return Il(i,s,o.downloadUnpackNumChannels),s}function Ic(e,t,n,r,o){var a=Rl(n,r),i=a[0],s=a[1],u=new Float32Array(_l(n*r,o.downloadUnpackNumChannels));Dl(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.FLOAT,u)});var l=new Float32Array(n*r);return Il(u,l,o.downloadUnpackNumChannels),l}function Nc(e,t,n,r,o){var a=Rl(n,r),i=a[0],s=a[1],u=new Uint8Array(_l(n*r,4));return Dl(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Tc(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(Tl(a,i));u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);var c=new Float32Array(Pa([n,r,o]));return Al(l,n,r,o,c),c}function Ac(e,t,n,r,o,a,i,s){var u=Nl(a,i),l=u[0],c=u[1],f=new Float32Array(Tl(a,i));Dl(e,t,function(){return e.readPixels(0,0,l,c,e.RGBA,e.FLOAT,f)});var d=new Float32Array(Pa([n,r,o]));return Al(f,n,r,o,d)}var Dc=Object.freeze({createVertexShader:fc,createVertexBuffer:dc,createIndexBuffer:pc,getTextureConfig:hc,createFloat32MatrixTexture:mc,createFloat16MatrixTexture:gc,createUnsignedBytesMatrixTexture:yc,createPackedMatrixTexture:bc,createFloat16PackedMatrixTexture:xc,bindVertexProgramAttributeStreams:wc,uploadPixelDataToTexture:Ec,uploadMatrixToTexture:Sc,uploadMatrixToPackedTexture:kc,maybeCreateBufferFromOutputTexture:Rc,downloadFloat32MatrixFromBuffer:_c,downloadFloat32MatrixFromOutputTexture:Ic,downloadByteEncodedFloatMatrixFromOutputTexture:Nc,downloadPackedMatrixFromBuffer:Tc,downloadMatrixFromPackedOutputTexture:Ac}),Oc=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Zi.get("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){Ca[e]=t}(t,e)):this.gl=ka(t),1===Zi.get("WEBGL_VERSION")?(this.textureFloatExtension=Pl(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),Zi.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Pl(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Pl(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=dc(this.gl,this.debug),this.indexBuffer=pc(this.gl,this.debug),this.framebuffer=Kl(this.gl,this.debug),this.textureConfig=hc(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return Zi.get("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Dl(t,this.debug,function(){return t.finish()}),Dl(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Dl(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Dl(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Dl(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Dl(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),mc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),gc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),yc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Ec(this.gl,this.debug,e,t)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),xc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),bc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(ec(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Dl(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.uploadMatrixToTexture=function(e,t,n,r){this.throwIfDisposed();var o=Hl();return Sc(this.gl,this.debug,e,t,n,r,o,this.textureConfig)},e.prototype.uploadMatrixToPackedTexture=function(e,t,n,r,o,a,i){return this.throwIfDisposed(),kc(this.gl,this.debug,e,t,n,r,o,a,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Ic(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Nc(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return Tc(this.gl,e,t,n,r,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t,n){return _c(this.gl,e,t,n,this.textureConfig)},e.prototype.maybeCreateBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Rc(this.gl,this.debug,e,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(Zi.get("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n,r,o,a){var i=this;return this.downloadMatrixDriver(e,function(){return Ac(i.gl,i.debug,t,n,r,o,a,i.textureConfig)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=Ll(t,this.debug,e),r=fc(t,this.debug),o=zl(t,this.debug);return Dl(t,this.debug,function(){return t.attachShader(o,r)}),Dl(t,this.debug,function(){return t.attachShader(o,n)}),Wl(t,this.debug,o),this.debug&&Ul(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=wc(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Dl(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Ul(this.gl,this.debug,this.program),Dl(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Yl(this.gl,this.debug,e,t):Ql(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Dl(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Jl(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Nl(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&Ul(this.gl,this.debug,this.program),tc(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Dl(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Dl(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Pl(this.gl,this.debug,2===Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return wa(this,void 0,void 0,function(){var t=this;return Ea(this,function(n){switch(n.label){case 0:return[4,Ua(function(){return t.disposed||t.isQueryAvailable(e,Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Ua(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Zl(this.gl,this.debug,e,this.framebuffer),this.debug&&tc(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Zl(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&tc(this.gl)):ec(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Zl(r,this.debug,e,this.framebuffer),this.debug&&tc(r),this.outputTexture=e,Dl(r,this.debug,function(){return r.viewport(0,0,t,n)}),Dl(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),Dl(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Fc(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!Ma(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!Ma(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var Pc=function(e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,f=s.left,d=s.top,p=o*r,h=pu();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+e[1]+" || pos >= "+e[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+u+")) * "+i+" - "+d+";\n            int d0 = offsetY + "+c+" * (pos / "+p+");\n\n            if(d0 >= "+t[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+f+".);\n            int d1 = offsetX + "+l+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n            if(d1 >= "+t[1]+" || d1 < 0) continue;\n\n            vec2 innerDims = vec2(d1, int(mod(float(pos), "+o+".)));\n            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),\n                                              int(innerDims.y)), innerDims);\n          }\n        }\n\n        "+h.output+" = result;\n      }\n    "},Mc=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Lc=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Bc=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},zc=function(e,t,n,r,o,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=t;var i=n?e[1]:e[2],s=Math.ceil(i/2),u=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";a&&(d="vec4 activation(vec4 x) {\n        "+a+"\n      }",p="result = activation(result);");var h=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),this.userCode="\n      "+d+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          result += ("+c[0]+" * "+f[0]+") + ("+c[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+h+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},Wc=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),Uc=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},jc=function(e){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=lu("rc",t),r=ku(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}};var Vc=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=ku(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Hc=function(e,t,n){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=ku(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=lu("rc",r),u=lu("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",h=0,v=1===r?2:4;h<v;h++)p+="\n        "+f[h]+"\n        if ("+d+") {\n          result["+h+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+h+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";p+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+p+"\n        setOutput(result);\n      }\n    "},Gc=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,p="0.0";if(d||(p="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+c+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var h=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(h="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+c+", "+f+");\n      const float initializationValue = "+p+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+p+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+h+");\n      }\n    "}},qc=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";o%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},Kc=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      "+function(e){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+hu(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  "}(t)+"\n      "+function(e){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+function(e,t){if(e.length!==t.length)throw new Error("Vectors to be dotted must be of the same length -got "+e.length+" and "+t.length);for(var n=[],r=Math.floor(e.length/4),o=e.length%4,a=0;a<r;a++){var i=e.slice(4*a,4*a+4),s=t.slice(4*a,4*a+4);n.push(vu(i)+", "+vu(s))}return 0!==o&&(i=e.slice(4*r),s=t.slice(4*r),1===i.length&&(i=i.map(function(e){return"float("+e+")"}),s=s.map(function(e){return"float("+e+")"})),n.push(vu(i)+", "+vu(s))),n.map(function(e,t){return"dot("+e+")"}).join("+")}(["coords.x","coords.y","coords.z"],ai(e).map(function(e){return e.toString()}).concat(["1."]))+");\n    }\n  "}(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "};var $c=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],p=1/f,h=1/d,v=2*Math.ceil(p)+2,m=2*Math.ceil(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Xc=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Yc=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+"; \n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Qc=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],p=1/f,h=1/d,v=2*Math.ceil(p)+2,m=2*Math.ceil(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Jc=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Zc=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=ku(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},ef=function(e,t){this.variableNames=["x"],this.usesPackedTextures=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=lu("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=ku(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1), rc);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1), rc + 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},tf=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=ku(o.length),u=ku(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices("+l+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var d="getUpdates("+f+")",p=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+p+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},nf=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},rf=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=ku(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},of=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=ku(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return af.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+af[t]+" = start["+t+"] + coords."+af[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),af=["x","y","z","w","u","v"];var sf=function(){function e(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=ku(this.rank),n=lu("coords",this.rank),r=lu("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+" \n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),uf=function(e,t,n,r){this.variableNames=["x"];var o=n.filter(function(e,t){return-1===r.indexOf(t)});this.outputShape=o;var a=n.length,i=ku(n.length),s=ku(o.length),u="";if(1===a)u="coords * strides + begin";else{var l=0;u=n.map(function(e,t){return-1===r.indexOf(t)?(l++,1===o.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(l-1)+"] * strides["+t+"] + begin["+t+"]"):"begin["+t+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},lf=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=cf(t,n),a=ff(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Sl.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Sl.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Sl.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Sl.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Sl.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=ff(t,cf(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function cf(e,t){if(e===Cl.UPLOAD)return t?Sl.PACKED_2X2_FLOAT32:Sl.UNPACKED_FLOAT32;if(e===Cl.RENDER||null==e)return t?Zi.get("WEBGL_RENDER_FLOAT32_ENABLED")?Sl.PACKED_2X2_FLOAT32:Sl.PACKED_2X2_FLOAT16:Zi.get("WEBGL_RENDER_FLOAT32_ENABLED")?Sl.UNPACKED_FLOAT32:Sl.UNPACKED_FLOAT16;if(e===Cl.DOWNLOAD||e===Cl.PIXELS)return Sl.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function ff(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var df=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=ku(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "};var pf=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=ku(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "};var hf=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=ku(this.rank),a=uu("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},vf=.3275911,mf=.254829592,gf=-.284496736,yf=1.421413741,bf=-1.453152027,xf=1.061405429,wf=1.7580993408473768,Ef=1.0507009873554805,Cf=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Sf="if (isnan(x)) return x;",kf=Sf+"\n  return (x < 0.0) ? 0.0 : x;\n",Rf="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+wf+";\n  float scale = "+Ef+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n";var _f="return exp(x);",If=Sf+"\n  return sin(x);\n",Nf=Sf+"\n  return cos(x);\n",Tf=Sf+"\n  return atan(x);\n",Af=Sf+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",Df=Sf+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Of='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+vf+";\n  float a1 = "+mf+";\n  float a2 = "+gf+";\n  float a3 = "+yf+";\n  float a4 = "+bf+";\n  float a5 = "+xf+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n",Ff="return x;",Pf="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Mf=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Lf=function(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var t=e.length,n=lu("rc",t),r=ku(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "};var Bf=Ds({concat_:function(e,t){void 0===t&&(t=0),Aa(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=os(e,"tensors","concat");t=Va(t,n[0].shape)[0];var r=Es(n.map(function(e){return e.shape}),t);if(0===Pa(r))return Bs([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});!function(e,t){var n=e[0].length;e.forEach(function(e,t){Aa(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),Aa(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var a=0;a<n;a++)Aa(a===t||e[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}(o,t);var a=n;return Zi.engine.runKernel(function(e){return e.concat(n,t)},a,function(e){var n=o.map(function(e){return e[t]});return Vf(e,n,t).map(function(e){return function(){return e}})})}}),zf=Ds({concat1d_:function(e){return Bf(e,0)}}),Wf=Ds({concat2d_:function(e,t){return Bf(e,t)}}),Uf=Ds({concat3d_:function(e,t){return Bf(e,t)}}),jf=Ds({concat4d_:function(e,t){return Bf(e,t)}}),Vf=Ds({split_:function(e,t,n){void 0===n&&(n=0);var r,o=rs(e,"x","split");return n=Va(n,o.shape)[0],"number"==typeof t?(Aa(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(Aa(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),Zi.engine.runKernel(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return Bf(e,n)}}})}});"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;function Hf(e,t){return e(t={exports:{}},t.exports),t.exports}var Gf=Hf(function(e){!function(e,t){function n(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function r(e,t){var r=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),o=t&&t.state,a=r.next;return a.int32=function(){return 4294967296*r.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.alea=r}(0,e)}),qf=Hf(function(e){!function(e,t){function n(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function r(e,t){var r=new function(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xor128=r}(0,e)}),Kf=Hf(function(e){!function(e,t){function n(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function r(e,t){var r=new function(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xorwow=r}(0,e)}),$f=Hf(function(e){!function(e,t){function n(e,t){return t.x=e.x.slice(),t.i=e.i,t}function r(e,t){null==e&&(e=+new Date);var r=new function(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&(o.x&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xorshift7=r}(0,e)}),Xf=Hf(function(e){!function(e,t){function n(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function r(e,t){null==e&&(e=+new Date);var r=new function(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&(o.X&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xor4096=r}(0,e)}),Yf=Hf(function(e){!function(e,t){function n(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function r(e,t){var r=new function(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.tychei=r}(0,e)}),Qf=Hf(function(e){!function(t,r){var o,a=this,i=256,s="random",u=r.pow(i,6),l=r.pow(2,52),c=2*l,f=255;function d(e,n,d){var m=[],g=h(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),v(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,v(t)]}}():e,3),m),y=new function(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=f&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=f&o+1],n=n*i+s[f&(s[o]=s[a=f&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}(m),b=function(){for(var e=y.g(6),t=u,n=0;e<l;)e=(e+n)*i,t*=i,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,h(v(y.S),t),(n.pass||d||function(e,t,n,o){return o&&(o.S&&p(o,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(b,g,"global"in n?n.global:this==r,n.state)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function h(e,t){for(var n,r=e+"",o=0;o<r.length;)t[f&o]=f&(n^=19*t[f&o])+r.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=d,h(r.random(),t),e.exports){e.exports=d;try{o=n(Object(function(){var e=new Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(e){}}}([],Math)});Qf.alea=Gf,Qf.xor128=qf,Qf.xorwow=Kf,Qf.xorshift7=$f,Qf.xor4096=Xf,Qf.tychei=Yf;var Jf=Qf.alea,Zf=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Jf(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}();function ed(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",di(e),new xi(e,t,n)}var td=Ds({batchToSpaceND_:function(e,t,n){var r=rs(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return Aa(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),Aa(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),Aa(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),Zi.engine.runKernel(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),nd=Ds({cast_:function(e,t){var n=rs(e,"x","cast");return Zi.engine.runKernel(function(e){return e.cast(n,t)},{$x:n},function(e){return{$x:function(){return e.clone()}}})}}),rd=Ds({clone_:function(e){var t=rs(e,"x","clone",null);return Zi.engine.runKernel(function(e){return Si.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),od=Ds({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=rs(e,"x","cumsum"),a=bs([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=ws(1,o.rank)[0],u=Zi.engine.runKernel(function(e){return e.cumsum(i,s,n,r)},{permutedX:i},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=a&&(u=u.transpose(a)),u}}),ad=Ds({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=rs(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return Aa(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),Aa(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),Aa(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),Zi.engine.runKernel(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),id=Ds({expandDims_:function(e,t){void 0===t&&(t=0);var n=rs(e,"x","expandDims");Aa(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(Aa(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),yd(n,r)}}),sd=Ds({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=ed([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Ed(id(s,0),[n[0],1,1]);if(2===n.length)return Ed(id(id(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Ed(id(id(id(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),ud=Ds({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=rs(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=Zi.engine.runKernel(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===i?u.as1D():u}}),ld=Ds({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=rs(e,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),Zi.engine.runKernel(function(e){return e.oneHot(o,t,n,r)},{$indices:o},function(e){return{$indices:function(){return Gs(o.shape,"float32")}}}).reshape(a)}}),cd=Ds({pad_:function(e,t,n){void 0===n&&(n=0);var r=rs(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=t.map(function(e){return e[0]});return Zi.engine.runKernel(function(e){return e.pad(r,t,n)},{$x:r},function(e){return{$x:function(){return e.slice(o,r.shape)}}})}}),fd=Ds({pad1d_:function(e,t,n){return void 0===n&&(n=0),Aa(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),cd(e,[t],n)}}),dd=Ds({pad2d_:function(e,t,n){return void 0===n&&(n=0),Aa(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),cd(e,t,n)}}),pd=Ds({pad3d_:function(e,t,n){return void 0===n&&(n=0),Aa(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),cd(e,t,n)}}),hd=Ds({pad4d_:function(e,t,n){return void 0===n&&(n=0),Aa(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),cd(e,t,n)}}),vd=Ds({rand_:function(e,t,n){var r=Pa(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return Si.make(e,{values:o},n)}}),md=Ds({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Zf(t,n,r,!1,o),i=ed(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),gd=Ds({randomUniform_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var o=ed(e,r),a=0;a<o.values.length;a++)o.values[a]=Ta(t,n);return o.toTensor()}}),yd=Ds({reshape_:function(e,t){var n=rs(e,"x","reshape",null);return t=ja(t,n.size),Aa(n.size===Pa(t),function(){return"new shape and old shape must have the same number of elements."}),Zi.engine.runKernel(function(e){return e.reshape(n,t)},{$x:n},function(e){return{$x:function(){return e.reshape(n.shape)}}})}}),bd=Ds({spaceToBatchND_:function(e,t,n){var r=rs(e,"x","spaceToBatchND");return Aa(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),Aa(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),Aa(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),Zi.engine.runKernel(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),xd=Ds({squeeze_:function(e,t){var n=rs(e,"x","squeeze");return yd(n,Ha(n.shape,t).newShape)}}),wd=Ds({stack_:function(e,t){void 0===t&&(t=0);var n=os(e,"tensors","stack");if(Aa(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;Aa(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){Da(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){Aa(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(e){return e.expandDims(t)});return Bf(i,t)}}),Ed=Ds({tile_:function(e,t){var n=rs(e,"x","tile");return Aa(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}),Zi.engine.runKernel(function(e,r){var o=e.tile(n,t);return r([n]),o},{$x:n},function(e,n){var r=n[0];return{$x:function(){var n=Xs(r);if(1===r.rank)for(var o=0;o<t[0];++o)n=n.add(e.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<t[0];++o)for(var a=0;a<t[1];++a)n=n.add(e.slice([o*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(var i=0;i<t[2];++i)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(i=0;i<t[2];++i)for(var s=0;s<t[3];++s)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}})}}),Cd=Ds({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Zf(t,n,r,!0,o),i=ed(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Sd=Ds({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=rs(e,"x","unstack");return Aa(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length),Zi.engine.runKernel(function(e){return e.unstack(n,t)},{$x:n},function(e){return{$x:function(){return wd(e,t)}}})}}),kd=function(e,t){return wa(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f;return Ea(this,function(d){switch(d.label){case 0:return n=rs(e,"x","setdiff1d"),r=rs(t,"y","setdiff1d"),Aa(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),Aa(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),Aa(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(a=d.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new xi([s],n.dtype),l=new xi([s],"int32"),c=0,f=0;c<o.length;c++)i.has(o[c])||(u.values[f]=o[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Rd(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=ed(e,"int32"),a=ed([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var _d={};var Id=function(){function e(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,Zi.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(null==e){var t=ka(Zi.get("WEBGL_VERSION"));this.binaryCache=function(e){return e in _d||(_d[e]={}),_d[e]}(Zi.get("WEBGL_VERSION")),this.gpgpu=new Oc(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new lf(this.gpgpu)}return e.prototype.register=function(e,t,n){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:n})},e.prototype.setDataMover=function(e){this.texData=new Ys(e)},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[e.height,e.width],r=[e.height,e.width,t];if(Zi.get("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var o=this.makeTensorHandle(n,"int32");this.texData.get(o.dataId).usage=Cl.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(o.dataId),e);var a=new wl(r),i=this.compileAndRun(a,[o]);return this.disposeData(o.dataId),i},e.prototype.makeTensorHandle=function(e,t){var n={};return this.register(n,e,t),{dataId:n,shape:e,dtype:t}},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");if(Zi.get("DEBUG"))for(var n=0;n<t.length;n++){var r=t[n];if(!Ol(r))throw Error("The value "+r+" cannot be represented on this device.")}var o=this.texData.get(e),a=o.texture,i=o.texShape,s=o.usage,u=o.dtype,l=o.isPacked;if("complex64"===u)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=a&&(this.releaseTexture(e,a,i,s,u,l),o.texture=null,o.texShape=null),o.usage=Cl.UPLOAD,o.values=t},e.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape;if(null!=a){var s=new Cf(i,Ff),u=this.compileAndRun(s,[{dataId:e,shape:i,dtype:r}]),l=this.readSync(u.dataId);return u.dispose(),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var c,f,d=null!=this.activeTimers;return d&&(c=performance.now()),f="complex64"===r?Zs(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),d&&(this.downloadWaitMs+=performance.now()-c),this.convertAndCacheOnCPU(e,f)},e.prototype.read=function(e){return wa(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f,d,p,h,v,m,g,y,b,x,w,E,C,S;return Ea(this,function(k){switch(k.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(e){return r.push(e)})];if(o=this.texData.get(e),a=o.texture,i=o.values,s=o.texShape,u=o.isPacked,l=o.shape,c=o.slice,f=o.dtype,null!=c)return d=new Cf(l,Ff),p=this.compileAndRun(d,[{dataId:e,shape:l,dtype:f}]),h=this.read(p.dataId),p.dispose(),[2,h];if(null!=i)return[2,this.convertAndCacheOnCPU(e)];if(this.pendingRead.set(e,[]),!Zi.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Zi.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return v=s[1],m=s[0],u&&(t=Nl(s[0],s[1]),v=t[0],m=t[1]),g=this.gpgpu.maybeCreateBufferFromTexture(a,m,v),[4,this.gpgpu.createAndWaitForFence()];case 1:return k.sent(),g instanceof WebGLTexture?y=this.getValuesFromTexture(e):(b=Pa(l),u?(x=ac(l),w=1,E=1,l.length&&(n=ic(l),w=n[0],E=n[1]),y=this.gpgpu.downloadPackedMatrixFromBuffer(g,x,w,E,s[0],s[1]).subarray(0,b)):y=this.gpgpu.downloadFloat32MatrixFromBuffer(g,s[0],s[1]).subarray(0,b)),C=this.convertAndCacheOnCPU(e,y),S=this.pendingRead.get(e),this.pendingRead.delete(e),S.forEach(function(e){return e(C)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,C]}})})},e.prototype.getValuesFromTexture=function(e){var t,n=this,r=this.texData.get(e),o=r.shape,a=r.dtype,i=r.texture,s=r.texShape,u=Pa(o);if(Zi.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(e).isPacked){var l=ac(o),c=1,f=1;return o.length&&(c=(t=ic(o))[0],f=t[1]),this.gpgpu.downloadMatrixFromPackedTexture(i,l,c,f,s[0],s[1]).subarray(0,u)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(i,s[0],s[1]).subarray(0,u)}var d=this.makeTensorHandle(o,"float32");d.size=Pa(o),this.texData.get(d.dataId).usage=Cl.DOWNLOAD;var p=is(function(){var t=new ml(o);return n.compileAndRun(t,[{shape:o,dtype:a,dataId:e}],d,null,!1)}),h=this.texData.get(p.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture,h.texShape[0],h.texShape[1]).subarray(0,u);return this.disposeData(d.dataId),v},e.prototype.time=function(e){return wa(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return Ea(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=Fa(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),a=Fa(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return i=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:Na(i),getExtraProfileInfo:function(){return i.map(function(e,t){return{name:a[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},e.prototype.getQueryTime=function(e){return wa(this,void 0,void 0,function(){var t;return Ea(this,function(n){return Zi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},e.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e))if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.complexTensors,s=t.isPacked,u=t.slice;if(null!=n){var l=u&&u.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),this.releaseTexture(e,n,o,a,r,s),this.texData.delete(e))}null!=i&&(i.real.dispose(),i.imag.dispose())}},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getCPUBackend=function(){return Zi.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Zi.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&e.size<t})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.getCanvas=function(){return this.canvas},e.prototype.complex=function(e,t){var n=this.makeOutputArray(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Zi.engine.keep(e.clone()),imag:Zi.engine.keep(t.clone())},n},e.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},e.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);var r=this.texData.get(e.dataId).isPacked,o=Ts(e.shape,t,n);if(r||!o){var a=Zi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new sf(n):new of(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},e.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=Si.make(n,{},e.dtype,this),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=As(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r,o,a,i,s,u);var l=_s(e.shape,t,n,r,o,a,i,s,u),c=l[0],f=l[1],d=l[2],p=f.filter(function(e,t){return-1===d.indexOf(t)});if(p.some(function(e){return 0===e}))return Bs([],p);var h=new uf(c,r,f,d);return this.compileAndRun(h,[e])},e.prototype.reverse=function(e,t){var n=Zi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new ef(e.shape,t):new Zc(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>Zi.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),r=this.concat(e.slice(0,n),t),o=this.concat(e.slice(n),t);return this.concat([r,o],t)}if(Zi.get("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new tl(e.map(function(e){return e.shape}),t);return this.compileAndRun(a,e)}var i=Es(e.map(function(e){return e.shape}),t),s=e.map(function(e){return e.as2D(-1,Pa(e.shape.slice(t)))}),u=new el(s.map(function(e){return e.shape}));return this.compileAndRun(u,s).reshape(i)},e.prototype.neg=function(e){var t=new Cf(e.shape,"return -x;");return this.compileAndRun(t,[e])},e.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,i,1),l=1===a?2:1,c=1===a?t.as3D(s,1,i):t;return this.multiply(u,c).sum(l,!0)}var f=Di(e.dtype,t.dtype),d=new zc(e.shape,[s,o,a],n,r),p=this.makePackedTensor(d.outputShape,f);return this.compileAndRun(d,[e,t],p)},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){var i=n?e.shape[2]:e.shape[1],s=r?t.shape[1]:t.shape[2],u=e.shape[0],l=Di(e.dtype,t.dtype),c=new zc(e.shape,[u,i,s],n,r,!!o,a?function(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?Pf:kf;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}(a,!0):null),f=this.makePackedTensor(c.outputShape,l),d=[e,t];return o&&d.push(o),this.compileAndRun(c,d,f)},e.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new Fu(Du,e.shape,t.shape),a=new Fu(Ou,e.shape,t.shape),i=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag),this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Bu,e.dtype);var c=new Vu(Bu,e.shape,t.shape),f=this.makeOutputArray(c.outputShape,e.dtype);return this.compileAndRun(c,[e,t],f)},e.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),Zi.get("WEBGL_PACK_BATCHNORMALIZATION")){var l=new Au(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)}var c=new Tu(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=new Mc(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new Lc(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},e.prototype.tile=function(e,t){var n=new df(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.pad=function(e,t,n){var r=Zi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Hc(e.shape,t,n):new Vc(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=Zi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new hf(e.shape,t):new pf(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new El(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},e.prototype.batchToSpaceND=function(e,t,n){Aa(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=cs(e.shape,t,r),a=fs(o.length,t.length),i=ds(e.shape,t,r),s=ps(n,t.length),u=hs(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){Aa(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=cs(i.shape,t,r,!1),u=fs(s.length,t.length,!1),l=ds(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=Ss(o),i=new qc({windowSize:a,inSize:o,batchSize:r},t),s=i.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],n);return this.compileAndRun(i,[e],c),1===c.shape[1]?c:this.reduce(c,t,n)},e.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=Ss(o),i=new su({windowSize:a,inSize:o,batchSize:r},t,null==n),s=i.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],"int32"),f=[e];return null!=n&&f.push(n),this.compileAndRun(i,f,c),1===c.shape[1]?c:this.argReduce(e,t,c)},e.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=Ss(r[r.length-1]),a=new Iu(r,o,t,null==n),i=this.makePackedTensor(a.outputShape,"int32"),s=null==n?[e]:[e,n];return this.compileAndRun(a,s,i),i.rank===e.rank?this.argReducePacked(e,t,i):i},e.prototype.sum=function(e,t){ys("sum",t,e.rank);var n=ms(e.shape,t),r=n[0],o=Pa(n[1]),a=e.as2D(-1,o),i=Oi(e.dtype);return this.reduce(a,"sum",i).reshape(r)},e.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=ms(e.shape,t),r=n[0],o=Pa(n[1]),a=e.as2D(-1,o),i=Oi(e.dtype);return this.reduce(a,"prod",i).reshape(r)},e.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=bs([r],e.rank),a=e;null!=o&&(a=e.transpose(o),r=ws(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=Pa([a.shape[r]]),u=a.as2D(-1,s),l=Oi(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(i);return null!=o&&(c=c.transpose(xs(o))),c},e.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=oi(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=oi(e,n+1);return n}(i,o),u=new nf({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),l=u.outputShape,c=l[0],f=l[1],d=this.makeOutputArray([c,f],r);return this.compileAndRun(u,[e,n],d),d.shape[1]===o?d:(n=Ks(0,o).tile([i/s]),this.segOpCompute(d,t,n,r,o))},e.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(ys("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!Zi.get("WEBGL_PACK_REDUCE")||e.rank<=2){var o=ms(e.shape,r),a=o[0],i=Pa(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},e.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},e.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},e.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new pl(e.shape,n,r);return this.compileAndRun(o,[e])},e.prototype.equal=function(e,t){if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Vu("return float(a == b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.notEqual=function(e,t){if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Vu("return float(a != b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Vu("return float(a < b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.lessEqual=function(e,t){if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Vu("return float(a <= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Vu("return float(a > b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greaterEqual=function(e,t){if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Vu("return float(a >= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalNot=function(e){var t=new Cf(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Vu("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalOr=function(e,t){if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Vu("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.select=function(e,t,n){var r=new rf(e.rank,t.shape,t.rank),o=this.makeOutputArray(r.outputShape,Di(t.dtype,n.dtype));return this.compileAndRun(r,[e,t,n],o)},e.prototype.where=function(e){ls("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Rd(e.shape,t)},e.prototype.topk=function(e,t,n){return iu(e.dataSync(),e.shape,e.dtype,t)},e.prototype.min=function(e,t){ys("min",t,e.rank);var n=ms(e.shape,t),r=n[0],o=Pa(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS")?new Yu($u,e.shape,t.shape):new Vu(Uu,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.mod=function(e,t){var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS")?new Yu(Xu,e.shape,t.shape):new Vu("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);ys("max",t,e.rank);var n=ms(e.shape,t),r=n[0],o=Pa(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS")?new Yu(Ku,e.shape,t.shape):new Vu(Wu,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.all=function(e,t){ys("all",t,e.rank);var n=ms(e.shape,t),r=n[0],o=Pa(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(e,t){ys("any",t,e.rank);var n=ms(e.shape,t),r=n[0],o=Pa(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.squaredDifference=function(e,t){var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS")?new Yu(zu,e.shape,t.shape):new Vu(zu,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.realDivide=function(e,t){var n=new Vu("if (a == b) return 1.0;\n  return a / b;",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e,t],r)},e.prototype.floorDiv=function(e,t){if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  vec4 resultSign = sign(a) * sign(b);\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  ivec4 result = ia / ib;\n  ivec4 amodb = ia - ib * result;\n\n  // Vectorize INT_DIV\n  // if (resultSign < 0.0 && amodb != 0) result -= 1;\n  // return float(result);\n  return vec4(result -\n     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));\n","int32");var n=new Vu("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[e,t],r)},e.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Mu);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Di(e.dtype,t.dtype);if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Mu,n);var r=new Vu(Mu,e.shape,t.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],o)},e.prototype.packedBinaryOp=function(e,t,n,r){var o=new Yu(n,e.shape,t.shape),a=this.makePackedTensor(o.outputShape,r);return this.compileAndRun(o,[e,t],a)},e.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorHandle(e,a),u=r.makeComplexComponentTensorHandle(t,i),l=new Vu(n,e.shape,t.shape),c=r.makeOutputArray(l.outputShape,Di(a.dtype,i.dtype));return r.compileAndRun(l,[s,u],c)}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},e.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},e.prototype.addN=function(e){for(var t=e[0],n=1;n<e.length;n++)t=this.add(t,e[n]);return t},e.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Lu);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Di(e.dtype,t.dtype);if(Zi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Lu,e.dtype);var r=new Vu(Lu,e.shape,t.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],o)},e.prototype.pow=function(e,t){var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS"),r=n?new Yu(Gu,e.shape,t.shape):new Vu("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),o=Di(e.dtype,t.dtype),a=n?this.makePackedTensor(r.outputShape,o):this.makeOutputArray(r.outputShape,o);return this.compileAndRun(r,[e,t],a)},e.prototype.ceil=function(e){var t=new Cf(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new Cf(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},e.prototype.sign=function(e){var t=new Cf(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},e.prototype.isNaN=function(e){var t=new Cf(e.shape,"return float(isnan(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isInf=function(e){var t=new Cf(e.shape,"return float(isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isFinite=function(e){var t=new Cf(e.shape,"return float(!isnan(x) && !isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.round=function(e){var t=new Cf(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t;return t=Zi.get("WEBGL_PACK")?new Mf(e.shape,_f):new Cf(e.shape,_f),this.compileAndRun(t,[e])},e.prototype.expm1=function(e){var t=new Cf(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t;return t=Zi.get("WEBGL_PACK")?new Mf(e.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new Cf(e.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(t,[e])},e.prototype.log1p=function(e){var t=new Cf(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new Cf(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},e.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Cf(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new Cf(e.shape,"return x * x;");return this.compileAndRun(t,[e])},e.prototype.reciprocal=function(e){var t=new Cf(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t;return t=Zi.get("WEBGL_PACK")?new Mf(e.shape,Pf):new Cf(e.shape,kf),this.compileAndRun(t,[e])},e.prototype.prelu=function(e,t){var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS")?new Yu("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",e.shape,t.shape):new Vu("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.elu=function(e){var t=new Cf(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e,t){var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS")?new Yu("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Vu("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.selu=function(e){var t=new Cf(e.shape,Rf);return this.compileAndRun(t,[e])},e.prototype.int=function(e){var t=new Cf(e.shape,"return float(int(x));"),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],n)},e.prototype.clip=function(e,t,n){var r,o=(r=Zi.get("WEBGL_PACK_CLIP")?new Ju(e.shape):new Qu(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},e.prototype.abs=function(e){var t=new Cf(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},e.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Zu(e.shape),r=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(e){var t=new Cf(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},e.prototype.softplus=function(e){var t=new Cf(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new Cf(e.shape,If);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new Cf(e.shape,Nf);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new Cf(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new Cf(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new Cf(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new Cf(e.shape,Tf);return this.compileAndRun(t,[e])},e.prototype.atan2=function(e,t){var n=Zi.get("WEBGL_PACK_BINARY_OPERATIONS")?new Yu(qu,e.shape,t.shape):new Vu(ju,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.sinh=function(e){var t=new Cf(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new Cf(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new Cf(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},e.prototype.asinh=function(e){var t=new Cf(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},e.prototype.acosh=function(e){var t=new Cf(e.shape,Af);return this.compileAndRun(t,[e])},e.prototype.atanh=function(e){var t=new Cf(e.shape,Df);return this.compileAndRun(t,[e])},e.prototype.erf=function(e){var t=new Cf(e.shape,Of);return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var n=new Cf(e.shape,function(e){return void 0===e&&(e=0),Sf+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},e.prototype.conv2dByMatMul=function(e,t,n){var r=e.shape,o=this.texData.get(e.dataId),a=n.inChannels,i=r[0]*r[1]*r[2],s=n.outChannels,u=(1===i||1===s)&&a>1e3,l=r[2]%2!=0&&!!o.isPacked;if(u||!Zi.get("WEBGL_LAZILY_UNPACK")||!Zi.get("WEBGL_PACK_BINARY_OPERATIONS")||!l){var c=this.reshape(e,[1,r[0]*r[1]*r[2],n.inChannels]),f=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(c,f,!1,!1),n.outShape)}var d=Si.make([1,r[0]*r[1]*(r[2]+1),n.inChannels],{dataId:e.dataId},e.dtype,this),p=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,Aa(lc(o.shape,d.shape),function(){return"packed reshape "+o.shape+" to "+d.shape+" isn't free"});var h=this.reshape(t,[1,n.inChannels,n.outChannels]),v=this.batchMatMul(d,h,!1,!1),m=this.texData.get(v.dataId);return Aa(m.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=p,m.shape=n.outShape,Si.make(n.outShape,{dataId:v.dataId},v.dtype,this)},e.prototype.conv2dWithIm2Row=function(e,t,n){var r=n.filterWidth,o=n.filterHeight,a=n.inChannels,i=n.outWidth,s=n.outHeight,u=r*o*a,l=s*i,c=[u,l],f=e.squeeze([0]),d=t.reshape([1,u,-1]),p=new Pc(c,f.shape,n),h=this.compileAndRun(p,[f]).reshape([1,c[0],c[1]]),v=new zc(h.shape,[1,l,n.outChannels],!0,!1);return this.compileAndRun(v,[h,d]).reshape([1,s,i,n.outChannels])},e.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(Zi.get("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new ul(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerInput=function(e,t,n){var r=new rl(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerFilter=function(e,t,n){var r=new nl(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2D=function(e,t,n){var r;return Zi.get("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new fl(n),this.compileAndRun(r,[e,t],this.makePackedTensor(n.outShape,e.dtype))):(r=new cl(n),this.compileAndRun(r,[e,t]))},e.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new sl(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new il(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3d=function(e,t,n){var r=new ll(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerInput=function(e,t,n){var r=new al(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerFilter=function(e,t,n){var r=new ol(n);return this.compileAndRun(r,[e,t])},e.prototype.maxPool=function(e,t){var n=new Gc(t,"max",!1),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[e],r)},e.prototype.avgPool=function(e,t){var n=new Gc(t,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e],r)},e.prototype.maxPoolBackprop=function(e,t,n,r){var o=new Gc(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Bc(r),s=this.makeOutputArray(i.outputShape,t.dtype),u=this.compileAndRun(i,[e,a],s);return a.dispose(),u},e.prototype.avgPoolBackprop=function(e,t,n){var r=new Nu(n),o=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[e],o)},e.prototype.cast=function(e,t){return Qs(e,t,this)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},e.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);return!n.isPacked||lc(e.shape,t)||null!==n.texture&&lc(n.shape,t)?Js(e,t):this.packedReshape(e,t)},e.prototype.resizeBilinear=function(e,t,n,r){var o=Zi.get("WEBGL_PACK_IMAGE_OPERATIONS")?new Yc(e.shape,t,n,r):new Xc(e.shape,t,n,r);return this.compileAndRun(o,[e])},e.prototype.resizeBilinearBackprop=function(e,t,n){var r=new $c(e,t,n);return this.compileAndRun(r,[e])},e.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new Jc(e.shape,t,n,r);return this.compileAndRun(o,[e])},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new Qc(e,t,n);return this.compileAndRun(r,[e])},e.prototype.multinomial=function(e,t,n,r){var o=t?e:Os(e),a=o.shape[0],i=o.shape[1],s=new Wc(a,i,n),u=this.makeOutputArray(s.outputShape,"int32"),l=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],u,l)},e.prototype.oneHot=function(e,t,n,r){var o=new Uc(e.size,t,n,r);return this.compileAndRun(o,[e])},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return ls("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),ru(e.dataSync(),t.dataSync(),n,r,o)},e.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new dl(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n])},e.prototype.depthToSpace=function(e,t,n){Aa(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,l=i/(t*t),c=new vl("NHWC"===n?[r,s,u,l]:[r,l,s,u],t,n);return this.compileAndRun(c,[e])},e.prototype.split=function(e,t,n){return au(e,t,n)},e.prototype.scatterND=function(e,t,n){var r=Rs(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/i,i],c=e.reshape([a,o]),f=t.reshape([a,i]);if(0===u)return Js(Bs([]),n);var d=zs(0),p=new tf(a,o,c.rank,f.rank,s,l);return this.compileAndRun(p,[f,c,d]).reshape(n)},e.prototype.sparseToDense=function(e,t,n,r){var o=Rs(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new tf(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},e.prototype.fft=function(e){return this.fftImpl(e,!1)},e.prototype.ifft=function(e){return this.fftImpl(e,!0)},e.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new bl(gl,e.shape,t),o=new bl(yl,e.shape,t),a=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=Cs(e,t),a=o[0],i=o[1],s=o[2],u=o[3],l=t.reshape([i,r]),c=e.reshape([e.size/s,s]),f=new kl(r,u,[i,s]);return this.compileAndRun(f,[c,l]).reshape(a)},e.prototype.fill=function(e,t,n){if("string"===(n=n||ni(t))){var r=qa(n,Pa(e));return r.fill(t),Si.make(e,{values:r},n)}var o=new xl(e,t),a=o.getCustomSetupFunc(t),i=this.makeOutputArray(e,n);return this.compileAndRun(o,[],i,a)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},e.prototype.makeOutputArray=function(e,t){return Si.make(e,{},t,this)},e.prototype.makePackedTensor=function(e,t){var n=Si.make(e,{},t,this);return this.texData.get(n.dataId).isPacked=!0,n},e.prototype.unpackTensor=function(e){var t=new Lf(e.shape);return this.compileAndRun(t,[e],Si.make(t.outputShape,{},e.dtype,this))},e.prototype.packTensor=function(e){var t=new jc(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype))},e.prototype.packedReshape=function(e,t){var n=e.reshape([ac(e.shape)].concat(ic(e.shape))),r=[ac(t)].concat(ic(t)),o=new Kc(r,n.shape);return this.compileAndRun(o,[n]).reshape(t)},e.prototype.compileAndRun=function(e,t,n,r,o){var a=this;if(void 0===o&&(o=!0),null==n&&(n=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=Ga(n.dtype,0),n;var i=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.usesPackedTextures&&Pa(t.shape)<=Zi.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:a.readSync(t.dataId)};e.usesPackedTextures&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.usesPackedTextures)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!lc(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,u={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},l=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,i,u),c=this.getAndSaveBinary(l,function(){return function(e,t,n,r){var o=t.userCode,a=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=mu(a,s,o,t.usesPackedTextures),l=e.createProgram(u),c=null,f=null;1===Zi.get("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1),f=e.getUniformLocation(l,"NAN",!1));for(var d={},p=0;p<t.variableNames.length;p++){var h=t.variableNames[p];d[h]=e.getUniformLocation(l,h,!1),d["offset"+h]=e.getUniformLocation(l,"offset"+h,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:d,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:f}}(a.gpgpu,e,i,u)}),f=null!=this.activeTimers;f&&(s=this.startTimer()),function(e,t,n,r,o){Fc(t.inShapeInfos,n),Fc([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===Zi.get("WEBGL_VERSION")&&(null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN)),n.forEach(function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(Pa(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,c,i,u,r);var d=1024*Zi.get("WEBGL_NUM_MB_BEFORE_PAGING");if(o&&this.numBytesInGPU>d)for(var p=this.numBytesInGPU-d;p>0&&this.lruDataGPU.length>0;){var h=this.lruDataGPU.shift(),v=this.texData.get(h),m=v.texShape,g=v.dtype;p-=this.computeBytes(m,g),this.read(h)}return f&&(s=this.endTimer(s),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(s)})),Zi.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(n.dataId).isPacked||e.isPackShader?n:this.unpackTensor(n)},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var e=this;return is(function(){var t=Zi.get("DEBUG");Zi.set("DEBUG",!1);var n=e.abs(zs(1e-8)).dataSync()[0];return Zi.set("DEBUG",t),n>0?32:16})},e.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=performance.now());var f=sc(r,u);n.texShape=f;var d=this.acquireTexture(e,f,s,o,u);if(n.texture=d,null!=a){if(u){var p=ac(r),h=1,v=1;r.length&&(h=(t=ic(r))[0],v=t[1]),this.gpgpu.uploadMatrixToPackedTexture(d,p,h,v,f[0],f[1],Nd(a))}else this.gpgpu.uploadMatrixToTexture(d,f[0],f[1],Nd(a));n.values=null,c&&(this.uploadWaitMs+=performance.now()-l)}}else Zi.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.indexOf(e)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(e),1),this.lruDataGPU.push(e))},e.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.texture,o=n.texShape,a=n.dtype,i=n.usage,s=n.isPacked;return null!=r&&(this.releaseTexture(e,r,o,i,a,s),n.texture=null,n.texShape=null,n.isPacked=!1),n.usage=Cl.UPLOAD,null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,a)),n.values},e.prototype.releaseTexture=function(e,t,n,r,o,a){if(Zi.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY){var i=this.lruDataGPU.indexOf(e);i>=0&&this.lruDataGPU.splice(i,1)}this.numBytesInGPU-=this.computeBytes(n,o),this.textureManager.releaseTexture(t,n,r,a)},e.prototype.acquireTexture=function(e,t,n,r,o){return Zi.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.push(e),this.numBytesInGPU+=this.computeBytes(t,r),this.textureManager.acquireTexture(t,n,o)},e.prototype.computeBytes=function(e,t){return e[0]*e[1]*Qa(t)},e}();function Nd(e){return e instanceof Float32Array?e:new Float32Array(e)}Zi.get("IS_BROWSER")&&Zi.registerBackend("webgl",function(){return new Id},2);var Td=Ds({abs_:function(e){var t=rs(e,"x","abs");return"complex64"===t.dtype?Zi.engine.runKernel(function(e){return e.complexAbs(t)},{$x:t}):Zi.engine.runKernel(function(e,n){var r=e.abs(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().step(-1))}}})}}),Ad=Ds({acos_:function(e){var t=rs(e,"x","acos");return Zi.engine.runKernel(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(zs(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Dd=Ds({acosh_:function(e){var t=rs(e,"x","acosh");return Zi.engine.runKernel(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Od=Ds({asin_:function(e){var t=rs(e,"x","asin");return Zi.engine.runKernel(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(zs(1).sub(n.toFloat().square()).sqrt())}}})}}),Fd=Ds({asinh_:function(e){var t=rs(e,"x","asinh");return Zi.engine.runKernel(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(zs(1).add(n.toFloat().square()).sqrt())}}})}}),Pd=Ds({atan_:function(e){var t=rs(e,"x","atan");return Zi.engine.runKernel(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),Md=Ds({atanh_:function(e){var t=rs(e,"x","atanh");return Zi.engine.runKernel(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(zs(1).sub(n.toFloat().square()))}}})}}),Ld=Ds({ceil_:function(e){var t=rs(e,"x","ceil");return Zi.engine.runKernel(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Xs(e)}}})}}),Bd=Ds({clipByValue_:function(e,t,n){var r=rs(e,"x","clipByValue");return Aa(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}),Zi.engine.runKernel(function(e,o){var a=e.clip(r,t,n);return o([r]),a},{$x:r},function(e,r){var o=r[0];return{$x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),Xs(e))}}})}}),zd=Ds({cos_:function(e){var t=rs(e,"x","cos");return Zi.engine.runKernel(function(e,n){var r=e.cos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sin().neg().mul(e)}}})}}),Wd=Ds({cosh_:function(e){var t=rs(e,"x","cosh");return Zi.engine.runKernel(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),Ud=Ds({erf_:function(e){var t=rs(e,"x","erf");return Aa("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),Zi.engine.runKernel(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),jd=Ds({exp_:function(e){var t=rs(e,"x","exp");return Zi.engine.runKernel(function(e,n){var r=e.exp(t);return n([r]),r},{$x:t},function(e,t){return{$x:function(){return e.mulStrict(t[0])}}})}}),Vd=Ds({expm1_:function(e){var t=rs(e,"x","expm1");return Zi.engine.runKernel(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),Hd=Ds({floor_:function(e){var t=rs(e,"x","floor");return Zi.engine.runKernel(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Xs(e)}}})}}),Gd=Ds({log_:function(e){var t=rs(e,"x","log");return Zi.engine.runKernel(function(e,n){var r=e.log(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat())}}})}}),qd=Ds({log1p_:function(e){var t=rs(e,"x","log1p");return Zi.engine.runKernel(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),Kd=Ds({logSigmoid_:function(e){var t=rs(e,"x","logSigmoid");return Zi.engine.runKernel(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),$d=Ds({neg_:function(e){var t=rs(e,"x","neg");return Zi.engine.runKernel(function(e){return e.neg(t)},{$x:t},function(e){return{$x:function(){return e.neg()}}})}}),Xd=Ds({reciprocal_:function(e){var t=rs(e,"x","reciprocal");return Zi.engine.runKernel(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),Yd=Ds({round_:function(e){var t=rs(e,"x","round");return Zi.engine.runKernel(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Xs(e)}}})}}),Qd=Ds({rsqrt_:function(e){var t=rs(e,"x","rsqrt");return Zi.engine.runKernel(function(e,n){var r=e.rsqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}})}}),Jd=Ds({sigmoid_:function(e){var t=rs(e,"x","sigmoid");return Zi.engine.runKernel(function(e,n){var r=e.sigmoid(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.mul(zs(1).sub(n)))}}})}}),Zd=Ds({sign_:function(e){var t=rs(e,"x","sign");return Zi.engine.runKernel(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Xs(e)}}})}}),ep=Ds({isNaN_:function(e){var t=rs(e,"x","isNaN");return Zi.engine.runKernel(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Xs(e)}}})}}),tp=Ds({isInf_:function(e){var t=rs(e,"x","isInf");return Zi.engine.runKernel(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Xs(e)}}})}}),np=Ds({isFinite_:function(e){var t=rs(e,"x","isFinite");return Zi.engine.runKernel(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Xs(e)}}})}}),rp=Ds({sin_:function(e){var t=rs(e,"x","sin");return Zi.engine.runKernel(function(e,n){var r=e.sin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cos().mul(e)}}})}}),op=Ds({sinh_:function(e){var t=rs(e,"x","sinh");return Zi.engine.runKernel(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),ap=Ds({softplus_:function(e){var t=rs(e,"x","softplus");return Zi.engine.runKernel(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),ip=Ds({sqrt_:function(e){var t=rs(e,"x","sqrt");return Zi.engine.runKernel(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),sp=Ds({square_:function(e){var t=rs(e,"x","square");return Zi.engine.runKernel(function(e,n){return n([t]),e.square(t)},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().mul(2))}}})}}),up=Ds({step_:function(e,t){void 0===t&&(t=0);var n=rs(e,"x","step");return Zi.engine.runKernel(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return Xs(e)}}})}}),lp=Ds({tan_:function(e){var t=rs(e,"x","tan");return Zi.engine.runKernel(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),cp=Ds({tanh_:function(e){var t=rs(e,"x","tanh");return Zi.engine.runKernel(function(e,n){var r=e.tanh(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return zs(1).sub(n.square()).mulStrict(e)}}})}});function fp(e,t,n,r,o,a){var i,s,u=rs(e,"x","batchNorm"),l=rs(t,"mean","batchNorm"),c=rs(n,"variance","batchNorm");return null!=o&&(i=rs(o,"scale","batchNorm")),null!=r&&(s=rs(r,"offset","batchNorm")),Aa(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Aa(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),Aa(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&Aa(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&Aa(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),hp(u,l,c,s,i,a)}function dp(e,t,n,r,o,a){var i,s,u=rs(e,"x","batchNorm"),l=rs(t,"mean","batchNorm"),c=rs(n,"variance","batchNorm");return null!=o&&(i=rs(o,"scale","batchNorm")),null!=r&&(s=rs(r,"offset","batchNorm")),Aa(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Aa(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),Aa(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&Aa(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&Aa(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),hp(u,l,c,s,i,a)}function pp(e,t,n,r,o,a){var i,s,u=rs(e,"x","batchNorm"),l=rs(t,"mean","batchNorm"),c=rs(n,"variance","batchNorm");return null!=o&&(i=rs(o,"scale","batchNorm")),null!=r&&(s=rs(r,"offset","batchNorm")),Aa(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),Aa(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),Aa(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&Aa(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&Aa(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),hp(u,l,c,s,i,a)}function hp(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u,l=rs(e,"x","batchNorm"),c=rs(t,"mean","batchNorm"),f=rs(n,"variance","batchNorm");return null!=o&&(i=rs(o,"scale","batchNorm")),null!=r&&(s=rs(r,"offset","batchNorm")),Aa(c.rank===f.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Aa(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Aa(null==i||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,Zi.engine.runKernel(function(e,t){var n=e.batchNormalization(u,vp(c),vp(f),a,vp(i),vp(s));return t([l,c,f,i]),n},{$x:l,$mean:c,$variance:f,$scale:i,$offset:s},function(e,t){var n=t[0],r=t[1],o=t[2],i=t[3],s=null==i?zs(1):i,l=fu(r.shape,u.shape),c=[];if(1===r.rank){for(var f=0;f<u.shape.length-1;++f)c.push(u.shape[f]);c.push(1)}var d=n.sub(r),p=e.mul(s),h=Qd(o.add(zs(a))),v=h.mul(h).mul(h).mul(zs(-.5));return{$x:function(){return 1===r.rank?e.mul(Ed(h.as4D(1,1,1,r.shape[0]),c)).mul(s).reshape(n.shape):e.mul(h).mul(s).reshape(n.shape)},$mean:function(){var e=h.mul(zs(-1)).mul(p);return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)},$variance:function(){var e=v.mul(d).mul(p);return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)},$scale:function(){var t=d.mul(h),n=e.mul(t);return 1===r.rank&&(n=n.sum(l)),n.reshape(r.shape)},$offset:function(){var t=e;return 1===r.rank&&(t=t.sum(l)),t.reshape(r.shape)}}}).reshape(l.shape)}function vp(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function mp(){Ji("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var gp=Ds({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),mp(),fp(e,t,n,a,o,r)}}),yp=Ds({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),mp(),dp(e,t,n,a,o,r)}}),bp=Ds({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),mp(),pp(e,t,n,a,o,r)}}),xp=Ds({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),mp(),hp(e,t,n,a,o,r)}}),wp=Ds({batchNorm_:hp}),Ep=Ds({batchNorm2d_:fp}),Cp=Ds({batchNorm3d_:dp}),Sp=Ds({batchNorm4d_:pp});function kp(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=Ip(t),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return Rp(e,s,n,r,o,a,!1,i)}function Rp(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3];if("channelsLast"===s)l=e[0],c=e[1],f=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],d=e[1],c=e[2],f=e[3]}var p,h=t[0],v=t[1],m=t[3],g=Ip(n),y=g[0],b=g[1],x=Ip(r),w=x[0],E=x[1],C=Tp(h,w),S=Tp(v,E),k=function(e,t,n,r,o,a,i,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,o,a){null==o&&(o=function(e,t,n,r){void 0===r&&(r=1);var o=Tp(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}(e,t,r));var i=e[0],s=e[1],u=Ap((i-t+2*o)/r+1,a);Aa(La(u),function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=Ap((s-t+2*o)/r+1,a);return Aa(La(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,n]}([t,n,1],a,1,r,e,s);l=f[0],c=f[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/o);var d=Math.max(0,(l-1)*r+a-t),p=Math.max(0,(c-1)*o+i-n),h=Math.floor(d/2),v=d-h,m=Math.floor(p/2);u={top:h,bottom:v,left:m,right:p-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,f,y,b,C,S,a),R=k.padInfo,_=k.outHeight,I=k.outWidth,N=i?m*d:m;return"channelsFirst"===s?p=[l,N,_,I]:"channelsLast"===s&&(p=[l,_,I,N]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:f,inChannels:d,outHeight:_,outWidth:I,outChannels:N,padInfo:R,strideHeight:y,strideWidth:b,filterHeight:h,filterWidth:v,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:E,inShape:e,outShape:p,filterShape:t}}function _p(e,t,n,r,o,a,i){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],f=s[3],d=s[4];if("channelsLast"===i)u=e[0],l=e[1],c=e[2],f=e[3],d=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);u=e[0],d=e[1],l=e[2],c=e[3],f=e[4]}var p,h=t[0],v=t[1],m=t[2],g=t[4],y=Np(n),b=y[0],x=y[1],w=y[2],E=Np(r),C=E[0],S=E[1],k=E[2],R=function(e,t,n,r,o,a,i,s,u,l){var c,f,d,p;if("same"===e){var h=((f=Math.ceil(t/o))-1)*o+s-t,v=((d=Math.ceil(n/a))-1)*a+u-n,m=((p=Math.ceil(r/i))-1)*i+l-r,g=Math.floor(h/2),y=h-g,b=Math.floor(v/2),x=v-b,w=Math.floor(m/2);c={top:b,bottom:x,left:w,right:m-w,front:g,back:y,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/o),d=Math.ceil((n-u+1)/a),p=Math.ceil((r-l+1)/i)}return{padInfo:c,outDepth:f,outHeight:d,outWidth:p}}(o,l,c,f,b,x,w,Tp(h,C),Tp(v,S),Tp(m,k)),_=R.padInfo,I=R.outDepth,N=R.outHeight,T=R.outWidth,A=a?g*d:g;return"channelsFirst"===i?p=[u,A,I,N,T]:"channelsLast"===i&&(p=[u,I,N,T,A]),{batchSize:u,dataFormat:i,inDepth:l,inHeight:c,inWidth:f,inChannels:d,outDepth:I,outHeight:N,outWidth:T,outChannels:A,padInfo:_,strideDepth:b,strideHeight:x,strideWidth:w,filterDepth:h,filterHeight:v,filterWidth:m,dilationDepth:C,dilationHeight:S,dilationWidth:k,inShape:e,outShape:p,filterShape:t}}function Ip(e){return"number"==typeof e?[e,e]:e}function Np(e){return"number"==typeof e?[e,e,e]:e}function Tp(e,t){return t<=1?e:e+(e-1)*(t-1)}function Ap(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Dp(e){var t=Ip(e),n=t[0],r=t[1];return 1===n&&1===r}function Op(e,t){return Dp(e)||Dp(t)}function Fp(e,t,n,r,o,a){Aa(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,s=t,u=!1;3===t.rank&&(u=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),i=[1,e[0],e[1],e[2]]);var l=i[3],c=s.shape[3];Aa(4===i.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+i.length+"."}),Aa(4===s.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),Aa(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}),Aa(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),Aa(c===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&Aa(La(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=Rp(i,n.shape,r,1,o,a),d=Zi.engine.runKernel(function(e,t){var r=e.conv2dDerInput(s,n,f);return t([n,s]),r},{dy4D:s,filter:n},function(e,t){var n=t[0],i=t[1];return{dy4D:function(){return Bp(e,n,r,o,"NHWC",1,a)},filter:function(){return Wp(e,i,n.shape,r,o,a)}}});return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Pp(e,t,n,r,o,a){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=t;3===s.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Aa(4===i.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+i.shape+"."}),Aa(4===s.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),Aa(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}),Aa(i.shape[3]===n[2],function(){return"Error in conv2dDerFilter: depth of input "+i.shape[3]+") must match input depth in filter ("+n[2]+"."}),Aa(s.shape[3]===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."}),null!=a&&Aa(La(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var u=Rp(i.shape,n,r,1,o,a);return Zi.engine.runKernel(function(e){return e.conv2dDerFilter(i,s,u)},{x4D:i,dy4D:s})}function Mp(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}var Lp=Ds({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=rs(e,"x","conv1d"),u=rs(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),Aa(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),Aa(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&Aa(La(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),Aa(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),Aa(Op(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),Aa("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),p=Bp(d,f,[1,n],r,"NHWC",[1,a],i);return c?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),Bp=Ds({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=rs(e,"x","conv2d"),u=rs(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Aa(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),Aa(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&Aa(La(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),Aa(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),Aa(Op(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),Aa("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var f=Rp(l.shape,u.shape,n,a,r,i),d=Zi.engine.runKernel(function(e,t){var n=e.conv2d(l,u,f);return t([u,l]),n},{x:l,$filter:u},function(e,t){var o=t,i=o[0],s=o[1];return Aa(Dp(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return Fp(s.shape,e,i,n,r)},$filter:function(){return Pp(s,e,i.shape,n,r)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),zp=Ds({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1,1]);var i=rs(e,"x","conv3d"),s=rs(t,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),Aa(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Aa(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),Aa(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),Aa(function(e,t){return Mp(e)||Mp(t)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),Aa("NHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported."});var c=_p(u.shape,s.shape,n,a,r),f=Zi.engine.runKernel(function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n},{x:u,$filter:s},function(e,t){Aa(Mp(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=t[0],i=t[1];return{x:function(){return function(e,t,n,r,o){Aa(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];Aa(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),Aa(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),Aa(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),Aa(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),Aa(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=_p(a,n.shape,r,1,o),f=Zi.engine.runKernel(function(e){return e.conv3dDerInput(i,n,c)},{dy5D:i});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),Aa(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),Aa(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),Aa(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),Aa(a.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."}),Aa(i.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=_p(a.shape,n,r,1,o);return Zi.engine.runKernel(function(e){return e.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Wp=Ds({conv2dDerFilter_:Pp}),Up=Ds({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=rs(e,"x","depthwiseConv2d"),u=rs(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Aa(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),Aa(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),Aa(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),Aa(Op(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&Aa(La(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f=Rp(l.shape,u.shape,n,a,r,i,!0),d=Zi.engine.runKernel(function(e,t){var n=e.depthwiseConv2D(l,u,f);return t([l,u]),n},{x:l,$filter:u},function(e,t){Aa(Dp(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var n=t[0],r=t[1];return{x:function(){return function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=Zi.engine.runKernel(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}(n.shape,e,r,f)},$filter:function(){return function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Zi.engine.runKernel(function(e){return e.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}(n,e,r.shape,f)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),jp=Ds({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=rs(e,"x","separableConv2d"),u=rs(t,"depthwiseFilter","separableConv2d"),l=rs(n,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(3===s.rank&&(f=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Aa(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),Aa(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),Aa(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),Aa(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),Aa(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],p=u.shape[3];Aa(l.shape[2]===d*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*p+", but got "+l.shape[2]+"."});var h=Up(c,u,r,o,i,a),v=Bp(h,l,1,"valid",i);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Vp=Ds({conv2dTranspose_:function(e,t,n,r,o,a){return Fp(n,rs(e,"x","conv2dTranspose"),rs(t,"filter","conv2dTranspose"),r,o,a)}});var Hp=Ds({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=rs(e,"a","matMul"),i=rs(t,"b","matMul");o=Fi(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],f=a.shape.slice(0,-2),d=i.shape.slice(0,-2),p=Pa(f),h=Pa(d);Aa(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),Aa(Ma(f,d),function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),Aa(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=a.shape.slice(0,-2).concat([l,c]),m=n?a.as3D(p,s,l):a.as3D(p,l,s),g=r?i.as3D(h,c,u):i.as3D(h,u,c);return Zi.engine.runKernel(function(e,t){var o=e.batchMatMul(m,g,n,r);return t([m,g]),o},{$a:m,$b:g},function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{$a:function(){return e.matMul(i,!1,!1)},$b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{$a:function(){return i.matMul(e,!1,!0)},$b:function(){return a.matMul(e,!1,!1)}}:{$a:function(){return i.matMul(e,!0,!0)},$b:function(){return e.matMul(a,!0,!0)}}:{$a:function(){return e.matMul(i,!1,!0)},$b:function(){return a.matMul(e,!0,!1)}}}).reshape(v)}}),Gp=Ds({dot_:function(e,t){var n=rs(e,"t1","dot"),r=rs(t,"t2","dot");Aa(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return Aa(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),qp=Ds({outerProduct_:function(e,t){var n=rs(e,"v1","outerProduct"),r=rs(t,"v2","outerProduct");return Aa(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}});var Kp=Ds({reverse_:function(e,t){var n=rs(e,"x","reverse");if(0===n.rank)return n.clone();var r=Va(t,n.shape);return Zi.engine.runKernel(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),$p=Ds({reverse1d_:function(e){var t=rs(e,"x","reverse");return Aa(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Kp(t,0)}}),Xp=Ds({reverse2d_:function(e,t){var n=rs(e,"x","reverse");return Aa(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Kp(n,t)}}),Yp=Ds({reverse3d_:function(e,t){var n=rs(e,"x","reverse");return Aa(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Kp(n,t)}}),Qp=Ds({reverse4d_:function(e,t){var n=rs(e,"x","reverse");return Aa(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Kp(n,t)}});function Jp(e,t,n,r,o,a){var i=rs(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),Aa(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Aa(Op(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=a&&Aa(La(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=kp(s.shape,t,n,r,o,a),c=Zi.engine.runKernel(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=rs(e,"dy","maxPoolBackprop"),l=rs(t,"input","maxPoolBackprop"),c=rs(n,"output","maxPoolBackprop");Aa(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),Aa(Op(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),Aa(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),Aa(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."}),null!=s&&Aa(La(i),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var f=kp(l.shape,r,o,a,i,s);return Zi.engine.runKernel(function(e){return e.maxPoolBackprop(u,l,c,f)},{$dy:u,$input:l})}(e,i,s,t,n,r,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Zp(e,t,n,r,o,a){var i=rs(e,"x","avgPool","float32");null==r&&(r=[1,1]),Aa(Op(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Aa(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&Aa(La(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=kp(s.shape,t,n,r,o,a),c=Zi.engine.runKernel(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,a){var i=rs(e,"dy","avgPoolBackprop"),s=rs(t,"input","avgPoolBackprop");Aa(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),Aa(Op(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Aa(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),Aa(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var f=kp(u.shape,n,r,o,a),d=Zi.engine.runKernel(function(e){return e.avgPoolBackprop(l,u,f)},{dy4D:l,input4D:u});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,o)}}});return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var eh=Ds({maxPool_:function(e,t,n,r,o){return Jp(e,t,n,1,r,o)}}),th=Ds({avgPool_:function(e,t,n,r,o){return Zp(e,t,n,1,r,o)}}),nh=Ds({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=rs(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Aa(Op(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=kp(s.shape,t,a,o,r),f=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([c.filterHeight,c.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],p=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),a=e.concat(r,o),i=t.map(function(e,t){return(e-a[t]%e)%e}),s=o.map(function(e,t){return e+i[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,i[t]]})]}([c.inHeight,c.inWidth],f,l),h=p[0],v=p[1],m=d?r:"valid",g=d?s:bd(s,f,h),y=("avg"===n?function(){return Zp(g,t,a,1,m)}:function(){return Jp(g,t,a,1,m)})(),b=d?y:td(y,f,v);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}});var rh=Ds({slice_:function(e,t,n){var r,o,a=rs(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice(),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(Aa(-1===e,function(){return"Bad value in size"}),a.shape[t]-r[t])}),function(e,t,n){Aa(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),Aa(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){Aa(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}(a,r,o);var i=a.shape;return Zi.engine.runKernel(function(e){return e.slice(a,r,o)},{$x:a},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{$x:function(){return e.pad(t)}}})}}),oh=Ds({slice1d_:function(e,t,n){var r=rs(e,"x","slice1d");return Aa(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),rh(r,[t],[n])}}),ah=Ds({slice2d_:function(e,t,n){var r=rs(e,"x","slice2d");return Aa(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),rh(r,t,n)}}),ih=Ds({slice3d_:function(e,t,n){var r=rs(e,"x","slice3d");return Aa(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),rh(r,t,n)}}),sh=Ds({slice4d_:function(e,t,n){var r=rs(e,"x","slice4d");return Aa(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),rh(r,t,n)}});function uh(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(gs(t.shape,r))),e.rank<n.rank&&(e=e.reshape(gs(e.shape,r))),{$x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var lh=Ds({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","all","bool"),o=Va(t,r.shape),a=o,i=bs(a,r.rank);null!=i&&(r=r.transpose(i),a=ws(a.length,r.rank));var s=Zi.engine.runKernel(function(e){return e.all(r,a)},{$x:r});if(n){var u=gs(s.shape,o);return s.reshape(u)}return s}}),ch=Ds({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","any","bool"),o=Va(t,r.shape),a=o,i=bs(a,r.rank);null!=i&&(r=r.transpose(i),a=ws(a.length,r.rank));var s=Zi.engine.runKernel(function(e){return e.any(r,a)},{$x:r});if(n){var u=gs(s.shape,o);return s.reshape(u)}return s}}),fh=Ds({argMax_:function(e,t){void 0===t&&(t=0);var n=rs(e,"x","argMax");null==t&&(t=0);var r=Va(t,n.shape),o=bs(r,n.rank);return null!=o&&(n=n.transpose(o),r=ws(r.length,n.rank)),Zi.engine.runKernel(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Xs(n)}}})}}),dh=Ds({argMin_:function(e,t){void 0===t&&(t=0);var n=rs(e,"x","argMin");null==t&&(t=0);var r=Va(t,n.shape),o=bs(r,n.rank);return null!=o&&(n=n.transpose(o),r=ws(r.length,n.rank)),Zi.engine.runKernel(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Xs(n)}}})}}),ph=Ds({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","logSumExp"),o=Va(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=gs(s.shape,o);return s.reshape(u)}return s}}),hh=Ds({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","max"),o=r,a=Va(t,r.shape),i=a,s=bs(i,r.rank);null!=s&&(r=r.transpose(s),i=ws(i.length,r.rank));var u=Zi.engine.runKernel(function(e,t){var n=e.max(r,i);return t([o,n]),n},{$x:r},function(e,t){return uh(e,t[1],t[0],a,s)});if(n){var l=gs(u.shape,a);u=u.reshape(l)}return u}}),vh=Ds({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","mean"),o=Va(t,r.shape),a=Pa(ms(r.shape,o)[1]);return as(function(e){var r=zs(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Hs(e.shape,"float32")).div(a)}}})(r)}}),mh=Ds({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","min"),o=r,a=Va(t,r.shape),i=a,s=bs(i,r.rank);null!=s&&(r=r.transpose(s),i=ws(i.length,r.rank));var u=Zi.engine.runKernel(function(e,t){var n=e.min(r,i);return t([o,n]),n},{$x:r},function(e,t){return uh(e,t[1],t[0],a,s)});if(n){var l=gs(u.shape,a);u=u.reshape(l)}return u}}),gh=Ds({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Va(t,(e=rs(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;return n||(a=gs(o.shape,r)),{mean:o,variance:e.toFloat().sub(o.reshape(a)).square().mean(r,n)}}}),yh=Ds({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=Va(t,r.shape);return as(function(e){var t=bs(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=ws(r.length,e.rank));var i=Zi.engine.runKernel(function(e){return e.sum(a,r)},{permutedX:a});if(n){var s=gs(i.shape,o);i=i.reshape(s)}return{value:i,gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Hs(e.shape,"float32"))}}})(r)}}),bh=Ds({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rs(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=Va(t,r.shape),a=bs(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=ws(i.length,r.rank));var u=Zi.engine.runKernel(function(e){return e.prod(s,i)},{permutedX:s});if(n){var l=gs(u.shape,o);u=u.reshape(l)}return u}});var xh=Ds({equal_:function(e,t){var n,r=rs(e,"a","equal"),o=rs(t,"b","equal");return n=Fi(r,o),r=n[0],o=n[1],du(r.shape,o.shape),Zi.engine.runKernel(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),wh=Ds({equalStrict_:function(e,t){var n=rs(e,"a","equalStrict"),r=rs(t,"b","equalStrict");return Da(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Eh=Ds({greater_:function(e,t){var n,r=rs(e,"a","greater"),o=rs(t,"b","greater");return n=Fi(r,o),r=n[0],o=n[1],du(r.shape,o.shape),Zi.engine.runKernel(function(e){return e.greater(r,o)},{$a:r,$b:o})}}),Ch=Ds({greaterEqual_:function(e,t){var n,r=rs(e,"a","greaterEqual"),o=rs(t,"b","greaterEqual");return n=Fi(r,o),r=n[0],o=n[1],du(r.shape,o.shape),Zi.engine.runKernel(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return Xs(n)},$b:function(){return Xs(r)}}})}}),Sh=Ds({greaterEqualStrict_:function(e,t){var n=rs(e,"a","greaterEqualStrict"),r=rs(t,"b","greaterEqualStrict");return Da(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),kh=Ds({greaterStrict_:function(e,t){var n=rs(e,"a","greaterStrict"),r=rs(t,"b","greaterStrict");return Da(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Rh=Ds({less_:function(e,t){var n,r=rs(e,"a","less"),o=rs(t,"b","less");return n=Fi(r,o),r=n[0],o=n[1],du(r.shape,o.shape),Zi.engine.runKernel(function(e){return e.less(r,o)},{$a:r,$b:o})}}),_h=Ds({lessEqual_:function(e,t){var n,r=rs(e,"a","lessEqual"),o=rs(t,"b","lessEqual");return n=Fi(r,o),r=n[0],o=n[1],du(r.shape,o.shape),Zi.engine.runKernel(function(e){return e.lessEqual(r,o)},{$a:r,$b:o})}}),Ih=Ds({lessEqualStrict_:function(e,t){var n=rs(e,"a","lessEqualStrict"),r=rs(t,"b","lessEqualStrict");return Da(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Nh=Ds({lessStrict_:function(e,t){var n=rs(e,"a","lessStrict"),r=rs(t,"b","lessStrict");return Da(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Th=Ds({notEqual_:function(e,t){var n,r=rs(e,"a","notEqual"),o=rs(t,"b","notEqual");return n=Fi(r,o),r=n[0],o=n[1],du(r.shape,o.shape),Zi.engine.runKernel(function(e){return e.notEqual(r,o)},{$a:r,$b:o})}}),Ah=Ds({notEqualStrict_:function(e,t){var n=rs(e,"a","notEqualStrict"),r=rs(t,"b","notEqualStrict");return Da(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});var Dh=Ds({add_:function(e,t){var n,r=rs(e,"a","add"),o=rs(t,"b","add");n=Fi(r,o),r=n[0],o=n[1];var a=du(r.shape,o.shape);return Zi.engine.runKernel(function(e){return e.add(r,o)},{$a:r,$b:o},function(e){return{$a:function(){var t=e,n=fu(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=fu(o.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)}}})}}),Oh=Ds({addN_:function(e){Aa(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Aa(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return rs(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Ma(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return Zi.engine.runKernel(function(e){return e.addN(t)},r,function(e){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n})}}),Fh=Ds({addStrict_:function(e,t){var n=rs(e,"a","addStrict"),r=rs(t,"b","addStrict");return Da(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Ph=Ds({atan2_:function(e,t){var n,r=rs(e,"a","atan2"),o=rs(t,"b","atan2");n=Fi(r,o),r=n[0],o=n[1];var a=du(r.shape,o.shape);return Zi.engine.runKernel(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Dh(n.square(),r.square()),o=e.mul(r.div(t)),i=fu(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=Dh(n.square(),r.square()),o=$d(e.mul(n.div(t))),i=fu(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),Mh=Ds({div_:function(e,t){var n,r=rs(e,"a","div"),o=rs(t,"b","div");if(n=Fi(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return Bh(r,o);var a=du(r.shape,o.shape);return Zi.engine.runKernel(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),o=fu(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=fu(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}})}}),Lh=Ds({divStrict_:function(e,t){var n=rs(e,"a","div"),r=rs(t,"b","div");return Da(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Bh=Ds({floorDiv_:function(e,t){var n,r=rs(e,"a","floorDiv"),o=rs(t,"b","floorDiv");n=Fi(r,o),r=n[0],o=n[1];var a=du(r.shape,o.shape);return Zi.engine.runKernel(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),o=fu(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=fu(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}})}}),zh=Ds({maximum_:function(e,t){var n,r=rs(e,"a","maximum"),o=rs(t,"b","maximum");return n=Fi(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),du(r.shape,o.shape),Zi.engine.runKernel(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.greaterEqual(r).toFloat())},$b:function(){return e.mul(n.less(r).toFloat())}}})}}),Wh=Ds({maximumStrict_:function(e,t){var n=rs(e,"a","maximumStrict"),r=rs(t,"b","maximumStrict");return Da(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Uh=Ds({minimum_:function(e,t){var n,r=rs(e,"a","minimum"),o=rs(t,"b","minimum");return n=Fi(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),du(r.shape,o.shape),Zi.engine.runKernel(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.lessEqual(r).toFloat())},$b:function(){return e.mul(n.greater(r).toFloat())}}})}}),jh=Ds({minimumStrict_:function(e,t){var n=rs(e,"a","minimumStrict"),r=rs(t,"b","minimumStrict");return Da(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Vh=Ds({mod_:function(e,t){var n,r=rs(e,"a","mod"),o=rs(t,"b","mod");n=Fi(r,o),r=n[0],o=n[1];var a=du(r.shape,o.shape);return Zi.engine.runKernel(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=fu(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=fu(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),Hh=Ds({modStrict_:function(e,t){var n=rs(e,"a","modStrict"),r=rs(t,"b","modStrict");return Da(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Gh=Ds({mul_:function(e,t){var n,r=rs(e,"a","mul"),o=rs(t,"b","mul");n=Fi(r,o),r=n[0],o=n[1];var a=du(r.shape,o.shape);return Zi.engine.runKernel(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.mul(r.toFloat()),o=fu(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=fu(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),qh=Ds({mulStrict_:function(e,t){var n=rs(e,"a","mul"),r=rs(t,"b","mul");return Da(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Kh=Ds({pow_:function(e,t){var n=rs(e,"base","pow"),r=rs(t,"exp","pow"),o=du(n.shape,r.shape);return e=n.cast(Di(n.dtype,r.dtype)),t=r.cast(Di(n.dtype,r.dtype)),Zi.engine.runKernel(function(e,t){var o=e.pow(n,r);return t([n,r,o]),o},{$base:n,$exp:r},function(e,t){var n=t[0],r=t[1],a=t[2];return{$base:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(zs(1))))),i=fu(n.shape,o);return i.length>0&&(a=a.sum(i)),a.reshape(n.shape)},$exp:function(){var t=n.greater(0),i=n.log().where(t,Xs(n)),s=e.mul(a.mul(i)),u=fu(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}})}}),$h=Ds({powStrict_:function(e,t){return Da(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Xh=Ds({squaredDifference_:function(e,t){var n,r=rs(e,"a","squaredDifference"),o=rs(t,"b","squaredDifference");return n=Fi(r,o),r=n[0],o=n[1],du(r.shape,o.shape),Zi.engine.runKernel(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1],o=zs(2);return{$a:function(){return e.mul(n.sub(r).mul(o))},$b:function(){return e.mul(r.sub(n).mul(o))}}})}}),Yh=Ds({squaredDifferenceStrict_:function(e,t){var n=rs(e,"a","squaredDifferenceStrict"),r=rs(t,"b","squaredDifferenceStrict");return Da(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Qh=Ds({sub_:function(e,t){var n,r=rs(e,"a","sub"),o=rs(t,"b","sub");n=Fi(r,o),r=n[0],o=n[1];var a=du(r.shape,o.shape);return Zi.engine.runKernel(function(e){return e.subtract(r,o)},{$a:r,$b:o},function(e){return{$a:function(){var t=e,n=fu(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=fu(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}})}}),Jh=Ds({subStrict_:function(e,t){var n=rs(e,"a","subStrict"),r=rs(t,"b","subStrict");return Da(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}});var Zh=Ds({logicalAnd_:function(e,t){var n=rs(e,"a","logicalAnd","bool"),r=rs(t,"b","logicalAnd","bool");return du(n.shape,r.shape),Zi.engine.runKernel(function(e){return e.logicalAnd(n,r)},{$a:n,$b:r})}}),ev=Ds({logicalNot_:function(e){var t=rs(e,"x","logicalNot","bool");return Zi.engine.runKernel(function(e){return e.logicalNot(t)},{$x:t})}}),tv=Ds({logicalOr_:function(e,t){var n=rs(e,"a","logicalOr","bool"),r=rs(t,"b","logicalOr","bool");return du(n.shape,r.shape),Zi.engine.runKernel(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),nv=Ds({logicalXor_:function(e,t){var n=rs(e,"a","logicalXor","bool"),r=rs(t,"b","logicalXor","bool");return du(n.shape,r.shape),tv(e,t).logicalAnd(Zh(e,t).logicalNot())}}),rv=Ds({where_:function(e,t,n){var r=rs(t,"a","where"),o=rs(n,"b","where"),a=rs(e,"condition","where","bool");return Da(r.shape,o.shape,"Error in where: "),1===a.rank?Aa(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Da(a.shape,o.shape,"Error in where: "),Zi.engine.runKernel(function(e,t){var n=e.select(a,r,o);return t([a]),n},{$condition:a,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return Xs(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),ov=function(e){return wa(this,void 0,void 0,function(){var t,n,r;return Ea(this,function(o){switch(o.label){case 0:return[4,(t=rs(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=Rd(t.shape,n),e!==t&&t.dispose(),[2,r]}})})};var av=Ds({elu_:function(e){var t=rs(e,"x","elu");return Zi.engine.runKernel(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return Zi.engine.runKernel(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),iv=Ds({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=rs(e,"x","leakyRelu");return zh(zs(t).mul(n),n)}}),sv=Ds({prelu_:function(e,t){var n=rs(e,"x","prelu"),r=rs(t,"alpha","prelu");return Zi.engine.runKernel(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{$x:n,$alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{$x:function(){return rv(o,e,e.mul(r))},$alpha:function(){var t=rv(o,Xs(e),e.mul(n)),a=fu(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}})}}),uv=Ds({relu_:function(e){var t=rs(e,"x","relu");return"bool"===t.dtype?t.toInt():Zi.engine.runKernel(function(e,n){var r=e.relu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n.step().toFloat())}}})}}),lv=Ds({selu_:function(e){var t=rs(e,"x","selu");return Zi.engine.runKernel(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(zs(0)),r=zs(wf),o=zs(Ef),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return rv(t,a,i)}}})}});var cv=Ds({transpose_:function(e,t){var n=rs(e,"x","transpose");return null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),Aa(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){Aa(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1?n.clone():Zi.engine.runKernel(function(e){return e.transpose(n,t)},{$x:n},function(e){var n=xs(t);return{$x:function(){return e.transpose(n)}}})}});var fv=Ds({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=rs(e,"x","localResponseNormalization");Aa(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),Aa(La(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=Zi.engine.runKernel(function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return Zi.engine.runKernel(function(a){return a.LRNGrad(e,i,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}});function dv(e,t,n){if(void 0===n&&(n=null),0===e.rank)return e.abs();if(1!==e.rank&&null===n)return dv(e.reshape([-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return e.abs().sum(n);if(t===1/0)return e.abs().max(n);if(t===-1/0)return e.abs().min(n);if("euclidean"===t||2===t)return e.abs().pow(zs(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}if(Array.isArray(n)&&2===n.length){if(1===t)return e.abs().sum(n[0]).max(n[1]-1);if(t===1/0)return e.abs().sum(n[1]).max(n[0]);if(t===-1/0)return e.abs().sum(n[1]).min(n[0]);if("fro"===t||"euclidean"===t)return e.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+n)}var pv=Ds({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=dv(e=rs(e,"x","norm"),t,n),a=o.shape;if(r){var i=Va(n,e.shape);a=gs(o.shape,i)}return o.reshape(a)}});function hv(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function vv(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var mv=Ds({gather_:function(e,t,n){void 0===n&&(n=0);var r=rs(e,"x","gather"),o=rs(t,"indices","gather","int32");n=Va(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return Zi.engine.runKernel(function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a},{$x:r},function(e,t){var o=t[0];return{$x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),l=u.length,c=hv(0,s),f=hv(s+1,s+1+l),d=vv([i,[a],u]),p=e.reshape(d),h=o.reshape([a]),v=vv([[s],c,f]),m=p.transpose(v),g=gv(m,h,r.shape[n]),y=xs(v);return g.transpose(y)}}}).reshape(a.outputShape)}}),gv=Ds({unsortedSegmentSum_:function(e,t,n){var r=rs(e,"x","unsortedSegmentSum"),o=rs(t,"segmentIds","unsortedSegmentSum","int32");return Aa(La(n),function(){return"numSegments must be of dtype int"}),Zi.engine.runKernel(function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=zh(t,Xs(t)),r=mv(e,n),o=Ch(t,zs(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=id(o,i+1);o=Zh(o,Hs(r.shape,"bool"));var s=Xs(r);return rv(o,r,s)}(e,n)}}})}});var yv=Ds({basicLSTMCell_:function(e,t,n,r,o,a){var i=rs(e,"forgetBias","basicLSTMCell"),s=rs(t,"lstmKernel","basicLSTMCell"),u=rs(n,"lstmBias","basicLSTMCell"),l=rs(r,"data","basicLSTMCell"),c=rs(o,"c","basicLSTMCell"),f=rs(a,"h","basicLSTMCell"),d=l.concat(f,1).matMul(s).add(u),p=d.shape[0],h=d.shape[1]/4,v=[p,h],m=d.slice([0,0],v),g=d.slice([0,h],v),y=d.slice([0,2*h],v),b=d.slice([0,3*h],v),x=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(i.add(y).sigmoid()));return[x,x.tanh().mulStrict(b.sigmoid())]}}),bv=Ds({multiRNNCell_:function(e,t,n,r){for(var o=rs(t,"data","multiRNNCell"),a=os(n,"c","multiRNNCell"),i=os(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var f=[],d=[];for(l=0;l<u.length;l+=2)f.push(u[l]),d.push(u[l+1]);return[f,d]}});var xv=Ds({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=rs(e,"v","movingAverage"),i=rs(t,"x","movingAverage"),s=rs(n,"decay","movingAverage");Pi(a,i),Aa(Ma(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=zs(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){Aa(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=rs(r,"step","movingAverage");c=c.div(u.sub(Kh(s,f)))}return a.add(c)}});var wv=Ds({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==i)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var l=rs(e,"x","stridedSlice");if(r.every(function(e){return 1===e})){var c=_s(l.shape,t,n,r,o,a,i,s,u),f=c[0],d=c[1],p=c[2],h=d.filter(function(e,t){return-1===p.indexOf(t)});return rh(l,f,d).reshape(h)}return Zi.engine.runKernel(function(e){return e.stridedSlice(l,t,n,r,o,a,i,s,u)},{$x:l})}});var Ev=Ds({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=rs(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=Zi.engine.runKernel(function(e){return e.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}});var Cv=Ds({scatterND_:function(e,t,n){var r=rs(e,"indices","scatterND","int32"),o=rs(t,"updates","scatterND");return ks(o,r,n),Zi.engine.runKernel(function(e){return e.scatterND(r,o,n)},{$indices:r,$updates:o})}});var Sv=Ds({fft_:function(e){Aa("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Zi.engine.runKernel(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),kv=Ds({ifft_:function(e){Aa("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Zi.engine.runKernel(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),Rv=Ds({rfft_:function(e){Aa("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.zerosLike(),o=Ps(e,r).as2D(n,t),a=Sv(o),i=Math.floor(t/2)+1,s=Ms(a),u=Ls(a),l=s.split([i,t-i],s.shape.length-1),c=u.split([i,t-i],u.shape.length-1),f=e.shape.slice();return f[e.shape.length-1]=i,Ps(l[0],c[0]).reshape(f)}}),_v=Ds({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=kv(r);return Ms(o)}var a=[n,2*(t-1)],i=Ms(e).as2D(n,t),s=Ls(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(zs(-1)),c=i.concat(u,1),f=s.concat(l,1);return r=Ps(c,f).as2D(a[0],a[1]),o=kv(r),Ms(o)}}),Iv=Object.freeze({fft:Sv,ifft:kv,rfft:Rv,irfft:_v});var Nv=Ds({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=rs(e,"sparseIndices","sparseToDense","int32"),a=rs(t,"sparseValues","sparseToDense"),i=rs(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),Zi.engine.runKernel(function(e){return e.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}});var Tv,Av=Ds({gatherND_:function(e,t){var n=rs(t,"indices","gatherND","int32"),r=rs(e,"x","gatherND");return Zi.engine.runKernel(function(e){return e.gatherND(r,n)},{$x:r,$indices:n})}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Tv||(Tv={}));var Dv=Ds({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Tv.SUM_BY_NONZERO_WEIGHTS);var o=rs(e,"labels","absoluteDifference"),a=rs(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=rs(n,"weights","absoluteDifference")),Da(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return Ov(s,i,r)}}),Ov=Ds({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Tv.SUM_BY_NONZERO_WEIGHTS);var r=rs(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=rs(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===Tv.NONE)return a;if(n===Tv.SUM)return a.sum();if(n===Tv.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(zs(i)):s}if(n===Tv.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(zs(r.size));var u=o.mul(Hs(r.shape)).notEqual(zs(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),Fv=Ds({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=Tv.SUM_BY_NONZERO_WEIGHTS);var a=rs(e,"labels","cosineDistance"),i=rs(t,"predictions","cosineDistance"),s=null;null!=r&&(s=rs(r,"weights","cosineDistance")),Da(a.shape,i.shape,"Error in cosineDistance: ");var u=zs(1).sub(a.mul(i).sum(n,!0));return Ov(u,s,o)}}),Pv=Ds({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Tv.SUM_BY_NONZERO_WEIGHTS);var o=rs(e,"labels","hingeLoss"),a=rs(t,"predictions","hingeLoss"),i=null;null!=n&&(i=rs(n,"weights","hingeLoss")),Da(o.shape,a.shape,"Error in hingeLoss: ");var s=zs(1);o=zs(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return Ov(u,i,r)}}),Mv=Ds({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=Tv.SUM_BY_NONZERO_WEIGHTS);var a=rs(e,"labels","huberLoss"),i=rs(t,"predictions","huberLoss"),s=null;null!=n&&(s=rs(n,"weights","huberLoss")),Da(a.shape,i.shape,"Error in huberLoss: ");var u=zs(r),l=i.sub(a).abs(),c=Uh(l,u),f=l.sub(c),d=zs(.5).mul(c.square()).add(u.mul(f));return Ov(d,s,o)}}),Lv=Ds({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Tv.SUM_BY_NONZERO_WEIGHTS);var a=rs(e,"labels","logLoss"),i=rs(t,"predictions","logLoss"),s=null;null!=n&&(s=rs(n,"weights","logLoss")),Da(a.shape,i.shape,"Error in logLoss: ");var u=zs(1),l=zs(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return Ov(c,s,o)}}),Bv=Ds({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Tv.SUM_BY_NONZERO_WEIGHTS);var o=rs(e,"labels","meanSquaredError"),a=rs(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=rs(n,"weights","meanSquaredError")),Da(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return Ov(s,i,r)}}),zv=Ds({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Tv.SUM_BY_NONZERO_WEIGHTS);var a=rs(e,"multiClassLabels","sigmoidCrossEntropy"),i=rs(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=rs(n,"weights","sigmoidCrossEntropy")),Da(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=zs(r),l=zs(1),c=zs(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var f=function(e,t){var n=rs(e,"labels","sigmoidCrossEntropyWithLogits"),r=rs(t,"logits","sigmoidCrossEntropyWithLogits");Da(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return Ov(f,s,o)}}),Wv=Ds({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Tv.SUM_BY_NONZERO_WEIGHTS);var a=rs(e,"onehotLabels","softmaxCrossEntropy"),i=rs(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=rs(n,"weights","softmaxCrossEntropy")),Da(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=zs(r),l=zs(1),c=zs(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return as(function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=gs(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(a,i);return Ov(f,s,o)}}),Uv=Object.freeze({get Reduction(){return Tv},absoluteDifference:Dv,computeWeightedLoss:Ov,cosineDistance:Fv,hingeLoss:Pv,huberLoss:Mv,logLoss:Lv,meanSquaredError:Bv,sigmoidCrossEntropy:zv,softmaxCrossEntropy:Wv});function jv(e,t){return void 0===t&&(t=!1),Zi.engine.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=sd(n),a=e.clone(),i=Us([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=o;t=Zi.engine.tidy(function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=l.sign().neg(),f=l.sub(c.mul(u)),d=t.div(f);s=1===d.shape[0]?i.clone():i.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var p=c.matMul(f).div(u).neg(),h=a.slice([e,0],[n-e,r]),v=p.mul(s);a=0===e?h.sub(v.matMul(s.transpose().matMul(h))):a.slice([0,0],[e,r]).concat(h.sub(v.matMul(s.transpose().matMul(h))),0);var m=o.slice([0,e],[n,o.shape[1]-e]);return o=0===e?m.sub(m.matMul(s).matMul(v.transpose())):o.slice([0,0],[n,e]).concat(m.sub(m.matMul(s).matMul(v.transpose())),1),[s,a,o]}),s=t[0],a=t[1],o=t[2],us([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var Vv=Ds({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,Aa(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){Aa(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=Vf(e,e.shape[0],0).map(function(e){return xd(e,[0])});Aa(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(e){a.push(Zi.engine.tidy(function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=yh(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(pv(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?wd(a,0):a}}),Hv=Ds({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return jv(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=[],o=[];return Sd(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0).forEach(function(e){var n=jv(e,t),a=n[0],i=n[1];r.push(a),o.push(i)}),[wd(r,0).reshape(e.shape),wd(o,0).reshape(e.shape)]}}),Gv=Object.freeze({gramSchmidt:Vv,qr:Hv});function qv(e,t,n,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var a=e.shape[0];return n=Math.min(n,a),Aa(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),Aa(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),Aa(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),Aa(1===t.rank,function(){return"scores must be a 1D tensor"}),Aa(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}var Kv=Ds({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=rs(e,"images","resizeBilinear");Aa(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),Aa(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Zi.engine.runKernel(function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return Zi.engine.runKernel(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),$v=Ds({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=rs(e,"images","resizeNearestNeighbor");Aa(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),Aa(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),Aa("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Zi.engine.runKernel(function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return Zi.engine.runKernel(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Xv=Ds({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=rs(e,"boxes","nonMaxSuppression"),i=rs(t,"scores","nonMaxSuppression"),s=qv(a,i,n,r,o);return n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,Zi.engine.runKernel(function(e){return e.nonMaxSuppression(a,i,n,r,o)},{$boxes:a})}}),Yv=function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),wa(this,void 0,void 0,function(){var a,i,s,u,l,c;return Ea(this,function(f){switch(f.label){case 0:return a=rs(e,"boxes","nonMaxSuppressionAsync"),i=rs(t,"scores","nonMaxSuppressionAsync"),s=qv(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,a.data()];case 1:return u=f.sent(),[4,i.data()];case 2:return l=f.sent(),c=ru(u,l,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,c]}})})},Qv=Ds({cropAndResize_:function(e,t,n,r,o,a){var i=rs(e,"image","cropAndResize","float32"),s=rs(t,"boxes","cropAndResize","float32"),u=rs(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return Aa(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),Aa(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),Aa(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),Aa(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),Aa(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),Aa("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),Zi.engine.runKernel(function(e,t){return e.cropAndResize(i,s,u,r,o,a)},{$image:i,$boxes:s})}}),Jv=Object.freeze({resizeBilinear:Kv,resizeNearestNeighbor:$v,nonMaxSuppression:Xv,nonMaxSuppressionAsync:Yv,cropAndResize:Qv});var Zv=Ds({matMul_:function(e,t,n,r,o,a){var i;void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a="linear");var s=rs(e,"a","fused matMul"),u=rs(t,"b","fused matMul");i=Fi(s,u),s=i[0],u=i[1];var l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],f=n?s.shape[s.rank-1]:s.shape[s.rank-2],d=r?u.shape[u.rank-2]:u.shape[u.rank-1],p=s.shape.slice(0,-2),h=u.shape.slice(0,-2),v=Pa(p),m=Pa(h);Aa(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),Aa(Ma(p,h),function(){return"Error in fused matMul: outer dimensions ("+p+") and ("+h+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),Aa(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var g,y=s.shape.slice(0,-2).concat([f,d]),b=n?s.as3D(v,l,f):s.as3D(v,f,l),x=r?u.as3D(m,d,c):u.as3D(m,c,d);null!=o&&du(y,(g=Fi(g=rs(o,"bias","fused matMul"),s)[0]).shape);var w={$a:b,$b:x};return null!=o&&(w.$bias=g),Zi.engine.runKernel(function(e,t){var o=e.fusedBatchMatMul(b,x,n,r,g,a);return t([b,x,o]),o},w,function(e,t){var i,s=t[0],u=t[1],l=t[2];if(null==a||"linear"===a)i=e;else{if("relu"!==a)throw new Error("Gradient for activation "+a+" has not been implemented yet.");i=e.mul(l.step())}var c={};return null!=o&&(c={$bias:function(){var e=i,t=fu(g.shape,i.shape);return t.length>0&&(e=e.sum(t)),e.reshape(g.shape)}}),n||r?!n&&r?Object.assign({$a:function(){return i.matMul(u,!1,!1)},$b:function(){return i.matMul(s,!0,!1)}},c):n&&!r?Object.assign({$a:function(){return u.matMul(i,!1,!0)},$b:function(){return s.matMul(i,!1,!1)}},c):Object.assign({$a:function(){return u.matMul(i,!0,!0)},$b:function(){return i.matMul(s,!0,!0)}},c):Object.assign({$a:function(){return i.matMul(u,!1,!0)},$b:function(){return s.matMul(i,!0,!1)}},c)}).reshape(y)}}),em=Object.freeze({matMul:Zv}),tm=Object.freeze({image:Jv,linalg:Gv,losses:Uv,spectral:Iv,fused:em,op:Ds,batchNormalization2d:gp,batchNormalization3d:yp,batchNormalization4d:bp,batchNormalization:xp,batchNorm:wp,batchNorm2d:Ep,batchNorm3d:Cp,batchNorm4d:Sp,complex:Ps,real:Ms,imag:Ls,concat:Bf,concat1d:zf,concat2d:Wf,concat3d:Uf,concat4d:jf,split:Vf,conv1d:Lp,conv2d:Bp,conv3d:zp,conv2dDerFilter:Wp,depthwiseConv2d:Up,separableConv2d:jp,conv2dTranspose:Vp,matMul:Hp,dot:Gp,outerProduct:qp,reverse:Kp,reverse1d:$p,reverse2d:Xp,reverse3d:Yp,reverse4d:Qp,maxPool:eh,avgPool:th,pool:nh,slice:rh,slice1d:oh,slice2d:ah,slice3d:ih,slice4d:sh,abs:Td,acos:Ad,acosh:Dd,asin:Od,asinh:Fd,atan:Pd,atanh:Md,ceil:Ld,clipByValue:Bd,cos:zd,cosh:Wd,erf:Ud,exp:jd,expm1:Vd,floor:Hd,log:Gd,log1p:qd,logSigmoid:Kd,neg:$d,reciprocal:Xd,round:Yd,rsqrt:Qd,sigmoid:Jd,sign:Zd,isNaN:ep,isInf:tp,isFinite:np,sin:rp,sinh:op,softplus:ap,sqrt:ip,square:sp,step:up,tan:lp,tanh:cp,all:lh,any:ch,argMax:fh,argMin:dh,logSumExp:ph,max:hh,mean:vh,min:mh,moments:gh,sum:yh,prod:bh,equal:xh,equalStrict:wh,greater:Eh,greaterEqual:Ch,greaterEqualStrict:Sh,greaterStrict:kh,less:Rh,lessEqual:_h,lessEqualStrict:Ih,lessStrict:Nh,notEqual:Th,notEqualStrict:Ah,add:Dh,addN:Oh,addStrict:Fh,atan2:Ph,div:Mh,divStrict:Lh,floorDiv:Bh,maximum:zh,maximumStrict:Wh,minimum:Uh,minimumStrict:jh,mod:Vh,modStrict:Hh,mul:Gh,mulStrict:qh,pow:Kh,powStrict:$h,squaredDifference:Xh,squaredDifferenceStrict:Yh,sub:Qh,subStrict:Jh,elu:av,leakyRelu:iv,prelu:sv,relu:uv,selu:lv,logicalAnd:Zh,logicalNot:ev,logicalOr:tv,logicalXor:nv,where:rv,whereAsync:ov,buffer:ed,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:td,cast:nd,clone:rd,cumsum:od,depthToSpace:ad,expandDims:id,eye:sd,multinomial:ud,oneHot:ld,pad:cd,pad1d:fd,pad2d:dd,pad3d:pd,pad4d:hd,rand:vd,randomNormal:md,randomUniform:gd,reshape:yd,spaceToBatchND:bd,squeeze:xd,stack:wd,tile:Ed,truncatedNormal:Cd,unstack:Sd,setdiff1dAsync:kd,fill:qs,linspace:function(e,t,n){if(0===n)throw new Error("Cannot request zero samples");var r=(t-e)/(n-1),o=ci(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return Ws(o,"float32")},ones:Hs,range:Ks,scalar:zs,tensor:Bs,tensor1d:Ws,tensor2d:Us,tensor3d:js,tensor4d:Vs,tensor5d:function(e,t,n){if(Oa(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=es(e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Bs(e,t=t||r,n)},tensor6d:function(e,t,n){if(Oa(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=es(e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Bs(e,t=t||r,n)},zeros:Gs,onesLike:$s,zerosLike:Xs,transpose:cv,softmax:Os,logSoftmax:Fs,localResponseNormalization:fv,norm:pv,gather:mv,unsortedSegmentSum:gv,basicLSTMCell:yv,multiRNNCell:bv,movingAverage:xv,stridedSlice:wv,topk:Ev,scatterND:Cv,fft:Sv,ifft:kv,rfft:Rv,irfft:_v,sparseToDense:Nv,gatherND:Av});var nm=function(){function e(){this.blockSize=48,this.firstUse=!0,Zi.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return e.prototype.setDataMover=function(e){this.data=new Ys(e)},e.prototype.register=function(e,t,n){if(this.firstUse&&(this.firstUse=!1,Zi.get("IS_NODE")&&ls("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:n})},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,r;if(Zi.get("IS_NODE")&&null==e.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=e.getContext)n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData)n=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),n=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(4===t)r=new Int32Array(n);else{var o=e.width*e.height;r=new Int32Array(o*t);for(var a=0;a<o;a++)for(var i=0;i<t;++i)r[a*t+i]=n[4*a+i]}return js(r,[e.height,e.width,t],"int32")},e.prototype.read=function(e){return wa(this,void 0,void 0,function(){return Ea(this,function(t){return[2,this.readSync(e)]})})},e.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Zs(r.real.dataSync(),r.imag.dataSync()):this.data.get(e).values},e.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},e.prototype.time=function(e){return wa(this,void 0,void 0,function(){var t;return Ea(this,function(n){return t=fi(),e(),[2,{kernelMs:fi()-t}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(e,t){var n=Si.make(e.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:Zi.engine.keep(e.clone()),imag:Zi.engine.keep(t.clone())},n},e.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},e.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&Aa("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})},e.prototype.slice=function(e,t,n){if(this.assertNotComplex(e,"slice"),Ts(e.shape,t,n)){var r=As(t,e.strides),o=Pa(n);return Bs(e.dataSync().subarray(r,r+o),n,e.dtype)}for(var a=ed(n,e.dtype),i=e.bufferSync(),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(e,n){return e+t[n]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){this.assertNotComplex(e,"stridedSlice");var l=_s(e.shape,t,n,r,o,a,i,s,u),c=l[0],f=l[1],d=l[2],p=f.filter(function(e,t){return-1===d.indexOf(t)});if(p.some(function(e){return 0===e}))return Bs([],p);for(var h=ed(f,e.dtype),v=e.bufferSync(),m=0;m<h.size;m++){for(var g=h.indexToLoc(m),y=new Array(g.length),b=0;b<y.length;b++)y[b]=g[b]*r[b]+c[b];h.set.apply(h,[v.get.apply(v,y)].concat(g))}return h.toTensor().reshape(p)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},e.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var n=ed(e.shape,e.dtype),r=e.bufferSync(),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},e.prototype.concat=function(e,t){this.assertNotComplex(e,"concat");var n=e.map(function(e){var n=Pa(e.shape.slice(t));return e.as2D(-1,n)}),r=Es(n.map(function(e){return e.shape}),1),o=ed(r,e[0].dtype).values;if(1===n[0].shape[0]){var a=0;n.forEach(function(e){o.set(e.dataSync(),a),a+=e.size})}else{var i=0;n.forEach(function(e){for(var t=e.dataSync(),n=0,a=0;a<e.shape[0];++a)for(var s=a*r[1]+i,u=0;u<e.shape[1];++u)o[s+u]=t[n++];i+=e.shape[1]})}var s=Es(e.map(function(e){return e.shape}),t);return Bs(o,s,e[0].dtype)},e.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(zs(-1),e)},e.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,Di(e.dtype,t.dtype),function(e,t){return e+t})},e.prototype.addN=function(e){this.assertNotComplex(e,"addN");for(var t=e.map(function(e){return e.dataSync()}),n=ed(e[0].shape,e[0].dtype),r=n.values,o=0;o<e.length;o++)for(var a=t[o],i=0;i<r.length;i++)r[i]+=a[i];return n.toTensor()},e.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,Di(e.dtype,t.dtype),function(e,t){return e-t})},e.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},e.prototype.batchMatMul=function(e,t,n,r){this.assertNotComplex([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=e.dataSync(),l=t.dataSync(),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=c[0],d=c[1],p=c[2],h=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=h[0],m=h[1],g=h[2],y=a*i,b=ed([s,a,i],e.dtype),x=b.values,w=this.blockSize,E=0;E<s;E++)for(var C=0;C<a;C+=w)for(var S=0;S<i;S+=w)for(var k=0;k<o;k+=w)for(var R=Math.min(C+w,a),_=Math.min(S+w,i),I=Math.min(k+w,o),N=C;N<R;N++)for(var T=S;T<_;T++){for(var A=0,D=k;D<I;D++)A+=u[E*f+N*d+D*p]*l[D*v+T*m+E*g];x[E*y+(N*i+T)]+=A}return b.toTensor()},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){var i=this.batchMatMul(e,t,n,r);return o&&(i=this.add(i,o)),a&&(i=function(e,t,n){if("linear"===t)return e.linear(n);if("relu"===t)return e.relu(n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}(this,a,i)),i},e.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,Di(e.dtype,t.dtype),function(e,t){return e*t})},e.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},e.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},e.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),ys("sum",t,e.rank);for(var n=ms(e.shape,t),r=n[0],o=n[1],a=Gs(r,Di(e.dtype,"int32")),i=Pa(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=0,d=0;d<i;++d)f+=u[c+d];s[l]=f}return a},e.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var n=ms(e.shape,t),r=n[0],o=n[1],a=Gs(r,Di(e.dtype,"int32")),i=Pa(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=1,d=0;d<i;++d)f*=u[c+d];s[l]=f}return a},e.prototype.unsortedSegmentSum=function(e,t,n){this.assertNotComplex(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=zs(a,"int32"),s=xh(i,t).asType("float32").mul(e).sum(0);r.push(s)}return wd(r)},e.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var n=[t];ys("argMin",n,e.rank);for(var r=ms(e.shape,n),o=r[0],a=r[1],i=Gs(o,"int32"),s=Pa(a),u=i.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var f=c*s,d=l[f],p=0,h=0;h<s;++h){var v=l[f+h];v<d&&(d=v,p=h)}u[c]=p}return i},e.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var n=[t];ys("argMax",n,e.rank);for(var r=ms(e.shape,n),o=r[0],a=r[1],i=Gs(o,"int32"),s=Pa(a),u=i.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var f=c*s,d=l[f],p=0,h=0;h<s;++h){var v=l[f+h];v>d&&(d=v,p=h)}u[c]=p}return i},e.prototype.cumsum=function(e,t,n,r){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=Di(e.dtype,"int32"),a=Gs(e.shape,o),i=a.dataSync(),s=e.dataSync(),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var f=0;f<u;f++){var d=l(c,f);if(0===f)i[d]=n?0:s[d];else{var p=l(c,f-1);i[d]=n?s[p]+i[p]:s[d]+i[p]}}return a},e.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},e.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},e.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},e.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},e.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},e.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},e.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return Si.make(e.shape,{values:n},"bool")},e.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},e.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},e.prototype.select=function(e,t,n){this.assertNotComplex([e,t,n],"select");for(var r=e.dataSync(),o=t.dataSync(),a=n.dataSync(),i=Gs(t.shape,Di(t.dtype,n.dtype)),s=i.dataSync(),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:t.shape[1],c=0;c<r.length;c++)for(var f=0;f<l;f++)1===r[c]?s[u++]=o[c]:s[u++]=a[c];return i},e.prototype.where=function(e){this.assertNotComplex([e],"where");var t=e.dataSync();return Rd(e.shape,t)},e.prototype.topk=function(e,t,n){return this.assertNotComplex(e,"topk"),iu(e.dataSync(),e.shape,e.dtype,t)},e.prototype.min=function(e,t){this.assertNotComplex(e,"min"),ys("min",t,e.rank);for(var n=ms(e.shape,t),r=n[0],o=n[1],a=Gs(r,e.dtype),i=Pa(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];p<f&&(f=p)}s[l]=f}return a},e.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},e.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},e.prototype.max=function(e,t){this.assertNotComplex(e,"max"),ys("max",t,e.rank);for(var n=ms(e.shape,t),r=n[0],o=n[1],a=Gs(r,e.dtype),i=Pa(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];p>f&&(f=p)}s[l]=f}return a},e.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},e.prototype.all=function(e,t){this.assertNotComplex(e,"all"),ys("all",t,e.rank);for(var n=ms(e.shape,t),r=n[0],o=n[1],a=Gs(r,e.dtype),i=Pa(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];f=f&&p}s[l]=f}return a},e.prototype.any=function(e,t){this.assertNotComplex(e,"any"),ys("any",t,e.rank);for(var n=ms(e.shape,t),r=n[0],o=n[1],a=Gs(r,e.dtype),i=Pa(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];f=f||p}s[l]=f}return a},e.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},e.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return Si.make(e.shape,{values:n})},e.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return Si.make(e.shape,{values:n})},e.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return Si.make(e.shape,{values:n})},e.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return Si.make(e.shape,{values:n},"bool")},e.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return Si.make(e.shape,{values:n},"bool")},e.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return Si.make(e.shape,{values:n},"bool")},e.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return Si.make(e.shape,{values:n})},e.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return Si.make(e.shape,{values:n})},e.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return Si.make(e.shape,{values:n})},e.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return Si.make(e.shape,{values:n})},e.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return Si.make(e.shape,{values:n})},e.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return Si.make(e.shape,{values:n})},e.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return Si.make(e.shape,{values:n})},e.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=o*o}return Si.make(e.shape,{values:n})},e.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return Si.make(e.shape,{values:n})},e.prototype.linear=function(e){return e},e.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=Gs(e.shape,e.dtype),n=t.dataSync(),r=e.dataSync(),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},e.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},e.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return Si.make(e.shape,{values:t})},e.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var n=new Float32Array(t.size),r=t.dataSync(),o=e.dataSync(),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return Si.make(t.shape,{values:n})},e.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=wf,n=Ef,r=new Float32Array(e.size),o=e.dataSync(),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?n*i:t*(Math.exp(i)-1)}return Si.make(e.shape,{values:r})},e.prototype.clip=function(e,t,n){this.assertNotComplex(e,"clip");for(var r=new Float32Array(e.size),o=e.dataSync(),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return Si.make(e.shape,{values:r})},e.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return Si.make(e.shape,{values:t})},e.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return Si.make(e.shape,{values:t})},e.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=n[r];return Si.make(e.shape,{values:t},"int32")},e.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return Si.make(e.shape,{values:t})},e.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return Si.make(e.shape,{values:n})},e.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return Si.make(e.shape,{values:t})},e.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return Si.make(e.shape,{values:t})},e.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return Si.make(e.shape,{values:t})},e.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return Si.make(e.shape,{values:t})},e.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return Si.make(e.shape,{values:t})},e.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return Si.make(e.shape,{values:t})},e.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},e.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return Si.make(e.shape,{values:t})},e.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return Si.make(e.shape,{values:t})},e.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Ba(n[r]);return Si.make(e.shape,{values:t})},e.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return Si.make(e.shape,{values:t})},e.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return Si.make(e.shape,{values:t})},e.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return Si.make(e.shape,{values:t})},e.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),n=e.dataSync(),r=vf,o=mf,a=gf,i=yf,s=bf,u=xf,l=0;l<n.length;++l){var c=n[l],f=1/(1+r*c);t[l]=1-((((u*f+s)*f+i)*f+a)*f+o)*f*Math.exp(-c*c)}return Si.make(e.shape,{values:t})},e.prototype.step=function(e,t){void 0===t&&(t=0),this.assertNotComplex(e,"step");for(var n=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return Si.make(e.shape,{values:n})},e.prototype.conv2d=function(e,t,n){this.assertNotComplex([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=ed(n.outShape,e.dtype),c=e.dataSync(),f=t.dataSync(),d=l.values,p=0;p<n.batchSize;++p)for(var h=p*e.strides[0],v=p*l.strides[0],m=0;m<n.outHeight;++m)for(var g=v+m*l.strides[1],y=m*n.strideHeight-s,b=0;b<r;b++){var x=y+b*a;if(!(x<0||x>=n.inHeight))for(var w=b*t.strides[0],E=h+x*e.strides[1],C=0;C<n.outWidth;++C)for(var S=g+C*n.outChannels,k=C*n.strideWidth-u,R=0;R<o;R++){var _=k+R*i;if(!(_<0||_>=n.inWidth))for(var I=w+R*t.strides[1],N=E+_*n.inChannels,T=I,A=0;A<n.inChannels;++A){for(var D=c[N+A],O=0;O<n.outChannels;++O)d[S+O]+=D*f[T+O];T+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,f=n.padInfo.top,d=ed(n.outShape,e.dtype),p=e.dataSync(),h=t.dataSync(),v=d.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*d.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*d.strides[1],w=b*n.strideDepth-l,E=0;E<r;E++){var C=w+E*i;if(!(C<0||C>=n.inDepth))for(var S=E*t.strides[0],k=g+C*e.strides[1],R=0;R<n.outHeight;++R)for(var _=x+R*d.strides[2],I=R*n.strideHeight-f,N=0;N<o;N++){var T=I+N*s;if(!(T<0||T>=n.inHeight))for(var A=S+N*t.strides[1],D=k+T*e.strides[2],O=0;O<n.outWidth;++O)for(var F=_+O*n.outChannels,P=O*n.strideWidth-c,M=0;M<a;M++){var L=P+M*u;if(!(L<0||L>=n.inWidth))for(var B=A+M*t.strides[2],z=D+L*n.inChannels,W=B,U=0;U<n.inChannels;++U){for(var j=p[z+U],V=0;V<n.outChannels;++V)v[F+V]+=j*h[W+V];W+=n.outChannels}}}}return d.toTensor()},e.prototype.conv2dDerInput=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerInput");for(var r=ed(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=e.dataSync(),c=e.strides,f=c[0],d=c[1],p=c[2],h=t.dataSync(),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,E=n.inChannels,C=n.inHeight,S=n.inWidth,k=n.outChannels,R=n.outHeight,_=n.outWidth,I=n.strideHeight,N=n.strideWidth,T=x-1-n.padInfo.top,A=w-1-n.padInfo.left,D=0;D<b;++D)for(var O=0;O<E;++O)for(var F=0;F<C;++F)for(var P=F-T,M=Math.max(0,Math.ceil(P/I)),L=Math.min(R,(x+P)/I),B=0;B<S;++B){for(var z=B-A,W=Math.max(0,Math.ceil(z/N)),U=Math.min(_,(w+z)/N),j=0,V=M;V<L;++V)for(var H=V*I-P,G=W;G<U;++G)for(var q=f*D+d*V+p*G,K=m*(x-1-H)+g*(w-1-(G*N-z))+y*O,$=0;$<k;++$)j+=l[q+$]*h[K+$];o[i*D+s*F+u*B+O]=j}return r.toTensor()},e.prototype.conv3dDerInput=function(e,t,n){for(var r=ed(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=e.dataSync(),f=e.strides,d=f[0],p=f[1],h=f[2],v=f[3],m=t.dataSync(),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],E=n.batchSize,C=n.filterDepth,S=n.filterHeight,k=n.filterWidth,R=n.inChannels,_=n.inDepth,I=n.inHeight,N=n.inWidth,T=n.outChannels,A=n.outDepth,D=n.outHeight,O=n.outWidth,F=n.strideDepth,P=n.strideHeight,M=n.strideWidth,L=C-1-n.padInfo.front,B=S-1-n.padInfo.top,z=k-1-n.padInfo.left,W=0;W<E;++W)for(var U=0;U<R;++U)for(var j=0;j<_;++j)for(var V=j-L,H=Math.max(0,Math.ceil(V/F)),G=Math.min(A,(C+V)/F),q=0;q<I;++q)for(var K=q-B,$=Math.max(0,Math.ceil(K/P)),X=Math.min(D,(S+K)/P),Y=0;Y<N;++Y){for(var Q=Y-z,J=Math.max(0,Math.ceil(Q/M)),Z=Math.min(O,(k+Q)/M),ee=0,te=H;te<G;++te)for(var ne=te*F-V,re=$;re<X;++re)for(var oe=re*P-K,ae=J;ae<Z;++ae)for(var ie=d*W+p*te+h*re+v*ae,se=y*(C-1-ne)+b*(S-1-oe)+x*(k-1-(ae*M-Q))+w*U,ue=0;ue<T;++ue)ee+=c[ie+ue]*m[se+ue];o[i*W+s*j+u*q+l*Y+U]=ee}return r.toTensor()},e.prototype.conv2dDerFilter=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=ed(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=e.bufferSync(),f=t.bufferSync(),d=0;d<a;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),h=Math.min(n.outHeight,(n.inHeight+l-d)/r),v=0;v<i;++v)for(var m=Math.max(0,Math.ceil((u-v)/o)),g=Math.min(n.outWidth,(n.inWidth+u-v)/o),y=0;y<n.inChannels;++y)for(var b=0;b<n.outChannels;++b){for(var x=0,w=0;w<n.batchSize;++w)for(var E=p;E<h;++E)for(var C=d+E*r-l,S=m;S<g;++S){var k=v+S*o-u;x+=c.get(w,C,k,y)*f.get(w,E,S,b)}s.set(x,d,v,y,b)}return s.toTensor()},e.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=ed(n.filterShape,"float32"),c=l.values,f=l.strides,d=f[0],p=f[1],h=f[2],v=f[3],m=t.dataSync(),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],E=e.dataSync(),C=e.strides,S=C[0],k=C[1],R=C[2],_=C[3],I=n.padInfo.front,N=n.padInfo.left,T=n.padInfo.top,A=0;A<i;++A)for(var D=Math.max(0,Math.ceil((I-A)/r)),O=Math.min(n.outDepth,(n.inDepth+I-A)/r),F=A*d,P=0;P<s;++P)for(var M=Math.max(0,Math.ceil((T-P)/o)),L=Math.min(n.outHeight,(n.inHeight+T-P)/o),B=P*p+F,z=0;z<u;++z)for(var W=Math.max(0,Math.ceil((N-z)/a)),U=Math.min(n.outWidth,(n.inWidth+N-z)/a),j=z*h+B,V=0;V<n.inChannels;++V)for(var H=V*v+j,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var $=K*S,X=K*y,Y=D;Y<O;++Y)for(var Q=(A+Y*r-I)*k+$,J=Y*b+X,Z=M;Z<L;++Z)for(var ee=(P+Z*o-T)*R+Q,te=Z*x+J,ne=W;ne<U;++ne){var re=ne*w+te;q+=E[(z+ne*a-N)*_+ee+V]*m[re+G]}c[H+G]=q}return l.toTensor()},e.prototype.depthwiseConv2D=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=ed(n.outShape,e.dtype),f=e.dataSync(),d=t.dataSync(),p=c.values,h=0;h<n.batchSize;++h)for(var v=h*e.strides[0],m=h*c.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*c.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var E=x*t.strides[0],C=v+w*e.strides[1],S=0;S<n.outWidth;++S)for(var k=y+S*c.strides[2],R=S*n.strideWidth-u,_=0;_<o;++_){var I=R+_*i;if(!(I<0||I>=n.inWidth))for(var N=E+_*t.strides[1],T=C+I*n.inChannels,A=k,D=N,O=0;O<n.inChannels;++O){for(var F=f[T+O],P=0;P<l;++P)p[A+P]+=F*d[D+P];A+=l,D+=l}}}return c.toTensor()},e.prototype.depthwiseConv2DDerInput=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var r=ed(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=e.dataSync(),c=e.strides,f=c[0],d=c[1],p=c[2],h=t.dataSync(),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,E=n.inChannels,C=n.inHeight,S=n.inWidth,k=n.outChannels,R=n.outHeight,_=n.outWidth,I=n.strideHeight,N=n.strideWidth,T=x-1-n.padInfo.top,A=w-1-n.padInfo.left,D=k/E,O=0;O<b;++O)for(var F=0;F<E;++F)for(var P=0;P<C;++P)for(var M=P-T,L=Math.max(0,Math.ceil(M/I)),B=Math.min(R,(x+M)/I),z=0;z<S;++z){for(var W=z-A,U=Math.max(0,Math.ceil(W/N)),j=Math.min(_,(w+W)/N),V=0,H=L;H<B;++H)for(var G=H*I-M,q=U;q<j;++q)for(var K=f*O+d*H+p*q,$=m*(x-1-G)+g*(w-1-(q*N-W))+y*F,X=0;X<D;++X)V+=l[K+(F*D+X)]*h[$+X];o[i*O+s*P+u*z+F]=V}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=ed(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,f=e.bufferSync(),d=t.bufferSync(),p=0;p<a;++p)for(var h=Math.max(0,Math.ceil((l-p)/r)),v=Math.min(n.outHeight,(n.inHeight+l-p)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/c),w=b%c,E=0,C=0;C<n.batchSize;++C)for(var S=h;S<v;++S)for(var k=p+S*r-l,R=g;R<y;++R){var _=m+R*o-u;E+=f.get(C,k,_,x)*d.get(C,S,R,b)}s.set(E,p,m,x,w)}return s.toTensor()},e.prototype.tile=function(e,t){this.assertNotComplex(e,"tile");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=ed(n,e.dtype),a=e.bufferSync();for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=i[u]%e.shape[u];var l=a.locToIndex(s);o.values[r]=a.values[l]}return o.toTensor()},e.prototype.pad=function(e,t,n){this.assertNotComplex(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),a=e.bufferSync(),i=ed(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map(function(e,t){return e+o[t]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},e.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var o=e.dataSync(),a=ed(n,e.dtype),i=e.bufferSync();for(r=0;r<e.size;++r){for(var s=i.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[t[l]];var c=a.locToIndex(u);a.values[c]=o[r]}return a.toTensor()},e.prototype.gather=function(e,t,n){this.assertNotComplex([e,t],"gather");var r=e.shape.slice(),o=t.dataSync();r[n]=o.length;for(var a=ed(r,e.dtype),i=e.bufferSync(),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},e.prototype.batchToSpaceND=function(e,t,n){this.assertNotComplex([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=cs(e.shape,t,r),a=fs(o.length,t.length),i=ds(e.shape,t,r),s=ps(n,t.length),u=hs(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){this.assertNotComplex([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=cs(i.shape,t,r,!1),u=fs(s.length,t.length,!1),l=ds(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.pool=function(e,t,n){this.assertNotComplex(e,"pool");for(var r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=e.dataSync(),p=ed(t.outShape,e.dtype),h=p.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*v,x=y*e.strides[0],w=0;w<t.inChannels;++w)for(var E=0;E<t.outHeight;++E)for(var C=E*r-l,S=Math.max(0,C),k=Math.min(t.inHeight,s+C),R=b+E*m,_=0;_<t.outWidth;++_){for(var I=_*o-c,N=Math.max(0,I),T=Math.min(t.inWidth,u+I),A=f,D=0,O=0,F=S;F<k;F+=a){for(var P=x+F*e.strides[1],M=N;M<T;M+=i){var L=d[P+M*e.strides[2]+w];"max"===n&&L>A?A=L:"avg"===n&&(D+=L,O++)}if(isNaN(A))break}h[R+_*g+w]="avg"===n?D/O:A}return p.toTensor()},e.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},e.prototype.maxPoolPositions=function(e,t){for(var n=ed(t.outShape,"int32"),r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,f=e.bufferSync(),d=0;d<t.batchSize;++d)for(var p=0;p<t.inChannels;++p)for(var h=0;h<t.outHeight;++h){for(var v=h*r-l,m=v;m<0;)m+=a;for(var g=Math.min(t.inHeight,s+v),y=0;y<t.outWidth;++y){for(var b=y*o-c,x=b;x<0;)x+=i;for(var w=Math.min(t.inWidth,u+b),E=Number.NEGATIVE_INFINITY,C=-1,S=m;S<g;S+=a)for(var k=S-v,R=x;R<w;R+=i){var _=R-b,I=f.get(d,S,R,p);I>E&&(E=I,C=k*u+_)}n.set(C,d,h,y,p)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(e,t,n,r){this.assertNotComplex([t,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,r),a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,f=c-1-r.padInfo.left,d=l-1-r.padInfo.top,p=ed(t.shape,"float32"),h=o.bufferSync(),v=e.bufferSync(),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-d,w=b-f,E=0,C=0;C<l;C+=s){var S=(x+C)/a;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var R=(w+k)/i;if(!(R<0||R>=r.outWidth||Math.floor(R)!==R)){var _=l*c-1-h.get(m,S,R,g)===C*c+k?1:0;0!==_&&(E+=v.get(m,S,R,g)*_)}}}p.set(E,m,y,b,g)}return p.toTensor()},e.prototype.avgPoolBackprop=function(e,t,n){this.assertNotComplex([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,f=c-1-n.padInfo.left,d=l-1-n.padInfo.top,p=ed(t.shape,"float32"),h=1/(a*i),v=e.bufferSync(),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-d,w=b-f,E=0,C=0;C<l;C+=s){var S=(x+C)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var R=(w+k)/o;R<0||R>=n.outWidth||Math.floor(R)!==R||(E+=v.get(m,S,R,g))}}p.set(E*h,m,y,b,g)}return p.toTensor()},e.prototype.cast=function(e,t){return Qs(e,t,this)},e.prototype.reshape=function(e,t){return Js(e,t)},e.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},e.prototype.resizeBilinear=function(e,t,n,r){this.assertNotComplex(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=e.dataSync(),c=new Float32Array(Pa([a,t,n,u])),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=0,h=f[0]/d[0],v=f[1]/d[1],m=0;m<a;m++)for(var g=0;g<t;g++)for(var y=h*g,b=Math.floor(y),x=y-b,w=Math.min(i-1,Math.ceil(y)),E=m*e.strides[0]+b*e.strides[1],C=m*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var k=v*S,R=Math.floor(k),_=k-R,I=Math.min(s-1,Math.ceil(k)),N=E+R*e.strides[2],T=C+R*e.strides[2],A=E+ +I*e.strides[2],D=C+I*e.strides[2],O=0;O<u;O++){var F=l[N+O],P=l[T+O],M=F+(l[A+O]-F)*_,L=M+(P+(l[D+O]-P)*_-M)*x;c[p++]=L}return Bs(c,[a,t,n,u])},e.prototype.resizeBilinearBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=[n&&l>1?a-1:a,n&&c>1?i-1:i],p=[n&&l>1?l-1:l,n&&c>1?c-1:c],h=d[0]/p[0],v=d[1]/p[1],m=e.dataSync(),g=0,y=0;y<o;y++)for(var b=y*t.strides[0],x=0;x<l;x++)for(var w=x*h,E=Math.floor(w),C=Math.min(Math.ceil(w),a-1),S=b+E*t.strides[1],k=b+C*t.strides[1],R=w-E,_=1-R,I=0;I<c;I++)for(var N=I*v,T=Math.floor(N),A=Math.min(Math.ceil(N),i-1),D=N-T,O=1-D,F=S+T*t.strides[2],P=S+A*t.strides[2],M=k+T*t.strides[2],L=k+A*t.strides[2],B=_*O,z=_*D,W=R*O,U=R*D,j=0;j<s;j++){var V=m[g++];f[F+j]+=V*B,f[P+j]+=V*z,f[M+j]+=V*W,f[L+j]+=V*U}return Vs(f,[o,i,a,s],t.dtype)},e.prototype.resizeNearestNeighbor=function(e,t,n,r){this.assertNotComplex(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=e.dataSync(),c=new Float32Array(a*t*n*u),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=f[0]/d[0],h=f[1]/d[1],v=0,m=0;m<a;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var b=p*y,x=g+Math.min(i-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var E=h*w,C=x+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],S=0;S<u;S++){var k=l[C+S];c[v++]=k}return Bs(c,[a,t,n,u],e.dtype)},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=e.dataSync(),p=[n&&l>1?a-1:a,n&&c>1?i-1:i],h=[n&&l>1?l-1:l,n&&c>1?c-1:c],v=p[0]/h[0],m=p[1]/h[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<o;w++)for(var E=w*t.strides[0],C=0;C<a;C++)for(var S=E+C*t.strides[1],k=Math.floor(C*g),R=Math.floor(k-b/2),_=0;_<i;_++)for(var I=S+_*t.strides[2],N=Math.floor(_*y),T=Math.floor(N-x/2),A=0;A<s;A++){for(var D=0,O=0;O<b;O++){var F=O+R;if(!(F<0||F>=l)){var P=E+F*e.strides[1],M=F*v;if(C===Math.min(a-1,n?Math.round(M):Math.floor(M)))for(var L=0;L<x;L++){var B=L+T;if(!(B<0||B>=c)){var z=P+B*e.strides[2],W=B*m;_===Math.min(i-1,n?Math.round(W):Math.floor(W))&&(D+=d[z+A])}}}}f[I+A]=D}return Vs(f,t.shape,t.dtype)},e.prototype.batchNormalization=function(e,t,n,r,o,a){this.assertNotComplex([e,t,n,o,a],"batchNorm");for(var i=e.dataSync(),s=t.dataSync(),u=n.dataSync(),l=o?o.dataSync():new Float32Array([1]),c=a?a.dataSync():new Float32Array([0]),f=new Float32Array(i.length),d=c.length,p=l.length,h=u.length,v=s.length,m=0,g=0,y=0,b=0,x=0;x<i.length;++x)f[x]=c[m++]+(i[x]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),m>=d&&(m=0),g>=v&&(g=0),y>=p&&(y=0),b>=h&&(b=0);return Vs(f,e.shape)},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=e.dataSync(),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var f=0;f<u;f++){var d=c(f),p=s[f]*Math.pow(n+r*d,-o);l[f]=p}return Vs(l,e.shape)},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){this.assertNotComplex(e,"LRNGrad");for(var s=e.shape[3],u=e.dataSync(),l=t.dataSync(),c=n.dataSync(),f=new Float32Array(e.size),d=e.size,p=0;p<d;p++){for(var h=p%s,v=p-h+Math.max(0,h-r),m=p-h+Math.min(s,h+r+1),g=0,y=v;y<m;y++)g+=Math.pow(l[y],2);for(g=a*g+o,y=v;y<m;y++){var b=-2*a*i*l[y]*c[p]/g;p===y&&(b+=Math.pow(g,-i)),b*=u[p],f[y]+=b}}return Vs(f,e.shape)},e.prototype.multinomial=function(e,t,n,r){this.assertNotComplex(e,"multinomial");for(var o=t?e:Os(e),a=o.shape[0],i=o.shape[1],s=Gs([a,n],"int32"),u=s.dataSync(),l=o.dataSync(),c=0;c<a;++c){var f=c*i,d=new Float32Array(i-1);d[0]=l[f];for(var p=1;p<d.length;++p)d[p]=d[p-1]+l[f+p];for(var h=Jf(r.toString()),v=c*n,m=0;m<n;++m){var g=h();u[v+m]=d.length;for(var y=0;y<d.length;y++)if(g<d[y]){u[v+m]=y;break}}}return s},e.prototype.oneHot=function(e,t,n,r){this.assertNotComplex(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=e.dataSync(),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return Us(o,[e.size,t],"int32")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return this.assertNotComplex(e,"nonMaxSuppression"),ru(e.dataSync(),t.dataSync(),n,r,o)},e.prototype.fft=function(e){return this.fftBatch(e,!1)},e.prototype.ifft=function(e){return this.fftBatch(e,!0)},e.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=ed(e.shape,"float32"),a=ed(e.shape,"float32"),i=Ms(e).as2D(n,r),s=Ls(e).as2D(n,r),u=0;u<n;u++)for(var l=i.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),f=Ps(l,c),d=this.fftImpl(f,t).dataSync(),p=0;p<r;p++){var h=eu(d,p);o.values[u*r+p]=h.real,a.values[u*r+p]=h.imag}return Ps(o.toTensor(),a.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=Ps(Ms(o).div(zs(r)),Ls(o).div(zs(r)))),o}var a=e.dataSync(),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return Ps(i.real,i.imag).as2D(e.shape[0],e.shape[1])},e.prototype.isExponentOf2=function(e){return 0==(e&e-1)},e.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=e.dataSync(),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=Ps(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=Ps(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=Ps(l.real,l.imag).mul(u),f=i.add(c),d=i.sub(c),p=Ms(f).concat(Ms(d)),h=Ls(f).concat(Ls(d));return Ps(p,h).as1D()},e.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=nu(o*s,t,n),l=eu(e,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}n&&(a/=t,i/=t),tu(r,a,i,o)}return r},e.prototype.depthToSpace=function(e,t,n){Aa("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),Aa(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,l=i/(t*t),c=e.dataSync(),f=new Float32Array(r*s*u*l),d=0,p=0;p<r;++p)for(var h=0;h<s;++h)for(var v=Math.floor(h/t),m=h%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(m*t+g%t)*l,x=0;x<l;++x){var w=x+b+i*(y+a*(v+o*p));f[d++]=c[w]}return Vs(f,[r,s,u,l])},e.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=du(e.shape,t.shape),a=ed(o,n),i=e.dataSync(),s=t.dataSync(),u=cu(e.shape,o),l=cu(t.shape,o),c=a.values;if(u.length+l.length===0)for(var f=0;f<c.length;++f)c[f]=r(i[f%i.length],s[f%s.length]);else{var d=e.bufferSync(),p=t.bufferSync(),h=function(n){var o=a.indexToLoc(n),f=o.slice(-e.rank);u.forEach(function(e){return f[e]=0});var h=d.locToIndex(f),v=o.slice(-t.rank);l.forEach(function(e){return v[e]=0});var m=p.locToIndex(v);c[n]=r(i[h],s[m])};for(f=0;f<c.length;++f)h(f)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=du(e.shape,t.shape),o=ed(r,"float32"),a=ed(r,"float32"),i=e.dataSync(),s=t.dataSync(),u=cu(e.shape,r),l=cu(t.shape,r),c=o.values,f=a.values;if(u.length+l.length===0)for(var d=0;d<c.length;d++){var p=d%i.length,h=d%s.length,v=n(i[2*p],i[2*p+1],s[2*h],s[2*h+1]);c[d]=v.real,f[d]=v.imag}else{var m=this.data.get(e.dataId).complexTensors.real.bufferSync(),g=this.data.get(t.dataId).complexTensors.real.bufferSync(),y=function(r){var a=o.indexToLoc(r),d=a.slice(-e.rank);u.forEach(function(e){return d[e]=0});var p=m.locToIndex(d),h=a.slice(-t.rank);l.forEach(function(e){return h[e]=0});var v=g.locToIndex(h),y=n(i[2*p],i[2*p+1],s[2*v],s[2*v+1]);c[r]=y.real,f[r]=y.imag};for(d=0;d<c.length;d++)y(d)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(e,t,n){return au(e,t,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],f=t.shape[0],d=r[0],p=r[1],h=ed([f,d,p,c],e.dtype),v=t.dataSync(),m=n.dataSync(),g=e.dataSync(),y=e.strides,b=h.strides,x=0;x<f;x++){var w=4*x,E=v[w],C=v[w+1],S=v[w+2],k=v[w+3],R=m[x];if(!(R>=s))for(var _=d>1?(S-E)*(u-1)/(d-1):0,I=p>1?(k-C)*(l-1)/(p-1):0,N=0;N<d;N++){var T=d>1?E*(u-1)+N*_:.5*(E+S)*(u-1);if(T<0||T>u-1)for(var A=0;A<p;A++)for(var D=0;D<c;D++){var O=D+A*b[2]+N*b[1]+x*b[0];h.values[O]=a}else if("bilinear"===o){var F=Math.floor(T),P=Math.ceil(T),M=T-F;for(A=0;A<p;A++)if((G=p>1?C*(l-1)+A*I:.5*(C+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],h.values[O]=a;else{var L=Math.floor(G),B=Math.ceil(G),z=G-L;for(D=0;D<c;D++){var W=g[O=D+L*y[2]+F*y[1]+R*y[0]],U=g[O=D+B*y[2]+F*y[1]+R*y[0]],j=g[O=D+L*y[2]+P*y[1]+R*y[0]],V=W+(U-W)*z,H=j+(g[O=D+B*y[2]+P*y[1]+R*y[0]]-j)*z;O=D+A*b[2]+N*b[1]+x*b[0],h.values[O]=V+(H-V)*M}}}else for(A=0;A<p;++A){var G;if((G=p>1?C*(l-1)+A*I:.5*(C+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],h.values[O]=a;else{var q=Math.round(G),K=Math.round(T);for(D=0;D<c;D++){var $=D+q*y[2]+K*y[1]+R*y[0],X=D+A*b[2]+N*b[1]+x*b[0];h.values[X]=g[$]}}}}}return h.toTensor()},e.prototype.sparseToDense=function(e,t,n,r){var o=Rs(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(e,t,n,l,s,i,a,u,r,!1)},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=Cs(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return Bs([],a,e.dtype);for(var l=new xi([i,s],e.dtype),c=t.dataSync(),f=e.dataSync(),d=0;d<i;d++){for(var p=[],h=0,v=0;v<r;v++){var m=c[d*r+v];h+=m*u[v],p.push(m)}if(h<0||h>=e.size/s)throw new Error("Invalid indices: "+p+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[d*s+g]=f[h*s+g]}return l.toTensor().reshape(a)},e.prototype.scatterND=function(e,t,n){var r=Rs(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=zs(0);return this.scatter(e,t,n,u,i,a,o,s,l,!0)},e.prototype.fill=function(e,t,n){var r=qa(n=n||ni(t),Pa(e));return r.fill(t),Si.make(e,{values:r},n)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){var t=qa(e.dtype,Pa(e.shape));return Si.make(e.shape,{values:t},e.dtype)},e.prototype.scatter=function(e,t,n,r,o,a,i,s,u,l){var c=[r/o,o],f=e.dataSync(),d=t.dataSync();if(0===r)return Bs([],n,t.dtype);var p=new xi(c,t.dtype);p.values.fill(u.dataSync()[0]);for(var h=0;h<a;h++){for(var v=[],m=0,g=0;g<i;g++){var y=f[h*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<o;b++)l?p.values[m*o+b]+=d[h*o+b]:p.values[m*o+b]=0===t.rank?d[0]:d[h*o+b]}return p.toTensor().reshape(n)},e}();Zi.registerBackend("cpu",function(){return new nm},1);"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;var rm={float32:4,int32:4,uint16:2,uint8:1,bool:1};function om(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=Pa(i),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=rm[l.dtype],f=e.slice(r,r+s*c),d="uint8"===l.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(d,function(e){return e*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(d,function(e){return Math.round(e*l.scale+l.min)})}r+=s*c}else{var p=rm[a];if(f=e.slice(r,r+s*p),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(f)}r+=s*p}var h=void 0;if("float32"===a)h=Bs(u,i,"float32");else if("int32"===a)h=Bs(u,i,"int32");else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);h=Bs(u,i,"bool")}n[o]=h},a=0,i=t;a<i.length;a++)o(i[a]);return n}function am(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var im="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function sm(e){return im?Buffer.byteLength(e):new Blob([e]).size}function um(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function lm(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function cm(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:sm(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:sm(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var fm=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),dm="://",pm=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){Aa(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(dm)&&(t=t.slice(0,t.indexOf(dm))),Aa(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();Aa(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function hm(e){if(-1===e.indexOf(dm))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+pm.getSchemes().join(","));return{scheme:e.split(dm)[0],path:e.split(dm)[1]}}function vm(e,t,n){return void 0===n&&(n=!1),wa(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f;return Ea(this,function(d){switch(d.label){case 0:return Aa(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),Aa((r=fm.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),Aa(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],Aa((a=fm.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),Aa(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=hm(e).scheme,u=hm(e).path,l=s===hm(e).scheme,[4,o.load()];case 1:return c=d.sent(),n&&l?[4,pm.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,i.save(c)];case 4:return f=d.sent(),!n||l?[3,6]:[4,pm.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var mm="tensorflowjs",gm="models_store",ym="model_info_store";function bm(){if(!Zi.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function xm(e){var t=e.result;t.createObjectStore(gm,{keyPath:"modelPath"}),t.createObjectStore(ym,{keyPath:"modelPath"})}var wm=function(){function e(e){if(this.indexedDB=bm(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return wa(this,void 0,void 0,function(){return Ea(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return wa(this,void 0,void 0,function(){return Ea(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open(mm,1);o.onupgradeneeded=function(){return xm(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(gm,"readonly"),s=i.objectStore(gm).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=cm(t),c=a.transaction(ym,"readwrite"),f=c.objectStore(ym),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:l});d.onsuccess=function(){var o=(u=a.transaction(gm,"readwrite")).objectStore(gm).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});o.onsuccess=function(){return e({modelArtifactsInfo:l})},o.onerror=function(e){var t=(f=c.objectStore(ym)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},d.onerror=function(e){return a.close(),r(d.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),Em=function(e){return Zi.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(wm.URL_SCHEME)?function(e){return new wm(e)}(e.slice(wm.URL_SCHEME.length)):null};fm.registerSaveRouter(Em),fm.registerLoadRouter(Em);var Cm=function(){function e(){this.indexedDB=bm()}return e.prototype.listModels=function(){return wa(this,void 0,void 0,function(){var e=this;return Ea(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open(mm,1);r.onupgradeneeded=function(){return xm(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(ym,"readonly"),a=o.objectStore(ym).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return wa(this,void 0,void 0,function(){var t=this;return Ea(this,function(n){return e=function(e){return e.startsWith(wm.URL_SCHEME)?e.slice(wm.URL_SCHEME.length):e}(e),[2,new Promise(function(n,r){var o=t.indexedDB.open(mm,1);o.onupgradeneeded=function(){return xm(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(ym,"readwrite"),s=i.objectStore(ym),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(gm,"readwrite")).objectStore(gm).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if(Zi.get("IS_BROWSER"))try{pm.registerManager(wm.URL_SCHEME,new Cm)}catch(yg){}var Sm="/",km="tensorflowjs_models",Rm="info",_m="model_topology",Im="weight_specs",Nm="weight_data",Tm="model_metadata";function Am(e){return{info:[km,e,Rm].join(Sm),topology:[km,e,_m].join(Sm),weightSpecs:[km,e,Im].join(Sm),weightData:[km,e,Nm].join(Sm),modelMetadata:[km,e,Tm].join(Sm)}}function Dm(e){var t=e.split(Sm);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Sm)}var Om=function(){function e(e){if(!Zi.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Am(this.modelPath)}return e.prototype.save=function(e){return wa(this,void 0,void 0,function(){var t,n,r;return Ea(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=cm(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){return im?Buffer.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return wa(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return Ea(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(im){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),Fm=function(e){return Zi.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Om.URL_SCHEME)?function(e){return new Om(e)}(e.slice(Om.URL_SCHEME.length)):null};fm.registerSaveRouter(Fm),fm.registerLoadRouter(Fm);var Pm=function(){function e(){Aa(Zi.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Aa(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return wa(this,void 0,void 0,function(){var e,t,n,r,o,a;return Ea(this,function(i){for(e={},t=km+Sm,n=Sm+Rm,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=Dm(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return wa(this,void 0,void 0,function(){var t,n;return Ea(this,function(r){if(e=function(e){return e.startsWith(Om.URL_SCHEME)?e.slice(Om.URL_SCHEME.length):e}(e),t=Am(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(Zi.get("IS_BROWSER"))try{pm.registerManager(Om.URL_SCHEME,new Pm)}catch(yg){}var Mm=function(){function e(t){if(!Zi.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return wa(this,void 0,void 0,function(){var t,n,r,o,a,i;return Ea(this,function(s){if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,a.click(),null!=e.weightData&&((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,i.click()),[2,{modelArtifactsInfo:cm(e)}]})})},e.URL_SCHEME="downloads://",e}(),Lm=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return wa(this,void 0,void 0,function(){var e,t,n=this;return Ea(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var c=[],f=[],d=[];u.forEach(function(e){e.paths.forEach(function(e){f.push(e),d.push(null)}),c.push.apply(c,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=f.indexOf(e);d[o]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:um(d)})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return lm(e.name)}),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach(function(e){var a=lm(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function Bm(e,t,n,r){!function(e){Aa(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){Aa(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),Aa(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),Aa(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var i=n+ ++o/e.length*(r-n);return t(i),a}),a}))}function zm(e,t){return wa(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return Ea(this,function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit)}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=f.sent(),[3,4];case 2:return[4,Bm(r,t.onProgress,o,a)];case 3:i=f.sent(),f.label=4;case 4:return s=i.map(function(e){return e.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=f.sent(),[3,8];case 6:return[4,Bm(s,t.onProgress,u,l)];case 7:c=f.sent(),f.label=8;case 8:return[2,c]}})})}function Wm(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),wa(t,void 0,void 0,function(){var t,a,i,s,u,l,c,f,d,p;return Ea(this,function(h){switch(h.label){case 0:if(t=n.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,l=rm[u]*Pa(e.shape),c=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=o?o.forEach(function(t,n){t===e.name&&(c(),i[n]=!0)}):c(),s.push(e.name),r+=l})}),!i.every(function(e){return e}))throw u=o.filter(function(e,t){return!i[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),c=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)})}),[4,e(c)];case 1:return f=h.sent(),d={},p=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=f[p+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,l=0;l<t;l++){var c=new Uint8Array(f[p+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(e){var t=om(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]}),p+=t}),[2,d]}})})}}fm.registerSaveRouter(function(e){return Zi.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Mm.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Mm(e)}(e.slice(Mm.URL_SCHEME.length)):null});var Um=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null==t.fetchFunc){var n=Zi.global.fetch;if(void 0===n)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");t.fetchFunc=n.bind(Zi.global)}else Aa("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(e,n){return t.fetchFunc(e,n).catch(function(t){throw new Error("Request for "+e+" failed due to error: "+t)})},Aa(null!=e&&e.length>0,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(e)&&Aa(2===e.length,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return wa(this,void 0,void 0,function(){var t,n,r,o;return Ea(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:cm(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return wa(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s;return Ea(this,function(u){switch(u.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(e=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,e.json()];case 3:return t=u.sent(),[3,5];case 4:throw u.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:s=u.sent(),a=s[0],i=s[1],u.label=7;case 7:return[2,{modelTopology:r,weightSpecs:a,weightData:i}]}})})},e.prototype.loadWeights=function(e){return wa(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f;return Ea(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,u=e;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],e.forEach(function(e){e.paths.forEach(function(e){c.push(a+e+o)})}),[4,zm(c,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[i,um(f)]]}})})},e.prototype.getFetchFunc=function(){return this.fetchFunc},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function jm(e){return null!=e.match(Um.URL_SCHEME_REGEX)}var Vm=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return jm(e)}):jm(e))?Hm(e,{onProgress:t}):null};function Hm(e,t){return new Um(e,t)}fm.registerSaveRouter(Vm),fm.registerLoadRouter(Vm);var Gm=function(){function e(e,t,n){this.modelTopology=e,this.weightSpecs=t,this.weightData=n}return e.prototype.load=function(){return wa(this,void 0,void 0,function(){var e;return Ea(this,function(t){return e={},null!=this.modelTopology&&(e=xa({modelTopology:this.modelTopology},e)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(e=xa({weightSpecs:this.weightSpecs},e)),null!=this.weightData&&this.weightData.byteLength>0&&(e=xa({weightData:this.weightData},e)),[2,e]})})},e}(),qm=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return wa(this,void 0,void 0,function(){return Ea(this,function(t){return[2,this.saveHandler(e)]})})},e}();Object.freeze({browserFiles:function(e){return new Lm(e)},browserHTTPRequest:Hm,concatenateArrayBuffers:um,decodeWeights:om,encodeWeights:function(e){return wa(this,void 0,void 0,function(){var t,n,r,o;return Ea(this,function(a){switch(a.label){case 0:for(r in t=[],n=[],e){if("float32"!==(o=e[r]).dtype&&"int32"!==o.dtype&&"bool"!==o.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+o.dtype);t.push({name:r,shape:o.shape,dtype:o.dtype}),n.push(o.data())}return[4,Promise.all(n)];case 1:return[2,{data:am(a.sent()),specs:t}]}})})},fromMemory:function(e,t,n){return new Gm(e,t,n)},getLoadHandlers:function(e,t){return fm.getLoadHandlers(e)},getModelArtifactsInfoForJSON:cm,getSaveHandlers:function(e){return fm.getSaveHandlers(e)},isHTTPScheme:jm,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),wa(this,void 0,void 0,function(){return Ea(this,function(o){return[2,Wm(function(e){return zm(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return fm.registerLoadRouter(e)},registerSaveRouter:function(e){return fm.registerSaveRouter(e)},weightsLoaderFactory:Wm,withSaveHandler:function(e){return new qm(e)},copyModel:function(e,t){return wa(this,void 0,void 0,function(){return Ea(this,function(n){switch(n.label){case 0:return[4,vm(e,t,!1)];case 1:return[2,n.sent()]}})})},listModels:function(){return wa(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return Ea(this,function(s){switch(s.label){case 0:e=pm.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,pm.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+dm+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return wa(this,void 0,void 0,function(){return Ea(this,function(n){switch(n.label){case 0:return[4,vm(e,t,!0)];case 1:return[2,n.sent()]}})})},removeModel:function(e){return wa(this,void 0,void 0,function(){var t;return Ea(this,function(n){switch(n.label){case 0:return t=hm(e),[4,pm.getManager(t.scheme).removeModel(t.path)];case 1:return[2,n.sent()]}})})}});var Km=Ds({confusionMatrix_:function(e,t,n){var r=rs(e,"labels","confusionMatrix"),o=rs(t,"predictions","confusionMatrix");Aa(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),Aa(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),Aa(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),Aa(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),Aa(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=ld(r.asType("int32"),n),i=ld(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}});Object.freeze({confusionMatrix:Km});var $m=Ds({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return Zi.engine.fromPixels(e,t)}}),Xm=Object.freeze({toPixels:function(e,t){return wa(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,h,v,m,g,y,b,x,w;return Ea(this,function(E){switch(E.label){case 0:if(n=rs(e,"img","toPixels"),e instanceof Si||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return s=n.min(),u=n.max(),[4,s.data()];case 1:return l=E.sent()[0],[4,u.data()];case 2:if(c=E.sent()[0],s.dispose(),u.dispose(),"float32"===n.dtype){if(l<0||c>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+l+" - "+c+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(l<0||c>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+l+" - "+c+"].")}return[4,n.data()];case 3:for(f=E.sent(),d="float32"===n.dtype?255:1,p=new Uint8ClampedArray(a*o*4),h=0;h<o*a;++h)v=void 0,m=void 0,g=void 0,y=void 0,1===i?(v=f[h]*d,m=f[h]*d,g=f[h]*d,y=255):3===i?(v=f[3*h]*d,m=f[3*h+1]*d,g=f[3*h+2]*d,y=255):4===i&&(v=f[4*h]*d,m=f[4*h+1]*d,g=f[4*h+2]*d,y=f[4*h+3]*d),p[0+(b=4*h)]=Math.round(v),p[b+1]=Math.round(m),p[b+2]=Math.round(g),p[b+3]=Math.round(y);return null!=t&&(t.width=a,t.height=o,x=t.getContext("2d"),w=new ImageData(p,a,o),x.putImageData(w,0,0)),n!==e&&n.dispose(),[2,p]}})})},fromPixels:$m}),Ym=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),Qm=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Jm(e){Aa(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),Aa("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),Aa(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Qm.register(e)}Object.freeze({Serializable:Ym,SerializationMap:Qm,registerClass:Jm});function Zm(e,t,n){return null==n&&(n=Zi.get("TEST_EPSILON")),eg(e,"number"==typeof t||"boolean"==typeof t?[t]:t,function(e,t){return tg(e,Number(t),n)})}function eg(e,t,n){if(e instanceof Si||t instanceof Si){if(e instanceof Si&&t instanceof Si){if(e.dtype!==t.dtype)throw new Error("Arrays are of different type actual: "+e.dtype+" vs expected: "+t.dtype+".");if(!Ma(e.shape,t.shape))throw new Error("Arrays are of different shape actual: "+e.shape+" vs expected: "+t.shape+".")}}else{var r=e.constructor.name,o=t.constructor.name;if(r!==o)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+o)}var a,i;if(a=e instanceof Si?e.dataSync():e,i=t instanceof Si?t.dataSync():t,a.length!==i.length)throw new Error("Arrays have different lengths actual: "+a.length+" vs expected: "+i.length+".\nActual:   "+a+".\nExpected: "+i+".");for(var s=0;s<i.length;++s){var u=a[s],l=i[s];if(!n(u,l))throw new Error("Arrays differ: actual["+s+"] = "+u+", expected["+s+"] = "+l+".\nActual:   "+a+".\nExpected: "+i+".")}}function tg(e,t,n){return!(!isNaN(e)||!isNaN(t))||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({WEBGL_ENVS:{HAS_WEBGL:!0},PACKED_ENVS:{WEBGL_PACK:!0},NODE_ENVS:{IS_NODE:!0},CHROME_ENVS:{IS_CHROME:!0},BROWSER_ENVS:{IS_BROWSER:!0},CPU_ENVS:{HAS_WEBGL:!1},ALL_ENVS:{},expectArraysClose:Zm,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return e instanceof Si&&"string"===e.dtype||t instanceof Si&&"string"===t.dtype||Array.isArray(e)&&Za(e[0])||Array.isArray(t)&&Za(t[0])?eg(e,n,function(e,t){return e==t}):Zm(e,t,0)},expectNumbersClose:function(e,t,n){if(null==n&&(n=Zi.get("TEST_EPSILON")),!tg(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){var r;r=e instanceof Si?e.dataSync():e;for(var o=0;o<r.length;o++)if(r[o]<t||r[o]>n)throw new Error("Value out of range:"+r[o]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:Dc,webgl_util:cc,MathBackendWebGL:Id,GPGPUContext:Oc});var ng=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ba(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;return this.applyGradients(a),Object.keys(a).forEach(function(e){return a[e].dispose()}),t?o:(o.dispose(),null)},t.prototype.computeGradients=function(e,t){return function(e,t){if(Aa(ri(e),function(){return"The f passed in variableGrads(f) must be a function"}),Aa(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof ki}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),null==t)for(var n in t=[],Zi.engine.registeredVariables)t.push(Zi.engine.registeredVariables[n]);var r=t.length;Aa((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable."});var o=Zi.engine.gradients(e,t,null,!0),a=o.value,i=o.grads;Aa(i.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Aa(0===a.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var s={};return t.forEach(function(e,t){null!=i[t]&&(s[e.name]=i[t])}),{value:a,grads:s}}(e,t)},t.prototype.dispose=function(){},t}(Ym);Object.defineProperty(ng,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var rg=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads={},o.accumulatedUpdates={},o.c=ss(zs(-t)),o.rhoScalar=ss(zs(n)),o.oneMinusRho=ss(zs(1-n)),null===r&&(r=Zi.get("EPSILON")),o.epsilonScalar=ss(zs(r)),o}return ba(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=Zi.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&is(function(){t.accumulatedGrads[n]=Xs(o).variable(!1)}),null==r.accumulatedUpdates[n]&&is(function(){t.accumulatedUpdates[n]=Xs(o).variable(!1)});var a=e[n],i=r.accumulatedGrads[n],s=r.accumulatedUpdates[n];is(function(){var e=t.rhoScalar.mul(i).add(t.oneMinusRho.mul(a.square())),r=s.add(t.epsilonScalar).sqrt().div(i.add(t.epsilonScalar).sqrt()).mul(a),u=t.rhoScalar.mul(s).add(t.oneMinusRho.mul(r.square()));t.accumulatedGrads[n].assign(e),t.accumulatedUpdates[n].assign(u);var l=t.c.mul(r).add(o);o.assign(l)})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(t){return e.accumulatedUpdates[t].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(t){return e.accumulatedGrads[t].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="AdadeltaOptimizer",t}(ng);Jm(rg);var og=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads={},r.c=ss(zs(-t)),r.epsilon=ss(zs(Zi.get("EPSILON"))),r}return ba(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=Zi.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&is(function(){t.accumulatedGrads[n]=qs(o.shape,t.initialAccumulatorValue).variable(!1)});var a=e[n],i=r.accumulatedGrads[n];is(function(){var e=i.add(a.square());t.accumulatedGrads[n].assign(e);var r=t.c.mul(a.div(e.add(t.epsilon).sqrt())).add(o);o.assign(r)})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){var e=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(t){return e.accumulatedGrads[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="AdagradOptimizer",t}(ng);Jm(og);var ag=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment={},a.accumulatedSecondMoment={},a.c=ss(zs(-t)),a.beta1Scalar=ss(zs(n)),a.beta2Scalar=ss(zs(r)),is(function(){a.accBeta1=zs(n).variable(),a.accBeta2=zs(r).variable()}),a.oneMinusBeta1=ss(zs(1-n)),a.oneMinusBeta2=ss(zs(1-r)),a.one=ss(zs(1)),null===o&&(o=Zi.get("EPSILON")),a.epsScalar=ss(zs(o)),a}return ba(t,e),t.prototype.applyGradients=function(e){var t=this;is(function(){var n=t.one.sub(t.accBeta1),r=t.one.sub(t.accBeta2);for(var o in e){var a=Zi.engine.registeredVariables[o];if(null==t.accumulatedFirstMoment[o]){var i=!1;t.accumulatedFirstMoment[o]=Xs(a).variable(i)}null==t.accumulatedSecondMoment[o]&&(i=!1,t.accumulatedSecondMoment[o]=Xs(a).variable(i));var s=e[o],u=t.accumulatedFirstMoment[o],l=t.accumulatedSecondMoment[o],c=t.beta1Scalar.mul(u).add(t.oneMinusBeta1.mul(s)),f=t.beta2Scalar.mul(l).add(t.oneMinusBeta2.mul(s.square())),d=c.div(n),p=f.div(r);t.accumulatedFirstMoment[o].assign(c),t.accumulatedSecondMoment[o].assign(f);var h=t.c.mul(d.div(t.epsScalar.add(p.sqrt()))).add(a);a.assign(h)}t.accBeta1.assign(t.accBeta1.mul(t.beta1Scalar)),t.accBeta2.assign(t.accBeta2.mul(t.beta2Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(t){return e.accumulatedFirstMoment[t].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(t){return e.accumulatedSecondMoment[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="AdamOptimizer",t}(ng);Jm(ag);var ig=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment={},i.accumulatedWeightedInfNorm={},i.c=ss(zs(-t)),i.beta1Scalar=ss(zs(n)),i.beta2Scalar=ss(zs(r)),i.decayScalar=ss(zs(a)),is(function(){i.iteration=zs(0).variable(),i.accBeta1=zs(n).variable()}),i.oneMinusBeta1=ss(zs(1-n)),i.one=ss(zs(1)),null===o&&(o=Zi.get("EPSILON")),i.epsScalar=ss(zs(o)),i}return ba(t,e),t.prototype.applyGradients=function(e){var t=this;is(function(){var n=t.one.sub(t.accBeta1),r=t.c.div(t.one.add(t.decayScalar.mul(t.iteration)));for(var o in e){var a=Zi.engine.registeredVariables[o];if(null==t.accumulatedFirstMoment[o]){var i=!1;t.accumulatedFirstMoment[o]=Xs(a).variable(i)}null==t.accumulatedWeightedInfNorm[o]&&(i=!1,t.accumulatedWeightedInfNorm[o]=Xs(a).variable(i));var s=e[o],u=t.accumulatedFirstMoment[o],l=t.accumulatedWeightedInfNorm[o],c=t.beta1Scalar.mul(u).add(t.oneMinusBeta1.mul(s)),f=t.beta2Scalar.mul(l),d=s.abs(),p=f.maximum(d);t.accumulatedFirstMoment[o].assign(c),t.accumulatedWeightedInfNorm[o].assign(p);var h=r.div(n).mul(c.div(t.epsScalar.add(p))).add(a);a.assign(h)}t.iteration.assign(t.iteration.add(t.one)),t.accBeta1.assign(t.accBeta1.mul(t.beta1Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(t){return e.accumulatedFirstMoment[t].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(t){return e.accumulatedWeightedInfNorm[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="AdamaxOptimizer",t}(ng);Jm(ig);var sg=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return ba(t,e),t.prototype.applyGradients=function(e){var t=this;Object.keys(e).forEach(function(n){var r=e[n],o=Zi.engine.registeredVariables[n];is(function(){var e=t.c.mul(r).add(o);o.assign(e)})})},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=ss(zs(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGDOptimizer",t}(ng);Jm(sg);var ug=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.m=zs(o.momentum),o.accumulations={},o}return ba(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=Zi.engine.registeredVariables[n];null==r.accumulations[n]&&is(function(){t.accumulations[n]=Xs(o).variable(!1)});var a=r.accumulations[n],i=e[n];is(function(){var e,r=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(r.mul(t.m))).add(o):t.c.mul(r).add(o),t.accumulations[n].assign(r),o.assign(e)})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){if(e.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var t in this.accumulations)this.accumulations[t].dispose()},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="MomentumOptimizer",t}(sg);Jm(ug);var lg=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;return i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares={},i.accumulatedMeanGrads={},i.accumulatedMoments={},i.c=ss(zs(t)),i.decayScalar=ss(zs(n)),i.momentumScalar=ss(zs(r)),i.oneMinusDecay=ss(zs(1-n)),i.centered=a,null===o&&(o=Zi.get("EPSILON")),i.epsilonScalar=ss(zs(o)),i}return ba(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=Zi.engine.registeredVariables[n];null==r.accumulatedMeanSquares[n]&&is(function(){t.accumulatedMeanSquares[n]=Xs(o).variable(!1)}),null==r.accumulatedMeanGrads[n]&&r.centered&&is(function(){t.accumulatedMeanGrads[n]=Xs(o).variable(!1)}),null==r.accumulatedMoments[n]&&is(function(){t.accumulatedMoments[n]=Xs(o).variable(!1)});var a=r.accumulatedMeanSquares[n],i=r.accumulatedMeanGrads[n],s=r.accumulatedMoments[n],u=e[n];is(function(){var e=t.decayScalar.mul(a).add(t.oneMinusDecay.mul(u.square()));if(t.centered){var r=t.decayScalar.mul(i).add(t.oneMinusDecay.mul(u)),l=t.momentumScalar.mul(s).add(t.c.mul(u).div(e.sub(r.square().add(t.epsilonScalar)).sqrt()));t.accumulatedMeanSquares[n].assign(e),t.accumulatedMeanGrads[n].assign(r),t.accumulatedMoments[n].assign(l);var c=o.sub(l);o.assign(c)}else{var f=t.decayScalar.mul(a).add(t.oneMinusDecay.mul(u.square()));l=t.momentumScalar.mul(s).add(t.c.mul(u).div(f.add(t.epsilonScalar).sqrt())),t.accumulatedMeanSquares[n].assign(f),t.accumulatedMoments[n].assign(l),c=o.sub(l),o.assign(c)}})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(t){return e.accumulatedMeanSquares[t].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(t){return e.accumulatedMeanGrads[t].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(t){return e.accumulatedMoments[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSPropOptimizer",t}(ng);Jm(lg);var cg=function(){function e(){}return e.sgd=function(e){return new sg(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new ug(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new lg(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new ag(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new rg(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new ig(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new og(e,t)},e}();cg.sgd,cg.momentum,cg.adadelta,cg.adagrad,cg.rmsprop,cg.adamax,cg.adam,Yi.setBackend,Yi.getBackend,Yi.disposeVariables,Yi.memory;!function(e){Ei=e}(tm);var fg=function(e,t){return fg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},fg(e,t)};function dg(e,t){function n(){this.constructor=e}fg(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var pg=function(){return pg=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},pg.apply(this,arguments)};function hg(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(yg){a(yg)}}function s(e){try{u(r.throw(e))}catch(yg){a(yg)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})}function vg(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(yg){a=[6,yg],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function mg(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}var gg=function(e,t){return(gg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function yg(e,t){function n(){this.constructor=e}gg(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function bg(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function xg(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var wg=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],o=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,o)})}},e}();function Eg(){return Cg}var Cg=null,Sg=new Map,kg=new Map;function Rg(e,t){var n=Ag(e,t);return Sg.get(n)}function _g(e){return kg.get(e)}function Ig(e){for(var t=Sg.entries(),n=[];;){var r=t.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===e&&n.push(s)}return n}function Ng(e){var t=e.kernelName,n=e.backendName,r=Ag(t,n);if(Sg.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");Sg.set(r,e)}function Tg(e){var t=e.kernelName;kg.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),kg.set(t,e)}function Ag(e,t){return t+"_"+e}function Dg(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function Og(e,t,n){return Math.max(e,Math.min(t,n))}function Fg(e){return e%2==0?e:e+1}function Pg(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function Mg(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Lg(e,t,n){void 0===n&&(n=""),Mg(Ug(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function Bg(e){Mg(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function zg(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||ty(e)&&!n)for(var r=0;r<e.length;++r)zg(e[r],t,n);else t.push(e);return t}function Wg(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Ug(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function jg(e){return e%1==0}function Vg(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Hg(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Gg(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function qg(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function Kg(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function $g(e,t){var n=t.length;return Mg((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),Mg(e.every(function(e){return jg(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function Xg(e,t){for(var n=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||o?null:$g(t,e).sort(),i=0,s=0;s<e.length;++s){if(null!=a){if(a[i]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[i]<=s&&i++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Yg(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Qg(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Jg(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Zg(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function ey(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function ty(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function ny(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function ry(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}function oy(e){return"string"==typeof e||e instanceof String}function ay(e){return"boolean"==typeof e}function iy(e){return"number"==typeof e}function sy(e){return Array.isArray(e)?sy(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":iy(e)?"float32":oy(e)?"string":ay(e)?"bool":"float32"}function uy(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ly(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function cy(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function fy(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=zg(e)),n&&Jg(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function dy(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[t+i];else{a=n[0];var s=n.slice(1),u=s.reduce(function(e,t){return e*t});for(i=0;i<a;i++)o[i]=e(t+i*u,s,r)}return o}(0,e,t)}function py(e,t){for(var n=hy(e,t),r=0;r<n.length;r++)n[r]=1;return n}function hy(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function vy(){return Eg().platform.now()}function my(e){e.forEach(function(t){Mg(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function gy(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",Eg().platform.encode(e,t)}function yy(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",Eg().platform.decode(e,t)}function by(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function xy(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}Object.freeze({shuffle:Dg,clamp:Og,nearestLargerEven:Fg,sum:Pg,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:Mg,assertShapesMatch:Lg,assertNonNull:Bg,flatten:zg,sizeFromShape:Wg,isScalarShape:function(e){return 0===e.length},arraysEqual:Ug,isInt:jg,tanh:Vg,sizeToSquarishShape:Hg,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return Dg(t),t},rightPad:Gg,repeatedTry:qg,inferFromImplicitShape:Kg,parseAxisParam:$g,squeezeShape:Xg,getTypedArrayFromDType:Yg,getArrayFromDType:Qg,checkConversionForErrors:Jg,isValidDtype:Zg,hasEncodingLoss:ey,isTypedArray:ty,bytesPerElement:ny,bytesFromStringArray:ry,isString:oy,isBoolean:ay,isNumber:iy,inferDtype:sy,isFunction:uy,nearestDivisor:ly,computeStrides:cy,toTypedArray:fy,toNestedArray:dy,makeOnesTypedArray:py,makeZerosTypedArray:hy,now:vy,assertNonNegativeIntegerDimensions:my,fetch:function(e,t){return Eg().platform.fetch(e,t)},encodeString:gy,decodeString:yy,locToIndex:by,indexToLoc:xy});var wy=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Ey)}return e.prototype.profileKernel=function(e,t,n){var r,o=this,a=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then(function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(e,n,r,a.kernelMs,t,i)})})}),r},e}(),Ey=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o,a){var i="number"==typeof r?Gg(r+"ms",9):r.error,s=Gg(e,25),u=t.rank,l=t.size,c=Gg(t.shape.toString(),14),f="";for(var d in o){var p=o[d].shape||t.shape,h=p.length;f+=d+": "+h+"D "+(h>0?p:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function Cy(e,t,n){return Gg(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":oy(e)?"'"+e+"'":"bool"===n?Sy(e):parseFloat(e.toFixed(7)).toString(),t)}function Sy(e){return 0===e?"false":"true"}function ky(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Ry=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=Wg(e),null!=n){var o=n.length;Mg(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Qg(t,this.size),this.strides=cy(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Mg(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return _y().makeTensor(this.values,this.shape,this.dtype)},e}(),_y=null,Iy=null,Ny=null,Ty=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Wg(e),this.strides=cy(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),Mg(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),Iy.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return bg(this,void 0,void 0,function(){var e;return xg(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Iy.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return Iy.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return bg(this,void 0,void 0,function(){var e;return xg(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,dy(this.shape,e)]}})})},e.prototype.arraySync=function(){return dy(this.shape,this.dataSync())},e.prototype.data=function(){return bg(this,void 0,void 0,function(){var e,t;return xg(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=_y().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(e){return yy(e)})]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=_y().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return yy(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return bg(this,void 0,void 0,function(){var e;return xg(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,_y().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(_y().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),Iy.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),Iy.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),Iy.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),Iy.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),Iy.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),Iy.clone(this)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var o=cy(t),a=function(e,t,n,r){var o=Wg(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?ky(e):e;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,f=0;f<a;f++)i[f]=Math.max(i[f],Cy(u[c+f],0,n).length);return i}(e,t,n,o),i=t.length,s=function e(t,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[Cy(ky(t)[0],0,r)]:"bool"===r?[Sy(t[0])]:[t[0].toString()];if(1===l){if(u>20){var c=3*s,f=Array.from(t.slice(0,c)),d=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(f=ky(f),d=ky(d)),["["+f.map(function(e,t){return Cy(e,a[t],r)}).join(", ")+", ..., "+d.map(function(e,t){return Cy(e,a[u-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?ky(t):Array.from(t)).map(function(e,t){return Cy(e,a[t],r)}).join(", ")+"]"]}var p=n.slice(1),h=o.slice(1),v=o[0]*s,m=[];if(u>20){for(var g=0;g<3;g++){var y=(b=g*v)+v;m.push.apply(m,e(t.slice(b,y),p,r,h,a,!1))}for(m.push("..."),g=u-3;g<u;g++)y=(b=g*v)+v,m.push.apply(m,e(t.slice(b,y),p,r,h,a,g===u-1))}else for(g=0;g<u;g++){var b;y=(b=g*v)+v,m.push.apply(m,e(t.slice(b,y),p,r,h,a,g===u-1))}var x=2===l?",":"";for(m[0]="["+m[0]+x,g=1;g<m.length-1;g++)m[g]=" "+m[g]+x;var w=",\n";for(g=2;g<l;g++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":w),m}(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Iy.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),Iy.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),Iy.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),Iy.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),Iy.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),Iy.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),Iy.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Iy.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),Iy.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),Iy.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),Ny("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Iy.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Iy.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Iy.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),Iy.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),Iy.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),Iy.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),Iy.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),Iy.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),Iy.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),Iy.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),Iy.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),Iy.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),Iy.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),Iy.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),Iy.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Iy.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),Iy.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Iy.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),Iy.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),Iy.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Iy.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),Iy.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Iy.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),Iy.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),Iy.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),Iy.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),Iy.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),Iy.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Iy.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),Iy.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Iy.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Iy.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Iy.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Iy.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),Iy.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),Iy.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),Iy.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),Iy.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),Iy.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),Iy.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),Iy.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),Iy.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),Iy.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),Iy.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),Iy.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),Iy.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),Iy.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),Iy.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),Iy.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),Iy.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),Iy.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),Iy.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),Iy.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),Iy.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Iy.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),Iy.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),Iy.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),Iy.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),Iy.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),Iy.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),Iy.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),Iy.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),Iy.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),Iy.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),Iy.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),Iy.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),Iy.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),Iy.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),Iy.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),Iy.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),Iy.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),Iy.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),Iy.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),Iy.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),Iy.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),Iy.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),Iy.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),Iy.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),Iy.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),Iy.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),Iy.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Iy.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Iy.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Iy.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Iy.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),Iy.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Iy.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),Iy.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Iy.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),Iy.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Iy.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Iy.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),Iy.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),Iy.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),_y().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Iy.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Iy.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Iy.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),Iy.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),Iy.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Iy.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),Iy.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),Iy.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),Iy.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),Iy.spectral.irfft(this)},e}();Object.defineProperty(Ty,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Ay,Dy,Oy,Fy,Py,My=function(e){function t(t,n,r,o){var a=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=n,a.name=r,a}return yg(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ug(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");_y().disposeTensor(this),this.dataId=e.dataId,_y().incRef(this,null)},t.prototype.dispose=function(){_y().disposeVariable(this),this.isDisposedInternal=!0},t}(Ty);Object.defineProperty(My,Symbol.hasInstance,{value:function(e){return e instanceof Ty&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ay||(Ay={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Dy||(Dy={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Oy||(Oy={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Fy||(Fy={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Py||(Py={}));var Ly={float32:Fy,int32:Dy,bool:Oy,complex64:Py};function By(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Ly[e][t]}function zy(e){return By(e,"int32")}function Wy(e,t){if(e.dtype===t.dtype)return[e,t];var n=By(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Uy(e,t){Mg(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function jy(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Ty)n.push(t);else if(o=t,Array.isArray(o)||"object"==typeof o){var o,a=t;for(var i in a){var s=a[i];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:Wy,assertTypesMatch:Uy,isTensorInList:function(e,t){return t.some(function(t){return t.id===e.id})},getTensorsInContainer:jy});var Vy,Hy=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Gy=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Hy}return e.prototype.ready=function(){return bg(this,void 0,void 0,function(){var e,t,n;return xg(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return bg(this,void 0,void 0,function(){var t,n,r;return xg(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new wy(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;Ig(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;Ig(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then(function(n){return!(o<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)}).catch(function(n){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,o=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(e){return{x:function(){return e.toFloat()}}},[],{}),t},e.prototype.runKernel=function(e,t,n,r,o){return this.runKernelFunc(null,t,null,e,n,r,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),o=0;n.forEach(function(e){o+="complex64"===e.dtype?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-t-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,o,a,i){var s,u=this,l=[],c=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,d=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var h,v=Rg(r,this.backendName);if(null!=v)f=function(){var e=u.backend.numDataIds();h=v.kernelFunc({inputs:t,attrs:o,backend:u.backend});var n=Array.isArray(h)?h:[h];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map(function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)});if(c){var f=u.getTensorsForGradient(r,t,s);if(null==f){null==i&&(i=[]);var d=s.filter(function(e,t){return i[t]});f=(a||[]).slice().concat(d)}l=u.saveTensorsForBackwardMode(f)}return s};else{var m=function(e){c&&(l=e.map(function(e){return u.keep(u.clone(e))}))};f=function(){var t=u.backend.numDataIds();h=u.tidy(function(){return e(u.backend,m)});var n=Array.isArray(h)?h:[h];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,function(){return f()}):f()}),c&&this.addTapeNode(r,t,s,n,l,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShapes:s.map(function(e){return e.shape})}),Array.isArray(h)?s:s[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map(function(e){return t.keep(t.clone(e))})},e.prototype.getTensorsForGradient=function(e,t,n){var r=_g(e);if(null!=r){var o=r.inputsToSave||[],a=r.outputsToSave||[],i=void 0;r.saveAllInputs?(Mg(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),i=Object.keys(t).map(function(e){return t[e]})):i=o.map(function(e){return t[e]});var s=n.filter(function(e,t){return a[t]});return i.concat(s)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=e;"string"===n&&oy(e[0])&&(o=e.map(function(e){return gy(e)}));var a=r.write(o,t,n),i=new Ty(t,n,a,this.nextTensorId());if(this.incRef(i,r),"string"===n){var s=this.state.tensorInfo.get(a),u=ry(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},e.prototype.makeTensorFromDataId=function(e,t,n,r){var o=new Ty(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,r),o},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var o=new My(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*ny(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof My||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return bg(this,void 0,void 0,function(){var t,n;return xg(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,o,a){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},u=_g(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],o=hy(r.size,r.dtype);return i.makeTensor(o,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],o,a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=jy(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==i.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),Mg(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});Mg(a instanceof Ty,function(){return"The result y returned by f() must be a tensor."});var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(h=e[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){h.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,o[h.id]=!0;break}if(l)break}}var f={};f[n.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(i=(h=e[a]).inputs,c=0;c<h.outputs.length;c++)if(f[h.outputs[c].id]){for(var s in i)f[i[s].id]=!0,d[h.id]=!0;break}var p=[];for(a=0;a<e.length;a++){var h;if(o[(h=e[a]).id]&&d[h.id]){var v={};for(var s in h.inputs){var m=h.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},h);g.inputs=v,g.outputs=h.outputs,p.push(g)}}return p}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[a.id]=null==n?(r=py(Wg(e=a.shape),"float32"),qy.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach(function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var i=o.gradient(a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n(function(){return i[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!Ug(r.shape,a.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(s,i,function(e){return o.tidy(e)});var u=t.map(function(e){return s[e.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()}),o.state.activeTape=null),{value:a,grads:u}})},e.prototype.customGrad=function(e){var t=this;return Mg(uy(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Mg(r.every(function(e){return e instanceof Ty}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return r.forEach(function(e,t){a[t]=e}),t.runKernelFunc(function(t,o){return Mg((n=e.apply(void 0,r.concat([o]))).value instanceof Ty,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Mg(uy(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];Mg(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Mg(a.every(function(e){return e instanceof Ty}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(e,t){i[t]=function(){return e}}),i})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return bg(this,void 0,void 0,function(){var t,n;return xg(this,function(r){switch(r.label){case 0:return t=vy(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=vy()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Hy,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),qy=function(){var e=function(){if(null==Vy){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Vy=e}return Vy}();if(null==e._tfengine){var t=new wg(e);e._tfengine=new Gy(t)}return function(e){Cg=e}(e._tfengine.ENV),_y=function(){return e._tfengine},e._tfengine}();function Ky(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var $y=Eg();$y.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),$y.registerFlag("IS_BROWSER",function(){return Ky()}),$y.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),$y.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),$y.registerFlag("PROD",function(){return!1}),$y.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return $y.getBool("DEBUG")}),$y.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),$y.registerFlag("IS_TEST",function(){return!1});var Xy,Yy,Qy,Jy={},Zy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function eb(e,t){Jy[e]=t}function tb(e){e in Jy||(Jy[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Jy[e]},!1),1===e?t.getContext("webgl",Zy)||t.getContext("experimental-webgl",Zy):t.getContext("webgl2",Zy)}(e));var t=Jy[e];return t.isContextLost()?(delete Jy[e],tb(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Jy[e])}function nb(e,t){return[t,e]}function rb(e){var t=Wg(e);return Hg(Math.ceil(t/4))}function ob(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function ab(e,t){var n,r,o,a,i,s,u,l,c,f=e;return 2===Eg().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,o=f.RGBA16F,a=f.RGBA32F,i=f.RED,s=4,u=1,l=f.HALF_FLOAT,c=f.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=f.RGBA,i=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function ib(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+ub(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Xy||(Xy={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Yy||(Yy={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Qy||(Qy={}));function sb(e){return!!(Eg().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function ub(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function lb(e,t,n){return Db(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function cb(e,t,n){var r=Db(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ib(e,t,function(){return e.shaderSource(r,n)}),ib(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function fb(e,t,n){var r=Db(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ib(e,t,function(){return e.shaderSource(r,n)}),ib(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=hb.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map(function(e,t){return Gg((t+1).toString(),a)+e}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),f=i.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+Gg(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var db,pb,hb=/ERROR: [0-9]+:([0-9]+):/g;function vb(e,t){return Db(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function mb(e,t,n){if(ib(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function gb(e,t,n){if(ib(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function yb(e,t,n){var r=Db(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ib(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),ib(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function bb(e,t,n){var r=Db(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ib(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),ib(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function xb(e,t){return Db(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function wb(e,t){var n=Eg().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Eb(e,t){return Db(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Cb(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(ib(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),ib(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),ib(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function Sb(e,t,n,r){Ob(e,r),ib(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),ib(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function kb(e,t,n,r){return Db(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function Rb(e,t,n){return e.getUniformLocation(t,n)}function _b(e,t,n,r,o,a){ib(e,t,function(){return Sb(e,t,r,a)}),ib(e,t,function(){return e.uniform1i(o,a)})}function Ib(e,t,n,r){ib(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),ib(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function Nb(e,t,n){ib(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),ib(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Tb(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Ab(e,t))}function Ab(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Db(e,t,n,r){var o=ib(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function Ob(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Fb(e,t){return void 0===t&&(t=2),Wg(e.slice(0,e.length-t))}function Pb(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Mb(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Fb(e)].concat(Pb(e))),t}function Lb(e,t){var n;void 0===t&&(t=!1);var r=Eg().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?Fg(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=Xg(e);e=o.newShape}var a=Wg(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=Fb(e),s=2,u=2;return e.length&&(s=(n=Pb(e))[0],u=n[1]),Hg(a=i*(s/2)*(u/2)).map(function(e){return 2*e})}return Hg(a)}function Bb(e){return e%2==0}function zb(e,t){if(Ug(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Bb(n)&&Bb(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Bb(e[0])&&Bb(t[0])}function Wb(e){if(null==db){var t=tb(e);db=t.getParameter(t.MAX_TEXTURE_SIZE)}return db}function Ub(e){if(null==pb){var t=tb(e);pb=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,pb)}function jb(e){if(0===e)return 0;var t=tb(e);return Vb(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Vb(t,"EXT_disjoint_timer_query")?1:0}function Vb(e,t){return null!=e.getExtension(t)}function Hb(e){try{if(null!=tb(e))return!0}catch(e){return!1}return!1}function Gb(e){if(0===e)return!1;var t=tb(e);if(1===e){if(!Vb(t,"OES_texture_float"))return!1}else if(!Vb(t,"EXT_color_buffer_float"))return!1;return Kb(t)}function qb(e){if(0===e)return!1;var t=tb(e);if(1!==e){if(Vb(t,"EXT_color_buffer_float"))return Kb(t);if(Vb(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=ab(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}(t,n)}return!1}return!!Vb(t,"OES_texture_float")&&!!Vb(t,"WEBGL_color_buffer_float")&&Kb(t)}function Kb(e){var t=ab(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function $b(e){return 2===e&&null!=tb(e).fenceSync}var Xb=Object.freeze({callAndCheck:ib,canBeRepresented:sb,getWebGLErrorMessage:ub,getExtensionOrThrow:lb,createVertexShader:cb,createFragmentShader:fb,createProgram:vb,linkProgram:mb,validateProgram:gb,createStaticVertexBuffer:yb,createStaticIndexBuffer:bb,getNumChannels:function(){return 2===Eg().getNumber("WEBGL_VERSION")?1:4},createTexture:xb,validateTextureSize:wb,createFramebuffer:Eb,bindVertexBufferToProgramAttribute:Cb,bindTextureUnit:Sb,unbindTextureUnit:function(e,t,n){Ob(e,n),ib(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),ib(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:kb,getProgramUniformLocation:Rb,bindTextureToProgramUniformSampler:_b,bindCanvasToFramebuffer:function(e,t){ib(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),ib(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),ib(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:Ib,unbindColorTextureFromFramebuffer:Nb,validateFramebuffer:Tb,getFramebufferErrorMessage:Ab,getBatchDim:Fb,getRowsCols:Pb,getShapeAs3D:Mb,getTextureShapeFromLogicalShape:Lb,isReshapeFree:zb,getWebGLMaxTextureSize:Wb,resetMaxTextureSize:function(){db=null},resetMaxTexturesInShader:function(){pb=null},getMaxTexturesInShader:Ub,getWebGLDisjointQueryTimerVersion:jb,hasExtension:Vb,isWebGLVersionEnabled:Hb,isCapableOfRenderingToFloatTexture:Gb,isDownloadFloatTextureEnabled:qb,isWebGLFenceEnabled:$b}),Yb=Eg();function Qb(e){Eg().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Jb(e,t){return qy.tidy(e,t)}function Zb(e){jy(e).forEach(function(e){return e.dispose()})}function ex(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Eg().getBool("IS_TEST")||console.warn.apply(console,e)}function tx(e,t){var n=e;if(ty(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||ty(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Eg().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||ty(t)){Mg(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),Mg(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var o=n.slice(1),a=0;a<t.length;++a)e(t[a],o,r.concat(a))}else Mg(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,r,[]),r}function nx(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function rx(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Ty)return nx(r,e.dtype,t,n),e;var o=sy(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),nx(r,o,t,n),null==e||!ty(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=tx(e,o);ty(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?fy(e,o,Eg().getBool("DEBUG")):zg(e,[],!0);return qy.makeTensor(s,i,o)}function ox(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return rx(e,t+"["+r+"]",n)},r)}function ax(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function ix(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}function sx(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function ux(e,t){return ix(e,t.map(function(e){return 1}),t)}function lx(e,t,n){Mg(ax(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function cx(e,t){if(ax(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function fx(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function dx(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function px(e,t){var n=e[0].length;e.forEach(function(e,t){Mg(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),Mg(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var a=0;a<n;a++)Mg(a===t||e[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function hx(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function vx(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];qy.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),qy.endScope(o),o}catch(e){throw qy.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Yb.registerFlag("HAS_WEBGL",function(){return Yb.getNumber("WEBGL_VERSION")>0}),Yb.registerFlag("WEBGL_VERSION",function(){return Hb(2)?2:Hb(1)?1:0}),Yb.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Yb.get("WEBGL_VERSION")}),Yb.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Yb.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Yb.registerFlag("WEBGL_PACK",function(){return Yb.getBool("HAS_WEBGL")}),Yb.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_PACK_CLIP",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Yb.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_PACK_REDUCE",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_CONV_IM2COL",function(){return Yb.getBool("WEBGL_PACK")}),Yb.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Wb(Yb.getNumber("WEBGL_VERSION"))}),Yb.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Ub(Yb.getNumber("WEBGL_VERSION"))}),Yb.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=Yb.getNumber("WEBGL_VERSION");return 0===e?0:jb(e)}),Yb.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Yb.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),Yb.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Gb(Yb.getNumber("WEBGL_VERSION"))}),Yb.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Yb.getBool("WEBGL_FORCE_F16_TEXTURES")&&Yb.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Yb.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return qb(Yb.getNumber("WEBGL_VERSION"))}),Yb.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return $b(Yb.getNumber("WEBGL_VERSION"))}),Yb.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Yb.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Ny=Qb;var mx=vx({complex_:function(e,t){var n=rx(e,"real","complex"),r=rx(t,"imag","complex");return Lg(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),qy.runKernelFunc(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),gx=vx({real_:function(e){var t=rx(e,"input","real");return qy.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),yx=vx({imag_:function(e){var t=rx(e,"input","imag");return qy.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function bx(e,t,n){return xx(e,t,tx(e,n),n)}function xx(e,t,n,r){if(null==r&&(r=sy(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ty(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){my(t);var o=Wg(t),a=Wg(n);Mg(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==Wg(t.slice(i));Mg(n[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return ty(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?fy(e,r,Eg().getBool("DEBUG")):zg(e,[],!0),qy.makeTensor(e,t,r)}function wx(e,t){if((ty(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&ty(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xx(e,[],[],t)}function Ex(e,t){Bg(e);var n=tx(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xx(e,null,n,t)}function Cx(e,t,n){if(Bg(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=tx(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xx(e,t,r,n)}function Sx(e,t,n){if(Bg(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=tx(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xx(e,t,r,n)}function kx(e,t,n){if(Bg(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=tx(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xx(e,t,r,n)}function Rx(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Rx(e,"float32"),r=_x(e,"float32");return mx(n,r)}var o=py(Wg(e),t);return qy.makeTensor(o,e,t)}function _x(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=_x(e,"float32"),r=_x(e,"float32");return mx(n,r)}var o=hy(Wg(e),t);return qy.makeTensor(o,e,t)}function Ix(e,t,n){return qy.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function Nx(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return _x([0],r);var o=hy(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return Ex(o,r)}var Tx=vx({onesLike_:function(e){var t=rx(e,"x","onesLike");if("complex64"===t.dtype){var n=Tx(gx(t)),r=Ax(yx(t));return mx(n,r)}return qy.runKernelFunc(function(e){return e.onesLike(t)},{x:t},function(e,t){return{x:function(){return Ax(e)}}},"OnesLike")}}),Ax=vx({zerosLike_:function(e){var t=rx(e,"x","zerosLike");return qy.runKernelFunc(function(e){return e.zerosLike(t)},{x:t},function(e,t){return{x:function(){return Ax(e)}}},"ZerosLike")}}),Dx=vx({concat_:function(e,t){void 0===t&&(t=0),Mg(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=ox(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")}),t=$g(t,n[0].shape)[0];var r=hx(n.map(function(e){return e.shape}),t);if(0===Wg(r))return bx([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});px(o,t);var a=n,i={axis:t};return qy.runKernelFunc(function(e){return e.concat(n,t)},a,function(e){var n=o.map(function(e){return e[t]});return Lx(e,n,t).map(function(e){return function(){return e}})},"Concat",i)}}),Ox=vx({concat1d_:function(e){return Dx(e,0)}}),Fx=vx({concat2d_:function(e,t){return Dx(e,t)}}),Px=vx({concat3d_:function(e,t){return Dx(e,t)}}),Mx=vx({concat4d_:function(e,t){return Dx(e,t)}}),Lx=vx({split_:function(e,t,n){void 0===n&&(n=0);var r,o=rx(e,"x","split");return n=$g(n,o.shape)[0],"number"==typeof t?(Mg(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(Mg(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),qy.runKernelFunc(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return Dx(e,n)}}})}});function Bx(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",my(e),new Ry(e,t,n)}var zx=vx({batchToSpaceND_:function(e,t,n){var r=rx(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return Mg(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),Mg(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),Mg(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),qy.runKernelFunc(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),Wx=vx({cast_:function(e,t){var n=rx(e,"x","cast");if(!Zg(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return qy.runKernelFunc(function(e){return e.cast(n,t)},{x:n},function(e){return{x:function(){return e.clone()}}},"Cast",r)}}),Ux=vx({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=rx(e,"x","cumsum"),a=cx([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=dx(1,o.rank)[0],u=qy.runKernelFunc(function(e){return e.cumsum(i,s,n,r)},{permutedX:i},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=a&&(u=u.transpose(a)),u}}),jx=vx({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=rx(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return Mg(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),Mg(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),Mg(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),qy.runKernelFunc(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),Vx=vx({expandDims_:function(e,t){void 0===t&&(t=0);var n=rx(e,"x","expandDims",null);Mg(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(Mg(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Hx(n,r)}}),Hx=vx({reshape_:function(e,t){var n=rx(e,"x","reshape",null);t=Kg(t,n.size),Mg(n.size===Wg(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return qy.runKernelFunc(function(e){return e.reshape(n,t)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}},"Reshape",r)}}),Gx=vx({spaceToBatchND_:function(e,t,n){var r=rx(e,"x","spaceToBatchND");return Mg(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),Mg(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),Mg(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),qy.runKernelFunc(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),qx=vx({squeeze_:function(e,t){var n=rx(e,"x","squeeze");return Hx(n,Xg(n.shape,t).newShape)}}),Kx=vx({stack_:function(e,t){void 0===t&&(t=0);var n=ox(e,"tensors","stack");if(Mg(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;Mg(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){Lg(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){Mg(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(e){return e.expandDims(t)});return Dx(i,t)}}),$x=vx({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=rx(e,"x","unstack");Mg(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return qy.runKernelFunc(function(e){return e.unstack(n,t)},{x:n},function(e){return{x:function(){return Kx(e,t)}}},"Unpack",r)}});function Xx(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function Yx(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function Qx(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function Jx(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Zx(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}var ew="Div",tw="SquaredDifference",nw="BroadcastTo",rw="OneHot",ow="Identity",aw="Tile",iw="PadV2",sw=vx({add_:function(e,t){var n,r=rx(e,"a","add"),o=rx(t,"b","add");n=Wy(r,o),r=n[0],o=n[1];var a={a:r,b:o};return qy.runKernelFunc(function(e,t){var n=e.add(r,o);return t([r,o]),n},a,null,"Add")}});function uw(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function lw(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function cw(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}var fw=vx({abs_:function(e){var t=rx(e,"x","abs");return"complex64"===t.dtype?qy.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):qy.runKernelFunc(function(e,n){var r=e.abs(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}},"Abs")}}),dw=vx({acos_:function(e){var t=rx(e,"x","acos");return qy.runKernelFunc(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(wx(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),pw=vx({acosh_:function(e){var t=rx(e,"x","acosh");return qy.runKernelFunc(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),hw=vx({asin_:function(e){var t=rx(e,"x","asin");return qy.runKernelFunc(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(wx(1).sub(n.toFloat().square()).sqrt())}}})}}),vw=vx({asinh_:function(e){var t=rx(e,"x","asinh");return qy.runKernelFunc(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(wx(1).add(n.toFloat().square()).sqrt())}}})}}),mw=vx({atan_:function(e){var t=rx(e,"x","atan");return qy.runKernelFunc(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),gw=vx({atanh_:function(e){var t=rx(e,"x","atanh");return qy.runKernelFunc(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(wx(1).sub(n.toFloat().square()))}}})}}),yw=vx({ceil_:function(e){var t=rx(e,"x","ceil");return qy.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ax(e)}}})}}),bw=vx({clipByValue_:function(e,t,n){var r=rx(e,"x","clipByValue");Mg(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],a={min:t,max:n};return qy.runKernelFunc(function(e,o){var a=e.clip(r,t,n);return o([r]),a},{x:r},function(e,r){var o=r[0];return{x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),Ax(e))}}},"ClipByValue",a,o)}}),xw=vx({cos_:function(e){var t=rx(e,"x","cos"),n=[t];return qy.runKernelFunc(function(e,n){var r=e.cos(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}},"Cos",{},n)}}),ww=vx({cosh_:function(e){var t=rx(e,"x","cosh");return qy.runKernelFunc(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),Ew=vx({erf_:function(e){var t=rx(e,"x","erf");return Mg("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),qy.runKernelFunc(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Cw=vx({exp_:function(e){var t=rx(e,"x","exp");return qy.runKernelFunc(function(e,n){var r=e.exp(t);return n([r]),r},{x:t},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),Sw=vx({expm1_:function(e){var t=rx(e,"x","expm1");return qy.runKernelFunc(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),kw=vx({floor_:function(e){var t=rx(e,"x","floor");return qy.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ax(e)}}})}}),Rw=vx({log_:function(e){var t=rx(e,"x","log"),n=[t];return qy.runKernelFunc(function(e,n){var r=e.log(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}},"Log",{},n)}}),_w=vx({log1p_:function(e){var t=rx(e,"x","log1p");return qy.runKernelFunc(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),Iw=vx({logSigmoid_:function(e){var t=rx(e,"x","logSigmoid");return qy.runKernelFunc(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),Nw=vx({neg_:function(e){var t=rx(e,"x","neg"),n=[t];return qy.runKernelFunc(function(e){return e.neg(t)},{x:t},function(e){return{x:function(){return e.neg()}}},"Neg",{},n)}}),Tw=vx({reciprocal_:function(e){var t=rx(e,"x","reciprocal");return qy.runKernelFunc(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),Aw=vx({round_:function(e){var t=rx(e,"x","round");return qy.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ax(e)}}})}}),Dw=vx({rsqrt_:function(e){var t=rx(e,"x","rsqrt"),n=[t];return qy.runKernelFunc(function(e,n){var r=e.rsqrt(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Ow=vx({sigmoid_:function(e){var t=rx(e,"x","sigmoid");return qy.runKernelFunc(function(e,n){var r=e.sigmoid(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(wx(1).sub(n)))}}},"Sigmoid")}}),Fw=vx({sign_:function(e){var t=rx(e,"x","sign");return qy.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ax(e)}}})}}),Pw=vx({isNaN_:function(e){var t=rx(e,"x","isNaN");return qy.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ax(e)}}})}}),Mw=vx({isInf_:function(e){var t=rx(e,"x","isInf");return qy.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ax(e)}}})}}),Lw=vx({isFinite_:function(e){var t=rx(e,"x","isFinite");return qy.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ax(e)}}})}}),Bw=vx({sin_:function(e){var t=rx(e,"x","sin"),n=[t];return qy.runKernelFunc(function(e,n){var r=e.sin(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}},"Sin",{},n)}}),zw=vx({sinh_:function(e){var t=rx(e,"x","sinh");return qy.runKernelFunc(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),Ww=vx({softplus_:function(e){var t=rx(e,"x","softplus");return qy.runKernelFunc(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),Uw=vx({sqrt_:function(e){var t=rx(e,"x","sqrt");return qy.runKernelFunc(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),jw=vx({step_:function(e,t){void 0===t&&(t=0);var n=rx(e,"x","step");return qy.runKernelFunc(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return Ax(e)}}})}}),Vw=vx({tan_:function(e){var t=rx(e,"x","tan");return qy.runKernelFunc(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),Hw=vx({tanh_:function(e){var t=rx(e,"x","tanh");return qy.runKernelFunc(function(e,n){var r=e.tanh(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return wx(1).sub(n.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}}),Gw=vx({addStrict_:function(e,t){var n=rx(e,"a","addStrict"),r=rx(t,"b","addStrict");return Lg(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),qw=vx({atan2_:function(e,t){var n,r=rx(e,"a","atan2"),o=rx(t,"b","atan2");n=Wy(r,o),r=n[0],o=n[1];var a=cw(r.shape,o.shape);return qy.runKernelFunc(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=sw(n.square(),r.square()),o=e.mul(r.div(t)),i=lw(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=sw(n.square(),r.square()),o=Nw(e.mul(n.div(t))),i=lw(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),Kw=vx({divStrict_:function(e,t){var n=rx(e,"a","div"),r=rx(t,"b","div");return Lg(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),$w=vx({floorDiv_:function(e,t){var n,r=rx(e,"a","floorDiv"),o=rx(t,"b","floorDiv");n=Wy(r,o),r=n[0],o=n[1];var a=cw(r.shape,o.shape);return qy.runKernelFunc(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=lw(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=lw(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}},"FloorDiv")}}),Xw=vx({maximum_:function(e,t){var n,r=rx(e,"a","maximum"),o=rx(t,"b","maximum");return n=Wy(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),cw(r.shape,o.shape),qy.runKernelFunc(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}},"Maximum")}}),Yw=vx({maximumStrict_:function(e,t){var n=rx(e,"a","maximumStrict"),r=rx(t,"b","maximumStrict");return Lg(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Qw=vx({minimum_:function(e,t){var n,r=rx(e,"a","minimum"),o=rx(t,"b","minimum");return n=Wy(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),cw(r.shape,o.shape),qy.runKernelFunc(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}},"Minimum")}}),Jw=vx({minimumStrict_:function(e,t){var n=rx(e,"a","minimumStrict"),r=rx(t,"b","minimumStrict");return Lg(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Zw=vx({mod_:function(e,t){var n,r=rx(e,"a","mod"),o=rx(t,"b","mod");n=Wy(r,o),r=n[0],o=n[1];var a=cw(r.shape,o.shape);return qy.runKernelFunc(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=lw(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=lw(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),eE=vx({modStrict_:function(e,t){var n=rx(e,"a","modStrict"),r=rx(t,"b","modStrict");return Lg(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),tE=vx({mul_:function(e,t){var n,r=rx(e,"a","mul"),o=rx(t,"b","mul");n=Wy(r,o),r=n[0],o=n[1];var a=cw(r.shape,o.shape);return qy.runKernelFunc(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),o=lw(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=lw(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}},"Mul")}}),nE=vx({mulStrict_:function(e,t){var n=rx(e,"a","mul"),r=rx(t,"b","mul");return Lg(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),rE=vx({pow_:function(e,t){var n,r=rx(e,"base","pow"),o=rx(t,"exp","pow");n=Wy(r,o),r=n[0],o=n[1];var a=cw(r.shape,o.shape),i=[r,o];return qy.runKernelFunc(function(e,t){var n=e.pow(r,o);return t([r,o,n]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1],o=t[2];return{a:function(){var t=r.toFloat(),o=e.mul(t.mul(n.pow(t.sub(wx(1))))),i=lw(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},b:function(){var t=n.greater(0),i=n.log().where(t,Ax(n)),s=e.mul(o.mul(i)),u=lw(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},i,[!0])}}),oE=vx({powStrict_:function(e,t){return Lg(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),aE=vx({squaredDifferenceStrict_:function(e,t){var n=rx(e,"a","squaredDifferenceStrict"),r=rx(t,"b","squaredDifferenceStrict");return Lg(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),iE=vx({sub_:function(e,t){var n,r=rx(e,"a","sub"),o=rx(t,"b","sub");n=Wy(r,o),r=n[0],o=n[1];var a=cw(r.shape,o.shape);return qy.runKernelFunc(function(e){return e.subtract(r,o)},{a:r,b:o},function(e){return{a:function(){var t=e,n=lw(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=lw(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}},"Sub")}}),sE=vx({subStrict_:function(e,t){var n=rx(e,"a","subStrict"),r=rx(t,"b","subStrict");return Lg(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),uE=vx({div_:function(e,t){var n,r=rx(e,"a","div"),o=rx(t,"b","div");if(n=Wy(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return $w(r,o);var a={a:r,b:o};return qy.runKernelFunc(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},a,null,ew,{})}});function lE(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=cy(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,l]}Object.freeze({prepareAndValidate:lE});function cE(e){return e<=30?e:ly(e,Math.floor(Math.sqrt(e)))}function fE(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}function dE(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}fE(n,t,e)}function pE(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:Wg(t.shape)/u,sliceSize:i,strides:cy(n.slice(0,o)).concat([1]),outputSize:Wg(n)}}Object.freeze({validateUpdateShape:fE,validateInput:dE,calculateShapes:pE});function hE(e,t,n){Mg(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),Mg(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){Mg(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}function vE(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function mE(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function gE(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),Og(0,a,s-1)}function yE(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?Og(0,a,s):Og(-1,a,s-1)}function bE(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function xE(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:hE,maskToAxes:vE,computeOutShape:mE,startForAxis:gE,stopForAxis:yE,isSliceContinous:bE,computeFlatOffset:xE});function wE(e){return qy.customGrad(e)}var EE=vx({softmax_:function(e,t){void 0===t&&(t=-1);var n=rx(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return qy.runKernelFunc(function(e,r){var o=e.softmax(n,t);return r([o]),o},{logits:n},function(e,n){var r=n[0],o=e.mul(r);return{logits:function(){return o.sub(o.sum([t],!0).mul(r))}}},"Softmax",{dim:t},[],[!0])}}),CE=vx({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=rx(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return wE(function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),SE=vx({transpose_:function(e,t){var n=rx(e,"x","transpose");if(null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),Mg(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){Mg(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return qy.runKernelFunc(function(e){return e.transpose(n,t)},{x:n},null,"Transpose",r)}}),kE=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),RE=function(){function e(){}return e.prototype.time=function(e){return _E("time")},e.prototype.read=function(e){return _E("read")},e.prototype.readSync=function(e){return _E("readSync")},e.prototype.numDataIds=function(){return _E("numDataIds")},e.prototype.disposeData=function(e){return _E("disposeData")},e.prototype.write=function(e,t,n){return _E("write")},e.prototype.move=function(e,t,n,r){return _E("move")},e.prototype.memory=function(){return _E("memory")},e.prototype.floatPrecision=function(){return _E("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return _E("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,_E("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return _E("slice")},e.prototype.stridedSlice=function(e,t,n,r){return _E("stridedSlice")},e.prototype.unstack=function(e,t){return _E("unstack")},e.prototype.reverse=function(e,t){return _E("reverse")},e.prototype.concat=function(e,t){return _E("concat")},e.prototype.neg=function(e){return _E("neg")},e.prototype.add=function(e,t){return _E("add")},e.prototype.addN=function(e){return _E("addN")},e.prototype.subtract=function(e,t){return _E("subtract")},e.prototype.multiply=function(e,t){return _E("multiply")},e.prototype.realDivide=function(e,t){return _E("realDivide")},e.prototype.floorDiv=function(e,t){return _E("floorDiv")},e.prototype.sum=function(e,t){return _E("sum")},e.prototype.prod=function(e,t){return _E("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return _E("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return _E("argMin")},e.prototype.argMax=function(e,t){return _E("argMax")},e.prototype.equal=function(e,t){return _E("equal")},e.prototype.notEqual=function(e,t){return _E("notEqual")},e.prototype.less=function(e,t){return _E("less")},e.prototype.lessEqual=function(e,t){return _E("lessEqual")},e.prototype.greater=function(e,t){return _E("greater")},e.prototype.greaterEqual=function(e,t){return _E("greaterEqual")},e.prototype.logicalNot=function(e){return _E("logicalNot")},e.prototype.logicalAnd=function(e,t){return _E("logicalAnd")},e.prototype.logicalOr=function(e,t){return _E("logicalOr")},e.prototype.where=function(e){return _E("where")},e.prototype.select=function(e,t,n){return _E("select")},e.prototype.topk=function(e,t,n){return _E("topk")},e.prototype.min=function(e,t){return _E("min")},e.prototype.minimum=function(e,t){return _E("minimum")},e.prototype.mod=function(e,t){return _E("mod")},e.prototype.max=function(e,t){return _E("max")},e.prototype.maximum=function(e,t){return _E("maximum")},e.prototype.all=function(e,t){return _E("all")},e.prototype.any=function(e,t){return _E("any")},e.prototype.squaredDifference=function(e,t){return _E("squaredDifference")},e.prototype.ceil=function(e){return _E("ceil")},e.prototype.floor=function(e){return _E("floor")},e.prototype.round=function(e){return _E("round")},e.prototype.sign=function(e){return _E("sign")},e.prototype.isNaN=function(e){return _E("isNaN")},e.prototype.isInf=function(e){return _E("isInf")},e.prototype.isFinite=function(e){return _E("isFinite")},e.prototype.pow=function(e,t){return _E("pow")},e.prototype.exp=function(e){return _E("exp")},e.prototype.expm1=function(e){return _E("expm1")},e.prototype.softmax=function(e,t){return _E("softmax")},e.prototype.log=function(e){return _E("log")},e.prototype.log1p=function(e){return _E("log1p")},e.prototype.sqrt=function(e){return _E("sqrt")},e.prototype.rsqrt=function(e){return _E("rsqrt")},e.prototype.square=function(e){return _E("square")},e.prototype.reciprocal=function(e){return _E("reciprocal")},e.prototype.relu=function(e){return _E("relu")},e.prototype.relu6=function(e){return _E("relu6")},e.prototype.prelu=function(e,t){return _E("prelu")},e.prototype.elu=function(e){return _E("elu")},e.prototype.eluDer=function(e,t){return _E("eluDer")},e.prototype.selu=function(e){return _E("selu")},e.prototype.int=function(e){return _E("int")},e.prototype.clip=function(e,t,n){return _E("clip")},e.prototype.abs=function(e){return _E("abs")},e.prototype.complexAbs=function(e){return _E("complexAbs")},e.prototype.sigmoid=function(e){return _E("sigmoid")},e.prototype.softplus=function(e){return _E("softplus")},e.prototype.sin=function(e){return _E("sin")},e.prototype.cos=function(e){return _E("cos")},e.prototype.tan=function(e){return _E("tan")},e.prototype.asin=function(e){return _E("asin")},e.prototype.acos=function(e){return _E("acos")},e.prototype.atan=function(e){return _E("atan")},e.prototype.atan2=function(e,t){return _E("atan2")},e.prototype.sinh=function(e){return _E("sinh")},e.prototype.cosh=function(e){return _E("cosh")},e.prototype.tanh=function(e){return _E("tanh")},e.prototype.asinh=function(e){return _E("asinh")},e.prototype.acosh=function(e){return _E("acosh")},e.prototype.atanh=function(e){return _E("atanh")},e.prototype.erf=function(e){return _E("erf")},e.prototype.step=function(e,t){return _E("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,_E("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return _E("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return _E("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return _E("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,_E("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return _E("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return _E("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return _E("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return _E("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return _E("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return _E("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return _E("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return _E("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return _E("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return _E("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return _E("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return _E("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return _E("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return _E("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return _E("reshape")},e.prototype.cast=function(e,t){return _E("cast")},e.prototype.tile=function(e,t){return _E("tile")},e.prototype.pad=function(e,t,n){return _E("pad")},e.prototype.transpose=function(e,t){return _E("transpose")},e.prototype.gather=function(e,t,n){return _E("gather")},e.prototype.gatherND=function(e,t){return _E("gatherND")},e.prototype.scatterND=function(e,t,n){return _E("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return _E("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return _E("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return _E("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return _E("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return _E("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return _E("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,o,a){return _E("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){return _E("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){return _E("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return _E("multinomial")},e.prototype.oneHot=function(e,t,n,r){return _E("oneHot")},e.prototype.cumsum=function(e,t,n,r){return _E("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return _E("nonMaxSuppression")},e.prototype.fft=function(e){return _E("fft")},e.prototype.ifft=function(e){return _E("ifft")},e.prototype.complex=function(e,t){return _E("complex")},e.prototype.real=function(e){return _E("real")},e.prototype.imag=function(e){return _E("imag")},e.prototype.cropAndResize=function(e,t,n,r,o,a){return _E("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return _E("depthToSpace")},e.prototype.split=function(e,t,n){return _E("split")},e.prototype.sparseToDense=function(e,t,n,r){return _E("sparseToDense")},e.prototype.diag=function(e){return _E("diag")},e.prototype.fill=function(e,t,n){return _E("fill")},e.prototype.onesLike=function(e){return _E("onesLike")},e.prototype.zerosLike=function(e){return _E("zerosLike")},e.prototype.linspace=function(e,t,n){return _E("linspace")},e.prototype.dispose=function(){return _E("dispose")},e}();function _E(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function IE(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=OE(t),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return TE(e,s,n,r,o,a,!1,i)}function NE(e,t,n,r,o,a,i){void 0===i&&(i="NDHWC");var s,u,l=FE(t),c=l[0],f=l[1],d=l[2];if("NDHWC"===i)u="channelsLast",s=[c,f,d,e[4],e[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,f,d,e[1],e[1]]}return AE(e,s,n,r,o,!1,u,a)}function TE(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3];if("channelsLast"===s)l=e[0],c=e[1],f=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],d=e[1],c=e[2],f=e[3]}var p,h=t[0],v=t[1],m=t[3],g=OE(n),y=g[0],b=g[1],x=OE(r),w=x[0],E=x[1],C=PE(h,w),S=PE(v,E),k=function(e,t,n,r,o,a,i,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,o){null==r&&(r=DE(e,t,n));var a=e[1],i=ME((e[0]-t+2*r)/n+1,o);Mg(jg(i),function(){return"The output # of rows ("+i+") must be an integer. Change the stride and/or zero pad parameters"});var s=ME((a-t+2*r)/n+1,o);return Mg(jg(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[i,s]}([t,n],a,r,e,s);l=f[0],c=f[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/o);var d=Math.max(0,(l-1)*r+a-t),p=Math.max(0,(c-1)*o+i-n),h=Math.floor(d/2),v=d-h,m=Math.floor(p/2);u={top:h,bottom:v,left:m,right:p-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,f,y,b,C,S,a),R=k.padInfo,_=k.outHeight,I=k.outWidth,N=i?m*d:m;return"channelsFirst"===s?p=[l,N,_,I]:"channelsLast"===s&&(p=[l,_,I,N]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:f,inChannels:d,outHeight:_,outWidth:I,outChannels:N,padInfo:R,strideHeight:y,strideWidth:b,filterHeight:h,filterWidth:v,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:E,inShape:e,outShape:p,filterShape:t}}function AE(e,t,n,r,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3],p=u[4];if("channelsLast"===i)l=e[0],c=e[1],f=e[2],d=e[3],p=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);l=e[0],p=e[1],c=e[2],f=e[3],d=e[4]}var h,v=t[0],m=t[1],g=t[2],y=t[4],b=FE(n),x=b[0],w=b[1],E=b[2],C=FE(r),S=C[0],k=C[1],R=C[2],_=PE(v,S),I=PE(m,k),N=PE(g,R),T=function(e,t,n,r,o,a,i,s,u,l,c){var f,d,p,h;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,o,a){null==o&&(o=DE(e,t,r));var i=e[1],s=e[2],u=ME((e[0]-t+2*o)/r+1,a);Mg(jg(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=ME((i-t+2*o)/r+1,a);Mg(jg(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var c=ME((s-t+2*o)/r+1,a);return Mg(jg(c),function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,c,1]}([t,n,r,1],s,0,o,e,c);d=v[0],p=v[1],h=v[2]}else if("same"===e){var m=((d=Math.ceil(t/o))-1)*o+s-t,g=((p=Math.ceil(n/a))-1)*a+u-n,y=((h=Math.ceil(r/i))-1)*i+l-r,b=Math.floor(m/2),x=m-b,w=Math.floor(g/2),E=g-w,C=Math.floor(y/2);f={top:w,bottom:E,left:C,right:y-C,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/o),p=Math.ceil((n-u+1)/a),h=Math.ceil((r-l+1)/i)}return{padInfo:f,outDepth:d,outHeight:p,outWidth:h}}(o,c,f,d,x,w,E,_,I,N,s),A=T.padInfo,D=T.outDepth,O=T.outHeight,F=T.outWidth,P=a?y*p:y;return"channelsFirst"===i?h=[l,P,D,O,F]:"channelsLast"===i&&(h=[l,D,O,F,P]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:f,inWidth:d,inChannels:p,outDepth:D,outHeight:O,outWidth:F,outChannels:P,padInfo:A,strideDepth:x,strideHeight:w,strideWidth:E,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:_,effectiveFilterHeight:I,effectiveFilterWidth:N,dilationDepth:S,dilationHeight:k,dilationWidth:R,inShape:e,outShape:h,filterShape:t}}function DE(e,t,n,r){void 0===r&&(r=1);var o=PE(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function OE(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function FE(e){return"number"==typeof e?[e,e,e]:e}function PE(e,t){return t<=1?e:e+(e-1)*(t-1)}function ME(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function LE(e){var t=OE(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function BE(e,t){return LE(e)||LE(t)}function zE(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function WE(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=_x(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!ey(e.dtype,t))return qy.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=wx(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function UE(e,t){return qy.makeTensorFromDataId(e.dataId,t,e.dtype)}function jE(e,t,n){var r=(t-e)/(n-1),o=hy(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return Ex(o,"float32")}Object.freeze({castTensor:WE,reshapeTensor:UE,linspaceImpl:jE,upcastType:By,axesAreInnerMostDims:ax,combineLocations:ix,computeOutAndReduceShapes:sx,expandShapeToKeepDim:ux,assertAxesAreInnerMostDims:lx,getAxesPermutation:cx,getUndoAxesPermutation:fx,getInnerMostAxes:dx,getBroadcastDims:uw,getReductionAxes:lw,assertAndGetBroadcastShape:cw,assertParamsConsistent:px,computeOutShape:hx,computePool2DInfo:IE,computePool3DInfo:NE,computeConv2DInfo:TE,computeConv3DInfo:AE,computeDefaultPad:DE,tupleValuesAreOne:LE,eitherStridesOrDilationsAreOne:BE,convertConv2DDataFormat:zE,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:cE});function VE(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function HE(e,t){return{real:e[2*t],imag:e[2*t+1]}}function GE(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function qE(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function KE(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,o=e.length,a=0,i=!1;r<o;){var s=n(t,e[a=r+(o-r>>>1)]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}(e,t,n||$E)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function $E(e,t){return e>t?1:e<t?-1:0}function XE(e,t,n,r,o){return QE(e,t,n,r,o,0).selectedIndices}function YE(e,t,n,r,o,a){var i=QE(e,t,n,r,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function QE(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map(function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}}).filter(function(e){return e.score>o}).sort(eC),l=a>0?-.5/a:0,c=[],f=[];c.length<n&&u.length>0;){var d=u.pop(),p=d.score,h=d.boxIndex,v=d.suppressBeginIndex;if(p<o)break;for(var m=!1,g=c.length-1;g>=v;--g){var y=JE(e,h,c[g]);if(y>=r){m=!0;break}if(d.score=d.score*ZE(r,l,y),d.score<=o)break}d.suppressBeginIndex=c.length,m||(d.score===p?(c.push(h),f.push(d.score)):d.score>o&&KE(u,d,eC))}var b=c.length;return s&&(c.fill(0,b),f.fill(0,b)),{selectedIndices:Ex(c,"int32"),selectedScores:Ex(f,"float32"),numValidOutputs:wx(b,"int32")}}function JE(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),p=(s-a)*(u-i),h=(f-l)*(d-c);if(p<=0||h<=0)return 0;var v=Math.max(a,l),m=Math.max(i,c),g=Math.min(s,f),y=Math.min(u,d),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(p+h-b)}function ZE(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function eC(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function tC(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a})}function nC(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Bx(n,e.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(e.rank),s=0;s<i.length;s++)i[s]=a[s]%e.shape[s];var u=e.locToIndex(i);o.values[r]=e.values[u]}return o.toTensor()}function rC(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=Yg(n,s*r),c=Yg("int32",s*r),f=0;f<s;f++){for(var d=f*u,p=e.subarray(d,d+u),h=[],v=0;v<p.length;v++)h.push({value:p[v],index:v});h.sort(function(e,t){return t.value-e.value});var m=f*r,g=l.subarray(m,m+r),y=c.subarray(m,m+r);for(v=0;v<r;v++)g[v]=h[v].value,y[v]=h[v].index}var b=t.slice();return b[b.length-1]=r,[bx(l,b,n),bx(c,b,"int32")]}function oC(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Bx(e,"int32"),a=Bx([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var aC=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},iC=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},sC=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function uC(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function lC(e,t){return 1===t?[e]:uC(e,t)}function cC(){var e,t,n,r,o,a,i,s,u,l;return 2===Eg().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function fC(e,t,n){void 0===n&&(n="index");var r=cy(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function dC(e){var t=cy(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var pC="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function hC(e,t,n,r){var o=[];e.forEach(function(e){var t=Wg(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var a,i,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?mC(e):vC(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=uw(e.shapeInfo.logicalShape,t.logicalShape),l=CC(s),c=s-i,f=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+f[e+c]+" = 0;"}).join("\n");var d;d=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+c]}).join(", ");var p="return outputValue;",h=1===Wg(e.shapeInfo.logicalShape),v=1===Wg(t.logicalShape);if(1!==i||h||v){if(h&&!v)p=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=i-2,g=i-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?p="return vec4(outputValue.x);":u.indexOf(m)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+p+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Ug(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l,c=CC(u),f=uw(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,p=["x","y","z","w","u","v"];l=0===s?"":u<2&&f.length>=1?"coords = 0;":f.map(function(e){return"coords."+p[e+d]+" = 0;"}).join("\n");var h;return h=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+p[t+d]}).join(", "),"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+l+"\n      return get"+r+"("+h+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,c=cC(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+gC+"\n    "+yC+"\n    "+bC+"\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ug(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,o,a,i}(t.logicalShape,l),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return Ug(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=fC(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=fC(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=fC(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=fC(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,l),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(d+=xC),[d,f,i,s,a,u,n].join("\n")}function vC(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+wC(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+EC(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=wC(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&Ug(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=Xg(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n      "+vC(SC(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+kC(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+EC(e)+"\n      }\n    ";var c=o[0],f=o[1],d=wC(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+c+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=Xg(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n        "+vC(SC(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+kC(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+EC(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,f=c[0],d=c[1],p=e.shapeInfo.flatOffset;return d===o&&null==p?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===a&&null==p?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+wC(n)+";\n        vec2 uv = uvFromFlat("+f+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=Xg(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return"\n      "+vC(SC(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+kC(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+EC(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],p=f[1];return p===i&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+p+", index + "+wC(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=Xg(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return"\n      "+vC(SC(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+kC(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+EC(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],h=d[1];return h===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+wC(n)+";\n      vec2 uv = uvFromFlat("+p+", "+h+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Xg(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+vC(SC(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+kC(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,f=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+c+", "+l+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+EC(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,h=p[0],v=p[1];return v===f&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+l+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":v===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+wC(n)+";\n      vec2 uv = uvFromFlat("+h+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function mC(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+cC().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=cC();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=cC();if(null!=o&&Ug(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+mC(SC(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+kC(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+cC().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),f="int b, int row, int col",d="b * "+c+" + (row / 2) * "+l+" + (col / 2)",p=2;p<n-1;p++)f="int b"+p+", "+f,d="b"+p+" * "+(c*=t[n-p-1])+" + "+d;return"\n    vec4 "+o+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+cC().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var gC="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",yC="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",bC="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",xC="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function wC(e){return"offset"+e}function EC(e){var t=e.name,n=Wg(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function CC(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function SC(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function kC(e,t){return t.map(function(t){return e[t]}).join(", ")}var RC=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Mg(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=CC(l),f=lC("coords",l);if(1===a){var d=CC(s=l+1);i="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[l-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[l-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[l-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+f[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+f[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+f[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+f[l-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),h="."+p[s-1],v=p.map(function(e){return"int "+e}),m=lC("sourceLocR",s-1).concat("inIdx.r"),g=lC("sourceLocG",s-1).concat("inIdx.g"),y=lC("sourceLocB",s-1).concat("inIdx.b"),b=lC("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+f[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+f[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+h+", sourceLocG"+h+",\n          sourceLocB"+h+", sourceLocA"+h+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},_C=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},IC=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=c-1-e.padInfo.front,h=f-1-e.padInfo.top,v=d-1-e.padInfo.left,m=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+p+", "+h+", "+v+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+l+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},NC=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],cw(e,t),cw(e,n);var i="0.0";null!=r&&(cw(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(cw(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},TC=function(e,t,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],cw(e,t),cw(e,n);var i="vec4(0.0)";null!=r&&(cw(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(cw(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},AC=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=cw(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},DC="return a + b;",OC="return a - b;",FC="return a * b;",PC="return (a < 0.) ? b * a : a;",MC=function(e,t,n){this.variableNames=["A","B"],this.outputShape=cw(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},LC="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",BC=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=cw(t,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===Wg(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+CC(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=lC("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},zC=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),WC=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),UC=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},jC=function(e){this.outputShape=[],this.outputShape=hx(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},VC=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=hx(e,t);var n=this.outputShape,r=n.length,o=CC(r),a=lC("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c=i.slice(-2),f=i.join(),d="if ("+l+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+c.join()+"));\n        }";for(u=1;u<s.length;u++){var p=s[u-1];d+="\n        if ("+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+HC(i,l,p)+"),\n            vec2("+HC(c,l,p)+"));\n        }"}var h=s.length,v=s[s.length-1];d+="\n        return getChannel(\n          getT"+h+"("+HC(i,l,v)+"),\n          vec2("+HC(c,l,v)+"));",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function HC(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?e+" - "+n:e}).join()}var GC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a="channelsLast"===e.dataFormat,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+c+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+l+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},KC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},$C=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},XC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},YC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},QC=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,a=e.padInfo.left,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),p=e.inChannels%4,h="channelsLast"===e.dataFormat,v=h?1:2,m=h?2:3,g=h?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+h+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===p)+") {\n\n              if ("+h+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===p)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+h+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===p)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+h+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},JC=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,f=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),h=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===h)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+p+") *\n                  getW(wF, wR, wC, "+p+", d2);\n              } else if ("+(2===h)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===h)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1),\n                  getX(batch, xF, xR, xC, "+p+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2),\n                  getW(wF, wR, wC, "+p+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ZC=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,h=e.outChannels/e.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+h+";\n        int q = d2 - d1 * "+h+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},eS=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,h=p,v="int xR; int xC; int xCOffset;",m=0;m<d;m++)for(var g=0;g<p;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<d;m++)for(var y=0;y<h;y++){if(v+="\n          xR = xRCorner + "+m*c+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===l){if(g<p&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+m+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<p)){var b=s%2==0?Fg(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<p&&(v+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<p&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<p&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<p&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<p&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<d;m++)for(g=0;g<p;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+E+"\n        "+w+"\n        setOutput(result);\n      }\n    "},tS=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],f=n[1];this.outputShape=[l,c,f,u];var d="bilinear"===r?1:0,p=[i-1+".0",s-1+".0"],h=p[0],v=p[1],m=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],g=m[0],y=m[1],b=m[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=x[0],E=x[1],C=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+h+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+C+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},nS=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+CC(r)+" coords = getOutputCoords();\n        int end = "+rS(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+rS(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function rS(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var oS=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Xy.DENSE;var t=rb(e),n=cC();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fC(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},aS=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Xy.DENSE;var t=rb(e),n=cC();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fC(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},iS=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),sS=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},uS=function(e){this.variableNames=["A"],this.outTexUsage=Yy.DOWNLOAD;var t=cC();this.outputShape=e,this.userCode="\n      "+pC+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},lS=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Yy.DOWNLOAD;var t=cC();this.outputShape=e,this.userCode="\n      "+pC+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},cS=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=cC(),o=t[0],a=t[1];this.outputShape=e;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+dC(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},fS=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=cC(),o=t[0],a=t[1];this.outputShape=e;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+e[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+dC(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},dS=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},pS=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),hS=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=CC(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},vS=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=CC(t.length),o=CC(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function mS(e,t){var n=cC();return cb(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function gS(e,t){return yb(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function yS(e,t){return bb(e,t,new Uint16Array([0,1,2,2,1,3]))}function bS(e,t,n,r,o,a,i){wb(n,r);var s=xb(e,t),u=e.TEXTURE_2D;return ib(e,t,function(){return e.bindTexture(u,s)}),ib(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),ib(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),ib(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),ib(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),ib(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),ib(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function xS(e,t,n,r,o){var a=nb(n,r);return bS(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function wS(e,t,n,r,o){var a=nb(n,r);return bS(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function ES(e,t,n,r,o){var a=nb(n,r);return bS(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function CS(e,t,n,r,o){var a=ob(n,r);return bS(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function SS(e,t,n,r,o){var a=ob(n,r);return bS(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function kS(e,t,n,r){return ib(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Cb(e,t,n,"clipSpacePos",r,3,20,0)&&Cb(e,t,n,"uv",r,2,20,12)}function RS(e,t,n,r,o,a,i){var s,u,l;ib(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),ib(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),ib(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function _S(e,t,n,r){ib(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?ib(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):ib(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),ib(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function IS(e,t,n,r,o){var a=e.createBuffer();ib(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*n*r;return ib(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),ib(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),ib(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}function NS(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function TS(e,t,n,r,o){var a=nb(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return ib(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function AS(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(function(e,t){var n=ob(e,t);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function DS(e,t,n,r){var o=new Float32Array(n*r*4);return ib(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var OS=Object.freeze({createVertexShader:mS,createVertexBuffer:gS,createIndexBuffer:yS,createFloat32MatrixTexture:xS,createFloat16MatrixTexture:wS,createUnsignedBytesMatrixTexture:ES,createPackedMatrixTexture:CS,createFloat16PackedMatrixTexture:SS,bindVertexProgramAttributeStreams:kS,uploadDenseMatrixToTexture:RS,uploadPixelDataToTexture:_S,createBufferFromOutputTexture:IS,downloadFloat32MatrixFromBuffer:NS,downloadByteEncodedFloatMatrixFromOutputTexture:TS,downloadPackedMatrixFromBuffer:AS,downloadMatrixFromPackedOutputTexture:DS}),FS=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Eg().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,eb(t,e)):this.gl=tb(t);var n="WEBGL_color_buffer_float";if(1===Eg().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=lb(this.gl,this.debug,"OES_texture_float"),Vb(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=lb(this.gl,this.debug,"OES_texture_half_float");else if(Eg().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Vb(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=lb(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Eg().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Vb(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Vb(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=gS(this.gl,this.debug),this.indexBuffer=yS(this.gl,this.debug),this.framebuffer=Eb(this.gl,this.debug),this.textureConfig=ab(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return Eg().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;ib(t,this.debug,function(){return t.finish()}),ib(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),ib(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),ib(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),ib(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),ib(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),xS(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),wS(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),ES(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),_S(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),RS(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),SS(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),CS(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Nb(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ib(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return TS(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return AS(this.gl,e,0,0,0,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return NS(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=IS(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(Eg().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return DS(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=fb(t,this.debug,e),r=mS(t,this.debug),o=vb(t,this.debug);return ib(t,this.debug,function(){return t.attachShader(o,r)}),ib(t,this.debug,function(){return t.attachShader(o,n)}),mb(t,this.debug,o),this.debug&&gb(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=kS(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&ib(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&gb(this.gl,this.debug,this.program),ib(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?kb(this.gl,this.debug,e,t):Rb(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),ib(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),_b(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=ob(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&gb(this.gl,this.debug,this.program),Tb(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),ib(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),ib(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=lb(this.gl,this.debug,2===Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return bg(this,void 0,void 0,function(){var t=this;return xg(this,function(n){switch(n.label){case 0:return[4,qg(function(){return t.disposed||t.isQueryAvailable(e,Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||qg(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Ib(this.gl,this.debug,e,this.framebuffer),this.debug&&Tb(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Ib(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Tb(this.gl)):Nb(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Ib(r,this.debug,e,this.framebuffer),this.debug&&Tb(r),this.outputTexture=e,ib(r,this.debug,function(){return r.viewport(0,0,t,n)}),ib(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),ib(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function PS(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!Ug(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!Ug(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var MS=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,f=n.dataFormat,d=s.left,p=s.top,h=o*r,v=cC(),m="channelsLast"===f,g=m?0:1,y=m?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+p+";\n            d0 = offsetY + "+c+" * (pos / "+h+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+d+".);\n              d1 = offsetX + "+l+" * (int(mod(float(pos), "+h+".) / "+o+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+v.output+" = result;\n      }\n    "},LS=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},BS=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},zS=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},WS=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},US=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,f=u-1-e.padInfo.top,d=l-1-e.padInfo.left,p=s*u*l-1;this.userCode="\n      const ivec3 pads = ivec3("+c+", "+f+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+p+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+l+" +\n                  wR * "+l+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jS=function(e,t,n,r,o,a,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",h="";a&&(p=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",h="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+l+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+d[0]+");\n          result += ("+f[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},VS=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),HS=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},GS=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=lC("rc",t),r=CC(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},qS=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=CC(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},KS=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=CC(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=lC("rc",r),u=lC("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",h=0,v=1===r?2:4;h<v;h++)p+="\n        "+f[h]+"\n        if ("+d+") {\n          result["+h+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+h+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";p+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+p+"\n        setOutput(result);\n      }\n    "},$S=function(e,t,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;var h="avg"===t,v="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",m="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="0.0";if(h||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+s+");\n        const ivec2 pads = ivec2("+d+", "+p+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+l+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?o?v:m:"wR * "+f+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(a/4),x=a%4,w="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+d+", "+p+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+u+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+b+"; wC += 4) {\n            int xC = xCCorner + wC * "+l+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              getValue(batch, xR, xC + 3 * "+l+", d)\n            );\n\n            "+w+"\n          }\n\n          int xC = xCCorner + "+b+";\n          if ("+(1===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(2===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(3===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              initializationValue\n            );\n\n            "+w+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},XS=function(e,t,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,i=e.strideDepth,s=e.strideHeight,u=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,h=e.effectiveFilterWidth,v=e.padInfo.front,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;var y="avg"===t,b="0.0";if(y||(b="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+s+", "+u+");\n        const ivec3 pads = ivec3("+v+", "+m+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+l+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+p+";\n                wR += "+c+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+h+";\n                  wC += "+f+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?o?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+p+" * "+h+" +\n                      wR * "+h+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(x="avgValue / count");var w=4*Math.floor(a/4),E=a%4,C="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+s+", "+u+");\n      const ivec3 pads = ivec3("+v+", "+m+", "+g+");\n      const float initializationValue = "+b+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+b+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+l+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+";\n            wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+f+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+f+", ch)\n              );\n\n              "+C+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+C+"\n            } else if ("+(2===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+C+"\n            } else if ("+(3===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                initializationValue\n              );\n\n              "+C+"\n            }\n          }\n          setOutput("+x+");\n        }\n      }\n    "}},YS=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";o%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},QS=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+fC(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+dC(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},JS=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],p=1/f,h=1/d,v=2*Math.ceil(p)+2,m=2*Math.ceil(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ZS=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},ek=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},tk=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],p=1/f,h=1/d,v=2*Math.ceil(p)+2,m=2*Math.ceil(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},nk=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},rk=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=CC(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},ok=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=lC("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=CC(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},ak=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=CC(o.length),u=CC(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices("+l+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var d="getUpdates("+f+")",p=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+p+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},ik=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},sk=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=CC(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},uk=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=CC(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return lk.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+lk[t]+" = start["+t+"] + coords."+lk[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),lk=["x","y","z","w","u","v"],ck=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=CC(this.rank),n=lC("coords",this.rank),r=lC("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),fk=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=CC(n.length),a=CC(n.length),i="";if(1===r)i="coords * strides + begin";else{var s=0;i=n.map(function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},dk=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=pk(t,n),a=hk(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Qy.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Qy.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Qy.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Qy.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Qy.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=hk(t,pk(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function pk(e,t){if(e===Yy.UPLOAD)return Qy.PACKED_2X2_FLOAT32;if(e===Yy.RENDER||null==e)return function(e){return Eg().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Qy.PACKED_2X2_FLOAT32:Qy.UNPACKED_FLOAT32:e?Qy.PACKED_2X2_FLOAT16:Qy.UNPACKED_FLOAT16}(t);if(e===Yy.DOWNLOAD||e===Yy.PIXELS)return Qy.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function hk(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var vk=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=CC(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},mk=1.7580993408473768,gk=1.0507009873554805,yk=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},bk="if (isnan(x)) return x;",xk="return abs(x);",wk=bk+"\n  return (x < 0.0) ? 0.0 : x;\n",Ek=bk+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Ck="return (x >= 0.0) ? x : (exp(x) - 1.0);",Sk="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+mk+";\n  float scale = "+gk+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",kk="return -x;",Rk="return ceil(x);",_k="return floor(x);",Ik="return exp(x);",Nk="return exp(x) - 1.0;",Tk=bk+"\n  return sin(x);\n",Ak=bk+"\n  return cos(x);\n",Dk=bk+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",Ok=bk+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",Fk=bk+"\n  return atan(x);\n",Pk=bk+"return log(x + sqrt(x * x + 1.0));",Mk=bk+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",Lk=bk+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Bk="return x;",zk="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Wk="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Uk="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",jk=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Vk=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=lC("rc",t),r=CC(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},Hk={};function Gk(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?zk:wk;if("elu"===e)return t?Uk:Ck;if("relu6"===e)return t?Wk:Ek;if("prelu"===e)return t?LC:PC;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var qk=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Eg().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=tb(Eg().getNumber("WEBGL_VERSION"));r.binaryCache=((n=Eg().getNumber("WEBGL_VERSION"))in Hk||(Hk[n]={}),Hk[n]),r.gpgpu=new FS(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new dk(r.gpgpu),r.numMBBeforeWarning=null==Eg().global.screen?1024:Eg().global.screen.height*Eg().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new kE(r,qy),r}return yg(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(Eg().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Yy.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(Eg().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Yy.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new jk(i,Bk):new yk(i,Bk);var l=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:r}],r),c=this.readSync(l.dataId);return this.disposeData(l.dataId),c}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,d,p=null!=this.activeTimers;return p&&(f=vy()),d="complex64"===r?VE(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),p&&(this.downloadWaitMs+=vy()-f),this.convertAndCacheOnCPU(e,d)},t.prototype.read=function(e){return bg(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f,d,p,h,v,m,g,y,b,x,w,E;return xg(this,function(C){switch(C.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(n=this.texData.get(e),r=n.values,o=n.shape,a=n.slice,i=n.dtype,s=n.complexTensors,u=n.isPacked,null!=a)return void 0,l=u?new jk(o,Bk):new yk(o,Bk),c=this.runWebGLProgram(l,[{dataId:e,shape:o,dtype:i}],i),f=this.read(c.dataId),this.disposeData(c.dataId),[2,f];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!Eg().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Eg().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==i&&Eg().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(e),h=this.texData.get(p.dataId),d=(E=this.gpgpu).createBufferFromTexture.apply(E,[h.texture].concat(rb(o)))),this.pendingRead.set(e,[]),"complex64"===i?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return"complex64"!==i?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return m=C.sent(),g=m[0],y=m[1],v=VE(g,y),[3,5];case 4:null==d?v=this.getValuesFromTexture(e):(b=Wg(o),v=this.gpgpu.downloadFloat32MatrixFromBuffer(d,b)),C.label=5;case 5:return null!=p&&this.disposeData(p.dataId),x=this.convertAndCacheOnCPU(e,v),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach(function(e){return e(x)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,x]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!sb(n)){if(Eg().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.isPacked,i=Wg(r);if(Eg().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(rb(r))).subarray(0,i);return this.disposeData(s.dataId),l}var c=Eg().getBool("WEBGL_PACK")&&!0===a,f=c?Mb(r):r,d=c?new lS(f):new uS(f),p=this.runWebGLProgram(d,[{shape:f,dtype:o,dataId:e}],"float32"),h=this.texData.get(p.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeData(p.dataId),v},t.prototype.time=function(e){return bg(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return xg(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=zg(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),a=zg(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return s=u.sent(),i.kernelMs=Pg(s),i.getExtraProfileInfo=function(){return s.map(function(e,t){return{name:a[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:i.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:vy(),endMs:null}},t.prototype.endTimer=function(e){return Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=vy(),e)},t.prototype.getQueryTime=function(e){return bg(this,void 0,void 0,function(){var t;return xg(this,function(n){return Eg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.isPacked,s=t.slice,u=s&&s.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return Eg().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=qy.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&Wg(e.shape)<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:qy.keep(e.clone()),imag:qy.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===Wg(n))return bx([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,o=bE(e.shape,t,n);if(r||!o){var a=Eg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ck(n):new uk(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=this.makeOutput(n,e.dtype),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=xE(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var o=mE(t,n,r);if(o.some(function(e){return 0===e}))return bx([],o);var a=new fk(t,r,o);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=Eg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ok(e.shape,t):new rk(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map(function(e){return gx(e)}),r=e.map(function(e){return yx(e)});return mx(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>Eg().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),a=this.concat(e.slice(0,o),t),i=this.concat(e.slice(o),t);return this.concat([a,i],t)}if(Eg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new VC(e.map(function(e){return e.shape}),t);return this.compileAndRun(s,e)}var u=hx(e.map(function(e){return e.shape}),t),l=e.map(function(e){return e.as2D(-1,Wg(e.shape.slice(t)))}),c=new jC(l.map(function(e){return e.shape}));return this.compileAndRun(c,l).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kk,e.dtype);var t=new yk(e.shape,kk);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=SE(e,[0,2,1])),r&&(t=SE(t,[0,2,1]));var u=1===a?e:e.as3D(s,i,1),l=1===a?2:1,c=1===a?t.as3D(s,1,i):t;return this.multiply(u,c).sum(l,!0)}var f=By(e.dtype,t.dtype),d=new jS(e.shape,[s,o,a],n,r);return this.compileAndRun(d,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],l=o?n.shape[1]:n.shape[2],c=t.shape[0],f=By(t.dtype,n.dtype),d=null!=a,p=null!=s,h=i?Gk(i,!0):null,v=new jS(t.shape,[c,u,l],r,o,d,h,p),m=[t,n];return a&&m.push(a),s&&m.push(s),this.compileAndRun(v,m,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new AC("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new AC("return areal * bimag + aimag * breal;",e.shape,t.shape),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,FC,e.dtype);var c=new MC(FC,e.shape,t.shape);return this.compileAndRun(c,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),Eg().getBool("WEBGL_PACK_NORMALIZATION")){var l=new TC(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)}var c=new NC(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=Eg().getBool("WEBGL_PACK_NORMALIZATION")?new zS(e.shape,t,n,r,o):new LS(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new BS(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map(function(e){return yy(e)});return nC(Bx(e.shape,e.dtype,n),t)}var r=new vk(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=Eg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new KS(e.shape,t,n):new qS(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new hS(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){Mg(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=Xx(e.shape,t,r),a=Yx(o.length,t.length),i=Qx(e.shape,t,r),s=Jx(n,t.length),u=Zx(i,n,t.length);return SE(e.reshape(o),a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Mg(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Xx(i.shape,t,r,!1),u=Yx(s.length,t.length,!1),l=Qx(i.shape,t,r,!1);return SE(i.reshape(s),u).reshape(l)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=cE(o),i=new YS({windowSize:a,inSize:o,batchSize:r},t),s=this.compileAndRun(i,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=cE(o),i=new sC({windowSize:a,inSize:o,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=cE(r[r.length-1]),a=new RC(r,o,t,null==n),i=null==n?[e]:[e,n],s=this.compileAndRun(a,i,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){lx("sum",t,e.rank);var n=sx(e.shape,t),r=n[0],o=Wg(n[1]),a=e.as2D(-1,o),i=zy(e.dtype);return this.reduce(a,"sum",i).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=sx(e.shape,t),r=n[0],o=Wg(n[1]),a=e.as2D(-1,o),i=zy(e.dtype);return this.reduce(a,"prod",i).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=cx([r],e.rank),a=e;null!=o&&(a=SE(e,o),r=dx(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=Wg([a.shape[r]]),u=a.as2D(-1,s),l=zy(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(i);return null!=o&&(c=SE(c,fx(o))),c},t.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=ly(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ly(e,n+1);return n}(i,o),u=new ik({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),l=this.compileAndRun(u,[e,n],r);return l.shape[1]===o?l:(n=Nx(0,o).tile([i/s]),this.segOpCompute(l,t,n,r,o))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(lx("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!Eg().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=sx(e.shape,r),a=o[0],i=Wg(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new nS(e.shape,n,r);return this.compileAndRun(o,[e])},t.prototype.equal=function(e,t){if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new MC("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new MC("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new MC("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new MC("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new MC("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new MC("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new yk(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new MC("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new MC("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new sk(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],By(t.dtype,n.dtype))},t.prototype.where=function(e){ex("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return oC(e.shape,t)},t.prototype.topk=function(e,t,n){return rC(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){lx("min",t,e.rank);var n=sx(e.shape,t),r=n[0],o=Wg(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new MC("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new MC("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);lx("max",t,e.rank);var n=sx(e.shape,t),r=n[0],o=Wg(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new MC("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){lx("all",t,e.rank);var n=sx(e.shape,t),r=n[0],o=Wg(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){lx("any",t,e.rank);var n=sx(e.shape,t),r=n[0],o=Wg(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.floorDiv=function(e,t){if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new MC("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,DC);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=By(e.dtype,t.dtype);if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,DC,n);var r=new MC(DC,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new jk(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,o){void 0===o&&(o=!1);var a=new BC(n,e.shape,t.shape,o);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,i),l=new MC(n,e.shape,t.shape);return r.compileAndRun(l,[s,u],By(a.dtype,i.dtype))}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>Eg().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var o=e.map(function(e){return e.dtype}).reduce(function(e,t){return By(e,t)}),a=e.map(function(e){return e.shape}),i=Eg().getBool("WEBGL_PACK")?new iC(e[0].shape,a):new aC(e[0].shape,a);return this.compileAndRun(i,e,o)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,OC);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=By(e.dtype,t.dtype);if(Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,OC,e.dtype);var r=new MC(OC,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new MC("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=By(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Rk,e.dtype);var t=new yk(e.shape,Rk);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_k,e.dtype);var t=new yk(e.shape,_k);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new yk(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new yk(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new yk(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new yk(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new yk(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ik,e.dtype);var t=new yk(e.shape,Ik);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Nk,e.dtype);var t=new yk(e.shape,Nk);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=$g([t],e.shape),r=this.max(e,n),o=ux(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return uE(i,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new yk(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new yk(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new yk(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new yk(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new yk(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=Eg().getBool("WEBGL_PACK")?new jk(e.shape,zk):new yk(e.shape,wk),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=Eg().getBool("WEBGL_PACK")?new jk(e.shape,Wk):new yk(e.shape,Ek),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC(LC,e.shape,t.shape):new MC(PC,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Uk,e.dtype);var t=new yk(e.shape,Ck);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new MC("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new yk(e.shape,Sk);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new yk(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,o=(r=Eg().getBool("WEBGL_PACK_CLIP")?new WC(e.shape):new zC(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(Eg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,xk,e.dtype);var t=new yk(e.shape,xk);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new UC(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new yk(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new yk(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new yk(e.shape,Tk);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new yk(e.shape,Ak);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new yk(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new yk(e.shape,Dk);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new yk(e.shape,Ok);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new yk(e.shape,Fk);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new MC("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new yk(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new yk(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new yk(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new yk(e.shape,Pk);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new yk(e.shape,Mk);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new yk(e.shape,Lk);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new yk(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new yk(e.shape,function(e){return void 0===e&&(e=0),bk+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,o,a){var i=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,l=i[0]*i[1]*i[2],c=n.outChannels,f="channelsLast"===n.dataFormat,d=(1===l||1===c)&&u>1e3,p=i[2]%2!=0&&!!s.isPacked;if(d||!Eg().getBool("WEBGL_LAZILY_UNPACK")||!Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var h=f?i[0]*i[1]*i[2]:i[0]*i[2]*i[3],v=this.reshape(e,[1,h,n.inChannels]),m=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:m,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),n.outShape)}var g=f?i[0]*i[1]*(i[2]+1):i[0]*i[2]*(i[3]+1),y={dataId:e.dataId,shape:[1,g,n.inChannels],dtype:e.dtype},b=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,Mg(zb(s.shape,y.shape),function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"});var x=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),E=this.texData.get(w.dataId);return Mg(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=b,E.shape=n.outShape,qy.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,o,a){var i=n.filterWidth,s=n.filterHeight,u=n.inChannels,l=n.outWidth,c=n.outHeight,f="channelsLast"===n.dataFormat,d=i*s*u,p=c*l,h=[d,p],v=e.squeeze([0]),m=t.reshape([1,d,-1]),g=new MS(h,v.shape,n),y=this.compileAndRun(g,[v]).reshape([1,h[0],h[1]]),b=null!=r,x=null!=a,w=o?Gk(o,!0):null,E=new jS(y.shape,[1,p,n.outChannels],!0,!1,b,w,x),C=[y,m];r&&C.push(r),x&&C.push(a);var S=this.compileAndRun(E,C);return f?S.reshape([1,c,l,n.outChannels]):S.reshape([1,n.outChannels,c,l])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,o,a,i);if(Eg().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,o,a,i);var s=null!=o,u=null!=i,l=a?Gk(a,!1):null,c=new QC(r,s,l,u),f=[t,n];return o&&f.push(o),i&&f.push(i),this.compileAndRun(c,f)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(Eg().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new QC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new qC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new GC(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,o=e.convInfo,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=Eg().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=i?Gk(i,u):null,c=[n,r],f=null!=a,d=null!=s;return f&&c.push(a),d&&c.push(s),u?(t=new eS(o,f,l,d),this.compileAndRun(t,c)):(t=new ZC(o,f,l,d),this.compileAndRun(t,c))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return Eg().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new eS(n),this.compileAndRun(r,[e,t])):(r=new ZC(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new YC(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new XC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new JC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new $C(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new KC(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new $S(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new $S(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var o=new $S(r,"max",!0),a=this.compileAndRun(o,[t]),i=new WS(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new _C(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return WE(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new XS(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new IC(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new XS(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var o=new XS(r,"max",!0),a=this.compileAndRun(o,[t]),i=new US(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!zb(e.shape,t)&&(null===n.texture||!zb(n.shape,t))){var r=this.packedReshape(e,t);return qy.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return UE(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var o=Eg().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ek(e.shape,t,n,r):new ZS(e.shape,t,n,r);return this.compileAndRun(o,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new JS(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new nk(e.shape,t,n,r);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new tk(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var o=t?e:EE(e),a=o.shape[0],i=o.shape[1],s=new VS(a,i,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var o=new HS(e.size,t,n,r);return this.compileAndRun(o,[e])},t.prototype.diag=function(e){var t=new sS(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return ex("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),XE(e.dataSync(),t.dataSync(),n,r,o)},t.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new tS(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){Mg(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,l=i/(t*t),c=new iS("NHWC"===n?[r,s,u,l]:[r,l,s,u],t,n);return this.compileAndRun(c,[e])},t.prototype.split=function(e,t,n){return tC(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=pE(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/i,i],c=e.reshape([a,o]),f=t.reshape([a,i]);if(0===u)return UE(bx([]),n);var d=wx(0),p=new ak(a,o,c.rank,f.rank,s,l);return this.compileAndRun(p,[f,c,d]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var o=pE(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new ak(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new dS("return real * expR - imag * expI;",e.shape,t),o=new dS("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=lE(e,t),a=o[0],i=o[1],s=o[2],u=o[3],l=t.reshape([i,r]),c=e.reshape([e.size/s,s]),f=new vS(r,u,[i,s]);return this.compileAndRun(f,[c,l]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||sy(t))){var r=Qg(n,Wg(e));return r.fill(t),qy.makeTensor(r,e,n,this)}var o=new pS(e,t),a=o.getCustomSetupFunc(t);return this.compileAndRun(o,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return jE(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return qy.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new Vk(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new GS(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Fb(e.shape)].concat(Pb(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[Fb(t)].concat(Pb(t)),a=new QS(o,n),i=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,o=n.shape,a=n.dtype,i=Mb(o);return t=r?new aS(i):new oS(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(t,[{shape:i,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,o){var a=this;void 0===o&&(o=!1);var i=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(i.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Xy.DENSE){var u=rb(e.outputShape);s.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===Wg(i.shape))return s.values=Yg(i.dtype,0),i;var l=[],c=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Wg(t.shape)<=Eg().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!zb(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),l.push(t),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(i.dataId);var f,d={shape:i.shape,texData:s,isUniform:!1},p=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,c,d),h=this.getAndSaveBinary(p,function(){return function(e,t,n,r){var o=t.userCode,a=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=hC(a,s,o,t.packedInputs),l=e.createProgram(u),c=null,f=e.getUniformLocation(l,"NAN",!1);1===Eg().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var d={},p=0;p<t.variableNames.length;p++){var h=t.variableNames[p];d[h]=e.getUniformLocation(l,h,!1),d["offset"+h]=e.getUniformLocation(l,"offset"+h,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:d,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:f}}(a.gpgpu,e,c,d)}),v=null!=this.activeTimers;if(v&&(f=this.startTimer()),function(e,t,n,r,o){PS(t.inShapeInfos,n),PS([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===Eg().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(Wg(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,h,c,d,r),l.forEach(function(e){return a.disposeData(e.dataId)}),v&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!Eg().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var m=this.unpackTensor(i);return this.disposeData(i.dataId),m}return i},t.prototype.compileAndRun=function(e,t,n,r,o){void 0===o&&(o=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,o);return qy.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(Eg().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Jb(function(){if(!Eg().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Eg().getBool("DEBUG");Eg().set("DEBUG",!1);var n=e.abs(wx(1e-8)).dataSync()[0];if(Eg().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=vy());var f=n.texShape;if(null==f&&(f=Lb(r,u),n.texShape=f),null!=a){var d=Mb(r),p=void 0,h=f[1],v=f[0],m=a instanceof Uint8Array;u?(h=(t=ob(f[0],f[1]))[0],v=t[1],p=new fS(d,[v,h],m)):p=new cS(d,[v,h],m);var g=this.makeTensorInfo([v,h],o);this.texData.get(g.dataId).usage=m?Yy.PIXELS:Yy.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),h,v,a);var y=this.runWebGLProgram(p,[g],o,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,c&&(this.uploadWaitMs+=vy()-l)}else{var x=this.acquireTexture(f,s,o,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*ny(t)},t}(RE);function Kk(e,t){return e(t={exports:{}},t.exports),t.exports}Ky()&&qy.registerBackend("webgl",function(){return new qk},2),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var $k=Kk(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var o=new n(e),a=t&&t.state,i=o.next;return i.int32=function(){return 4294967296*o.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.alea=o}(0,e)}),Xk=Kk(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor128=o}(0,e)}),Yk=Kk(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)}),Qk=Kk(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.x&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)}),Jk=Kk(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.X&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)}),Zk=Kk(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.tychei=o}(0,e)}),eR=Kk(function(e){!function(t,r){var o,a=this,i=256,s="random",u=r.pow(i,6),l=r.pow(2,52),c=2*l,f=255;function d(e,n,f){var d=[],g=v(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,m(t)]}}():e,3),d),y=new p(d),b=function(){for(var e=y.g(6),t=u,n=0;e<l;)e=(e+n)*i,t*=i,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,v(m(y.S),t),(n.pass||f||function(e,t,n,o){return o&&(o.S&&h(o,y),e.state=function(){return h(y,{})}),n?(r[s]=e,t):e})(b,g,"global"in n?n.global:this==r,n.state)}function p(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=f&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=f&o+1],n=n*i+s[f&(s[o]=s[a=f&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){for(var n,r=e+"",o=0;o<r.length;)t[f&o]=f&(n^=19*t[f&o])+r.charCodeAt(o++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=d,v(r.random(),t),e.exports){e.exports=d;try{o=n(475)}catch(e){}}}([],Math)});eR.alea=$k,eR.xor128=Xk,eR.xorwow=Yk,eR.xorshift7=Qk,eR.xor4096=Jk,eR.tychei=Zk;var tR=eR.alea,nR=vx({addN_:function(e){Mg(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Mg(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return rx(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Ug(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return qy.runKernelFunc(function(e,n){return e.addN(t)},r,null,"AddN")}});function rR(){Qb("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function oR(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function aR(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u=rx(e,"x","batchNorm"),l=rx(t,"mean","batchNorm"),c=rx(n,"variance","batchNorm");null!=o&&(i=rx(o,"scale","batchNorm")),null!=r&&(s=rx(r,"offset","batchNorm")),Mg(l.rank===c.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Mg(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Mg(null==i||l.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f={x:u,scale:i,offset:s,mean:l,variance:c},d={varianceEpsilon:a};return qy.runKernelFunc(function(e,t){var n=oR(u),r=e.batchNormalization(n,iR(l),iR(c),a,iR(i),iR(s));return t([u,l,c,i]),r},f,null,"FusedBatchNorm",d).reshape(u.shape)}function iR(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var sR=vx({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),rR(),aR(e,t,n,a,o,r)}}),uR=vx({batchNorm_:aR});function lR(e,t,n,r,o,a){var i,s,u=rx(e,"x","batchNorm"),l=rx(t,"mean","batchNorm"),c=rx(n,"variance","batchNorm");return null!=o&&(i=rx(o,"scale","batchNorm")),null!=r&&(s=rx(r,"offset","batchNorm")),Mg(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Mg(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),Mg(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&Mg(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&Mg(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),uR(u,l,c,s,i,a)}var cR=vx({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),rR(),lR(e,t,n,a,o,r)}}),fR=vx({batchNorm2d_:lR});function dR(e,t,n,r,o,a){var i,s,u=rx(e,"x","batchNorm"),l=rx(t,"mean","batchNorm"),c=rx(n,"variance","batchNorm");return null!=o&&(i=rx(o,"scale","batchNorm")),null!=r&&(s=rx(r,"offset","batchNorm")),Mg(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Mg(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),Mg(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&Mg(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&Mg(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),uR(u,l,c,s,i,a)}var pR=vx({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),rR(),dR(e,t,n,a,o,r)}}),hR=vx({batchNorm3d_:dR});function vR(e,t,n,r,o,a){var i,s,u=rx(e,"x","batchNorm"),l=rx(t,"mean","batchNorm"),c=rx(n,"variance","batchNorm");return null!=o&&(i=rx(o,"scale","batchNorm")),null!=r&&(s=rx(r,"offset","batchNorm")),Mg(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),Mg(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),Mg(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&Mg(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&Mg(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),uR(u,l,c,s,i,a)}var mR=vx({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),rR(),vR(e,t,n,a,o,r)}}),gR=vx({batchNorm4d_:vR}),yR=vx({broadcastTo_:function(e,t){var n=rx(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var a=n.shape,i=Array.from(t),s=t.length-1;s>=0;s--)if(a[s]===t[s])i[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var u=i.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0});if(0===u.length)return n.clone();var l={x:n},c={shape:t,inputShape:a};return qy.runKernelFunc(function(e){return e.tile(n,i)},l,function(e){return{x:function(){return e.sum(u,!0)}}},nw,c)}}),bR=vx({clone_:function(e){var t=rx(e,"x","clone",null);return qy.runKernelFunc(function(){return qy.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{x:t},null,ow)}}),xR=vx({logicalAnd_:function(e,t){var n=rx(e,"a","logicalAnd","bool"),r=rx(t,"b","logicalAnd","bool");return cw(n.shape,r.shape),qy.runKernelFunc(function(e){return e.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),wR=vx({logicalNot_:function(e){var t=rx(e,"x","logicalNot","bool");return qy.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),ER=vx({logicalOr_:function(e,t){var n=rx(e,"a","logicalOr","bool"),r=rx(t,"b","logicalOr","bool");return cw(n.shape,r.shape),qy.runKernelFunc(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),CR=vx({logicalXor_:function(e,t){var n=rx(e,"a","logicalXor","bool"),r=rx(t,"b","logicalXor","bool");return cw(n.shape,r.shape),ER(e,t).logicalAnd(xR(e,t).logicalNot())}}),SR=vx({where_:function(e,t,n){var r=rx(t,"a","where"),o=rx(n,"b","where"),a=rx(e,"condition","where","bool");return Lg(r.shape,o.shape,"Error in where: "),1===a.rank?Mg(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Lg(a.shape,o.shape,"Error in where: "),qy.runKernelFunc(function(e,t){var n=e.select(a,r,o);return t([a]),n},{$condition:a,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return Ax(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),kR=function(e){return bg(this,void 0,void 0,function(){var t,n,r;return xg(this,function(o){switch(o.label){case 0:return[4,(t=rx(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=oC(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},RR=vx({divNoNan_:function(e,t){var n,r=rx(e,"a","div"),o=rx(t,"b","div");r=(n=Wy(r,o))[0],o=n[1];var a=uE(r,o),i=Ax(a),s=o.equal(i);return SR(s,i,a)}}),_R=vx({tile_:function(e,t){var n=rx(e,"x","tile",null);Mg(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={x:n},a={reps:t};return qy.runKernelFunc(function(e,r){var o=e.tile(n,t);return r([n]),o},o,null,aw,a,r)}}),IR=vx({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=Bx([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return _R(Vx(s,0),[n[0],1,1]);if(2===n.length)return _R(Vx(Vx(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return _R(Vx(Vx(Vx(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),NR=vx({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=rx(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=qy.runKernelFunc(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===i?u.as1D():u}}),TR=vx({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=rx(e,"indices","oneHot","int32"),a=o.shape.concat([t]),i={indices:o=o.flatten()},s={depth:t,onValue:n,offValue:r};return qy.runKernelFunc(function(e,a){return a([o]),e.oneHot(o,t,n,r)},i,null,rw,s).reshape(a)}}),AR=vx({pad_:function(e,t,n){void 0===n&&(n=0);var r=rx(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n},a={x:r};return qy.runKernelFunc(function(e,o){return o([r]),e.pad(r,t,n)},a,null,iw,o)}}),DR=vx({pad1d_:function(e,t,n){return void 0===n&&(n=0),Mg(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),AR(e,[t],n)}}),OR=vx({pad2d_:function(e,t,n){return void 0===n&&(n=0),Mg(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),AR(e,t,n)}}),FR=vx({pad3d_:function(e,t,n){return void 0===n&&(n=0),Mg(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),AR(e,t,n)}}),PR=vx({pad4d_:function(e,t,n){return void 0===n&&(n=0),Mg(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),AR(e,t,n)}}),MR=vx({rand_:function(e,t,n){var r=Wg(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return qy.makeTensor(o,e,n)}});function LR(){return 32===qy.backend.floatPrecision()?.001:.1}function BR(e,t,n){var r=!0;if((ty(e)||ty(t))&&(r=!1),ty(e)&&ty(t)&&(r=!0),r){var o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var i=tx(e),s=tx(t);if(!Ug(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=ty(e)?e:zg(e),l=ty(t)?t:zg(t);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var f=u[c],d=l[c];if(!n(f,d))throw new Error("Arrays differ: actual["+c+"] = "+f+", expected["+c+"] = "+d+".\nActual:   "+u+".\nExpected: "+l+".")}}function zR(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=LR()),BR(e,t,function(e,t){return zR(e,t,n)})},testEpsilon:LR,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return oy(e)||oy(e[0])||oy(t)||oy(t[0])?BR(e,n,function(e,t){return e==t}):BR(e,t,function(e,t){return zR(e,t,0)})},expectNumbersClose:function(e,t,n){if(null==n&&(n=LR()),!zR(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}});var WR=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=tR(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),UR=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var o=r||Math.random();this.randu=tR(o.toString()),this.randn=new WR(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,o,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),jR=function(){function e(e,t,n,r){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=tR(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}(),VR=vx({randomGamma_:function(e,t,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new UR(t,n,r,o),i=Bx(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),HR=vx({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new WR(t,n,r,!1,o),i=Bx(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),GR=vx({randomUniform_:function(e,t,n,r,o){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Bx(e,r),i=new jR(t,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),qR=vx({square_:function(e){var t=rx(e,"x","square"),n=[t];return qy.runKernelFunc(function(e,n){return n([t]),e.square(t)},{x:t},null,"Square",{},n,[])}}),KR=vx({squaredDifference_:function(e,t){var n,r=rx(e,"a","squaredDifference"),o=rx(t,"b","squaredDifference");n=Wy(r,o),r=n[0],o=n[1],cw(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return qy.runKernelFunc(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},a,function(e,t){var n=t[0],r=t[1],o=wx(2);return{a:function(){return e.mul(n.sub(r).mul(o))},b:function(){return e.mul(r.sub(n).mul(o))}}},tw,{},i,[])}}),$R=vx({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var a=new WR(t,n,r,!0,o),i=Bx(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),XR=vx({equal_:function(e,t){var n,r=rx(e,"a","equal"),o=rx(t,"b","equal");return n=Wy(r,o),r=n[0],o=n[1],cw(r.shape,o.shape),qy.runKernelFunc(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),YR=vx({equalStrict_:function(e,t){var n=rx(e,"a","equalStrict"),r=rx(t,"b","equalStrict");return Lg(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),QR=vx({greater_:function(e,t){var n,r=rx(e,"a","greater"),o=rx(t,"b","greater");return n=Wy(r,o),r=n[0],o=n[1],cw(r.shape,o.shape),qy.runKernelFunc(function(e){return e.greater(r,o)},{a:r,b:o},null,"Greater")}}),JR=vx({greaterEqual_:function(e,t){var n,r=rx(e,"a","greaterEqual"),o=rx(t,"b","greaterEqual");return n=Wy(r,o),r=n[0],o=n[1],cw(r.shape,o.shape),qy.runKernelFunc(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return Ax(n)},b:function(){return Ax(r)}}},"GreaterEqual")}}),ZR=vx({greaterEqualStrict_:function(e,t){var n=rx(e,"a","greaterEqualStrict"),r=rx(t,"b","greaterEqualStrict");return Lg(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),e_=vx({greaterStrict_:function(e,t){var n=rx(e,"a","greaterStrict"),r=rx(t,"b","greaterStrict");return Lg(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),t_=vx({less_:function(e,t){var n,r=rx(e,"a","less"),o=rx(t,"b","less");return n=Wy(r,o),r=n[0],o=n[1],cw(r.shape,o.shape),qy.runKernelFunc(function(e){return e.less(r,o)},{a:r,b:o},null,"Less")}}),n_=vx({lessEqual_:function(e,t){var n,r=rx(e,"a","lessEqual"),o=rx(t,"b","lessEqual");return n=Wy(r,o),r=n[0],o=n[1],cw(r.shape,o.shape),qy.runKernelFunc(function(e,t){var n=e.lessEqual(r,o);return t([r,o]),n},{a:r,b:o},null,"LessEqual")}}),r_=vx({lessEqualStrict_:function(e,t){var n=rx(e,"a","lessEqualStrict"),r=rx(t,"b","lessEqualStrict");return Lg(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),o_=vx({lessStrict_:function(e,t){var n=rx(e,"a","lessStrict"),r=rx(t,"b","lessStrict");return Lg(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),a_=vx({notEqual_:function(e,t){var n,r=rx(e,"a","notEqual"),o=rx(t,"b","notEqual");return n=Wy(r,o),r=n[0],o=n[1],cw(r.shape,o.shape),qy.runKernelFunc(function(e){return e.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),i_=vx({notEqualStrict_:function(e,t){var n=rx(e,"a","notEqualStrict"),r=rx(t,"b","notEqualStrict");return Lg(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function s_(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function u_(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var l_=vx({gather_:function(e,t,n){void 0===n&&(n=0);var r=rx(e,"x","gather"),o=rx(t,"indices","gather","int32");n=$g(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return qy.runKernelFunc(function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a},{x:r,indices:o},function(e,t){var o=t[0];return{x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),l=u.length,c=s_(0,s),f=s_(s+1,s+1+l),d=u_([i,[a],u]),p=e.reshape(d),h=o.reshape([a]),v=u_([[s],c,f]),m=p.transpose(v),g=c_(m,h,r.shape[n]),y=fx(v);return g.transpose(y)},indices:function(){return o}}},"Gather",{axis:n}).reshape(a.outputShape)}}),c_=vx({unsortedSegmentSum_:function(e,t,n){var r=rx(e,"x","unsortedSegmentSum"),o=rx(t,"segmentIds","unsortedSegmentSum","int32");return Mg(jg(n),function(){return"numSegments must be of dtype int"}),qy.runKernelFunc(function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Xw(t,Ax(t)),r=l_(e,n),o=JR(t,wx(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=Vx(o,i+1);o=xR(o,Rx(r.shape,"bool"));var s=Ax(r);return SR(o,r,s)}(e,n)}}})}});function f_(e,t,n,r,o,a,i){void 0===a&&(a="NHWC"),Mg(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;3===t.rank&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),Mg(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),Mg(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),Mg(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];Mg(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),Mg(f===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."}),null!=i&&Mg(jg(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var d=zE(a),p=TE(s,n.shape,r,1,o,i,!1,d),h=qy.runKernelFunc(function(e,t){var r=e.conv2dDerInput(u,n,p);return t([n,u]),r},{dy4D:u,filter:n},function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return v_(e,n,r,o,a,1,i)},filter:function(){return g_(e,s,n.shape,r,o,a,i)}}});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function d_(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function p_(e,t,n,r,o){Mg(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];Mg(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),Mg(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),Mg(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),Mg(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),Mg(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=AE(a,n.shape,r,1,o),f=qy.runKernelFunc(function(e){return e.conv3dDerInput(i,n,c)},{dy5D:i});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var h_=vx({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=rx(e,"x","conv1d"),u=rx(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),Mg(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),Mg(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&Mg(jg(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),Mg(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),Mg(BE(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),Mg("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),p=v_(d,f,[1,n],r,"NHWC",[1,a],i);return c?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),v_=vx({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=rx(e,"x","conv2d"),u=rx(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Mg(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),Mg(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&Mg(jg(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f="NHWC"===o?l.shape[3]:l.shape[1];Mg(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."}),Mg(BE(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"});var d=zE(o),p=TE(l.shape,u.shape,n,a,r,i,!1,d),h=[u,l],v=qy.runKernelFunc(function(e,t){var n=e.conv2d(l,u,p);return t([u,l]),n},{x:l,filter:u},function(e,t){var i=t,s=i[0],u=i[1];return Mg(LE(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return y_(u.shape,e,s,n,r,o)},filter:function(){return g_(u,e,s.shape,n,r,o)}}},"Conv2D",p,h);return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),m_=vx({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=rx(e,"x","conv3d"),s=rx(t,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),Mg(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Mg(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),Mg(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),Mg(function(e,t){return d_(e)||d_(t)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),Mg("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=AE(u.shape,s.shape,n,a,r),f=qy.runKernelFunc(function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n},{x:u,$filter:s},function(e,t){Mg(d_(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=t[0],i=t[1];return{x:function(){return p_(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),Mg(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),Mg(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),Mg(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),Mg(a.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."}),Mg(i.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=AE(a.shape,n,r,1,o);return qy.runKernelFunc(function(e){return e.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),g_=vx({conv2dDerFilter_:function(e,t,n,r,o,a,i){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Mg(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),Mg(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),Mg(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];Mg(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),Mg(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),null!=i&&Mg(jg(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=zE(a),d=TE(s.shape,n,r,1,o,i,!1,f);return qy.runKernelFunc(function(e){return e.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),y_=vx({conv2dDerInput_:f_}),b_=vx({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=rx(e,"x","depthwiseConv2d"),u=rx(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Mg(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),Mg(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),Mg(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),Mg(BE(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&Mg(jg(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f=TE(l.shape,u.shape,n,a,r,i,!0),d=[l,u],p=qy.runKernelFunc(function(e,t){var n=e.depthwiseConv2D(l,u,f);return t([l,u]),n},{x:l,filter:u},function(e,t){Mg(LE(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var n=t[0],r=t[1];return{x:function(){return x_(n.shape,e,r,f)},filter:function(){return w_(n,e,r.shape,f)}}},"DepthwiseConv2dNative",f,d);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),x_=vx({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=qy.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),w_=vx({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),qy.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}}),E_=vx({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=rx(e,"x","separableConv2d"),u=rx(t,"depthwiseFilter","separableConv2d"),l=rx(n,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(3===s.rank&&(f=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Mg(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),Mg(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),Mg(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),Mg(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),Mg(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],p=u.shape[3];Mg(l.shape[2]===d*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*p+", but got "+l.shape[2]+"."});var h=b_(c,u,r,o,i,a),v=v_(h,l,1,"valid",i);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),C_=vx({conv2dTranspose_:function(e,t,n,r,o,a){return f_(n,rx(e,"x","conv2dTranspose"),rx(t,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),S_=vx({conv3dTranspose_:function(e,t,n,r,o){return p_(n,rx(e,"x","conv3dTranspose"),rx(t,"filter","conv3dTranspose"),r,o)}}),k_=vx({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=rx(e,"a","matMul"),i=rx(t,"b","matMul");o=Wy(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],f=a.shape.slice(0,-2),d=i.shape.slice(0,-2),p=Wg(f),h=Wg(d);Mg(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),Mg(Ug(f,d),function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),Mg(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=a.shape.slice(0,-2).concat([l,c]),m=n?a.as3D(p,s,l):a.as3D(p,l,s),g=r?i.as3D(h,c,u):i.as3D(h,u,c),y={transposeA:n,transposeB:r};return qy.runKernelFunc(function(e,t){var o=e.batchMatMul(m,g,n,r);return t([m,g]),o},{a:m,b:g},function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{a:function(){return e.matMul(i,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return i.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return i.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(i,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}},"BatchMatMul",y).reshape(v)}}),R_=vx({dot_:function(e,t){var n=rx(e,"t1","dot"),r=rx(t,"t2","dot");Mg(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return Mg(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),__=vx({outerProduct_:function(e,t){var n=rx(e,"v1","outerProduct"),r=rx(t,"v2","outerProduct");return Mg(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),I_=vx({reverse_:function(e,t){var n=rx(e,"x","reverse");if(0===n.rank)return n.clone();var r=$g(t,n.shape);return qy.runKernelFunc(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),N_=vx({reverse1d_:function(e){var t=rx(e,"x","reverse");return Mg(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),I_(t,0)}}),T_=vx({reverse2d_:function(e,t){var n=rx(e,"x","reverse");return Mg(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),I_(n,t)}}),A_=vx({reverse3d_:function(e,t){var n=rx(e,"x","reverse");return Mg(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),I_(n,t)}}),D_=vx({reverse4d_:function(e,t){var n=rx(e,"x","reverse");return Mg(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),I_(n,t)}});function O_(e,t,n,r,o,a){var i=rx(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),Mg(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Mg(BE(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=a&&Mg(jg(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=IE(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&Ug(l.inShape,l.outShape))return i.clone();var c=[s],f=qy.runKernelFunc(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=rx(e,"dy","maxPoolBackprop"),l=rx(t,"input","maxPoolBackprop"),c=rx(n,"output","maxPoolBackprop");Mg(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),Mg(BE(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),Mg(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),Mg(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var f=IE(l.shape,r,o,a,i,s);return qy.runKernelFunc(function(e){return e.maxPoolBackprop(u,l,c,f)},{$dy:u,$input:l})}(e,i,s,t,n,r,o)}}},"MaxPool",l,c);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function F_(e,t,n,r,o,a){var i=rx(e,"x","avgPool","float32");null==r&&(r=[1,1]),Mg(BE(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Mg(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&Mg(jg(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=IE(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&Ug(l.inShape,l.outShape))return i.clone();var c=qy.runKernelFunc(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,a){var i=rx(e,"dy","avgPoolBackprop"),s=rx(t,"input","avgPoolBackprop");Mg(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),Mg(BE(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Mg(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),Mg(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var f=IE(u.shape,n,r,o,a),d=qy.runKernelFunc(function(e){return e.avgPoolBackprop(l,u,f)},{dy4D:l,input4D:u});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var P_=vx({maxPool_:function(e,t,n,r,o){return O_(e,t,n,1,r,o)}}),M_=vx({avgPool_:function(e,t,n,r,o){return F_(e,t,n,1,r,o)}}),L_=vx({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=rx(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Mg(BE(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=IE(s.shape,t,a,o,r),f=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([c.filterHeight,c.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],p=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),a=e.concat(r,o),i=t.map(function(e,t){return(e-a[t]%e)%e}),s=o.map(function(e,t){return e+i[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,i[t]]})]}([c.inHeight,c.inWidth],f,l),h=p[0],v=p[1],m=d?r:"valid",g=d?s:Gx(s,f,h),y=("avg"===n?function(){return F_(g,t,a,1,m)}:function(){return O_(g,t,a,1,m)})(),b=d?y:zx(y,f,v);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),B_=vx({maxPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=rx(e,"x","maxPool3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),Mg(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),Mg("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),Mg(BE(n,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&Mg(jg(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=NE(u.shape,t,n,i,r,o,a),f=qy.runKernelFunc(function(e,t){var n=e.maxPool3d(u,c);return t([u,n]),n},{x:u},function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=rx(e,"dy","maxPool3dBackprop"),l=rx(t,"input","maxPool3dBackprop"),c=rx(n,"output","maxPool3dBackprop"),f=u,d=l,p=c,h=!1;4===l.rank&&(h=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),p=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),Mg(5===f.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."}),Mg(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),Mg(5===p.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+p.rank+"."}),null==a&&(a=[1,1,1]),Mg(BE(o,a),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),null!=s&&Mg(jg(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var v=NE(d.shape,r,o,a,i,s),m=qy.runKernelFunc(function(e){return e.maxPool3dBackprop(f,d,p,v)},{dy5D:f,input5D:d});return h?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(e,s,u,t,n,i,r,o)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),z_=vx({avgPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=rx(e,"x","avgPool3d","float32"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),Mg(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),Mg("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),Mg(BE(n,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&Mg(jg(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=NE(u.shape,t,n,i,r,o,a),f=qy.runKernelFunc(function(e){return e.avgPool3d(u,c)},{x:u},function(e){return{x:function(){return function(e,t,n,r,o,a,i){var s=rx(e,"dy","avgPool3dBackprop"),u=rx(t,"input","avgPool3dBackprop"),l=s,c=u,f=!1;4===u.rank&&(f=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),Mg(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),Mg(5===c.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),null==o&&(o=[1,1,1]),Mg(BE(r,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=i&&Mg(jg(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var d=NE(c.shape,n,r,o,a,i),p=qy.runKernelFunc(function(e){return e.avgPool3dBackprop(l,c,d)},{dy5D:l,input5D:c});return f?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}(e,u,t,n,i,r,o)}}});return f=f.cast(u.dtype),l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),W_=vx({maxPoolWithArgmax_:function(e,t,n,r,o){void 0===o&&(o=!1);var a=rx(e,"x","maxPoolWithArgmax"),i={filterSize:t,strides:n,pad:r,includeBatchInIndex:o},s=qy.runKernel("MaxPoolWithArgmax",{x:a},i);return{result:s[0],indexes:s[1]}}}),U_=vx({slice_:function(e,t,n){var r,o,a=rx(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach(function(e){Mg(-1!==e,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(Mg(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."}),a.shape[t]-r[t])}),hE(a,r,o);var i=a.shape,s={begin:r,size:o};return qy.runKernelFunc(function(e){return e.slice(a,r,o)},{x:a},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{x:function(){return AR(e,t)}}},"Slice",s)}}),j_=vx({slice1d_:function(e,t,n){var r=rx(e,"x","slice1d");return Mg(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),U_(r,[t],[n])}}),V_=vx({slice2d_:function(e,t,n){var r=rx(e,"x","slice2d");return Mg(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),U_(r,t,n)}}),H_=vx({slice3d_:function(e,t,n){var r=rx(e,"x","slice3d");return Mg(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),U_(r,t,n)}}),G_=vx({slice4d_:function(e,t,n){var r=rx(e,"x","slice4d");return Mg(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),U_(r,t,n)}});function q_(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(ux(t.shape,r))),e.rank<n.rank&&(e=e.reshape(ux(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var K_=vx({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","all","bool"),o=$g(t,r.shape),a=o,i=cx(a,r.rank);null!=i&&(r=r.transpose(i),a=dx(a.length,r.rank));var s=qy.runKernelFunc(function(e){return e.all(r,a)},{$x:r});if(n){var u=ux(s.shape,o);return s.reshape(u)}return s}}),$_=vx({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","any","bool"),o=$g(t,r.shape),a=o,i=cx(a,r.rank);null!=i&&(r=r.transpose(i),a=dx(a.length,r.rank));var s=qy.runKernelFunc(function(e){return e.any(r,a)},{$x:r});if(n){var u=ux(s.shape,o);return s.reshape(u)}return s}}),X_=vx({argMax_:function(e,t){void 0===t&&(t=0);var n=rx(e,"x","argMax");null==t&&(t=0);var r=$g(t,n.shape),o=cx(r,n.rank);null!=o&&(n=n.transpose(o),r=dx(r.length,n.rank));var a={axis:r[0]},i=[n];return qy.runKernelFunc(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{x:n},function(e,t){var n=t[0];return{x:function(){return Ax(n)}}},"ArgMax",a,i)}}),Y_=vx({argMin_:function(e,t){void 0===t&&(t=0);var n=rx(e,"x","argMin");null==t&&(t=0);var r=$g(t,n.shape),o=cx(r,n.rank);return null!=o&&(n=n.transpose(o),r=dx(r.length,n.rank)),qy.runKernelFunc(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Ax(n)}}})}}),Q_=vx({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","logSumExp"),o=$g(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=ux(s.shape,o);return s.reshape(u)}return s}}),J_=vx({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","max"),o=r,a=$g(t,r.shape),i=a,s=cx(i,r.rank);null!=s&&(r=r.transpose(s),i=dx(i.length,r.rank));var u=[r],l=qy.runKernelFunc(function(e,t){var n=e.max(r,i);return t([o,n]),n},{x:r},function(e,t){return q_(e,t[1],t[0],a,s)},"Max",{axes:i},u,[!0]);if(n){var c=ux(l.shape,a);l=l.reshape(c)}return l}}),Z_=vx({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","mean"),o=$g(t,r.shape),a=Wg(sx(r.shape,o)[1]);return wE(function(e){var r=wx(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Rx(e.shape,"float32")).div(a)}}})(r)}}),eI=vx({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","min"),o=r,a=$g(t,r.shape),i=a,s=cx(i,r.rank);null!=s&&(r=r.transpose(s),i=dx(i.length,r.rank));var u=[r],l=qy.runKernelFunc(function(e,t){var n=e.min(r,i);return t([o,n]),n},{x:r},function(e,t){return q_(e,t[1],t[0],a,s)},"Min",{axes:i},u,[!0]);if(n){var c=ux(l.shape,a);l=l.reshape(c)}return l}}),tI=vx({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$g(t,(e=rx(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;n||(a=ux(o.shape,r));var i=e.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),nI=vx({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=$g(t,r.shape);return wE(function(e){var t=cx(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=dx(r.length,e.rank));var i=function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Rx(e.shape,"float32"))},s={axes:r},u=qy.runKernelFunc(function(e){return e.sum(a,r)},{x:a},function(e){return{x:function(){return i(e)}}},"Sum",s);if(n){var l=ux(u.shape,o);u=u.reshape(l)}return{value:u,gradFunc:i}})(r)}}),rI=vx({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rx(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=$g(t,r.shape),a=cx(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=dx(i.length,r.rank));var u=qy.runKernelFunc(function(e){return e.prod(s,i)},{permutedX:s});if(n){var l=ux(u.shape,o);u=u.reshape(l)}return u}}),oI=vx({elu_:function(e){var t=rx(e,"x","elu");return qy.runKernelFunc(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return qy.runKernelFunc(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),aI=vx({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=rx(e,"x","leakyRelu");return Xw(wx(t).mul(n),n)}}),iI=vx({prelu_:function(e,t){var n=rx(e,"x","prelu"),r=rx(t,"alpha","prelu");return qy.runKernelFunc(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{x:n,alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{x:function(){return SR(o,e,e.mul(r))},alpha:function(){var t=SR(o,Ax(e),e.mul(n)),a=lw(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}},"Prelu")}}),sI=vx({relu_:function(e){var t=rx(e,"x","relu");return"bool"===t.dtype?t.toInt():qy.runKernelFunc(function(e,n){var r=e.relu(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}}),uI=vx({relu6_:function(e){var t=rx(e,"x","relu6");return"bool"===t.dtype?t.toInt():qy.runKernelFunc(function(e,n){var r=e.relu6(t);return n([t]),r},{x:t},function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}},"Relu6")}}),lI=vx({selu_:function(e){var t=rx(e,"x","selu");return qy.runKernelFunc(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(wx(0)),r=wx(mk),o=wx(gk),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return SR(t,a,i)}}})}}),cI=vx({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=rx(e,"x","localResponseNormalization");Mg(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),Mg(jg(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=qy.runKernelFunc(function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return qy.runKernelFunc(function(a){return a.LRNGrad(e,i,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),fI=vx({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(wx(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=rx(e,"x","norm"),t,n),a=o.shape;if(r){var i=$g(n,e.shape);a=ux(o.shape,i)}return o.reshape(a)}}),dI=vx({basicLSTMCell_:function(e,t,n,r,o,a){var i=rx(e,"forgetBias","basicLSTMCell"),s=rx(t,"lstmKernel","basicLSTMCell"),u=rx(n,"lstmBias","basicLSTMCell"),l=rx(r,"data","basicLSTMCell"),c=rx(o,"c","basicLSTMCell"),f=rx(a,"h","basicLSTMCell"),d=l.concat(f,1).matMul(s).add(u),p=d.shape[0],h=d.shape[1]/4,v=[p,h],m=d.slice([0,0],v),g=d.slice([0,h],v),y=d.slice([0,2*h],v),b=d.slice([0,3*h],v),x=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(i.add(y).sigmoid())),w=x.tanh().mulStrict(b.sigmoid());return[x,w]}}),pI=vx({multiRNNCell_:function(e,t,n,r){for(var o=rx(t,"data","multiRNNCell"),a=ox(n,"c","multiRNNCell"),i=ox(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var f=[],d=[];for(l=0;l<u.length;l+=2)f.push(u[l]),d.push(u[l+1]);return[f,d]}}),hI=vx({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=rx(e,"v","movingAverage"),i=rx(t,"x","movingAverage"),s=rx(n,"decay","movingAverage");Uy(a,i),Mg(Ug(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=wx(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){Mg(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=rx(r,"step","movingAverage");c=c.div(u.sub(rE(s,f)))}return a.add(c)}}),vI=vx({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var l=rx(e,"x","stridedSlice"),c=vE(s),f=l.shape.slice();c.forEach(function(e){t[e]=0,n[e]=1,f.splice(e,0,1)}),l=l.reshape(f);for(var d=0;d<l.rank;d++)t[d]=gE(o,t,r,l.shape,d),n[d]=yE(a,n,r,l.shape,d),r[d]=r[d]||1;var p=vE(u);p.forEach(function(e){n[e]=t[e]+1,r[e]=1});var h=mE(t,n,r),v=h.filter(function(e,t){return-1===p.indexOf(t)});return r.every(function(e){return 1===e})?U_(l,t,h).reshape(v):qy.runKernelFunc(function(e){return e.stridedSlice(l,t,n,r)},{$x:l}).reshape(v)}}),mI=vx({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=rx(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=qy.runKernelFunc(function(e){return e.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}}),gI=vx({scatterND_:function(e,t,n){var r=rx(e,"indices","scatterND","int32"),o=rx(t,"updates","scatterND");return dE(o,r,n),qy.runKernelFunc(function(e){return e.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),yI=vx({fft_:function(e){Mg("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return qy.runKernelFunc(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),bI=vx({ifft_:function(e){Mg("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return qy.runKernelFunc(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),xI=vx({rfft_:function(e,t){Mg("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(null!=t&&t<r){var a=e.shape.map(function(e){return 0}),i=e.shape.map(function(e){return e});i[e.shape.length-1]=t,n=e.slice(a,i),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(_x(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=mx(n,u).as2D(o,r),c=yI(l),f=Math.floor(r/2)+1,d=gx(c),p=yx(c),h=d.split([f,r-f],d.shape.length-1),v=p.split([f,r-f],p.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,mx(h[0],v[0]).reshape(m)}}),wI=vx({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=bI(r);return gx(o)}var a=[n,2*(t-1)],i=gx(e).as2D(n,t),s=yx(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(wx(-1)),c=i.concat(u,1),f=s.concat(l,1);return r=mx(c,f).as2D(a[0],a[1]),o=bI(r),gx(o)}}),EI=Object.freeze({fft:yI,ifft:bI,rfft:xI,irfft:wI}),CI=vx({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=rx(e,"sparseIndices","sparseToDense","int32"),a=rx(t,"sparseValues","sparseToDense"),i=rx(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),qy.runKernelFunc(function(e){return e.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),SI=vx({gatherND_:function(e,t){var n=rx(t,"indices","gatherND","int32"),r=rx(e,"x","gatherND");return qy.runKernelFunc(function(e){return e.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),kI=vx({diag_:function(e){var t=rx(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return qy.runKernelFunc(function(e){return e.diag(t)},{$x:t}).reshape(n)}}),RI=vx({dropout_:function(e,t,n,r){var o=rx(e,"x","dropout");if(Mg("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),Mg(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof Ty?o.clone():o;var a=function(e,t){if(null==t)return e.shape.slice();if(Ug(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(o,n),i=1-t,s=GR(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function _I(e,t,n){for(var r=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var i=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(i)}return Ex(o,"float32")}var II,NI=vx({hannWindow_:function(e){return _I(e,.5,.5)}}),TI=vx({hammingWindow_:function(e){return _I(e,.54,.46)}}),AI=vx({frame_:function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+t<=e.size;)i.push(U_(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=Dx([U_(e,a,t-s),Ix([s],o)]);i.push(u),a+=n}return 0===i.length?Cx([],[0,t]):Dx(i).as2D(i.length,t)}}),DI=vx({stft_:function(e,t,n,r,o){var a;void 0===o&&(o=NI),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=AI(e,t,n),s=tE(i,o(t)),u=[],l=0;l<i.shape[0];l++)u.push(xI(s.slice([l,0],[1,t]),r));return Dx(u)}}),OI=Object.freeze({hannWindow:NI,hammingWindow:TI,frame:AI,stft:DI});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(II||(II={}));var FI=vx({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=II.SUM_BY_NONZERO_WEIGHTS);var o=rx(e,"labels","absoluteDifference"),a=rx(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=rx(n,"weights","absoluteDifference")),Lg(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return PI(s,i,r)}}),PI=vx({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=II.SUM_BY_NONZERO_WEIGHTS);var r=rx(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=rx(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===II.NONE)return a;if(n===II.SUM)return a.sum();if(n===II.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(wx(i)):s}if(n===II.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(wx(r.size));var u=o.mul(Rx(r.shape)).notEqual(wx(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),MI=vx({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=II.SUM_BY_NONZERO_WEIGHTS);var a=rx(e,"labels","cosineDistance"),i=rx(t,"predictions","cosineDistance"),s=null;null!=r&&(s=rx(r,"weights","cosineDistance")),Lg(a.shape,i.shape,"Error in cosineDistance: ");var u=wx(1).sub(a.mul(i).sum(n,!0));return PI(u,s,o)}}),LI=vx({hingeLoss_:function(e,t,n,r){void 0===r&&(r=II.SUM_BY_NONZERO_WEIGHTS);var o=rx(e,"labels","hingeLoss"),a=rx(t,"predictions","hingeLoss"),i=null;null!=n&&(i=rx(n,"weights","hingeLoss")),Lg(o.shape,a.shape,"Error in hingeLoss: ");var s=wx(1);o=wx(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return PI(u,i,r)}}),BI=vx({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=II.SUM_BY_NONZERO_WEIGHTS);var a=rx(e,"labels","huberLoss"),i=rx(t,"predictions","huberLoss"),s=null;null!=n&&(s=rx(n,"weights","huberLoss")),Lg(a.shape,i.shape,"Error in huberLoss: ");var u=wx(r),l=i.sub(a).abs(),c=Qw(l,u),f=l.sub(c),d=wx(.5).mul(c.square()).add(u.mul(f));return PI(d,s,o)}}),zI=vx({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=II.SUM_BY_NONZERO_WEIGHTS);var a=rx(e,"labels","logLoss"),i=rx(t,"predictions","logLoss"),s=null;null!=n&&(s=rx(n,"weights","logLoss")),Lg(a.shape,i.shape,"Error in logLoss: ");var u=wx(1),l=wx(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return PI(c,s,o)}}),WI=vx({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=II.SUM_BY_NONZERO_WEIGHTS);var o=rx(e,"labels","meanSquaredError"),a=rx(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=rx(n,"weights","meanSquaredError")),Lg(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return PI(s,i,r)}}),UI=vx({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=II.SUM_BY_NONZERO_WEIGHTS);var a=rx(e,"multiClassLabels","sigmoidCrossEntropy"),i=rx(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=rx(n,"weights","sigmoidCrossEntropy")),Lg(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=wx(r),l=wx(1),c=wx(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var f=function(e,t){var n=rx(e,"labels","sigmoidCrossEntropyWithLogits"),r=rx(t,"logits","sigmoidCrossEntropyWithLogits");Lg(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return PI(f,s,o)}}),jI=vx({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=II.SUM_BY_NONZERO_WEIGHTS);var a=rx(e,"onehotLabels","softmaxCrossEntropy"),i=rx(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=rx(n,"weights","softmaxCrossEntropy")),Lg(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=wx(r),l=wx(1),c=wx(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return wE(function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=ux(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(a,i);return PI(f,s,o)}}),VI=Object.freeze({get Reduction(){return II},absoluteDifference:FI,computeWeightedLoss:PI,cosineDistance:MI,hingeLoss:LI,huberLoss:BI,logLoss:zI,meanSquaredError:WI,sigmoidCrossEntropy:UI,softmaxCrossEntropy:jI});function HI(e,t){return void 0===t&&(t=!1),qy.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=IR(n),a=e.clone(),i=Cx([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=o;t=qy.tidy(function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=Cx([[-1]]).where(l.greater(0),Cx([[1]])),f=l.sub(c.mul(u)),d=t.div(f);s=1===d.shape[0]?i.clone():i.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var p=c.matMul(f).div(u).neg(),h=a.slice([e,0],[n-e,r]),v=p.mul(s),m=s.transpose();if(0===e)a=h.sub(v.matMul(m.matMul(h)));else{var g=h.sub(v.matMul(m.matMul(h)));a=a.slice([0,0],[e,r]).concat(g,0)}var y=v.transpose(),b=o.slice([0,e],[n,o.shape[1]-e]);if(0===e)o=b.sub(b.matMul(s).matMul(y));else{var x=b.sub(b.matMul(s).matMul(y));o=o.slice([0,0],[n,e]).concat(x,1)}return[s,a,o]}),s=t[0],a=t[1],o=t[2],Zb([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var GI=vx({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=rx(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),n<0&&(n=s);var u=Nx(0,i,1,"int32").reshape([-1,1]),l=Nx(0,s,1,"int32"),c=iE(u,l),f=xR(c.lessEqual(wx(+t,"int32")),c.greaterEqual(wx(-n,"int32"))),d=_x([i,s],r.dtype);return Kx($x(r.reshape([-1,i,s])).map(function(e){return SR(f,e,d)})).reshape(o)}}),qI=vx({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,Mg(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){Mg(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=Lx(e,e.shape[0],0).map(function(e){return qx(e,[0])});Mg(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(e){a.push(qy.tidy(function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=nI(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(fI(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?Kx(a,0):a}}),KI=vx({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return HI(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=$x(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return r.forEach(function(e){var n=HI(e,t),r=n[0],i=n[1];o.push(r),a.push(i)}),[Kx(o,0).reshape(e.shape),Kx(a,0).reshape(e.shape)]}}),$I=Object.freeze({bandPart:GI,gramSchmidt:qI,qr:KI});function XI(e,t,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=e.shape[0];return n=Math.min(n,i),Mg(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),Mg(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),Mg(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),Mg(1===t.rank,function(){return"scores must be a 1D tensor"}),Mg(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),Mg(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var YI=vx({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=rx(e,"images","resizeBilinear");Mg(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),Mg(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=qy.runKernelFunc(function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)},{x:o},function(e,t){return{x:function(){return qy.runKernelFunc(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),QI=vx({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=rx(e,"images","resizeNearestNeighbor");Mg(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),Mg(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),Mg("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=qy.runKernelFunc(function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return qy.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),JI=vx({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=rx(e,"boxes","nonMaxSuppression"),i=rx(t,"scores","nonMaxSuppression"),s=XI(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return qy.runKernelFunc(function(e){return e.nonMaxSuppression(a,i,n,r,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),ZI=vx({nonMaxSuppressionWithScore_:function(e,t,n,r,o,a){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=rx(e,"boxes","nonMaxSuppression"),s=rx(t,"scores","nonMaxSuppression"),u=XI(i,s,n,r,o,a),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=qy.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),eN=vx({cropAndResize_:function(e,t,n,r,o,a){var i=rx(e,"image","cropAndResize"),s=rx(t,"boxes","cropAndResize","float32"),u=rx(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return Mg(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),Mg(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),Mg(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),Mg(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),Mg(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),Mg("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),qy.runKernelFunc(function(e,t){return e.cropAndResize(i,s,u,r,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),tN=Object.freeze({resizeBilinear:YI,resizeNearestNeighbor:QI,nonMaxSuppression:JI,nonMaxSuppressionAsync:function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),bg(this,void 0,void 0,function(){var a,i,s,u,l,c,f;return xg(this,function(d){switch(d.label){case 0:return a=rx(e,"boxes","nonMaxSuppressionAsync"),i=rx(t,"scores","nonMaxSuppressionAsync"),s=XI(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=d.sent(),l=u[0],c=u[1],f=XE(l,c,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,f]}})})},nonMaxSuppressionWithScore:ZI,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,o,a){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),bg(this,void 0,void 0,function(){var i,s,u,l,c,f,d;return xg(this,function(p){switch(p.label){case 0:return i=rx(e,"boxes","nonMaxSuppressionAsync"),s=rx(t,"scores","nonMaxSuppressionAsync"),u=XI(i,s,n,r,o,a),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=p.sent(),c=l[0],f=l[1],d=YE(c,f,n,r,o,a),i!==e&&i.dispose(),s!==t&&s.dispose(),[2,d]}})})},cropAndResize:eN}),nN=function(e,t){return!(e>0)||"linear"===t},rN=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},oN=function(e,t){var n=t,r=lw(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},aN=function(e,t,n){if("linear"===t)return e;if("relu"===t)return sI(e);if("elu"===t)return oI(e);if("relu6"===t)return uI(e);if("prelu"===t)return iI(e,n);throw new Error("Unknown fused activation "+t+".")},iN=vx({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,a=void 0!==o&&o,i=e.transposeB,s=void 0!==i&&i,u=e.bias,l=e.activation,c=void 0===l?"linear":l,f=e.preluActivationWeights;if(!1===nN(qy.state.gradientDepth,c)){var d=k_(n,r,a,s);return null!=u&&(d=sw(d,u)),aN(d,c,f)}var p=rx(n,"a","fused matMul"),h=rx(r,"b","fused matMul");t=Wy(p,h),p=t[0],h=t[1];var v=a?p.shape[p.rank-2]:p.shape[p.rank-1],m=s?h.shape[h.rank-1]:h.shape[h.rank-2],g=a?p.shape[p.rank-1]:p.shape[p.rank-2],y=s?h.shape[h.rank-2]:h.shape[h.rank-1],b=p.shape.slice(0,-2),x=h.shape.slice(0,-2),w=Wg(b),E=Wg(x);Mg(p.rank>=2&&h.rank>=2&&p.rank===h.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+h.rank+"."}),Mg(Ug(b,x),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+p.shape+" and "+h.shape+" must match."}),Mg(v===m,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+p.shape+" and "+h.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var C,S,k=p.shape.slice(0,-2).concat([g,y]),R=a?p.as3D(w,v,g):p.as3D(w,g,v),_=s?h.as3D(E,y,m):h.as3D(E,m,y);null!=u&&cw(k,(C=Wy(C=rx(u,"bias","fused matMul"),p)[0]).shape),null!=f&&(S=rx(f,"prelu weights","fused matMul"));var I={a:R,b:_};null!=u&&(I.bias=C),null!=f&&(I.preluActivationWeights=S);var N=[R,_];return qy.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:R,b:_,transposeA:a,transposeB:s,bias:C,activation:c,preluActivationWeights:S});return t([R,_,n]),n},I,function(e,t){var n=t[0],r=t[1],o=t[2],i=rN(e,o,c),l={};return null!=u&&(l={bias:function(){return oN(C,i)}}),a||s?!a&&s?Object.assign({a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}},l):a&&!s?Object.assign({a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}},l):Object.assign({a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}},l):Object.assign({a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},l)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:c},N,[!0]).reshape(k)}}),sN=vx({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights;if(d=d||"linear",!1===nN(qy.state.gradientDepth,d)){var h=v_(t,n,r,o,i,u,l);return null!=c&&(h=sw(h,c)),aN(h,d,p)}var v=rx(t,"x","conv2d"),m=rx(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),Mg(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),Mg(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=l&&Mg(jg(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),Mg(g.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),Mg(BE(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),Mg("NHWC"===i,function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var b,x,w=TE(g.shape,m.shape,r,u,o,l);null!=c&&(b=Wy(b=rx(c,"bias","fused conv2d"),v)[0],cw(w.outShape,b.shape)),null!=p&&(x=rx(p,"prelu weights","fused conv2d"));var E={x:g,filter:m};null!=c&&(E.bias=b),null!=p&&(E.preluActivationWeights=x);var C=[m,g],S=qy.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:g,filter:m,convInfo:w,bias:b,activation:d,preluActivationWeights:x});return t([m,g,n]),n},E,function(e,t){var n=t,a=n[0],i=n[1],s=n[2],l=rN(e,s,d);Mg(LE(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var f={};return null!=c&&(f={bias:function(){return oN(b,l)}}),Object.assign({x:function(){return y_(i.shape,l,a,r,o)},filter:function(){return g_(i,l,a.shape,r,o)}},f)},"FusedConv2D",{convInfo:w,activation:d},C,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),uN=vx({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights;if(!1===nN(qy.state.gradientDepth,d)){var h=b_(t,n,r,o,i,u,l);return null!=c&&(h=sw(h,c)),aN(h,d,p)}var v=rx(t,"x","depthwiseConv2d"),m=rx(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),Mg(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),Mg(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),Mg(g.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==u&&(u=[1,1]),Mg(BE(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=l&&Mg(jg(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var b,x,w=TE(g.shape,m.shape,r,u,o,l,!0);null!=c&&(b=Wy(b=rx(c,"bias","fused conv2d"),v)[0],cw(w.outShape,b.shape)),null!=p&&(x=rx(p,"prelu weights","fused depthwiseConv2d"));var E={x:g,filter:m};null!=c&&(E.bias=b),null!=p&&(E.preluActivationWeights=x);var C=[m,g],S=qy.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:b,activation:d,preluActivationWeights:x});return t([m,g,n]),n},E,function(e,t){Mg(LE(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=t[0],r=t[1],o=t[2],a=rN(e,o,d),i={};return null!=c&&(i={bias:function(){return oN(b,a)}}),Object.assign({x:function(){return x_(r.shape,a,n,w)},filter:function(){return w_(r,a,n.shape,w)}},i)},"FusedDepthwiseConv2D",{convInfo:w,activation:d},C,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),lN=Object.freeze({matMul:iN,conv2d:sN,depthwiseConv2d:uN}),cN=Object.freeze({image:tN,linalg:$I,losses:VI,spectral:EI,fused:lN,signal:OI,add:sw,addN:nR,batchNorm:uR,batchNormalization:sR,batchNorm2d:fR,batchNormalization2d:cR,batchNorm3d:hR,batchNormalization3d:pR,batchNorm4d:gR,batchNormalization4d:mR,broadcastTo:yR,clone:bR,div:uE,divNoNan:RR,eye:IR,multinomial:NR,oneHot:TR,pad:AR,pad1d:DR,pad2d:OR,pad3d:FR,pad4d:PR,rand:MR,randomGamma:VR,randomNormal:HR,randomUniform:GR,square:qR,squaredDifference:KR,tile:_R,truncatedNormal:$R,conv1d:h_,conv2d:v_,conv3d:m_,depthwiseConv2d:b_,separableConv2d:E_,conv2dTranspose:C_,conv3dTranspose:S_,op:vx,booleanMaskAsync:function(e,t,n){return bg(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,d,p,h,v;return xg(this,function(m){switch(m.label){case 0:for(r=rx(e,"tensor","boolMask"),o=rx(t,"mask","boolMask","bool"),a=null==n?0:n,i=o.rank,s=r.shape,Mg(i>0,function(){return"mask cannot be scalar"}),Lg(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+i;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+i)),f=r.reshape(c),d=o.reshape([-1]),[4,kR(d)];case 1:return p=m.sent(),h=p.squeeze([1]),v=l_(f,h,a),e!==r&&r.dispose(),t!==o&&o.dispose(),h.dispose(),f.dispose(),d.dispose(),p.dispose(),[2,v]}})})},complex:mx,real:gx,imag:yx,concat:Dx,concat1d:Ox,concat2d:Fx,concat3d:Px,concat4d:Mx,split:Lx,matMul:k_,dot:R_,outerProduct:__,reverse:I_,reverse1d:N_,reverse2d:T_,reverse3d:A_,reverse4d:D_,maxPool:P_,avgPool:M_,pool:L_,maxPool3d:B_,avgPool3d:z_,maxPoolWithArgmax:W_,slice:U_,slice1d:j_,slice2d:V_,slice3d:H_,slice4d:G_,abs:fw,acos:dw,acosh:pw,asin:hw,asinh:vw,atan:mw,atanh:gw,ceil:yw,clipByValue:bw,cos:xw,cosh:ww,erf:Ew,exp:Cw,expm1:Sw,floor:kw,log:Rw,log1p:_w,logSigmoid:Iw,neg:Nw,reciprocal:Tw,round:Aw,rsqrt:Dw,sigmoid:Ow,sign:Fw,isNaN:Pw,isInf:Mw,isFinite:Lw,sin:Bw,sinh:zw,softplus:Ww,sqrt:Uw,step:jw,tan:Vw,tanh:Hw,all:K_,any:$_,argMax:X_,argMin:Y_,logSumExp:Q_,max:J_,mean:Z_,min:eI,moments:tI,sum:nI,prod:rI,equal:XR,equalStrict:YR,greater:QR,greaterEqual:JR,greaterEqualStrict:ZR,greaterStrict:e_,less:t_,lessEqual:n_,lessEqualStrict:r_,lessStrict:o_,notEqual:a_,notEqualStrict:i_,addStrict:Gw,atan2:qw,divStrict:Kw,floorDiv:$w,maximum:Xw,maximumStrict:Yw,minimum:Qw,minimumStrict:Jw,mod:Zw,modStrict:eE,mul:tE,mulStrict:nE,pow:rE,powStrict:oE,squaredDifferenceStrict:aE,sub:iE,subStrict:sE,elu:oI,leakyRelu:aI,prelu:iI,relu:sI,relu6:uI,selu:lI,logicalAnd:xR,logicalNot:wR,logicalOr:ER,logicalXor:CR,where:SR,whereAsync:kR,buffer:Bx,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:zx,cast:Wx,cumsum:Ux,depthToSpace:jx,expandDims:Vx,reshape:Hx,spaceToBatchND:Gx,squeeze:qx,stack:Kx,unstack:$x,setdiff1dAsync:function(e,t){return bg(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f;return xg(this,function(d){switch(d.label){case 0:return n=rx(e,"x","setdiff1d"),r=rx(t,"y","setdiff1d"),Mg(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),Mg(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),Mg(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(a=d.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new Ry([s],n.dtype),l=new Ry([s],"int32"),c=0,f=0;c<o.length;c++)i.has(o[c])||(u.values[f]=o[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})},fill:Ix,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return qy.runKernelFunc(function(r){return r.linspace(e,t,n)},{})},ones:Rx,range:Nx,scalar:wx,tensor:bx,tensor1d:Ex,tensor2d:Cx,tensor3d:Sx,tensor4d:kx,tensor5d:function(e,t,n){if(Bg(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=tx(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xx(e,t,r,n)},tensor6d:function(e,t,n){if(Bg(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=tx(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return xx(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),qy.makeVariable(e,t,n,r)},zeros:_x,onesLike:Tx,zerosLike:Ax,transpose:SE,softmax:EE,logSoftmax:CE,localResponseNormalization:cI,norm:fI,gather:l_,unsortedSegmentSum:c_,basicLSTMCell:dI,multiRNNCell:pI,movingAverage:hI,stridedSlice:vI,topk:mI,scatterND:gI,fft:yI,ifft:bI,rfft:xI,irfft:wI,sparseToDense:CI,gatherND:SI,diag:kI,dropout:RI,hannWindow:NI,hammingWindow:TI,frame:AI,stft:DI,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),bg(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,d,p,h,v,m;return xg(this,function(g){switch(g.label){case 0:return r=rx(e,"predictions","inTopK"),o=rx(t,"targets","inTopK"),Mg(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),Mg(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Lg(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],Mg(n>0&&n<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n}),[4,r.data()];case 1:return i=g.sent(),[4,o.data()];case 2:for(s=g.sent(),u=[i.length/a,a],c=u[1],f=Yg("bool",l=u[0]),d=0;d<l;d++){for(p=d*c,h=i.subarray(p,p+c),v=[],m=0;m<h.length;m++)v.push({value:h[m],index:m});for(v.sort(function(e,t){return t.value-e.value}),f[d]=0,m=0;m<n;m++)if(v[m].index===s[d]){f[d]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,bx(f,o.shape,"bool")]}})})}});function fN(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&Mg("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function dN(e,t,n,r,o,a){for(var i=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,l=o.dilationWidth,c=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=o.padInfo.top,p=o.padInfo.left,h="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Bx(o.outShape,n),m=v.values,g=o.outShape[1]*o.outShape[2]*o.outShape[3],y=o.outShape[2]*o.outShape[3],b=o.outShape[3],x=0;x<o.batchSize;++x)for(var w=x*g,E=x*r[0],C=0;C<o.inChannels;++C)for(var S=0;S<o.outHeight;++S)for(var k=S*i-d,R=Math.max(0,k),_=Math.min(o.inHeight,c+k),I=w+S*y,N=0;N<o.outWidth;++N){for(var T=N*s-p,A=Math.max(0,T),D=Math.min(o.inWidth,f+T),O=h,F=0,P=0,M=R;M<_;M+=u){for(var L=E+M*r[1],B=A;B<D;B+=l){var z=e[L+B*r[2]+C];"max"===a&&z>O?O=z:"avg"===a&&(F+=z,P++)}if(isNaN(O))break}m[I+N*b+C]="avg"===a?F/P:O}return v}function pN(e,t,n,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);for(var i=Bx(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,h=r.padInfo.left,v=Bx(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-p,x=b;x<0;)x+=l;for(var w=Math.min(r.inHeight,f+b),E=0;E<r.outWidth;++E){for(var C=E*u-h,S=C;S<0;)S+=c;for(var k=Math.min(r.inWidth,d+C),R=Number.NEGATIVE_INFINITY,_=-1,I=x;I<w;I+=l)for(var N=I-b,T=S;T<k;T+=c){var A=T-C,D=v.get(m,I,T,g);D>R&&(R=D,_=o?a?((m*r.inHeight+I)*r.inWidth+T)*r.inChannels+g:(I*r.inWidth+T)*r.inChannels+g:N*d+A)}i.set(_,m,y,E,g)}}return i}function hN(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var vN=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new kE(t,qy),t}return yg(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,Eg().get("IS_NODE")&&ex("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?VE(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return yy(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Bx(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return qy.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return bg(this,void 0,void 0,function(){var t;return xg(this,function(n){return t=vy(),e(),[2,{kernelMs:vy()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:qy.keep(e.clone()),imag:qy.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(fN(e,"slice"),bE(e.shape,t,n)){var r=xE(t,e.strides),o=Wg(n);return bx(this.readSync(e.dataId).subarray(r,r+o),n,e.dtype)}for(var a=Bx(n,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(e,n){return e+t[n]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){fN(e,"stridedSlice");var o=mE(t,n,r);if(o.some(function(e){return 0===e}))return bx([],o);for(var a=Bx(o,e.dtype),i=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[c]*r[c]+t[c];a.set.apply(a,[i.get.apply(i,l)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Bx([e.size,e.size],e.dtype),r=n.values,o=0;o<t.length;o++)r[o*e.size+o]=t[o];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.reverse=function(e,t){fN(e,"reverse");for(var n=Bx(e.shape,e.dtype),r=this.bufferSync(e),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map(function(e){return gx(e)}),o=e.map(function(e){return yx(e)});return mx(this.concat(r,t),this.concat(o,t))}var a=e.map(function(e){var n=Wg(e.shape.slice(t));return e.as2D(-1,n)}),i=hx(a.map(function(e){return e.shape}),1),s=Bx(i,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach(function(e){s.set(n.readSync(e.dataId),u),u+=e.size})}else{var l=0;a.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,o=0;o<e.shape[0];++o)for(var a=o*i[1]+l,u=0;u<e.shape[1];++u)s[a+u]=t[r++];l+=e.shape[1]})}var c=hx(e.map(function(e){return e.shape}),t);return bx(s,c,e[0].dtype)},t.prototype.neg=function(e){return fN(e,"neg"),this.multiply(wx(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,By(e.dtype,t.dtype),function(e,t){return e+t})},t.prototype.addN=function(e){var t=this;fN(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=Bx(e[0].shape,e[0].dtype),o=r.values,a=0;a<e.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=$g([t],e.shape),r=this.max(e,n),o=ux(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return uE(i,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,By(e.dtype,t.dtype),function(e,t){return e-t})},t.prototype.pow=function(e,t){return fN([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,n,r){fN([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=c[0],d=c[1],p=c[2],h=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=h[0],m=h[1],g=h[2],y=a*i,b=Bx([s,a,i],e.dtype),x=b.values,w=this.blockSize,E=0;E<s;E++)for(var C=0;C<a;C+=w)for(var S=0;S<i;S+=w)for(var k=0;k<o;k+=w)for(var R=Math.min(C+w,a),_=Math.min(S+w,i),I=Math.min(k+w,o),N=C;N<R;N++)for(var T=S;T<_;T++){for(var A=0,D=k;D<I;D++)A+=u[E*f+N*d+D*p]*l[D*v+T*m+E*g];x[E*y+(N*i+T)]+=A}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,o);return a&&(u=this.add(u,a)),i&&(u=hN(this,u,i,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,By(e.dtype,t.dtype),function(e,t){return e*t})},t.prototype.floorDiv=function(e,t){return fN([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){fN(e,"sum"),lx("sum",t,e.rank);for(var n=sx(e.shape,t),r=n[0],o=n[1],a=_x(r,By(e.dtype,"int32")),i=Wg(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=0,d=0;d<i;++d)f+=u[c+d];s[l]=f}return a},t.prototype.prod=function(e,t){fN(e,"sum");for(var n=sx(e.shape,t),r=n[0],o=n[1],a=_x(r,By(e.dtype,"int32")),i=Wg(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=1,d=0;d<i;++d)f*=u[c+d];s[l]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){fN(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=wx(a,"int32"),s=XR(i,t).asType("float32").mul(e).sum(0);r.push(s)}return Kx(r)},t.prototype.argMin=function(e,t){fN(e,"argMin");var n=[t];lx("argMin",n,e.rank);for(var r=sx(e.shape,n),o=r[0],a=r[1],i=_x(o,"int32"),s=Wg(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,d=l[f],p=0,h=0;h<s;++h){var v=l[f+h];v<d&&(d=v,p=h)}u[c]=p}return i},t.prototype.argMax=function(e,t){fN(e,"argMax");var n=[t];lx("argMax",n,e.rank);for(var r=sx(e.shape,n),o=r[0],a=r[1],i=_x(o,"int32"),s=Wg(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,d=l[f],p=0,h=0;h<s;++h){var v=l[f+h];v>d&&(d=v,p=h)}u[c]=p}return i},t.prototype.cumsum=function(e,t,n,r){if(fN(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=By(e.dtype,"int32"),a=_x(e.shape,o),i=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var f=0;f<u;f++){var d=l(c,f);if(0===f)i[d]=n?0:s[d];else{var p=l(c,f-1);i[d]=n?s[p]+i[p]:s[d]+i[p]}}return a},t.prototype.equal=function(e,t){return fN([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return fN([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return fN([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return fN([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return fN([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return fN([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalNot=function(e){fN(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return fN([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return fN([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,n){fN([e,t,n],"select");for(var r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(n.dataId),i=_x(t.shape,By(t.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:Wg(t.shape.slice(1)),c=0;c<r.length;c++)for(var f=0;f<l;f++)1===r[c]?s[u++]=o[c]:s[u++]=a[c];return i},t.prototype.where=function(e){fN([e],"where");var t=this.readSync(e.dataId);return oC(e.shape,t)},t.prototype.topk=function(e,t,n){return fN(e,"topk"),rC(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){fN(e,"min"),lx("min",t,e.rank);for(var n=sx(e.shape,t),r=n[0],o=n[1],a=_x(r,e.dtype),i=Wg(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];p<f&&(f=p)}s[l]=f}return a},t.prototype.minimum=function(e,t){return fN([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return fN([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},t.prototype.max=function(e,t){fN(e,"max"),lx("max",t,e.rank);for(var n=sx(e.shape,t),r=n[0],o=n[1],a=_x(r,e.dtype),i=Wg(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];p>f&&(f=p)}s[l]=f}return a},t.prototype.maximum=function(e,t){return fN([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){fN(e,"all"),lx("all",t,e.rank);for(var n=sx(e.shape,t),r=n[0],o=n[1],a=_x(r,e.dtype),i=Wg(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];f=f&&p}s[l]=f}return a},t.prototype.any=function(e,t){fN(e,"any"),lx("any",t,e.rank);for(var n=sx(e.shape,t),r=n[0],o=n[1],a=_x(r,e.dtype),i=Wg(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var p=u[c+d];f=f||p}s[l]=f}return a},t.prototype.squaredDifference=function(e,t){return fN([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},t.prototype.ceil=function(e){fN(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){fN(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){fN(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){fN(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){fN(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){fN(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){fN(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){fN(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){fN(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){fN(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){fN(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){fN(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){fN(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){fN(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){fN(e,"relu");for(var t=_x(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},t.prototype.relu6=function(e){fN(e,"relu");for(var t=_x(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return t},t.prototype.prelu=function(e,t){return fN([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.elu=function(e){fN(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){fN([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){fN(e,"selu");for(var t=mk,n=gk,r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?n*i:t*(Math.exp(i)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){fN(e,"clip");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){fN(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){fN(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){fN(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){fN(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){fN(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){fN(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){fN(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){fN(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){fN(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return fN([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.sinh=function(e){fN(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){fN(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){fN(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Vg(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){fN(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){fN(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){fN(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){fN(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),a=Math.abs(n[r]),i=1/(1+.3275911*a);t[r]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),fN(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.conv2d(t,n,r);return o&&(s=this.add(s,o)),a&&(s=hN(this,s,a,i)),s},t.prototype.conv2d=function(e,t,n){fN([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l="channelsLast"===n.dataFormat,c=Bx(n.outShape,e.dtype),f=e.strides[0],d=l?e.strides[1]:e.strides[2],p=l?e.strides[2]:1,h=l?1:e.strides[1],v=c.strides[0],m=l?c.strides[1]:c.strides[2],g=l?c.strides[2]:1,y=l?1:c.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=c.values,E=0;E<n.batchSize;++E)for(var C=E*f,S=E*v,k=0;k<n.outHeight;++k)for(var R=S+k*m,_=k*n.strideHeight-u,I=0;I<r;I++){var N=_+I*a;if(!(N<0||N>=n.inHeight))for(var T=I*t.strides[0],A=C+N*d,D=0;D<n.outWidth;++D)for(var O=R+D*g,F=D*n.strideWidth-s,P=0;P<o;P++){var M=F+P*i;if(!(M<0||M>=n.inWidth))for(var L=A+M*p,B=T+P*t.strides[1],z=0;z<n.inChannels;++z){for(var W=b[L+z*h],U=0;U<n.outChannels;++U)w[O+U*y]+=W*x[B+U];B+=n.outChannels}}}return c.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,f=n.padInfo.top,d=Bx(n.outShape,e.dtype),p=this.readSync(e.dataId),h=this.readSync(t.dataId),v=d.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*d.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*d.strides[1],w=b*n.strideDepth-l,E=0;E<r;E++){var C=w+E*i;if(!(C<0||C>=n.inDepth))for(var S=E*t.strides[0],k=g+C*e.strides[1],R=0;R<n.outHeight;++R)for(var _=x+R*d.strides[2],I=R*n.strideHeight-f,N=0;N<o;N++){var T=I+N*s;if(!(T<0||T>=n.inHeight))for(var A=S+N*t.strides[1],D=k+T*e.strides[2],O=0;O<n.outWidth;++O)for(var F=_+O*n.outChannels,P=O*n.strideWidth-c,M=0;M<a;M++){var L=P+M*u;if(!(L<0||L>=n.inWidth))for(var B=A+M*t.strides[2],z=D+L*n.inChannels,W=B,U=0;U<n.inChannels;++U){for(var j=p[z+U],V=0;V<n.outChannels;++V)v[F+V]+=j*h[W+V];W+=n.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){fN([e,t],"conv2dDerInput");for(var r=Bx(n.inShape,"float32"),o=r.values,a=this.readSync(e.dataId),i=this.readSync(t.dataId),s=t.strides,u=s[0],l=s[1],c=s[2],f=n.batchSize,d=n.filterHeight,p=n.filterWidth,h=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,E=n.dataFormat,C=d-1-n.padInfo.top,S=p-1-n.padInfo.left,k="channelsLast"===E,R=r.strides[0],_=k?r.strides[1]:r.strides[2],I=k?r.strides[2]:1,N=k?1:r.strides[1],T=e.strides[0],A=k?e.strides[1]:e.strides[2],D=k?e.strides[2]:1,O=k?1:e.strides[1],F=0;F<f;++F)for(var P=0;P<h;++P)for(var M=0;M<v;++M)for(var L=M-C,B=Math.max(0,Math.ceil(L/x)),z=Math.min(y,(d+L)/x),W=0;W<m;++W){for(var U=W-S,j=Math.max(0,Math.ceil(U/w)),V=Math.min(b,(p+U)/w),H=0,G=B;G<z;++G)for(var q=G*x-L,K=j;K<V;++K)for(var $=T*F+A*G+D*K,X=u*(d-1-q)+l*(p-1-(K*w-U))+c*P,Y=0;Y<g;++Y)H+=a[$+O*Y]*i[X+Y];o[R*F+_*M+I*W+N*P]=H}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Bx(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=this.readSync(e.dataId),f=e.strides,d=f[0],p=f[1],h=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],E=n.batchSize,C=n.filterDepth,S=n.filterHeight,k=n.filterWidth,R=n.inChannels,_=n.inDepth,I=n.inHeight,N=n.inWidth,T=n.outChannels,A=n.outDepth,D=n.outHeight,O=n.outWidth,F=n.strideDepth,P=n.strideHeight,M=n.strideWidth,L=C-1-n.padInfo.front,B=S-1-n.padInfo.top,z=k-1-n.padInfo.left,W=0;W<E;++W)for(var U=0;U<R;++U)for(var j=0;j<_;++j)for(var V=j-L,H=Math.max(0,Math.ceil(V/F)),G=Math.min(A,(C+V)/F),q=0;q<I;++q)for(var K=q-B,$=Math.max(0,Math.ceil(K/P)),X=Math.min(D,(S+K)/P),Y=0;Y<N;++Y){for(var Q=Y-z,J=Math.max(0,Math.ceil(Q/M)),Z=Math.min(O,(k+Q)/M),ee=0,te=H;te<G;++te)for(var ne=te*F-V,re=$;re<X;++re)for(var oe=re*P-K,ae=J;ae<Z;++ae)for(var ie=d*W+p*te+h*re+v*ae,se=y*(C-1-ne)+b*(S-1-oe)+x*(k-1-(ae*M-Q))+w*U,ue=0;ue<T;++ue)ee+=c[ie+ue]*m[se+ue];o[i*W+s*j+u*q+l*Y+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){fN([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s="channelsLast"===n.dataFormat,u=Bx(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,f=this.bufferSync(e),d=this.bufferSync(t),p=0;p<a;++p)for(var h=Math.max(0,Math.ceil((c-p)/r)),v=Math.min(n.outHeight,(n.inHeight+c-p)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((l-m)/o)),y=Math.min(n.outWidth,(n.inWidth+l-m)/o),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,E=0;E<n.batchSize;++E)for(var C=h;C<v;++C)for(var S=p+C*r-c,k=g;k<y;++k){var R=m+k*o-l;w+=s?f.get(E,S,R,b)*d.get(E,C,k,x):f.get(E,b,S,R)*d.get(E,x,C,k)}u.set(w,p,m,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=Bx(n.filterShape,"float32"),c=l.values,f=l.strides,d=f[0],p=f[1],h=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],E=this.readSync(e.dataId),C=e.strides,S=C[0],k=C[1],R=C[2],_=C[3],I=n.padInfo.front,N=n.padInfo.left,T=n.padInfo.top,A=0;A<i;++A)for(var D=Math.max(0,Math.ceil((I-A)/r)),O=Math.min(n.outDepth,(n.inDepth+I-A)/r),F=A*d,P=0;P<s;++P)for(var M=Math.max(0,Math.ceil((T-P)/o)),L=Math.min(n.outHeight,(n.inHeight+T-P)/o),B=P*p+F,z=0;z<u;++z)for(var W=Math.max(0,Math.ceil((N-z)/a)),U=Math.min(n.outWidth,(n.inWidth+N-z)/a),j=z*h+B,V=0;V<n.inChannels;++V)for(var H=V*v+j,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var $=K*S,X=K*y,Y=D;Y<O;++Y)for(var Q=(A+Y*r-I)*k+$,J=Y*b+X,Z=M;Z<L;++Z)for(var ee=(P+Z*o-T)*R+Q,te=Z*x+J,ne=W;ne<U;++ne){var re=ne*w+te;q+=E[(z+ne*a-N)*_+ee+V]*m[re+G]}c[H+G]=q}return l.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return o&&(s=this.add(s,o)),a&&(s=hN(this,s,a,i)),s},t.prototype.depthwiseConv2D=function(e,t,n){fN([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=Bx(n.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),p=c.values,h=0;h<n.batchSize;++h)for(var v=h*e.strides[0],m=h*c.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*c.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var E=x*t.strides[0],C=v+w*e.strides[1],S=0;S<n.outWidth;++S)for(var k=y+S*c.strides[2],R=S*n.strideWidth-u,_=0;_<o;++_){var I=R+_*i;if(!(I<0||I>=n.inWidth))for(var N=E+_*t.strides[1],T=C+I*n.inChannels,A=k,D=N,O=0;O<n.inChannels;++O){for(var F=f[T+O],P=0;P<l;++P)p[A+P]+=F*d[D+P];A+=l,D+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){fN([e,t],"depthwiseConv2DDerInput");for(var r=Bx(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=this.readSync(e.dataId),c=e.strides,f=c[0],d=c[1],p=c[2],h=this.readSync(t.dataId),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,E=n.inChannels,C=n.inHeight,S=n.inWidth,k=n.outChannels,R=n.outHeight,_=n.outWidth,I=n.strideHeight,N=n.strideWidth,T=x-1-n.padInfo.top,A=w-1-n.padInfo.left,D=k/E,O=0;O<b;++O)for(var F=0;F<E;++F)for(var P=0;P<C;++P)for(var M=P-T,L=Math.max(0,Math.ceil(M/I)),B=Math.min(R,(x+M)/I),z=0;z<S;++z){for(var W=z-A,U=Math.max(0,Math.ceil(W/N)),j=Math.min(_,(w+W)/N),V=0,H=L;H<B;++H)for(var G=H*I-M,q=U;q<j;++q)for(var K=f*O+d*H+p*q,$=m*(x-1-G)+g*(w-1-(q*N-W))+y*F,X=0;X<D;++X)V+=l[K+(F*D+X)]*h[$+X];o[i*O+s*P+u*z+F]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){fN([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Bx(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,f=this.bufferSync(e),d=this.bufferSync(t),p=0;p<a;++p)for(var h=Math.max(0,Math.ceil((l-p)/r)),v=Math.min(n.outHeight,(n.inHeight+l-p)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/c),w=b%c,E=0,C=0;C<n.batchSize;++C)for(var S=h;S<v;++S)for(var k=p+S*r-l,R=g;R<y;++R){var _=m+R*o-u;E+=f.get(C,k,_,x)*d.get(C,S,R,b)}s.set(E,p,m,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return fN(e,"tile"),nC(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){fN(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),a=this.bufferSync(e),i=Bx(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map(function(e,t){return e+o[t]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},t.prototype.gather=function(e,t,n){fN([e,t],"gather");var r=e.shape.slice(),o=this.readSync(t.dataId);r[n]=o.length;for(var a=Bx(r,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){fN([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=Xx(e.shape,t,r),a=Yx(o.length,t.length),i=Qx(e.shape,t,r),s=Jx(n,t.length),u=Zx(i,n,t.length);return SE(e.reshape(o),a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){fN([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Xx(i.shape,t,r,!1),u=Yx(s.length,t.length,!1),l=Qx(i.shape,t,r,!1);return SE(i.reshape(s),u).reshape(l)},t.prototype.maxPool=function(e,t){return fN(e,"maxPool"),dN(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){fN([t,n],"maxPoolBackprop");for(var o=this.readSync(t.dataId),a=Bx(r.outShape,t.dtype,pN(o,t.shape,t.dtype,r).values),i=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=f-1-r.padInfo.left,p=c-1-r.padInfo.top,h=Bx(t.shape,"float32"),v=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-p,w=b-d,E=0,C=0;C<c;C+=u){var S=(x+C)/i;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var k=0;k<f;k+=l){var R=(w+k)/s;if(!(R<0||R>=r.outWidth||Math.floor(R)!==R)){var _=c*f-1-a.get(m,S,R,g)===C*f+k?1:0;0!==_&&(E+=v.get(m,S,R,g)*_)}}}h.set(E,m,y,b,g)}return h.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){fN([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,f=c-1-n.padInfo.left,d=l-1-n.padInfo.top,p=Bx(t.shape,"float32"),h=1/(a*i),v=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-d,w=b-f,E=0,C=0;C<l;C+=s){var S=(x+C)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var R=(w+k)/o;R<0||R>=n.outWidth||Math.floor(R)!==R||(E+=v.get(m,S,R,g))}}p.set(E*h,m,y,b,g)}return p.toTensor()},t.prototype.pool3d=function(e,t,n){fN(e,"pool3d");for(var r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,h=t.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=Bx(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],E=t.outShape[4],C=0;C<t.batchSize;++C)for(var S=C*b,k=C*e.strides[0],R=0;R<t.inChannels;++R)for(var _=0;_<t.outDepth;++_){for(var I=_*r-d,N=I;N<0;)N+=i;for(var T=Math.min(t.inDepth,l+I),A=S+_*x,D=0;D<t.outHeight;++D){for(var O=D*o-p,F=O;F<0;)F+=s;for(var P=Math.min(t.inHeight,c+O),M=A+D*w,L=0;L<t.outWidth;++L){for(var B=L*a-h,z=B;z<0;)z+=u;for(var W=Math.min(t.inWidth,f+B),U=M+L*E,j=v,V=0,H=0,G=N;G<T;G+=i){for(var q=k+G*e.strides[1],K=F;K<P;K+=s){for(var $=q+K*e.strides[2],X=z;X<W;X+=u){var Y=m[$+X*e.strides[3]+R];if("max"===n&&Y>j?j=Y:"avg"===n&&(V+=Y,H++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}y[U+R]="avg"===n?V/H:j}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return fN(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){fN([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,h=n.effectiveFilterWidth,v=d-1-n.padInfo.front,m=h-1-n.padInfo.left,g=p-1-n.padInfo.top,y=Bx(t.shape,"float32"),b=1/(i*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var E=0;E<n.inChannels;++E)for(var C=0;C<n.inDepth;++C)for(var S=0;S<n.inHeight;++S)for(var k=0;k<n.inWidth;++k){for(var R=C-v,_=S-g,I=k-m,N=0,T=0;T<d;T+=l){var A=(R+T)/r;if(!(A<0||A>=n.outDepth||Math.floor(A)!==A))for(var D=0;D<p;D+=c){var O=(_+D)/o;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var F=0;F<h;F+=f){var P=(I+F)/a;P<0||P>=n.outWidth||Math.floor(P)!==P||(N+=x.get(w,A,O,P,E))}}}y.set(N*b,w,C,S,k,E)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return fN(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Bx(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,h=t.padInfo.left,v=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-d,x=b;x<0;)x+=i;for(var w=Math.min(t.inDepth,l+b),E=0;E<t.outHeight;++E){for(var C=E*o-p,S=C;S<0;)S+=s;for(var k=Math.min(t.inHeight,c+C),R=0;R<t.outWidth;++R){for(var _=R*a-h,I=_;I<0;)I+=u;for(var N=Math.min(t.inWidth,f+_),T=Number.NEGATIVE_INFINITY,A=-1,D=x;D<w;D+=i)for(var O=D-b,F=S;F<k;F+=s)for(var P=F-C,M=I;M<N;M+=u){var L=M-_,B=v.get(m,D,F,M,g);B>=T&&(T=B,A=O*c*f+P*c+L)}n.set(A,m,y,E,R,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){fN([t,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(t,r),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,h=f-1-r.padInfo.front,v=p-1-r.padInfo.left,m=d-1-r.padInfo.top,g=Bx(t.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var E=0;E<r.inDepth;++E)for(var C=0;C<r.inHeight;++C)for(var S=0;S<r.inWidth;++S){for(var k=E-h,R=C-m,_=S-v,I=0,N=0;N<f;N+=u){var T=(k+N)/a;if(!(T<0||T>=r.outDepth||Math.floor(T)!==T))for(var A=0;A<d;A+=l){var D=(R+A)/i;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var O=0;O<p;O+=c){var F=(_+O)/s;if(!(F<0||F>=r.outWidth||Math.floor(F)!==F)){var P=f*d*p-1-y.get(x,T,D,F,w)===N*d*p+A*p+O?1:0;0!==P&&(I+=b.get(x,T,D,F,w)*P)}}}}g.set(I,x,E,C,S,w)}return g.toTensor()},t.prototype.cast=function(e,t){return WE(e,t,this)},t.prototype.reshape=function(e,t){return UE(e,t)},t.prototype.avgPool=function(e,t){return fN(e,"avgPool"),fN(e,"maxPool"),dN(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){fN(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(Wg([a,t,n,u])),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=0,h=f[0]/d[0],v=f[1]/d[1],m=0;m<a;m++)for(var g=0;g<t;g++)for(var y=h*g,b=Math.floor(y),x=y-b,w=Math.min(i-1,Math.ceil(y)),E=m*e.strides[0]+b*e.strides[1],C=m*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var k=v*S,R=Math.floor(k),_=k-R,I=Math.min(s-1,Math.ceil(k)),N=E+R*e.strides[2],T=C+R*e.strides[2],A=E+I*e.strides[2],D=C+I*e.strides[2],O=0;O<u;O++){var F=l[N+O],P=l[T+O],M=F+(l[A+O]-F)*_,L=M+(P+(l[D+O]-P)*_-M)*x;c[p++]=L}return bx(c,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){fN([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=[n&&l>1?a-1:a,n&&c>1?i-1:i],p=[n&&l>1?l-1:l,n&&c>1?c-1:c],h=d[0]/p[0],v=d[1]/p[1],m=this.readSync(e.dataId),g=0,y=0;y<o;y++)for(var b=y*t.strides[0],x=0;x<l;x++)for(var w=x*h,E=Math.floor(w),C=Math.min(Math.ceil(w),a-1),S=b+E*t.strides[1],k=b+C*t.strides[1],R=w-E,_=1-R,I=0;I<c;I++)for(var N=I*v,T=Math.floor(N),A=Math.min(Math.ceil(N),i-1),D=N-T,O=1-D,F=S+T*t.strides[2],P=S+A*t.strides[2],M=k+T*t.strides[2],L=k+A*t.strides[2],B=_*O,z=_*D,W=R*O,U=R*D,j=0;j<s;j++){var V=m[g++];f[F+j]+=V*B,f[P+j]+=V*z,f[M+j]+=V*W,f[L+j]+=V*U}return kx(f,[o,i,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){fN(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(a*t*n*u),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=f[0]/d[0],h=f[1]/d[1],v=0,m=0;m<a;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var b=p*y,x=g+Math.min(i-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var E=h*w,C=x+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],S=0;S<u;S++){var k=l[C+S];c[v++]=k}return bx(c,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){fN([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=this.readSync(e.dataId),p=[n&&l>1?a-1:a,n&&c>1?i-1:i],h=[n&&l>1?l-1:l,n&&c>1?c-1:c],v=p[0]/h[0],m=p[1]/h[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<o;w++)for(var E=w*t.strides[0],C=0;C<a;C++)for(var S=E+C*t.strides[1],k=Math.floor(C*g),R=Math.floor(k-b/2),_=0;_<i;_++)for(var I=S+_*t.strides[2],N=Math.floor(_*y),T=Math.floor(N-x/2),A=0;A<s;A++){for(var D=0,O=0;O<b;O++){var F=O+R;if(!(F<0||F>=l)){var P=E+F*e.strides[1],M=F*v;if(C===Math.min(a-1,n?Math.round(M):Math.floor(M)))for(var L=0;L<x;L++){var B=L+T;if(!(B<0||B>=c)){var z=P+B*e.strides[2],W=B*m;_===Math.min(i-1,n?Math.round(W):Math.floor(W))&&(D+=d[z+A])}}}}f[I+A]=D}return kx(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){fN([e,t,n,o,a],"batchNorm");for(var i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(i.length),d=c.length,p=l.length,h=u.length,v=s.length,m=0,g=0,y=0,b=0,x=0;x<i.length;++x)f[x]=c[m++]+(i[x]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),m>=d&&(m=0),g>=v&&(g=0),y>=p&&(y=0),b>=h&&(b=0);return kx(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){fN(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=this.readSync(e.dataId),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var f=0;f<u;f++){var d=c(f),p=s[f]*Math.pow(n+r*d,-o);l[f]=p}return kx(l,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){fN(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=this.readSync(n.dataId),f=new Float32Array(e.size),d=e.size,p=0;p<d;p++){for(var h=p%s,v=p-h+Math.max(0,h-r),m=p-h+Math.min(s,h+r+1),g=0,y=v;y<m;y++)g+=Math.pow(l[y],2);for(g=a*g+o,y=v;y<m;y++){var b=-2*a*i*l[y]*c[p]/g;p===y&&(b+=Math.pow(g,-i)),b*=u[p],f[y]+=b}}return kx(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){fN(e,"multinomial");for(var o=t?e:EE(e),a=o.shape[0],i=o.shape[1],s=_x([a,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<a;++c){var f=c*i,d=new Float32Array(i-1);d[0]=l[f];for(var p=1;p<d.length;++p)d[p]=d[p-1]+l[f+p];for(var h=tR(r.toString()),v=c*n,m=0;m<n;++m){var g=h();u[v+m]=d.length;for(var y=0;y<d.length;y++)if(g<d[y]){u[v+m]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){fN(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=this.readSync(e.dataId),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return Cx(o,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return fN(e,"nonMaxSuppression"),XE(this.readSync(e.dataId),this.readSync(t.dataId),n,r,o)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=Bx(e.shape,"float32"),a=Bx(e.shape,"float32"),i=gx(e).as2D(n,r),s=yx(e).as2D(n,r),u=0;u<n;u++)for(var l=i.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),f=mx(l,c),d=this.readSync(this.fftImpl(f,t).dataId),p=0;p<r;p++){var h=HE(d,p);o.values[u*r+p]=h.real,a.values[u*r+p]=h.imag}return mx(o.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=mx(gx(o).div(wx(r)),yx(o).div(wx(r)))),o}var a=this.readSync(e.dataId),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return mx(i.real,i.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=mx(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=mx(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=mx(l.real,l.imag).mul(u),f=i.add(c),d=i.sub(c),p=gx(f).concat(gx(d)),h=yx(f).concat(yx(d));return mx(p,h).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=qE(o*s,t,n),l=HE(e,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}n&&(a/=t,i/=t),GE(r,a,i,o)}return r},t.prototype.depthToSpace=function(e,t,n){Mg("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),Mg(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,l=i/(t*t),c=this.readSync(e.dataId),f=new Float32Array(r*s*u*l),d=0,p=0;p<r;++p)for(var h=0;h<s;++h)for(var v=Math.floor(h/t),m=h%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(m*t+g%t)*l,x=0;x<l;++x){var w=x+b+i*(y+a*(v+o*p));f[d++]=c[w]}return kx(f,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=cw(e.shape,t.shape),a=Bx(o,n),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=uw(e.shape,o),l=uw(t.shape,o),c=a.values;if(u.length+l.length===0)for(var f=0;f<c.length;++f)c[f]=r(i[f%i.length],s[f%s.length]);else{var d=this.bufferSync(e),p=this.bufferSync(t),h=function(n){var o=a.indexToLoc(n),f=o.slice(-e.rank);u.forEach(function(e){return f[e]=0});var h=d.locToIndex(f),v=o.slice(-t.rank);l.forEach(function(e){return v[e]=0});var m=p.locToIndex(v);c[n]=r(i[h],s[m])};for(f=0;f<c.length;++f)h(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=cw(e.shape,t.shape),o=Bx(r,"float32"),a=Bx(r,"float32"),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=uw(e.shape,r),l=uw(t.shape,r),c=o.values,f=a.values;if(u.length+l.length===0)for(var d=0;d<c.length;d++){var p=d%i.length,h=d%s.length,v=n(i[2*p],i[2*p+1],s[2*h],s[2*h+1]);c[d]=v.real,f[d]=v.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),d=a.slice(-e.rank);u.forEach(function(e){return d[e]=0});var p=m.locToIndex(d),h=a.slice(-t.rank);l.forEach(function(e){return h[e]=0});var v=g.locToIndex(h),y=n(i[2*p],i[2*p+1],s[2*v],s[2*v+1]);c[r]=y.real,f[r]=y.imag};for(d=0;d<c.length;d++)y(d)}return this.complex(o.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return tC(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],f=t.shape[0],d=r[0],p=r[1],h=Bx([f,d,p,c],"float32"),v=this.readSync(t.dataId),m=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=h.strides,x=0;x<f;x++){var w=4*x,E=v[w],C=v[w+1],S=v[w+2],k=v[w+3],R=m[x];if(!(R>=s))for(var _=d>1?(S-E)*(u-1)/(d-1):0,I=p>1?(k-C)*(l-1)/(p-1):0,N=0;N<d;N++){var T=d>1?E*(u-1)+N*_:.5*(E+S)*(u-1);if(T<0||T>u-1)for(var A=0;A<p;A++)for(var D=0;D<c;D++){var O=D+A*b[2]+N*b[1]+x*b[0];h.values[O]=a}else if("bilinear"===o){var F=Math.floor(T),P=Math.ceil(T),M=T-F;for(A=0;A<p;A++)if((G=p>1?C*(l-1)+A*I:.5*(C+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],h.values[O]=a;else{var L=Math.floor(G),B=Math.ceil(G),z=G-L;for(D=0;D<c;D++){var W=g[O=D+L*y[2]+F*y[1]+R*y[0]],U=g[O=D+B*y[2]+F*y[1]+R*y[0]],j=g[O=D+L*y[2]+P*y[1]+R*y[0]],V=W+(U-W)*z,H=j+(g[O=D+B*y[2]+P*y[1]+R*y[0]]-j)*z;O=D+A*b[2]+N*b[1]+x*b[0],h.values[O]=V+(H-V)*M}}}else for(A=0;A<p;++A){var G;if((G=p>1?C*(l-1)+A*I:.5*(C+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],h.values[O]=a;else{var q=Math.round(G),K=Math.round(T);for(D=0;D<c;D++){var $=D+q*y[2]+K*y[1]+R*y[0],X=D+A*b[2]+N*b[1]+x*b[0];h.values[X]=g[$]}}}}}return h.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var o=pE(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(e,t,n,l,s,i,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=lE(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return bx([],a,e.dtype);for(var l=new Ry([i,s],e.dtype),c=this.readSync(t.dataId),f=this.readSync(e.dataId),d=0;d<i;d++){for(var p=[],h=0,v=0;v<r;v++){var m=c[d*r+v];h+=m*u[v],p.push(m)}if(h<0||h>=e.size/s)throw new Error("Invalid indices: "+p+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[d*s+g]=f[h*s+g]}return l.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=pE(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=wx(0);return this.scatter(e,t,n,u,i,a,o,s,l,!0)},t.prototype.fill=function(e,t,n){var r=Qg(n=n||sy(t),Wg(e));return r.fill(t),qy.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=Qg(e.dtype,Wg(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return jE(e,t,n)},t.prototype.scatter=function(e,t,n,r,o,a,i,s,u,l){var c=[r/o,o],f=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return bx([],n,t.dtype);var p=new Ry(c,t.dtype);p.values.fill(this.readSync(u.dataId)[0]);for(var h=0;h<a;h++){for(var v=[],m=0,g=0;g<i;g++){var y=f[h*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<o;b++)l?p.values[m*o+b]+=d[h*o+b]:p.values[m*o+b]=0===t.rank?d[0]:d[h*o+b]}return p.toTensor().reshape(n)},t}(RE);function mN(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,o=n.backend,a=r,i=a.a,s=a.b,u=o;fN([i,s],e);var l=u.data.get(i.dataId).values,c=u.data.get(s.dataId).values,f=t(i.shape,s.shape,l,c,i.dtype),d=f[0],p=f[1];return{dataId:u.write(d,p,i.dtype),shape:p,dtype:i.dtype}}}}function gN(e){return function(t,n,r,o,a){var i=cw(t,n),s=i.length,u=cy(i),l=Yg(a,Wg(i)),c=t.length,f=n.length,d=cy(t),p=cy(n),h=uw(t,i),v=uw(n,i);if(h.length+v.length===0)for(var m=0;m<l.length;++m)l[m]=e(r[m%r.length],o[m%o.length]);else{var g=function(t){var n=xy(t,s,u),a=n.slice(-c);h.forEach(function(e){return a[e]=0});var i=by(a,c,d),m=n.slice(-f);v.forEach(function(e){return m[e]=0});var g=by(m,f,p);l[t]=e(r[i],o[g])};for(m=0;m<l.length;++m)g(m)}return[l,i]}}qy.registerBackend("cpu",function(){return new vN},1);var yN=gN(function(e,t){return e/t}),bN=mN(ew,yN),xN={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;fN(o,"MaxPoolWithArgmax");var f=c.data.get(o.dataId).values,d=IE(o.shape,i,s,[1,1],u),p=function(e,t,n,r,o){var a=dN(e,0,n,cy(t),o,"max"),i=pN(e,t,n,o,!0,r);return[a.values,i.values]}(f,o.shape,o.dtype,l,d),h=p[0],v=p[1],m=c.write(h,d.outShape,o.dtype),g=c.write(v,d.outShape,o.dtype);return[{dataId:m,shape:d.outShape,dtype:o.dtype},{dataId:g,shape:d.outShape,dtype:"int32"}]}},wN={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,d=n;fN(a,"NonMaxSuppressionWithScore");var p=YE(d.data.get(a.dataId).values,d.data.get(i.dataId).values,u,l,c,f);return[p.selectedIndices,p.selectedScores]}},EN={kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;fN(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},CN=gN(function(e,t){var n=e-t;return n*n});function SN(e,t,n,r,o){for(var a=Wg(t),i=t.length,s=cy(t),u=cy(o),l=Yg(n,Wg(o)),c=0;c<a;++c){for(var f=xy(c,i,s),d=new Array(f.length),p=0;p<d.length;p++)d[p]=f[r[p]];l[by(d,i,u)]=e[c]}return l}for(var kN=0,RN=[wN,EN,mN(tw,CN),bN,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n.perm,i=r;fN(o,"transpose");for(var s=o.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=o.shape[a[l]];var c=SN(i.data.get(o.dataId).values,o.shape,o.dtype,a,u);return{dataId:i.write(c,u,o.dtype),shape:u,dtype:o.dtype}}},xN];kN<RN.length;kN++)Ng(RN[kN]);for(var _N,IN=function(e){this.variableNames=["A"];var t=cC(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},NN=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=cC(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},TN=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=CC(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},AN=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=CC(this.rank),a=uC("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},DN=0,ON=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,a=r.numChannels,i="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],f=[c,l],d=[c,l,a];(s||i)&&(null==_N&&(_N=document.createElement("canvas").getContext("2d")),_N.canvas.width=l,_N.canvas.height=c,_N.drawImage(o,0,0,l,c),o=_N.canvas);var p=n.makeTensorInfo(f,"int32");n.texData.get(p.dataId).usage=Yy.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),o);var h=Eg().getBool("WEBGL_PACK")?new NN(d):new IN(d),v=n.runWebGLProgram(h,[p],"int32");return n.disposeData(p.dataId),v}},{kernelName:ew,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;return function(e,t,n){var r=new MC("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new BC("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",e.shape,t.shape,!0)),n.runWebGLProgram(r,[e,t],"float32")}(r.a,r.b,n)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;ex("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,d=n,p=YE(d.readSync(a.dataId),d.readSync(i.dataId),u,l,c,f);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,a=new yk(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:tw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n,s=Eg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BC("return (a - b) * (a - b);",o.shape,a.shape):new MC("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,o=e.backend,a=n.x,i=r.perm,s=o,u=a.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=a.shape[i[c]];if(s.shouldExecuteOnCPU([a])){var f=SN(s.texData.get(a.dataId).values,a.shape,a.dtype,i,l);t=s.makeTensorInfo(l,a.dtype),s.texData.get(t.dataId).values=f}else t=function(e,t,n){var r=Eg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new AN(e.shape,t):new TN(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}(a,i,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;Mg(4===o.shape.length,function(){return"Error in maxPool: input must be rank 4 but got rank "+o.shape.length+"."});var f=[1,1];Mg(BE(s,f),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+f+"'"});var d=IE(o.shape,i,s,f,u),p=function(e,t,n,r){var o=new $S(n,"max",!1),a=r.runWebGLProgram(o,[e],"float32");return o=new $S(n,"max",!0,!0,t),[a,r.runWebGLProgram(o,[e],"float32")]}(o,l,d,c);return[p[0],p[1]]}}];DN<ON.length;DN++)Ng(ON[DN]);for(var FN=0,PN=[{kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=cw(n.shape,r.shape);return{a:function(){var t=e,r=lw(n.shape,o);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},b:function(){var t=e,n=lw(r.shape,o);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n}},{kernelName:nw,gradFunc:function(e,t,n){for(var r=n,o=r.inputShape,a=r.shape,i=Array.from(a),s=o.length-1;s>=0;s--)if(o[s]===a[s])i[s]=1;else if(1!==o[s])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<i.length;s++)i[s]>1&&u.push(s);return{x:function(){return e.sum(u,!0)}}}},{kernelName:ew,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=cw(n.shape,r.shape);return{a:function(){var t=uE(e,r.toFloat()),a=lw(n.shape,o);return a.length>0?nI(t,a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=lw(r.shape,o);a.length>0&&(t=nI(t,a).reshape(r.shape));var i=qR(r);return Nw(uE(t,i.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,o=t[0],a=t[1],i=t[2],s=t[3],u=oR(o),l=null==s?wx(1):s,c=lw(a.shape,u.shape),f=[];if(1===a.rank){for(var d=0;d<u.shape.length-1;++d)f.push(u.shape[d]);f.push(1)}var p=iE(o,a),h=tE(e,l),v=Dw(sw(i,wx(r))),m=tE(tE(tE(v,v),v),wx(-.5));return{x:function(){return 1===a.rank?Hx(tE(tE(e,_R(v.as4D(1,1,1,a.shape[0]),f)),l),o.shape):Hx(tE(tE(e,v),l),o.shape)},mean:function(){var e=tE(tE(v,wx(-1)),h);return 1===a.rank&&(e=nI(e,c)),Hx(e,a.shape)},variance:function(){var e=tE(tE(m,p),h);return 1===a.rank&&(e=nI(e,c)),Hx(e,a.shape)},scale:function(){var t=tE(p,v),n=tE(e,t);return 1===a.rank&&(n=nI(n,c)),Hx(n,a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=nI(t,c)),Hx(t,a.shape)}}}},{kernelName:ow,gradFunc:function(e){return{x:function(){return e.toFloat()}}}},{kernelName:rw,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return _x(n.shape,"float32")}}}},{kernelName:iw,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],o=n.paddings.map(function(e){return e[0]});return{x:function(){return e.slice(o,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:tw,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=wx(2);return{a:function(){return tE(e,tE(o,iE(n,r)))},b:function(){return tE(e,tE(o,iE(r,n)))}}}},{kernelName:aw,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],o=n.reps;return{x:function(){var t=Ax(r);if(1===r.rank)for(var n=0;n<o[0];++n)t=t.add(e.slice([n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<o[0];++n)for(var a=0;a<o[1];++a)t=t.add(e.slice([n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(var i=0;i<o[2];++i)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(i=0;i<o[2];++i)for(var s=0;s<o[3];++s)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=fx(n.perm);return{x:function(){return SE(e,r)}}}}];FN<PN.length;FN++)Tg(PN[FN]);var MN=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();Eg().get("IS_BROWSER")&&Eg().setPlatform("browser",new MN);var LN,BN=function(){function e(){this.util=n(12),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=Eg().global.fetch?Eg().global.fetch(e,t):(null==LN&&(LN=n(519)),LN(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();Eg().get("IS_NODE")&&Eg().setPlatform("node",new BN);var zN={float32:4,int32:4,uint16:2,uint8:1,bool:1};function WN(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=Wg(i),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=zN[l.dtype],f=e.slice(r,r+s*c),d="uint8"===l.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(d,function(e){return e*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(d,function(e){return Math.round(e*l.scale+l.min)})}r+=s*c}else if("string"===a){var p=Wg(t.shape);u=[];for(var h=0;h<p;h++){var v=new Uint32Array(e.slice(r,r+4))[0];r+=4;var m=new Uint8Array(e.slice(r,r+v));u.push(m),r+=v}}else{var g=zN[a];if(f=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(f)}r+=s*g}n[o]=bx(u,i,a)},a=0,i=t;a<i.length;a++)o(i[a]);return n}function UN(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var jN="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function VN(e){return jN?Buffer.byteLength(e):new Blob([e]).size}function HN(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function GN(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function qN(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:VN(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:VN(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var KN=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),$N="://",XN=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){Mg(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith($N)&&(t=t.slice(0,t.indexOf($N))),Mg(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();Mg(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function YN(e){if(-1===e.indexOf($N))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+XN.getSchemes().join(","));return{scheme:e.split($N)[0],path:e.split($N)[1]}}function QN(e,t,n){return void 0===n&&(n=!1),bg(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f;return xg(this,function(d){switch(d.label){case 0:return Mg(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),Mg((r=KN.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),Mg(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],Mg((a=KN.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),Mg(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=YN(e).scheme,u=YN(e).path,l=s===YN(e).scheme,[4,o.load()];case 1:return c=d.sent(),n&&l?[4,XN.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,i.save(c)];case 4:return f=d.sent(),!n||l?[3,6]:[4,XN.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var JN="models_store",ZN="model_info_store";function eT(){if(!Eg().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function tT(e){var t=e.result;t.createObjectStore(JN,{keyPath:"modelPath"}),t.createObjectStore(ZN,{keyPath:"modelPath"})}var nT=function(){function e(e){if(this.indexedDB=eT(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return tT(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(JN,"readonly"),s=i.objectStore(JN).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=qN(t),c=a.transaction(ZN,"readwrite"),f=c.objectStore(ZN),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:l});d.onsuccess=function(){var o=(u=a.transaction(JN,"readwrite")).objectStore(JN).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});o.onsuccess=function(){return e({modelArtifactsInfo:l})},o.onerror=function(e){var t=(f=c.objectStore(ZN)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},d.onerror=function(e){return a.close(),r(d.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),rT=function(e){return Eg().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(nT.URL_SCHEME)?(t=e.slice(nT.URL_SCHEME.length),new nT(t)):null;var t};KN.registerSaveRouter(rT),KN.registerLoadRouter(rT);var oT=function(){function e(){this.indexedDB=eT()}return e.prototype.listModels=function(){return bg(this,void 0,void 0,function(){var e=this;return xg(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return tT(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(ZN,"readonly"),a=o.objectStore(ZN).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return bg(this,void 0,void 0,function(){var t=this;return xg(this,function(n){var r;return e=(r=e).startsWith(nT.URL_SCHEME)?r.slice(nT.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return tT(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(ZN,"readwrite"),s=i.objectStore(ZN),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(JN,"readwrite")).objectStore(JN).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if(Eg().getBool("IS_BROWSER"))try{XN.registerManager(nT.URL_SCHEME,new oT)}catch(gg){}var aT="/",iT="tensorflowjs_models",sT="info",uT="model_topology",lT="weight_specs",cT="weight_data",fT="model_metadata";function dT(e){return{info:[iT,e,sT].join(aT),topology:[iT,e,uT].join(aT),weightSpecs:[iT,e,lT].join(aT),weightData:[iT,e,cT].join(aT),modelMetadata:[iT,e,fT].join(aT)}}function pT(e){var t=e.split(aT);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(aT)}var hT=function(){function e(e){if(!Eg().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=dT(this.modelPath)}return e.prototype.save=function(e){return bg(this,void 0,void 0,function(){var t,n,r;return xg(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=qN(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(jN)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return bg(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return xg(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(jN){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),vT=function(e){return Eg().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(hT.URL_SCHEME)?(t=e.slice(hT.URL_SCHEME.length),new hT(t)):null;var t};KN.registerSaveRouter(vT),KN.registerLoadRouter(vT);var mT=function(){function e(){Mg(Eg().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Mg("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return bg(this,void 0,void 0,function(){var e,t,n,r,o,a;return xg(this,function(i){for(e={},t=iT+aT,n=aT+sT,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=pT(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return bg(this,void 0,void 0,function(){var t,n;return xg(this,function(r){var o;if(e=(o=e).startsWith(hT.URL_SCHEME)?o.slice(hT.URL_SCHEME.length):o,t=dT(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(Eg().getBool("IS_BROWSER"))try{XN.registerManager(hT.URL_SCHEME,new mT)}catch(gg){}function gT(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var yT=function(){function e(t){if(!Eg().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return bg(this,void 0,void 0,function(){var t,n,r,o,a,i;return xg(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,gT(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,gT(function(){return i.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:qN(e)}]}})})},e.URL_SCHEME="downloads://",e}(),bT=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return bg(this,void 0,void 0,function(){var e,t,n=this;return xg(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var c=[],f=[],d=[];u.forEach(function(e){e.paths.forEach(function(e){f.push(e),d.push(null)}),c.push.apply(c,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=f.indexOf(e);d[o]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:HN(d),format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,userDefinedMetadata:i.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return GN(e.name)}),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach(function(e){var a=GN(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function xT(e,t,n,r){!function(e){Mg(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){Mg(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),Mg(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),Mg(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var i=n+ ++o/e.length*(r-n);return t(i),a}),a}))}function wT(e,t){return bg(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return xg(this,function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?Eg().platform.fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit,{isBinary:!0})}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=f.sent(),[3,4];case 2:return[4,xT(r,t.onProgress,o,a)];case 3:i=f.sent(),f.label=4;case 4:return s=i.map(function(e){return e.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=f.sent(),[3,8];case 6:return[4,xT(s,t.onProgress,u,l)];case 7:c=f.sent(),f.label=8;case 8:return[2,c]}})})}function ET(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),bg(t,void 0,void 0,function(){var t,a,i,s,u,l,c,f,d,p;return xg(this,function(h){switch(h.label){case 0:if(t=n.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,l=zN[u]*Wg(e.shape),c=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=o?o.forEach(function(t,n){t===e.name&&(c(),i[n]=!0)}):c(),s.push(e.name),r+=l})}),!i.every(function(e){return e}))throw u=o.filter(function(e,t){return!i[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),c=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)})}),[4,e(c)];case 1:return f=h.sent(),d={},p=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=f[p+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,l=0;l<t;l++){var c=new Uint8Array(f[p+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(e){var t=WN(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]}),p+=t}),[2,d]}})})}}KN.registerSaveRouter(function(e){return Eg().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(yT.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new yT(e)}(e.slice(yT.URL_SCHEME.length)):null});var CT=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(Mg("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Eg().platform.fetch,Mg(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Mg(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return bg(this,void 0,void 0,function(){var t,n,r,o;return xg(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:qN(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return bg(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s,u,l,c,f;return xg(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,e.json()];case 3:return t=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,i=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:f=d.sent(),l=f[0],c=f[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:c,userDefinedMetadata:u,generatedBy:a,convertedBy:i,format:s}]}})})},e.prototype.loadWeights=function(e){return bg(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f;return xg(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,u=e;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],e.forEach(function(e){e.paths.forEach(function(e){c.push(a+e+o)})}),[4,wT(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[i,HN(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function ST(e){return null!=e.match(CT.URL_SCHEME_REGEX)}var kT=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return ST(e)}):ST(e))?RT(e,{onProgress:t}):null};function RT(e,t){return new CT(e,t)}KN.registerSaveRouter(kT),KN.registerLoadRouter(kT);var _T,IT=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){return[2,this.modelArtifacts]})})},e}(),NT=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(t){return[2,this.saveHandler(e)]})})},e}(),TT=Object.freeze({browserFiles:function(e){return new bT(e)},browserHTTPRequest:function(e,t){return RT(e,t)},concatenateArrayBuffers:HN,decodeWeights:WN,encodeWeights:function(e,t){return bg(this,void 0,void 0,function(){var n,r,o,a,i,s=this;return xg(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),a=function(a){var i=o[a],u=Array.isArray(e)?e[a].tensor:e[i];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+u.dtype);var l={name:i,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(e){return bg(s,void 0,void 0,function(){var t,n,r,o,a,i,s;return xg(this,function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(t=l.sent(),n=t.reduce(function(e,t){return e+t.length},0)+4*t.length,r=new Uint8Array(n),o=0,a=0;a<t.length;a++)i=t[a],s=new Uint8Array(new Uint32Array([i.length]).buffer),r.set(s,o),o+=4,r.set(i,o),o+=i.length;return e(r),[2]}})})});r.push(c)}else r.push(u.data());null!=t&&(l.group=t),n.push(l)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:UN(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new IT(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new IT({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new IT({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return KN.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:qN,getSaveHandlers:function(e){return KN.getSaveHandlers(e)},http:RT,isHTTPScheme:ST,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),bg(this,void 0,void 0,function(){return xg(this,function(o){return[2,ET(function(e){return wT(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return KN.registerLoadRouter(e)},registerSaveRouter:function(e){return KN.registerSaveRouter(e)},weightsLoaderFactory:ET,withSaveHandler:function(e){return new NT(e)},copyModel:function(e,t){return bg(this,void 0,void 0,function(){return xg(this,function(n){return[2,QN(e,t,!1)]})})},listModels:function(){return bg(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return xg(this,function(s){switch(s.label){case 0:e=XN.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,XN.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+$N+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return bg(this,void 0,void 0,function(){return xg(this,function(n){return[2,QN(e,t,!0)]})})},removeModel:function(e){return bg(this,void 0,void 0,function(){var t;return xg(this,function(n){return t=YN(e),[2,XN.getManager(t.scheme).removeModel(t.path)]})})}}),AT=vx({confusionMatrix_:function(e,t,n){var r=rx(e,"labels","confusionMatrix"),o=rx(t,"predictions","confusionMatrix");Mg(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),Mg(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),Mg(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),Mg(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),Mg(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=TR(r.asType("int32"),n),i=TR(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}}),DT=(Object.freeze({confusionMatrix:AT}),vx({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);i=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=Rg("FromPixels",qy.backendName))return qy.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],f=l[1];if(i?s=e.getContext("2d").getImageData(0,0,c,f).data:r||n?s=e.data:(a||o)&&(null==_T&&(_T=document.createElement("canvas").getContext("2d")),_T.canvas.width=c,_T.canvas.height=f,_T.drawImage(e,0,0,c,f),s=_T.getImageData(0,0,c,f).data),4===t)u=new Int32Array(s);else{var d=c*f;u=new Int32Array(d*t);for(var p=0;p<d;p++)for(var h=0;h<t;++h)u[p*t+h]=s[4*p+h]}return Sx(u,[f,c,t],"int32")}})),OT=Object.freeze({toPixels:function(e,t){return bg(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,h,v,m,g,y,b,x,w,E,C,S;return xg(this,function(k){switch(k.label){case 0:if(n=rx(e,"img","toPixels"),e instanceof Ty||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,n.data()];case 1:return s=k.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=k.sent(),f=c[0],d=c[1],p=f[0],h=d[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(p<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+h+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||h>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+h+"].")}for(v="float32"===n.dtype?255:1,m=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)y=void 0,b=void 0,x=void 0,w=void 0,1===i?(y=s[g]*v,b=s[g]*v,x=s[g]*v,w=255):3===i?(y=s[3*g]*v,b=s[3*g+1]*v,x=s[3*g+2]*v,w=255):4===i&&(y=s[4*g]*v,b=s[4*g+1]*v,x=s[4*g+2]*v,w=s[4*g+3]*v),m[0+(E=4*g)]=Math.round(y),m[E+1]=Math.round(b),m[E+2]=Math.round(x),m[E+3]=Math.round(w);return null!=t&&(t.width=a,t.height=o,C=t.getContext("2d"),S=new ImageData(m,a,o),C.putImageData(S,0,0)),n!==e&&n.dispose(),[2,m]}})})},fromPixels:DT}),FT=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),PT=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function MT(e){Mg(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),Mg("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),Mg(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),PT.register(e)}Object.freeze({Serializable:FT,SerializationMap:PT,registerClass:MT}),Object.freeze({gpgpu_util:OS,webgl_util:Xb,forceHalfFloat:function(){Eg().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:qk,setWebGLContext:eb,GPGPUContext:FS});var LT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yg(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;if(null!=n){var i=n.map(function(e){return{name:e.name,tensor:a[e.name]}});this.applyGradients(i)}else this.applyGradients(a);return Zb(a),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){Mg(uy(e),function(){return"The f passed in variableGrads(f) must be a function"}),Mg(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof My}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],qy.registeredVariables)t.push(qy.registeredVariables[r]);var o=n?t.filter(function(e){return!e.trainable}):null,a=t.length;Mg((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=qy.gradients(e,t,null,!0),s=i.value,u=i.grads;Mg(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Mg(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(e,t){null!=u[t]&&(l[e.name]=u[t])}),null!=o&&o.forEach(function(e){return l[e.name]=null}),{value:s,grads:l}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Zb(this.iterations_)},t.prototype.saveIterations=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:wx(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return bg(this,void 0,void 0,function(){var t;return xg(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(FT);Object.defineProperty(LT,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var BT=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=qy.backend.epsilon()),o}return yg(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=qy.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Jb(function(){return Ax(o).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Jb(function(){return Ax(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Jb(function(){var e=i.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(i.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));i.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Zb(this.accumulatedGrads.map(function(e){return e.variable})),Zb(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){var e;return xg(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){var t;return xg(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(LT);MT(BT);var zT=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return yg(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=qy.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Jb(function(){return Ix(o.shape,t.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable;Jb(function(){var e=i.add(a.square());i.assign(e);var n=a.div(e.add(qy.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Zb(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(LT);MT(zT);var WT=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Jb(function(){a.accBeta1=wx(n).variable(),a.accBeta2=wx(r).variable()}),null==o&&(a.epsilon=qy.backend.epsilon()),a}return yg(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Jb(function(){var r=iE(1,t.accBeta1),o=iE(1,t.accBeta2);n.forEach(function(n,a){var i=qy.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Jb(function(){return Ax(i).variable(!1)})}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Jb(function(){return Ax(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedSecondMoment[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=c.div(r),p=f.div(o);u.assign(c),l.assign(f);var h=d.div(p.sqrt().add(t.epsilon)).mul(-t.learningRate).add(i);i.assign(h)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Zb(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Zb(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){var e;return xg(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){var t,n=this;return xg(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Jb(function(){n.accBeta1.assign(rE(n.beta1,n.iterations_+1)),n.accBeta2.assign(rE(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(LT);MT(WT);var UT=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Jb(function(){i.iteration=wx(0).variable(),i.accBeta1=wx(n).variable()}),null==o&&(i.epsilon=qy.backend.epsilon()),i}return yg(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Jb(function(){var r=iE(1,t.accBeta1),o=uE(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,a){var i=qy.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Ax(i).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:Ax(i).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedWeightedInfNorm[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2),d=s.abs(),p=f.maximum(d);u.assign(c),l.assign(p);var h=o.div(r).mul(c.div(p.add(t.epsilon))).add(i);i.assign(h)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Zb(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Zb(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(LT);MT(UT);var jT=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return yg(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=qy.registeredVariables[n];Jb(function(){var e=t.c.mul(o).add(a);a.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return qy.keep(e)}(wx(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(LT);MT(jT);var VT=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=wx(o.momentum),o}return yg(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=qy.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Jb(function(){return Ax(o).variable(!1)})});var a=t.accumulations[r].variable,i=Array.isArray(e)?e[r].tensor:e[n];null!=i&&Jb(function(){var e,n=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(n.mul(t.m))).add(o):t.c.mul(n).add(o),a.assign(n),o.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Zb(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){return xg(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){return xg(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(jT);MT(VT);var HT=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;if(i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=qy.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return yg(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=qy.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Jb(function(){return Ax(o).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Jb(function(){return Ax(o).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Jb(function(){return Ax(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Jb(function(){var e=i.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),l=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));i.assign(e),n.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var f=i.mul(t.decay).add(a.square().mul(1-t.decay));l=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),i.assign(f),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Zb(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Zb(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Zb(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return bg(this,void 0,void 0,function(){var e;return xg(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return bg(this,void 0,void 0,function(){var t;return xg(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(LT);MT(HT);var GT=function(){function e(){}return e.sgd=function(e){return new jT(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new VT(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new HT(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new WT(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new BT(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new UT(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new zT(e,t)},e}();GT.sgd,GT.momentum,GT.adadelta,GT.adagrad,GT.rmsprop,GT.adamax,GT.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;Ty.prototype.add=function(e){return sw(this,e)},Ty.prototype.broadcastTo=function(e){return yR(this,e)},Ty.prototype.div=function(e){return uE(this,e)},Ty.prototype.divNoNan=function(e){return RR(this,e)},Ty.prototype.squaredDifference=function(e){return KR(this,e)},Ty.prototype.tile=function(e){return _R(this,e)},Ty.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),TR(this,e,t,n)},Ty.prototype.transpose=function(e){return SE(this,e)},Ty.prototype.pad=function(e,t){return AR(this,e,t)},Ty.prototype.batchNorm=function(e,t,n,r,o){return uR(this,e,t,n,r,o)},Iy=cN;var qT=function(){function e(e,t){if(!nA(e)||!nA(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}(),KT=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}();function $T(e,t){return e instanceof Ty&&e.shape.length===t}function XT(e){return $T(e,3)}function YT(e){return $T(e,4)}function QT(e){return e%2===0}function JT(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function ZT(e){return e&&e.width&&e.height}function eA(e){return e.reduce(function(e,t){return e.add(t)},new KT(0,0)).div(new KT(e.length,e.length))}function tA(e,t,n){return Array(e).fill(0).map(function(e,r){return t+r*n})}function nA(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function rA(e){return nA(e)&&0<=e&&e<=1}var oA,aA=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(nA),a=[r.x,r.y,r.width,r.height].every(nA);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],l=i[2],c=i[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(nA)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new KT(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new KT(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new KT(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new KT(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.round(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.floor(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(n-=i/2,o+=i),a<o&&(r-=i/2,a+=i),new e({x:n,y:r,width:o,height:a})},e.prototype.rescale=function(t){var n=ZT(t)?t.width:t,r=ZT(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,a=r.y,i=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(a,0),c=i-u,f=s-l;return new e({x:u,y:l,width:Math.min(c,t-u),height:Math.min(f,n-l)}).floor()},e.prototype.shift=function(t,n){var r=this.width,o=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:o})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,o=n,a=r,i=this.left,s=this.top,u=this.right,l=this.bottom;return u>t&&(o=-u+t+n,u=t),l>e&&(a=-l+e+r,l=e),i<1&&(a=2-i,i=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:o,y:s,ey:l,x:i,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),iA=function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:o},a)||this}return dg(t,e),t}(aA),sA=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return dg(t,e),t.assertIsValidLabeledBox=function(e,t){if(aA.assertIsValidBox(e,t),!nA(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(aA),uA=function(){function e(e,t,n,r,o){this._imageDims=new qT(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new aA(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new aA(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),lA=(function(e){function t(t,n,r,o){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=o,a}dg(t,e),t.assertIsValidPredictedBox=function(e,t){if(sA.assertIsValidLabeledBox(e,t),!rA(e.score)||!rA(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(sA),function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:o},a)||this}return dg(t,e),t}(aA));function cA(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function fA(e){var t="";if(!e)try{e=n(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(o){t=o.toString()}var r=e?function(t){return new Promise(function(n,r){e.readFile(t,function(e,t){return e?r(e):n(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:r}}function dA(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=fA();return pg({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},o)}function pA(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}function hA(){return"object"===typeof n.g&&"undefined"!==typeof process&&!!process.version}function vA(e){oA=e}function mA(){pA()&&vA(cA()),hA()&&vA(dA())}var gA,yA={getEnv:function(){if(!oA)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return oA},setEnv:vA,initialize:mA,createBrowserEnv:cA,createFileSystem:fA,createNodejsEnv:dA,monkeyPatch:function(e){if(oA||mA(),!oA)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?oA.Canvas:t,r=e.Image,o=void 0===r?oA.Image:r;oA.Canvas=n,oA.Image=o,oA.createCanvasElement=e.createCanvasElement||function(){return new n},oA.createImageElement=e.createImageElement||function(){return new o},oA.ImageData=e.ImageData||oA.ImageData,oA.Video=e.Video||oA.Video,oA.fetch=e.fetch||oA.fetch,oA.readFile=e.readFile||oA.readFile},isBrowser:pA,isNodejs:hA};function bA(e){return yA.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function xA(e){var t=yA.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=bA(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}mA(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(gA||(gA={}));var wA=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,o=e.fontSize,a=e.fontStyle,i=e.padding;this.anchorPosition=t||gA.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=i||4},EA=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new wA(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(t){return e.measureText(t).width}).reduce(function(e,t){return e<t?t:e},0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===gA.BOTTOM_RIGHT||n===gA.TOP_RIGHT,o=n===gA.BOTTOM_LEFT||n===gA.BOTTOM_RIGHT,a=this.measureWidth(e),i=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,u=o?this.anchor.y-i:this.anchor.y;if(t){var l=t.width,c=t.height;return{x:Math.max(Math.min(s,l-a),0),y:Math.max(Math.min(u,c-i),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=bA(e),n=xA(t),r=this.options,o=r.backgroundColor,a=r.fontColor,i=r.fontSize,s=r.fontStyle,u=r.padding;n.font=i+"px "+s;var l=this.measureWidth(n),c=this.measureHeight();n.fillStyle=o;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,l,c),n.fillStyle=a,this.text.forEach(function(e,t){var r=u+f.x,o=u+f.y+(t+1)*i;n.fillText(e,r,o)})},e}(),CA=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:gA.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new wA(Object.assign({},a,o))},SA=function(){function e(e,t){void 0===t&&(t={}),this.box=new aA(e),this.options=new CA(t)}return e.prototype.draw=function(e){var t=xA(e),n=this.options,r=n.boxColor,o=n.lineWidth,a=this.box,i=a.x,s=a.y,u=a.width,l=a.height;t.strokeStyle=r,t.lineWidth=o,t.strokeRect(i,s,u,l);var c=this.options.label;c&&new EA([c],{x:i-o/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function kA(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Jb(function(){var o=sw(v_(e,t.filters,[1,1],n),t.bias);return r?sI(o):o})}function RA(e,t){Object.keys(e).forEach(function(n){t.some(function(e){return e.originalPath===n})||e[n].dispose()})}function _A(e,t){return function(n,r,o,a){var i=kx(e(n*r*o*o),[o,o,n,r]),s=Ex(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function IA(e,t){return function(n,r,o){var a=Cx(e(n*r),[n,r]),i=Ex(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var NA=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function TA(e,t){return function(n,r,o){var a=kx(e(9*n),[3,3,n,1]),i=kx(e(n*r),[1,1,n,r]),s=Ex(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new NA(a,i,s)}}function AA(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new NA(n,r,o)}}function DA(e,t){return function(n,r,o){var a=e[n];if(!$T(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:o||n}),a}}function OA(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function FA(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",o=(e=e.replace(r,"")).split("/").filter(function(e){return e}),a=e.endsWith(".json")?o[o.length-1]:n,i=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:i=e.startsWith("/")?"/"+i:i,manifestUri:"/"===i?"/"+a:i+"/"+a}}function PA(e){var t=yA.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function MA(e){var t=yA.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new qT(e.naturalWidth,e.naturalHeight):e instanceof r?new qT(e.videoWidth,e.videoHeight):new qT(e.width,e.height)}function LA(e){var t=e.width,n=e.height,r=(0,yA.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function BA(e,t){var n=yA.getEnv().ImageData;if(!(e instanceof n)&&!PA(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||MA(e),o=r.width,a=r.height,i=LA({width:o,height:a});return e instanceof n?xA(i).putImageData(e,0,0):xA(i).drawImage(e,0,0,o,a),i}function zA(e,t){return hg(this,void 0,void 0,function(){var n;return vg(this,function(r){switch(r.label){case 0:return[4,(0,yA.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function WA(e){return hg(this,void 0,void 0,function(){return vg(this,function(t){switch(t.label){case 0:return[4,zA(e)];case 1:return[2,t.sent().json()]}})})}function UA(e,t){return hg(this,void 0,void 0,function(){var n,r,o,a,i,s;return vg(this,function(u){switch(u.label){case 0:return n=t||yA.getEnv().createCanvasElement(),r=e.shape.slice(YT(e)?1:0),o=r[0],a=r[1],i=r[2],s=Jb(function(){return e.as3D(o,a,i).toInt()}),[4,OT.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function jA(e){var t=yA.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function VA(e,t){return hg(this,void 0,void 0,function(){var n,r,o,a;return vg(this,function(i){switch(i.label){case 0:return n=FA(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,WA(r)];case 1:return a=i.sent(),[2,TT.loadWeights(a,o)]}})})}var HA=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(XT(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(YT(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var o=e instanceof yA.getEnv().Canvas?e:BA(e);n._canvases[t]=o,n._inputDimensions[t]=[o.height,o.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return tA(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new qT(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Jb(function(){var r=tA(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof Ty){var a=YT(o)?o:o.expandDims();return a=function(e,t){return void 0===t&&(t=!1),Jb(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var a=Math.abs(r-o),i=Math.round(a*(t?.5:1)),s=r>o?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,Ix(n,0)},l=u(i),c=a-l.shape[s],f=[t&&c?u(c):null,e,l].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return Dx(f,s)})}(a,t),a.shape[1]===e&&a.shape[2]===e||(a=tN.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(o instanceof yA.getEnv().Canvas)return OT.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=yA.getEnv(),o=r.Image,a=r.Canvas;if(!(e instanceof o||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=MA(e),s=t/Math.max(i.height,i.width),u=s*i.width,l=s*i.height,c=LA({width:t,height:t}),f=e instanceof a?e:BA(e),d=Math.abs(u-l)/2,p=n&&u<l?d:0,h=n&&l<u?d:0;return xA(c).drawImage(f,p,h,u,l),c}(o,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)}),o=Kx(r.map(function(e){return e.toFloat()})).as4D(n.batchSize,e,e,3);return o})},e}();function GA(e){return hg(this,void 0,void 0,function(){var t,n,r;return vg(this,function(o){switch(o.label){case 0:if(e instanceof HA)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(bA)).forEach(function(e,r){if(!jA(e)&&!XT(e)&&!YT(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(YT(e)){var o=e.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(e){return jA(e)&&(t=e,new Promise(function(e,n){if(t instanceof yA.getEnv().Canvas||PA(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),n(e))}t.addEventListener("load",r),t.addEventListener("error",o)}));var t}))];case 1:return o.sent(),[2,new HA(r,Array.isArray(e))]}})})}var qA=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof My})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof My)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,r=t.tensor,o=bx(r.dataSync());r.dispose(),e.reassignParamFromPath(n,o)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return hg(this,void 0,void 0,function(){return vg(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(e){return hg(this,void 0,void 0,function(){var t;return vg(this,function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,VA(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(e){return hg(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c;return vg(this,function(f){switch(f.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=yA.getEnv().readFile,n=FA(e,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,a=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},i=TT.weightsLoaderFactory(a),l=(u=JSON).parse,[4,t(r)];case 1:return s=l.apply(u,[f.sent().toString()]),[4,i(s,o)];case 2:return c=f.sent(),this.loadFromWeightMap(c),[2]}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}},{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof Ty))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function KA(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function $A(e,t,n,r){void 0===r&&(r=!0);for(var o=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),a=[],i=function(){var t=o.pop();a.push(t);for(var i=o,s=[],u=0;u<i.length;u++){var l=i[u],c=e[t],f=e[l];s.push(KA(c,f,r))}o=o.filter(function(e,t){return s[t]<=n})};o.length>0;)i();return a}function XA(e,t){return Jb(function(){var n=t[0],r=t[1],o=t[2],a=Ix(mg(e.shape.slice(0,3),[1]),n),i=Ix(mg(e.shape.slice(0,3),[1]),r),s=Ix(mg(e.shape.slice(0,3),[1]),o),u=Dx([a,i,s],3);return iE(e,u)})}function YA(e){return 1/(1+Math.exp(-e))}var QA,JA=function(e){return"number"===typeof e};function ZA(e){return Jb(function(){var t=tE(e,wx(.10000000149011612));return sw(sI(iE(e,t)),t)})}function eD(e,t){return Jb(function(){var n=AR(e,[[0,0],[1,1],[1,1],[0,0]]);return n=v_(n,t.conv.filters,[1,1],"valid"),n=iE(n,t.bn.sub),n=tE(n,t.bn.truediv),ZA(n=sw(n,t.conv.bias))})}function tD(e,t){return Jb(function(){var n=AR(e,[[0,0],[1,1],[1,1],[0,0]]);return n=E_(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),ZA(n=sw(n,t.bias))})}function nD(e,t){var n=_A(e,t);var r=TA(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,a){var i=n(r,o,3,a+"/conv"),s=function(n,r){var o=Ex(e(n)),a=Ex(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:a}}(o,a+"/bn");return{conv:i,bn:s}},extractSeparableConvParams:r}}function rD(e,t){var n=DA(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),o=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:o}},extractSeparableConvParams:AA(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(QA||(QA={}));var oD=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),aD=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!JA(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"===typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return JA(e.x)&&JA(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(JA)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return dg(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=eD(e,t.conv0);return n=eD(n=P_(n,[2,2],[2,2],"same"),t.conv1),n=eD(n=P_(n,[2,2],[2,2],"same"),t.conv2),n=eD(n=P_(n,[2,2],[2,2],"same"),t.conv3),n=eD(n=P_(n,[2,2],[2,2],"same"),t.conv4),n=eD(n=P_(n,[2,2],[2,2],"same"),t.conv5),n=eD(n=P_(n,[2,2],[1,1],"same"),t.conv6),kA(n=eD(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?ZA(kA(e,t.conv0,"valid",!1)):tD(e,t.conv0);return n=tD(n=P_(n,[2,2],[2,2],"same"),t.conv1),n=tD(n=P_(n,[2,2],[2,2],"same"),t.conv2),n=tD(n=P_(n,[2,2],[2,2],"same"),t.conv3),n=tD(n=P_(n,[2,2],[2,2],"same"),t.conv4),n=tD(n=P_(n,[2,2],[2,2],"same"),t.conv5),n=P_(n,[2,2],[1,1],"same"),n=t.conv6?tD(n,t.conv6):n,kA(n=t.conv7?tD(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Jb(function(){var o=e.toBatchTensor(t,!1).toFloat();return o=(o=n.config.meanRgb?XA(o,n.config.meanRgb):o).div(wx(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},t.prototype.forward=function(e,t){return hg(this,void 0,void 0,function(){var n;return vg(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,GA(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),hg(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,h,v=this;return vg(this,function(m){switch(m.label){case 0:return n=new oD(t),r=n.inputSize,o=n.scoreThreshold,[4,GA(e)];case 1:return a=m.sent(),[4,this.forwardInput(a,r)];case 2:return i=m.sent(),s=Jb(function(){return $x(i)[0].expandDims()}),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),o)];case 3:return l=m.sent(),i.dispose(),s.dispose(),c=l.map(function(e){return e.box}),f=l.map(function(e){return e.score}),d=l.map(function(e){return e.classScore}),p=l.map(function(e){return v.config.classes[e.label]}),h=$A(c.map(function(e){return e.rescale(r)}),f,this.config.iouThreshold,!0),[2,h.map(function(e){return new uA(f[e],d[e],p[e],c[e],u)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],o=rD(e,r),a=o.extractConvParams,i=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:a("conv8")};return RA(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var o,a=OA(e),i=a.extractWeights,s=a.getRemainingWeights,u=[],l=nD(i,u),c=l.extractConvParams,f=l.extractConvWithBatchNormParams,d=l.extractSeparableConvParams;if(t.withSeparableConvs){var p=r[0],h=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8];o={conv0:t.isFirstLayerConv2d?c(p,h,3,"conv0"):d(p,h,"conv0"),conv1:d(h,v,"conv1"),conv2:d(v,m,"conv2"),conv3:d(m,g,"conv3"),conv4:d(g,y,"conv4"),conv5:d(y,b,"conv5"),conv6:x?d(b,x,"conv6"):void 0,conv7:w?d(x,w,"conv7"):void 0,conv8:c(w||x||b,5*n,1,"conv8")}}else p=r[0],h=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8],o={conv0:f(p,h,"conv0"),conv1:f(h,v,"conv1"),conv2:f(v,m,"conv2"),conv3:f(m,g,"conv3"),conv4:f(g,y,"conv4"),conv5:f(y,b,"conv5"),conv6:f(b,x,"conv6"),conv7:f(x,w,"conv7"),conv8:c(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:o,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return hg(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,d,p,h,v,m,g,y,b,x,w,E,C,S,k,R,_,I,N,T,A,D=this;return vg(this,function(O){switch(O.label){case 0:return r=t.width,o=t.height,a=Math.max(r,o),i=a/r,s=a/o,u=e.shape[1],l=this.config.anchors.length,c=Jb(function(){var t=e.reshape([u,u,l,D.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,l,4]),t.slice([0,0,0,4],[u,u,l,1]),D.withClassScores?EE(t.slice([0,0,0,5],[u,u,l,D.config.classes.length]),3):wx(0)]}),f=c[0],d=c[1],p=c[2],h=[],[4,d.array()];case 1:return v=O.sent(),[4,f.array()];case 2:m=O.sent(),g=0,O.label=3;case 3:if(!(g<u))return[3,12];y=0,O.label=4;case 4:if(!(y<u))return[3,11];b=0,O.label=5;case 5:return b<l?(x=YA(v[g][y][b][0]),!n||x>n?(w=(y+YA(m[g][y][b][0]))/u*i,E=(g+YA(m[g][y][b][1]))/u*s,C=Math.exp(m[g][y][b][2])*this.config.anchors[b].x/u*i,S=Math.exp(m[g][y][b][3])*this.config.anchors[b].y/u*s,k=w-C/2,R=E-S/2,_={row:g,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(p,_)]:[3,7]):[3,9]):[3,10];case 6:return A=O.sent(),[3,8];case 7:A={classScore:1,label:0},O.label=8;case 8:N=(I=A).classScore,T=I.label,h.push(pg({box:new iA(k,R,k+C,R+S),score:x,classScore:x*N,label:T},_)),O.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return f.dispose(),d.dispose(),p.dispose(),[2,h]}})})},t.prototype.extractPredictedClass=function(e,t){return hg(this,void 0,void 0,function(){var n,r,o,a;return vg(this,function(i){switch(i.label){case 0:return n=t.row,r=t.col,o=t.anchor,[4,e.array()];case 1:return a=i.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return a[n][r][o][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(qA);function iD(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach(function(n,r){var o=n.x,a=n.y,i=t[r];e.moveTo(i.x,i.y),e.lineTo(o,a)}),n){var r=t[t.length-1],o=t[0];if(!r||!o)return;e.moveTo(r.x,r.y),e.lineTo(o.x,o.y)}e.stroke()}var sD=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return ha(t,e),t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r);return new t(o.score,o.relativeBox,o.imageDims)},t}(uA);function uD(e){return e.detection instanceof sD}function lD(e,t){var n={detection:t};return Object.assign({},e,n)}function cD(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof sD?t.score:uD(t)?t.detection.score:void 0,r=t instanceof sD?t.box:uD(t)?t.detection.box:new aA(t),o=n?""+JT(n):void 0;new SA(r,{label:o}).draw(e)})}function fD(e,t,n){return is(function(){var r=jp(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Dh(r,t.bias)})}function dD(e,t,n){return void 0===n&&(n=!1),is(function(){var r=uv(n?Dh(Bp(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):fD(e,t.conv0,[2,2])),o=fD(r,t.conv1,[1,1]),a=fD(uv(Dh(r,o)),t.conv2,[1,1]);return uv(Dh(r,Dh(o,a)))})}function pD(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),is(function(){var o=uv(n?Dh(Bp(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):fD(e,t.conv0,r?[2,2]:[1,1])),a=fD(o,t.conv1,[1,1]),i=fD(uv(Dh(o,a)),t.conv2,[1,1]),s=fD(uv(Dh(o,Dh(a,i))),t.conv3,[1,1]);return uv(Dh(o,Dh(a,Dh(i,s))))})}function hD(e,t){var n=_A(e,t),r=TA(e,t);function o(e,t,o,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,o+"/conv0"):r(e,t,o+"/conv0"),conv1:r(t,t,o+"/conv1"),conv2:r(t,t,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var i=o(e,t,n,a);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,n+"/conv3")}}}}function vD(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function mD(e,t){var n=DA(e,t),r=vD(n),o=AA(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2"),conv3:o(e+"/conv3")}}}}var gD=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return ha(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return is(function(){var n=pD(XA(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(zs(255)),t.dense0,!0);return n=pD(n,t.dense1),n=pD(n,t.dense2),n=pD(n,t.dense3),n=th(n,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=mD(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return RA(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=OA(e),r=n.extractWeights,o=n.getRemainingWeights,a=hD(r,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),l=a(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:l}}}(e)},t}(qA);function yD(e,t){return is(function(){return Dh(Hp(e,t.weights),t.bias)})}function bD(e){var t={},n={};return Object.keys(e).forEach(function(r){(r.startsWith("fc")?n:t)[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var xD=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return ha(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return is(function(){var r=e instanceof HA?t.faceFeatureExtractor.forwardInput(e):e;return yD(r.as2D(r.shape[0],-1),n.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],o=OA(e),a=o.extractWeights,i=o.getRemainingWeights,s=IA(a,r)(t,n,"fc");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=bD(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=DA(e,n),o={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return RA(e,n),{params:o,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,o=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(qA),wD=["neutral","happy","sad","angry","fearful","disgusted","surprised"],ED=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);wD.forEach(function(n,r){t[n]=e[r]})}return e.prototype.asSortedArray=function(){var e=this;return wD.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),CD=function(e){function t(t){return void 0===t&&(t=new gD),e.call(this,"FaceExpressionNet",t)||this}return ha(t,e),t.prototype.forwardInput=function(e){var t=this;return is(function(){return Os(t.runNet(e))})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictExpressions=function(e){return ma(this,void 0,void 0,function(){var t,n,r,o,a=this;return ga(this,function(i){switch(i.label){case 0:return[4,GA(e)];case 1:return t=i.sent(),[4,this.forwardInput(t)];case 2:return n=i.sent(),[4,Promise.all(Sd(n).map(function(e){return ma(a,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}})})}))];case 3:return r=i.sent(),n.dispose(),o=r.map(function(e){return new ED(e)}),[2,t.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(xD);function SD(e,t){var n={expressions:t};return Object.assign({},e,n)}function kD(e,t,n,r){void 0===n&&(n=.1),(Array.isArray(t)?t:[t]).forEach(function(t){var o=t instanceof ED?t:t.expressions instanceof ED?t.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=o.asSortedArray().filter(function(e){return e.probability>n}),i=uD(t)?t.detection.box.bottomLeft:r||new KT(0,0),s=new EA(a.map(function(e){return e.expression+" ("+JT(e.probability)+")"}),i);s.draw(e)})}var RD=function(){function e(e,t,n){void 0===n&&(n=new KT(0,0));var r=t.width,o=t.height;this._imgDims=new qT(r,o),this._shift=n,this._positions=e.map(function(e){return e.mul(new KT(r,o)).add(n)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new KT(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new KT(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new KT(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof sD?e.box.floor():new aA(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=r.useDlibAlignment,a=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],o=function(e){return r.sub(e).magnitude()},a=(o(t)+o(n))/2,i=Math.floor(a/.45),s=eA(e),u=Math.floor(Math.max(0,s.x-.5*i)),l=Math.floor(Math.max(0,s.y-.43*i));return new lA(u,l,Math.min(i,this.imageWidth+u),Math.min(i,this.imageHeight+l))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map(function(e){return e.x}),n=e.map(function(e){return e.y}),r=t.reduce(function(e,t){return t<e?t:e},1/0),o=n.reduce(function(e,t){return t<e?t:e},1/0),a=t.reduce(function(e,t){return e<t?t:e},0),i=n.reduce(function(e,t){return e<t?t:e},0);return new iA(r,o,a,i)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),_D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(eA)},t}(RD);function ID(e){return uD(e)&&e.landmarks instanceof RD&&e.unshiftedLandmarks instanceof RD&&e.alignedRect instanceof sD}function ND(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),a=e.detection.imageDims,i={landmarks:r,unshiftedLandmarks:t,alignedRect:new sD(e.detection.score,o.rescale(a.reverse()),a)};return Object.assign({},e,i)}var TD=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,o=void 0===r||r,a=e.lineWidth,i=e.lineColor,s=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=s||2,this.lineColor=i||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"},AD=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new TD(t)}return e.prototype.draw=function(e){var t=xA(e),n=this.options,r=n.drawLines,o=n.drawPoints,a=n.lineWidth,i=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof _D&&(t.strokeStyle=i,t.lineWidth=a,iD(t,this.faceLandmarks.getJawOutline()),iD(t,this.faceLandmarks.getLeftEyeBrow()),iD(t,this.faceLandmarks.getRightEyeBrow()),iD(t,this.faceLandmarks.getNose()),iD(t,this.faceLandmarks.getLeftEye(),!0),iD(t,this.faceLandmarks.getRightEye(),!0),iD(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach(function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})}},e}();function DD(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof RD?t:ID(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new AD(n).draw(e)})}function OD(e,t){var n=[],r=OA(e),o=r.extractWeights,a=r.getRemainingWeights,i=function(e,t){var n=_A(e,t),r=TA(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,o){return{separable_conv0:r(e,t,o+"/separable_conv0"),separable_conv1:r(t,t,o+"/separable_conv1"),expansion_conv:n(e,t,1,o+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(o,n),s=i.extractConvParams,u=i.extractSeparableConvParams,l=i.extractReductionBlockParams,c=i.extractMainBlockParams,f={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:l(32,64,"entry_flow/reduction_block_0"),reduction_block_1:l(64,128,"entry_flow/reduction_block_1")},d={};tA(t,0,1).forEach(function(e){d["main_block_"+e]=c(128,"middle_flow/main_block_"+e)});var p={reduction_block:l(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:d,exit_flow:p}}}function FD(e,t){var n=[],r=function(e,t){var n=DA(e,t),r=vD(n),o=AA(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),separable_conv2:o(e+"/separable_conv2")}}}}(e,n),o=r.extractConvParams,a=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:o("entry_flow/conv_in"),reduction_block_0:i("entry_flow/reduction_block_0"),reduction_block_1:i("entry_flow/reduction_block_1")},l={};tA(t,0,1).forEach(function(e){l["main_block_"+e]=s("middle_flow/main_block_"+e)});var c={reduction_block:i("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return RA(e,n),{params:{entry_flow:u,middle_flow:l,exit_flow:c},paramMappings:n}}function PD(e,t,n){return Dh(Bp(e,t.filters,n,"same"),t.bias)}function MD(e,t,n){void 0===n&&(n=!0);var r=n?uv(e):e;return r=fD(r,t.separable_conv0,[1,1]),r=fD(uv(r),t.separable_conv1,[1,1]),r=eh(r,[3,3],[2,2],"same"),r=Dh(r,PD(e,t.expansion_conv,[2,2]))}var LD,BD=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return ha(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return is(function(){var r=XA(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(zs(256)),o=uv(PD(r,n.entry_flow.conv_in,[2,2]));return o=MD(o,n.entry_flow.reduction_block_0,!1),o=MD(o,n.entry_flow.reduction_block_1),tA(t._numMainBlocks,0,1).forEach(function(e){o=function(e,t){var n=fD(uv(e),t.separable_conv0,[1,1]);return n=fD(uv(n),t.separable_conv1,[1,1]),n=fD(uv(n),t.separable_conv2,[1,1]),Dh(n,e)}(o,n.middle_flow["main_block_"+e])}),o=MD(o,n.exit_flow.reduction_block),o=uv(fD(o,n.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return FD(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return OD(e,this._numMainBlocks)},t}(qA);!function(e){e.FEMALE="female",e.MALE="male"}(LD||(LD={}));var zD=function(e){function t(t){void 0===t&&(t=new BD(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return ha(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return is(function(){var r=e instanceof HA?t.faceFeatureExtractor.forwardInput(e):e,o=th(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:yD(o,n.fc.age).as1D(),gender:yD(o,n.fc.gender)}})},t.prototype.forwardInput=function(e){var t=this;return is(function(){var n=t.runNet(e),r=n.age,o=n.gender;return{age:r,gender:Os(o)}})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return ma(this,void 0,void 0,function(){var t,n,r,o,a,i,s=this;return ga(this,function(u){switch(u.label){case 0:return[4,GA(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=Sd(n.age),o=Sd(n.gender),a=r.map(function(e,t){return{ageTensor:e,genderTensor:o[t]}}),[4,Promise.all(a.map(function(e){var t=e.ageTensor,n=e.genderTensor;return ma(s,void 0,void 0,function(){var e,r,o,a,i;return ga(this,function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(o=r>.5)?LD.MALE:LD.FEMALE,i=o?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:i}]}})})}))];case 3:return i=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=OA(e),r=n.extractWeights,o=n.getRemainingWeights,a=IA(r,t),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=bD(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=DA(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return RA(e,t),{params:o,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(qA),WD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],eA([e[3],e[4]])]},t}(RD),UD=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+JT(this.distance)+")":"")},e}(),jD=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e}();function VD(e,t){return ma(this,void 0,void 0,function(){var n,r,o,a,i,s;return ga(this,function(u){switch(u.label){case 0:return n=yA.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,GA(e)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=o.getInput(0))instanceof n?(i=a,[3,4]):[3,2];case 2:return[4,UA(a)];case 3:i=u.sent(),u.label=4;case 4:r=i,u.label=5;case 5:return s=xA(r),[2,t.map(function(e){return e instanceof sD?e.forSize(r.width,r.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(r.width,r.height)}).map(function(e){var t=e.x,n=e.y,r=e.width,o=e.height,a=LA({width:r,height:o});return xA(a).putImageData(s.getImageData(t,n,r,o),0,0),a})]}})})}function HD(e,t){return ma(this,void 0,void 0,function(){return ga(this,function(n){if(!XT(e)&&!YT(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(YT(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,is(function(){var n=e.shape.slice(YT(e)?1:0),r=n[0],o=n[1],a=n[2],i=t.map(function(e){return e instanceof sD?e.forSize(o,r).box:e}).map(function(e){return e.clipAtImageBorders(o,r)}).map(function(t){var n=t.x,i=t.y,s=t.width,u=t.height;return ih(e.as3D(r,o,a),[i,n,0],[u,s,a])});return i})]})})}var GD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map(function(e){var n=e.width,r=e.height,o=t/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return is(function(){var n=function(e,t){return wd([qs([68],e),qs([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],o=n.width,a=n.height;return t(o,a)?Math.abs(o-a)/2:0},i=e.mul(qs([o,136],t)).sub(wd(Array.from(Array(o),function(e,t){return n(function(e){return a(e,function(e,t){return e<t})}(t),function(e){return a(e,function(e,t){return t<e})}(t))}))).div(wd(Array.from(Array(o),function(e,t){return n(r[t].width,r[t].height)})));return i})},t.prototype.forwardInput=function(e){var t=this;return is(function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map(function(e){return{height:e[0],width:e[1]}}))})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.detectLandmarks=function(e){return ma(this,void 0,void 0,function(){var t,n,r,o=this;return ga(this,function(a){switch(a.label){case 0:return[4,GA(e)];case 1:return t=a.sent(),n=is(function(){return Sd(o.forwardInput(t))}),[4,Promise.all(n.map(function(e,n){return ma(o,void 0,void 0,function(){var r,o,a,i,s;return ga(this,function(u){switch(u.label){case 0:return a=(o=Array).from,[4,e.data()];case 1:return r=a.apply(o,[u.sent()]),i=r.filter(function(e,t){return QT(t)}),s=r.filter(function(e,t){return!QT(t)}),[2,new _D(Array(68).fill(0).map(function(e,t){return new KT(i[t],s[t])}),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}})})}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(xD),qD=function(e){function t(t){return void 0===t&&(t=new gD),e.call(this,"FaceLandmark68Net",t)||this}return ha(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(GD);var KD=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return ha(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return is(function(){var n=dD(XA(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(zs(255)),t.dense0,!0);return n=dD(n,t.dense1),n=dD(n,t.dense2),n=th(n,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=mD(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return RA(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=OA(e),r=n.extractWeights,o=n.getRemainingWeights,a=hD(r,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}(e)},t}(qA),$D=function(e){function t(t){return void 0===t&&(t=new KD),e.call(this,"FaceLandmark68TinyNet",t)||this}return ha(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(GD);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ha(t,e)}(qD);function XD(e,t,n,r,o){void 0===o&&(o="same");var a=t.conv,i=a.filters,s=a.bias,u=Bp(e,i,n,o);return u=function(e,t){return Dh(Gh(e,t.weights),t.biases)}(u=Dh(u,s),t.scale),r?uv(u):u}function YD(e,t){return XD(e,t,[1,1],!1)}function QD(e,t){return XD(e,t,[2,2],!0,"valid")}function JD(e,t){function n(n,r,o,a){var i=function(t,n,r){var o=e(t),a=o.length/(n*r*r);if(a%1!==0)throw new Error("depth has to be an integer: "+a+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return is(function(){return cv(Vs(o,[n,a,r,r]),[2,3,1,0])})}(n,r,o),s=Ws(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}function r(r,o,a,i){var s=n(r,o,a,i+"/conv"),u=function(n,r){var o=Ws(e(n)),a=Ws(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:a}}(o,i+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,o,a){return void 0===a&&(a=!1),{conv1:r((a?.5:1)*e,t,n,o+"/conv1"),conv2:r(e,t,n,o+"/conv2")}}}}function ZD(e,t){var n=DA(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),o=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:o}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function eO(e){var t=[],n=ZD(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,a=r("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),f=o("conv64_2"),d=o("conv64_3"),p=o("conv128_down"),h=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),y=o("conv256_2"),b=o("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!function(e){return $T(e,2)}(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:f,conv64_3:d,conv128_down:p,conv128_1:h,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return RA(e,t),{params:w,paramMappings:t}}function tO(e,t){var n=function(e,t){return XD(e,t,[1,1],!0)}(e,t.conv1);return n=YD(n,t.conv2),n=Dh(n,e),n=uv(n)}function nO(e,t){var n=QD(e,t.conv1);n=YD(n,t.conv2);var r=th(e,2,2,"valid"),o=Gs(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var i=n.shape.slice();i[1]=1;var s=Gs(i),u=(n=Bf([n,s],1)).shape.slice();u[2]=1;var l=Gs(u);n=Bf([n,l],2)}return r=a?Bf([r,o],3):r,n=Dh(r,n),n=uv(n)}var rO=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return ha(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return is(function(){var n=QD(XA(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(zs(256)),t.conv32_down);n=tO(n=eh(n,3,2,"valid"),t.conv32_1),n=tO(n,t.conv32_2),n=tO(n,t.conv32_3),n=tO(n=nO(n,t.conv64_down),t.conv64_1),n=tO(n,t.conv64_2),n=tO(n,t.conv64_3),n=tO(n=nO(n,t.conv128_down),t.conv128_1),n=tO(n,t.conv128_2),n=tO(n=nO(n,t.conv256_down),t.conv256_1);var r=(n=nO(n=tO(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Hp(r,t.fc)})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return ma(this,void 0,void 0,function(){var t,n,r,o=this;return ga(this,function(a){switch(a.label){case 0:return[4,GA(e)];case 1:return t=a.sent(),n=is(function(){return Sd(o.forwardInput(t))}),[4,Promise.all(n.map(function(e){return e.data()}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return eO(e)},t.prototype.extractParams=function(e){return function(e){var t=OA(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=JD(n,o),i=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),h=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),C=is(function(){return cv(Us(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:f,conv64_down:d,conv64_1:p,conv64_2:h,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:w,conv256_down_out:E,fc:C},paramMappings:o}}(e)},t}(qA);var oO=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,i=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=i,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!==typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function aO(e,t){function n(n,r,o,a,i){var s=Vs(e(n*r*o*o),[o,o,n,r]),u=Ws(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(i?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,o){var a=n(e,t,r,o,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function o(n,o,a){var i=function(n,r){var o=Vs(e(9*n),[3,3,n,1]),a=Ws(e(n)),i=Ws(e(n)),s=Ws(e(n)),u=Ws(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:a,batch_norm_offset:i,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv");return{depthwise_conv:i,pointwise_conv:r(n,o,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function iO(e){var t=[],n=function(e,t){var n=DA(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(e){var t="mobilenetv1/conv_"+e,o="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",i=t+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,i)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function i(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:i(0),box_predictor_1:i(1),box_predictor_2:i(2),box_predictor_3:i(3),box_predictor_4:i(4),box_predictor_5:i(5)}}}}(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!XT(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:a}};return RA(e,t),{params:i,paramMappings:t}}function sO(e,t,n){return is(function(){var r=Bp(e,t.filters,n,"same");return r=Dh(r,t.batch_norm_offset),Bd(r,0,6)})}function uO(e,t){return is(function(){var n=null,r=sO(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(e,t){var o=t+1,a=function(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}(o);r=function(e,t,n){return is(function(){var r=Up(e,t.filters,n,"same");return r=wp(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Bd(r,0,6)})}(r,e.depthwise_conv,a),r=sO(r,e.pointwise_conv,[1,1]),11===o&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function lO(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),d=(i-o)*(s-a),p=(c-u)*(f-l);if(d<=0||p<=0)return 0;var h=Math.max(o,u),v=Math.max(a,l),m=Math.min(i,c),g=Math.min(s,f),y=Math.max(m-h,0)*Math.max(g-v,0);return y/(d+p-y)}function cO(e,t){var n=function(e){var t=Sd(cv(e,[1,0])),n=[Qh(t[2],t[0]),Qh(t[3],t[1])];return{sizes:n,centers:[Dh(t[0],Mh(n[0],zs(2))),Dh(t[1],Mh(n[1],zs(2)))]}}(e),r=n.sizes,o=n.centers,a=Sd(cv(t,[1,0])),i=Mh(Gh(jd(Mh(a[2],zs(5))),r[0]),zs(2)),s=Dh(Gh(Mh(a[0],zs(10)),r[0]),o[0]),u=Mh(Gh(jd(Mh(a[3],zs(5))),r[1]),zs(2)),l=Dh(Gh(Mh(a[1],zs(10)),r[1]),o[1]);return cv(wd([Qh(s,i),Qh(l,u),Dh(s,i),Dh(l,u)]),[1,0])}function fO(e,t){return is(function(){var n=e.shape[0];return{boxPredictionEncoding:yd(kA(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:yd(kA(e,t.class_predictor),[n,-1,3])}})}var dO=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),pO=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return ha(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return is(function(){var n=e.toBatchTensor(512,!1).toFloat(),r=uO(Qh(Gh(n,zs(.007843137718737125)),zs(1)),t.mobilenetv1),o=function(e,t,n){return is(function(){var r=sO(e,n.conv_0,[1,1]),o=sO(r,n.conv_1,[2,2]),a=sO(o,n.conv_2,[1,1]),i=sO(a,n.conv_3,[2,2]),s=sO(i,n.conv_4,[1,1]),u=sO(s,n.conv_5,[2,2]),l=sO(u,n.conv_6,[1,1]),c=sO(l,n.conv_7,[2,2]),f=fO(t,n.box_predictor_0),d=fO(e,n.box_predictor_1),p=fO(o,n.box_predictor_2),h=fO(i,n.box_predictor_3),v=fO(u,n.box_predictor_4),m=fO(c,n.box_predictor_5);return{boxPredictions:Bf([f.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,h.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:Bf([f.classPrediction,d.classPrediction,p.classPrediction,h.classPrediction,v.classPrediction,m.classPrediction],1)}})}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return is(function(){var r=e.shape[0],o=cO(yd(Ed(n.extra_dim,[r,1,1]),[-1,4]),yd(e,[-1,4]));o=yd(o,[r,o.shape[0]/r,4]);var a=Jd(rh(t,[0,0,1],[-1,-1,-1])),i=rh(a,[0,0,0],[-1,-1,1]);return i=yd(i,[r,i.shape[1]]),{boxes:Sd(o),scores:Sd(i)}})}(o.boxPredictions,o.classPredictions,t.output_layer)})},t.prototype.forward=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,GA(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),ma(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,h,v,m,g,y,b,x,w;return ga(this,function(E){switch(E.label){case 0:return n=new dO(t),r=n.maxResults,o=n.minConfidence,[4,GA(e)];case 1:for(a=E.sent(),i=this.forwardInput(a),s=i.boxes,u=i.scores,l=s[0],c=u[0],f=1;f<s.length;f++)s[f].dispose(),u[f].dispose();return h=(p=Array).from,[4,c.data()];case 2:return d=h.apply(p,[E.sent()]),v=function(e,t,n,r,o){var a=e.shape[0],i=Math.min(n,a),s=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),u=function(e){return e<=r?1:0},l=[];return s.forEach(function(t){if(!(l.length>=i)){for(var n=t.score,r=l.length-1;r>=0;--r){var a=lO(e,t.boxIndex,l[r]);if(0!==a&&(t.score*=u(a),t.score<=o))break}n===t.score&&l.push(t.boxIndex)}}),l}(l,d,r,.5,o),m=a.getReshapedInputDimensions(0),g=a.inputSize,y=g/m.width,b=g/m.height,x=l.arraySync(),w=v.map(function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map(function(e){return e*b}),n=t[0],r=t[1],o=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map(function(e){return e*y}),i=o[0],s=o[1];return new sD(d[e],new lA(i,n,s-i,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),l.dispose(),c.dispose(),[2,w]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return iO(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=OA(e),r=n.extractWeights,o=n.getRemainingWeights,a=aO(r,t),i=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=i(),l=s(),c={extra_dim:js(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:c},paramMappings:t}}(e)},t}(qA);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ha(t,e)}(pO);var hO=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return ha(t,e),t}(oD),vO=function(){function e(){}return e.prototype.then=function(e){return ma(this,void 0,void 0,function(){var t;return ga(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},e.prototype.run=function(){return ma(this,void 0,void 0,function(){return ga(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},e}();function mO(e,t){var n={descriptor:t};return Object.assign({},e,n)}function gO(e,t,n,r,o){return void 0===o&&(o=function(e){return e.alignedRect}),ma(this,void 0,void 0,function(){var a,i,s,u,l;return ga(this,function(c){switch(c.label){case 0:return a=e.map(function(e){return ID(e)?o(e):e.detection}),(s=r)?[3,5]:t instanceof Si?[4,HD(t,a)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,VD(t,a)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return[4,n(i=s)];case 6:return l=c.sent(),i.forEach(function(e){return e instanceof Si&&e.dispose()}),[2,l]}})})}function yO(e,t,n,r,o){return ma(this,void 0,void 0,function(){var a=this;return ga(this,function(i){return[2,gO([e],t,function(e){return ma(a,void 0,void 0,function(){return ga(this,function(t){return[2,n(e[0])]})})},r,o)]})})}function bO(e){var t=OA(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=function(e,t){var n=_A(e,t),r=IA(e,t);function o(n,r){var o=Ws(e(n));return t.push({paramPath:r}),o}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:o(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:o(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:o(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return va({},e,{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),i=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return va({},e,{fc1:t,prelu4_alpha:n,fc2_1:i,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),i=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),l=r(256,2,"onet/fc2_1"),c=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return va({},e,{conv4:t,prelu4_alpha:i,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:c,fc2_3:f})}}}(n,o),i=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,l=i(),c=s(),f=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:f},paramMappings:o}}function xO(e){var t=[],n=function(e,t){var n=DA(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function o(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function i(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return va({},e,{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=i("rnet"),t=o("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return va({},e,{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=i("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=o("onet/fc1"),u=a("onet/prelu5_alpha"),l=o("onet/fc2_1"),c=o("onet/fc2_2"),f=o("onet/fc2_3");return va({},e,{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:c,fc2_3:f})}}}(e,t),r=n.extractPNetParams,o=n.extractRNetParams,a=n.extractONetParams,i=r(),s=o(),u=a();return RA(e,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}function wO(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var EO=function(e){function t(t,n,r,o){return e.call(this,{left:t,top:n,right:r,bottom:o},!0)||this}return ha(t,e),t}(aA);function CO(e){return is(function(){return Gh(Qh(e,zs(127.5)),zs(.0078125))})}function SO(e,t){return is(function(){return Dh(uv(e),Gh(t,$d(uv($d(e)))))})}function kO(e,t,n){return void 0===n&&(n=!1),is(function(){var r=kA(e,t.conv1,"valid");return r=SO(r,t.prelu1_alpha),r=SO(r=kA(r=eh(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=SO(r=kA(r=n?r:eh(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function RO(e,t,n,r,o){o.stage1=[];var a=t.map(function(t){return is(function(){var n={scale:t},o=function(e,t){return is(function(){var n=wO(t,e.shape.slice(1)),r=n.height,o=n.width,a=CO(Jv.resizeBilinear(e,[r,o]));return cv(a,[0,2,1,3])})}(e,t),a=Date.now(),i=function(e,t){return is(function(){var n=kO(e,t,!0),r=kA(n,t.conv4_1,"valid"),o=id(hh(r,3),3);return{prob:Os(Qh(r,o),3),regions:kA(n,t.conv4_2,"valid")}})}(o,r),s=i.prob,u=i.regions;return n.pnet=Date.now()-a,{scoresTensor:Sd(Sd(s,3)[1])[0],regionsTensor:Sd(u)[0],scale:t,statsForScale:n}})}),i=a.map(function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,i=e.statsForScale,s=function(e,t,n,r){for(var o=[],a=e.arraySync(),i=0;i<e.shape[0];i++)for(var s=0;s<e.shape[1];s++)a[i][s]>=r&&o.push(new KT(s,i));return o.map(function(e){var r=new iA(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),o=a[e.y][e.x],i=t.arraySync();return{cell:r,score:o,region:new EO(i[e.y][e.x][0],i[e.y][e.x][1],i[e.y][e.x][2],i[e.y][e.x][3])}})}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return o.stage1.push(i),[];var u=Date.now(),l=$A(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.5);return i.nms=Date.now()-u,i.numBoxes=l.length,o.stage1.push(i),l.map(function(e){return s[e]})}),s=i.reduce(function(e,t){return e.concat(t)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),f=$A(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.7);o.stage1_nms=Date.now()-c,l=f.map(function(e){return s[e].score}),u=f.map(function(e){return s[e]}).map(function(e){var t=e.cell,n=e.region;return new iA(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()})}return{boxes:u,scores:l}}function _O(e,t,n){var r=n.width,o=n.height;return ma(this,void 0,void 0,function(){var n,a,i,s=this;return ga(this,function(u){switch(u.label){case 0:return n=xA(e),[4,Promise.all(t.map(function(t){return ma(s,void 0,void 0,function(){var r,o,a,i,s,u,l,c;return ga(this,function(f){return r=t.padAtBorders(e.height,e.width),o=r.y,a=r.ey,i=r.x,s=r.ex,u=i-1,l=o-1,c=n.getImageData(u,l,s-u,a-l),[2,yA.isNodejs()?BA(c):createImageBitmap(c)]})})}))];case 1:return a=u.sent(),i=[],a.forEach(function(e){var t=xA(LA({width:r,height:o}));t.drawImage(e,0,0,r,o);for(var n=t.getImageData(0,0,r,o).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);i.push(a)}),[2,i.map(function(e){return is(function(){return CO(cv(Vs(e,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function IO(e,t,n,r,o){return ma(this,void 0,void 0,function(){var a,i,s,u,l,c,f,d,p,h,v,m,g,y;return ga(this,function(b){switch(b.label){case 0:return a=Date.now(),[4,_O(e,t,{width:24,height:24})];case 1:return i=b.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return is(function(){var n=kO(e,t),r=SO(yD(yd(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),o=yD(r,t.fc2_1),a=id(hh(o,1),1),i=Os(Qh(o,a),1),s=yD(r,t.fc2_2);return{scores:Sd(i,1)[1],regions:s}})}(e,r);return e.dispose(),t}),o.stage2_rnet=Date.now()-a,u=s.length>1?Bf(s.map(function(e){return e.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[b.sent()]),u.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),p=d.map(function(e){return t[e]}),h=d.map(function(e){return l[e]}),v=[],m=[],p.length>0&&(a=Date.now(),g=$A(p,h,.7),o.stage2_nms=Date.now()-a,y=g.map(function(e){var t=s[d[e]].regions.arraySync();return new EO(t[0][0],t[0][1],t[0][2],t[0][3])}),m=g.map(function(e){return h[e]}),v=g.map(function(e,t){return p[e].calibrate(y[t])})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:v,scores:m}]}})})}function NO(e,t,n,r,o){return ma(this,void 0,void 0,function(){var a,i,s,u,l,c,f,d,p,h,v,m,g,y,b;return ga(this,function(x){switch(x.label){case 0:return a=Date.now(),[4,_O(e,t,{width:48,height:48})];case 1:return i=x.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return is(function(){var n=kO(e,t);n=SO(n=kA(n=eh(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=SO(yD(yd(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),o=yD(r,t.fc2_1),a=id(hh(o,1),1),i=Os(Qh(o,a),1),s=yD(r,t.fc2_2),u=yD(r,t.fc2_3);return{scores:Sd(i,1)[1],regions:s,points:u}})}(e,r);return e.dispose(),t}),o.stage3_onet=Date.now()-a,u=s.length>1?Bf(s.map(function(e){return e.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[x.sent()]),u.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),p=d.map(function(e){var t=s[e].regions.arraySync();return new EO(t[0][0],t[0][1],t[0][2],t[0][3])}),h=d.map(function(e,n){return t[e].calibrate(p[n])}),v=d.map(function(e){return l[e]}),m=[],g=[],y=[],h.length>0&&(a=Date.now(),b=$A(h,v,.7,!1),o.stage3_nms=Date.now()-a,m=b.map(function(e){return h[e]}),g=b.map(function(e){return v[e]}),y=b.map(function(e,t){return Array(5).fill(0).map(function(n,r){var o=s[e].points.arraySync();return new KT(o[0][r]*(m[t].width+1)+m[t].left,o[0][r+5]*(m[t].height+1)+m[t].top)})})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:m,scores:g,points:y}]}})})}var TO=function(e){function t(){return e.call(this,"Mtcnn")||this}return ha(t,e),t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),ma(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,h,v,m,g,y,b,x,w,E;return ga(this,function(C){switch(C.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},a=Date.now(),i=is(function(){return function(e){return is(function(){return wd(Sd(e,3).reverse(),3)})}(id(Xm.fromPixels(r)).toFloat())}),s=function(e){return i.dispose(),o.total=Date.now()-a,e},u=i.shape.slice(1),l=u[0],c=u[1],f=new oO(t),d=f.minFaceSize,p=f.scaleFactor,h=f.maxNumScales,v=f.scoreThresholds,m=f.scaleSteps,g=(m||function(e,t,n){for(var r=n[0],o=n[1],a=12/e,i=[],s=Math.min(r,o)*a,u=0;s>=12;)i.push(a*Math.pow(t,u)),s*=t,u+=1;return i}(d,p,[l,c])).filter(function(e){var t=wO(e,[l,c]);return Math.min(t.width,t.height)>12}).slice(0,h),o.scales=g,o.pyramid=g.map(function(e){return wO(e,[l,c])}),y=Date.now(),[4,RO(i,g,v[0],n.pnet,o)];case 1:return b=C.sent(),o.total_stage1=Date.now()-y,b.boxes.length?(o.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,IO(r,b.boxes,v[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return x=C.sent(),o.total_stage2=Date.now()-y,x.boxes.length?(o.stage3_numInputBoxes=x.boxes.length,y=Date.now(),[4,NO(r,x.boxes,v[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return w=C.sent(),o.total_stage3=Date.now()-y,E=w.boxes.map(function(e,t){return ND(lD({},new sD(w.scores[t],new lA(e.left/c,e.top/l,e.width/c,e.height/l),{height:l,width:c})),new WD(w.points[t].map(function(t){return t.sub(new KT(e.left,e.top)).div(new KT(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,s({results:E,stats:o})]}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),ma(this,void 0,void 0,function(){var n;return ga(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,GA(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),ma(this,void 0,void 0,function(){var n;return ga(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,GA(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return xO(e)},t.prototype.extractParams=function(e){return bO(e)},t}(qA),AO=[new KT(1.603231,2.094468),new KT(6.041143,7.080126),new KT(2.882459,3.518061),new KT(4.266906,5.178857),new KT(9.041765,10.66308)],DO=[117.001,114.697,97.404],OO=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:AO,meanRgb:DO,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return ha(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return ma(this,void 0,void 0,function(){return ga(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new sD(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(aD),FO=[new KT(.738768,.874946),new KT(2.42204,2.65704),new KT(4.30971,7.04493),new KT(10.246,4.59428),new KT(12.6868,11.8741)],PO=[new KT(1.603231,2.094468),new KT(6.041143,7.080126),new KT(2.882459,3.518061),new KT(4.266906,5.178857),new KT(9.041765,10.66308)],MO=[117.001,114.697,97.404],LO=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:PO,meanRgb:MO}:{anchors:FO,withClassScores:!0});return e.call(this,n)||this}return ha(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return ma(this,void 0,void 0,function(){return ga(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new sD(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(aD);var BO={ssdMobilenetv1:new pO,tinyFaceDetector:new OO,tinyYolov2:new LO,mtcnn:new TO,faceLandmark68Net:new qD,faceLandmark68TinyNet:new $D,faceRecognitionNet:new rO,faceExpressionNet:new CD,ageGenderNet:new zD};function zO(e,t){var n={age:t};return Object.assign({},e,n)}function WO(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var UO=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return ha(t,e),t}(vO),jO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t,n=this;return ga(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,gO(e=r.sent(),this.input,function(e){return ma(n,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return BO.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){return SD(e,t[n])})]}})})},t.prototype.withAgeAndGender=function(){return new KO(this,this.input)},t}(UO),VO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t;return ga(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,yO(e,this.input,function(e){return BO.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,SD(e,t)]}})})},t.prototype.withAgeAndGender=function(){return new $O(this,this.input)},t}(UO),HO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.withAgeAndGender=function(){return new XO(this,this.input)},t.prototype.withFaceDescriptors=function(){return new JO(this,this.input)},t}(jO),GO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.withAgeAndGender=function(){return new YO(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ZO(this,this.input)},t}(VO),qO=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return ha(t,e),t}(vO),KO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t,n=this;return ga(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,gO(e=r.sent(),this.input,function(e){return ma(n,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return BO.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){var r=t[n],o=r.age;return zO(WO(e,r.gender,r.genderProbability),o)})]}})})},t.prototype.withFaceExpressions=function(){return new jO(this,this.input)},t}(qO),$O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t,n,r,o;return ga(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,yO(e,this.input,function(e){return BO.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,o=t.genderProbability,[2,zO(WO(e,r,o),n)]}})})},t.prototype.withFaceExpressions=function(){return new VO(this,this.input)},t}(qO),XO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.withFaceExpressions=function(){return new HO(this,this.input)},t.prototype.withFaceDescriptors=function(){return new JO(this,this.input)},t}(KO),YO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.withFaceExpressions=function(){return new GO(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ZO(this,this.input)},t}($O),QO=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return ha(t,e),t}(vO),JO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,gO(e=t.sent(),this.input,function(e){return Promise.all(e.map(function(e){return BO.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,t.sent().map(function(t,n){return mO(e[n],t)})]}})})},t.prototype.withFaceExpressions=function(){return new HO(this,this.input)},t.prototype.withAgeAndGender=function(){return new XO(this,this.input)},t}(QO),ZO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t;return ga(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,yO(e,this.input,function(e){return BO.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=n.sent(),[2,mO(e,t)]}})})},t.prototype.withFaceExpressions=function(){return new GO(this,this.input)},t.prototype.withAgeAndGender=function(){return new YO(this,this.input)},t}(QO),eF=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=r,o}return ha(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?BO.faceLandmark68TinyNet:BO.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(vO),tF=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t,n,r,o,a=this;return ga(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),t=e.map(function(e){return e.detection}),this.input instanceof Si?[4,HD(this.input,t)]:[3,3];case 2:return r=i.sent(),[3,5];case 3:return[4,VD(this.input,t)];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,Promise.all(n.map(function(e){return a.landmarkNet.detectLandmarks(e)}))];case 6:return o=i.sent(),n.forEach(function(e){return e instanceof Si&&e.dispose()}),[2,e.map(function(e,t){return ND(e,o[t])})]}})})},t.prototype.withFaceExpressions=function(){return new HO(this,this.input)},t.prototype.withAgeAndGender=function(){return new XO(this,this.input)},t.prototype.withFaceDescriptors=function(){return new JO(this,this.input)},t}(eF),nF=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t,n,r,o;return ga(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof Si?[4,HD(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,VD(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=a.sent(),n.forEach(function(e){return e instanceof Si&&e.dispose()}),[2,ND(e,o)]}})})},t.prototype.withFaceExpressions=function(){return new GO(this,this.input)},t.prototype.withAgeAndGender=function(){return new YO(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ZO(this,this.input)},t}(eF),rF=function(e){function t(t,n){void 0===n&&(n=new dO);var r=e.call(this)||this;return r.input=t,r.options=n,r}return ha(t,e),t}(vO),oF=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t,n,r;return ga(this,function(o){switch(o.label){case 0:return t=(e=this).input,(n=e.options)instanceof oO?[4,BO.mtcnn.forward(t,n)]:[3,2];case 1:return[2,o.sent().map(function(e){return e.detection})];case 2:if(r=n instanceof hO?function(e){return BO.tinyFaceDetector.locateFaces(e,n)}:n instanceof dO?function(e){return BO.ssdMobilenetv1.locateFaces(e,n)}:n instanceof oD?function(e){return BO.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return ma(e,void 0,void 0,function(){var e;return ga(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map(function(e){return lD({},e)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new tF(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new jO(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new KO(this.runAndExtendWithFaceDetections(),this.input)},t}(rF),aF=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.run=function(){return ma(this,void 0,void 0,function(){var e,t;return ga(this,function(n){switch(n.label){case 0:return[4,new oF(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return ma(e,void 0,void 0,function(){var e;return ga(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?lD({},e):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new nF(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new VO(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new $O(this.runAndExtendWithFaceDetection(),this.input)},t}(rF);!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map(function(e){if(e instanceof jD)return e;if(e instanceof Float32Array)return new jD(o(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new jD(o(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(e,t){return e-r[t]}).reduce(function(e,t){return e+Math.pow(t,2)},0))}(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,o=n.label;return new UD(o,t.computeMeanDistance(e,r))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new UD("unknown",t.distance)}}();va({},t,r);function iF(){const e=(0,o.useRef)(null),t=(0,o.useRef)([]),n=(0,o.useRef)([]),r=(0,o.useRef)([]),a=(0,o.useRef)(null),[i,s]=(0,o.useState)(""),[u,l]=(0,o.useState)(!1),[c,f]=(0,o.useState)(!1),[d,p]=(0,o.useState)(0),[h,v]=(0,o.useState)("#ccc"),[m,g]=(0,o.useState)(!1),y=Re();(0,o.useEffect)(()=>{(async()=>{await BO.tinyFaceDetector.loadFromUri("/models"),await BO.faceLandmark68TinyNet.loadFromUri("/models"),await BO.faceRecognitionNet.loadFromUri("/models")})()},[]),(0,o.useEffect)(()=>((async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0});e.current.srcObject=t,e.current.onloadedmetadata=()=>{e.current.play(),a.current=setInterval(b,100)}}catch(t){s("Cannot access camera. Allow camera and reload.")}})(),()=>clearInterval(a.current)),[]);const b=async()=>{var o,i;if(e.current&&0!==e.current.videoWidth)try{const u=await(o=e.current,i=new hO,void 0===i&&(i=new dO),new aF(o,i)).withFaceLandmarks(!0).withFaceDescriptor();if(!u)return s("Face not detected. Adjust lighting or move closer."),void v("red");const l=x(e.current);if(l.length>0)return s(l.join(" ")),void v("orange");const c=E(u.landmarks);n.current.push(c),n.current.length>12&&n.current.shift();const d=w(u.landmarks);r.current.push(d),r.current.length>12&&r.current.shift();const h=r.current.some(e=>!0===e)||Math.abs(Math.max(...n.current)-Math.min(...n.current))>8;if(g(h),!h)return s("Blink or move head slightly for liveness."),void v("orange");const m=document.createElement("canvas");m.width=e.current.videoWidth,m.height=e.current.videoHeight;m.getContext("2d").drawImage(e.current,0,0,m.width,m.height);const y=m.toDataURL("image/jpeg");t.current.push(y),p(t.current.length),s(""),v("green"),t.current.length>=10&&(f(!0),clearInterval(a.current))}catch(u){console.error(u),s("Error detecting face. Adjust camera or lighting."),v("red")}},x=e=>{const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height).data;let o=0;for(let s=0;s<r.length;s+=4){o+=.2126*r[s]+.7152*r[s+1]+.0722*r[s+2]}const a=o/(r.length/4),i=[];return a<50&&i.push("Face too dark. Increase lighting."),a>220&&i.push("Face too bright. Reduce lighting."),i},w=e=>{const t=e.getLeftEye(),n=e.getRightEye(),r=e=>(Math.hypot(e[1].x-e[5].x,e[1].y-e[5].y)+Math.hypot(e[2].x-e[4].x,e[2].y-e[4].y))/(2*Math.hypot(e[0].x-e[3].x,e[0].y-e[3].y));return(r(t)+r(n))/2<.22},E=e=>{const t=e.getNose()[3],n=e.getJawOutline(),r=(n[0].x+n[16].x)/2;return(t.x-r)/(n[16].x-n[0].x)*100};return(0,on.jsx)("div",{className:"face-wrapper",children:(0,on.jsxs)("div",{className:"face-card",children:[(0,on.jsx)("div",{className:"face-title",children:"Face Verification"}),(0,on.jsx)("div",{className:"camera-frame",style:{border:"4px solid ".concat(h)},children:(0,on.jsx)("video",{ref:e,autoPlay:!0,muted:!0,playsInline:!0})}),(0,on.jsx)("div",{className:"face-instruction",children:c?"Ready! Click Submit.":"Position your face, adjust lighting, and blink/move head. Frames: ".concat(d,"/").concat(10)}),m&&!i&&(0,on.jsx)("div",{className:"face-liveness",children:"Liveness detected \u2705"}),i&&(0,on.jsx)("div",{className:"face-error",children:i}),(0,on.jsx)("button",{onClick:async()=>{l(!0);const e=sessionStorage.getItem("email"),n=sessionStorage.getItem("username"),r=sessionStorage.getItem("password");try{const o=await fetch("http://127.0.0.1:8001/api/complete_signup/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,username:n,password:r,vectors:t.current})}),a=await o.json();if(!o.ok)throw new Error(a.error);localStorage.setItem("token",a.access),y("/Home")}catch(o){s(o.message||"Verification failed"),t.current=[],f(!1),p(0),v("#ccc")}finally{l(!1)}},disabled:!c||u,className:"submit-btn",children:u?"Submitting\u2026":"Submit"}),(0,on.jsx)("div",{className:"progress-bar",children:(0,on.jsx)("div",{className:"progress-fill",style:{width:"".concat(d/10*100,"%")}})})]})})}function sF(){return(0,on.jsxs)(Ye,{children:[(0,on.jsxs)($e,{element:(0,on.jsx)(un,{}),children:[(0,on.jsx)($e,{path:"/",element:(0,on.jsx)(gn,{})}),(0,on.jsx)($e,{path:"/upload",element:(0,on.jsx)(En,{})}),(0,on.jsx)($e,{path:"/profile",element:(0,on.jsx)(bn,{})}),(0,on.jsx)($e,{path:"/inbox",element:(0,on.jsx)(Sn,{})}),(0,on.jsx)($e,{path:"/notifications",element:(0,on.jsx)(_n,{})}),(0,on.jsx)($e,{path:"/edit-profile",element:(0,on.jsx)(Ln,{})}),(0,on.jsx)($e,{path:"/search",element:(0,on.jsx)(zn,{})})]}),(0,on.jsx)($e,{path:"/resetpassword",element:(0,on.jsx)(cn,{})}),(0,on.jsx)($e,{path:"/faceVerification",element:(0,on.jsx)(iF,{})}),(0,on.jsx)($e,{path:"/verify-otp",element:(0,on.jsx)(da,{})}),(0,on.jsx)($e,{path:"/signup",element:(0,on.jsx)(fa,{})}),(0,on.jsx)($e,{path:"/login",element:(0,on.jsx)(fn,{})}),(0,on.jsx)($e,{path:"/chat/:clientId",element:(0,on.jsx)(Nn,{})}),(0,on.jsx)($e,{path:"/forgotpassword",element:(0,on.jsx)(ln,{})}),(0,on.jsx)($e,{path:"/chatbot",element:(0,on.jsx)(An,{})})]})}i.createRoot(document.getElementById("root")).render((0,on.jsx)(Nt,{children:(0,on.jsx)(sF,{})}))})()})();
//# sourceMappingURL=main.13a8c113.js.map