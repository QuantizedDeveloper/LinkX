/*! For license information please see main.677d26c3.js.LICENSE.txt */
(()=>{var e={43(e,t,n){"use strict";e.exports=n(202)},65(){},153(e,t,n){"use strict";var r=n(43),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,c=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,r)&&!u.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},184(){},202(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function x(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var b=x.prototype=new y;b.constructor=x,v(b,g.prototype),b.isPureReactComponent=!0;var w=Array.isArray,C=Object.prototype.hasOwnProperty,E={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,r){var o,a={},i=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)C.call(t,o)&&!k.hasOwnProperty(o)&&(a[o]=t[o]);var u=arguments.length-2;if(1===u)a.children=r;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];a.children=l}if(e&&e.defaultProps)for(o in u=e.defaultProps)void 0===a[o]&&(a[o]=u[o]);return{$$typeof:n,type:e,key:i,ref:s,props:a,_owner:E.current}}function R(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function _(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function N(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return i=i(u=e),e=""===a?"."+_(u,0):a,w(i)?(o="",null!=e&&(o=e.replace(I,"$&/")+"/"),N(i,t,o,"",function(e){return e})):null!=i&&(R(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(I,"$&/")+"/")+e)),t.push(i)),1;if(u=0,a=""===a?".":a+":",w(e))for(var l=0;l<e.length;l++){var c=a+_(s=e[l],l);u+=N(s,t,o,c,i)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)u+=N(s=s.value,t,o,c=a+_(s,l++),i);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function T(e,t,n){if(null==e)return e;var r=[],o=0;return N(e,r,"","",function(e){return t.call(n,e,o++)}),r}function A(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},O={transition:null},F={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:O,ReactCurrentOwner:E};function P(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:T,forEach:function(e,t,n){T(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return T(e,function(){t++}),t},toArray:function(e){return T(e,function(e){return e})||[]},only:function(e){if(!R(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=o,t.Profiler=i,t.PureComponent=x,t.StrictMode=a,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F,t.act=P,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=v({},e.props),a=e.key,i=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,s=E.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)C.call(t,l)&&!k.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){u=Array(l);for(var c=0;c<l;c++)u[c]=arguments[c+2];o.children=u}return{$$typeof:n,type:e.type,key:a,ref:i,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=R,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=P,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},234(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>a(u,n))l<o&&0>a(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<o&&0>a(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],f=1,d=null,h=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(c);null!==t;){if(null===t.callback)o(c);else{if(!(t.startTime<=e))break;o(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function w(e){if(m=!1,b(e),!v)if(null!==r(l))v=!0,O(C);else{var t=r(c);null!==t&&F(w,t.startTime-e)}}function C(e,n){v=!1,m&&(m=!1,y(R),R=-1),p=!0;var a=h;try{for(b(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!N());){var i=d.callback;if("function"===typeof i){d.callback=null,h=d.priorityLevel;var s=i(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(l)&&o(l),b(n)}else o(l);d=r(l)}if(null!==d)var u=!0;else{var f=r(c);null!==f&&F(w,f.startTime-n),u=!1}return u}finally{d=null,h=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,k=!1,S=null,R=-1,I=5,_=-1;function N(){return!(t.unstable_now()-_<I)}function T(){if(null!==S){var e=t.unstable_now();_=e;var n=!0;try{n=S(!0,e)}finally{n?E():(k=!1,S=null)}}else k=!1}if("function"===typeof x)E=function(){x(T)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,D=A.port2;A.port1.onmessage=T,E=function(){D.postMessage(null)}}else E=function(){g(T,0)};function O(e){S=e,k||(k=!0,E())}function F(e,n){R=g(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,O(C))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:f++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(c,e),null===r(l)&&e===r(c)&&(m?(y(R),R=-1):m=!0,F(w,a-i))):(e.sortIndex=s,n(l,e),v||p||(v=!0,O(C))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},367(){},391(e,t,n){"use strict";var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},531(){},579(e,t,n){"use strict";e.exports=n(153)},730(e,t,n){"use strict";var r=n(43),o=n(853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)i.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),f=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function v(e,t,n,r,o,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){m[e]=new v(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){m[e]=new v(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){m[e]=new v(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){m[e]=new v(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){m[e]=new v(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function x(e,t,n,r){var o=m.hasOwnProperty(t)?m[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!f.call(p,e)||!f.call(h,e)&&(d.test(e)?p[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)}),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),C=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),I=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var F=Symbol.iterator;function P(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=F&&e[F]||e["@@iterator"])?e:null}var M,B=Object.assign;function L(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var W=!1;function z(e,t){if(!e||W)return"";W=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var o=l.stack.split("\n"),a=r.stack.split("\n"),i=o.length-1,s=a.length-1;1<=i&&0<=s&&o[i]!==a[s];)s--;for(;1<=i&&0<=s;i--,s--)if(o[i]!==a[s]){if(1!==i||1!==s)do{if(i--,0>--s||o[i]!==a[s]){var u="\n"+o[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=s);break}}}finally{W=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?L(e):""}function U(e){switch(e.tag){case 5:return L(e.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case E:return"Fragment";case C:return"Portal";case S:return"Profiler";case k:return"StrictMode";case N:return"Suspense";case T:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case R:return(e._context.displayName||"Context")+".Provider";case _:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return j(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function J(e,t){Q(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ae(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ce,fe=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ce(e,t)})}:ce);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(he).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]})});var ge=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Ee=null,ke=null;function Se(e){if(e=bo(e)){if("function"!==typeof Ce)throw Error(a(280));var t=e.stateNode;t&&(t=Co(t),Ce(e.stateNode,e.type,t))}}function Re(e){Ee?ke?ke.push(e):ke=[e]:Ee=e}function Ie(){if(Ee){var e=Ee,t=ke;if(ke=Ee=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function _e(e,t){return e(t)}function Ne(){}var Te=!1;function Ae(e,t,n){if(Te)return e(t,n);Te=!0;try{return _e(e,t,n)}finally{Te=!1,(null!==Ee||null!==ke)&&(Ne(),Ie())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=Co(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Oe=!1;if(c)try{var Fe={};Object.defineProperty(Fe,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Fe,Fe),window.removeEventListener("test",Fe,Fe)}catch(ce){Oe=!1}function Pe(e,t,n,r,o,a,i,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Me=!1,Be=null,Le=!1,We=null,ze={onError:function(e){Me=!0,Be=e}};function Ue(e,t,n,r,o,a,i,s,u){Me=!1,Be=null,Pe.apply(ze,arguments)}function je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(je(e)!==e)throw Error(a(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=je(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(r=o.return)){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return He(o),e;if(i===r)return He(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,u=o.child;u;){if(u===n){s=!0,n=o,r=i;break}if(u===r){s=!0,r=o,n=i;break}u=u.sibling}if(!s){for(u=i.child;u;){if(u===n){s=!0,n=i,r=o;break}if(u===r){s=!0,r=i,n=o;break}u=u.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=o.unstable_scheduleCallback,Xe=o.unstable_cancelCallback,$e=o.unstable_shouldYield,Ye=o.unstable_requestPaint,Qe=o.unstable_now,Je=o.unstable_getCurrentPriorityLevel,Ze=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,at=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var lt=64,ct=4194304;function ft(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,i=268435455&n;if(0!==i){var s=i&~o;0!==s?r=ft(s):0!==(a&=i)&&(r=ft(a))}else 0!==(i=n&~o)?r=ft(i):0!==a&&(r=ft(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(a=t&-t)||16===o&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-it(t)),r|=e[n],t&=~o;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var xt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,Ct,Et,kt,St,Rt=!1,It=[],_t=null,Nt=null,Tt=null,At=new Map,Dt=new Map,Ot=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pt(e,t){switch(e){case"focusin":case"focusout":_t=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":Tt=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Mt(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=bo(t))&&Ct(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Bt(e){var t=xo(e.target);if(null!==t){var n=je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void St(e.priority,function(){Et(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Lt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bo(n))&&Ct(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Wt(e,t,n){Lt(e)&&n.delete(t)}function zt(){Rt=!1,null!==_t&&Lt(_t)&&(_t=null),null!==Nt&&Lt(Nt)&&(Nt=null),null!==Tt&&Lt(Tt)&&(Tt=null),At.forEach(Wt),Dt.forEach(Wt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Rt||(Rt=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,zt)))}function jt(e){function t(t){return Ut(t,e)}if(0<It.length){Ut(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==_t&&Ut(_t,e),null!==Nt&&Ut(Nt,e),null!==Tt&&Ut(Tt,e),At.forEach(t),Dt.forEach(t),n=0;n<Ot.length;n++)(r=Ot[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ot.length&&null===(n=Ot[0]).blockedOn;)Bt(n),null===n.blockedOn&&Ot.shift()}var Vt=b.ReactCurrentBatchConfig,Ht=!0;function Gt(e,t,n,r){var o=xt,a=Vt.transition;Vt.transition=null;try{xt=1,Kt(e,t,n,r)}finally{xt=o,Vt.transition=a}}function qt(e,t,n,r){var o=xt,a=Vt.transition;Vt.transition=null;try{xt=4,Kt(e,t,n,r)}finally{xt=o,Vt.transition=a}}function Kt(e,t,n,r){if(Ht){var o=$t(e,t,n,r);if(null===o)Hr(e,t,r,Xt,n),Pt(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return _t=Mt(_t,e,t,n,r,o),!0;case"dragenter":return Nt=Mt(Nt,e,t,n,r,o),!0;case"mouseover":return Tt=Mt(Tt,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return At.set(a,Mt(At.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Dt.set(a,Mt(Dt.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Pt(e,r),4&t&&-1<Ft.indexOf(e)){for(;null!==o;){var a=bo(o);if(null!==a&&wt(a),null===(a=$t(e,t,n,r))&&Hr(e,t,r,Xt,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Xt=null;function $t(e,t,n,r){if(Xt=null,null!==(e=xo(e=we(r))))if(null===(t=je(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,r=n.length,o="value"in Qt?Qt.value:Qt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return Zt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,un,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=on(ln),fn=B({},ln,{view:0,detail:0}),dn=on(fn),hn=B({},fn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(an=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=an=0,un=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=on(hn),vn=on(B({},hn,{dataTransfer:0})),mn=on(B({},fn,{relatedTarget:0})),gn=on(B({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=B({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=on(yn),bn=on(B({},ln,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function Sn(){return kn}var Rn=B({},fn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Cn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=on(Rn),_n=on(B({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=on(B({},fn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),Tn=on(B({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=B({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=on(An),On=[9,13,27,32],Fn=c&&"CompositionEvent"in window,Pn=null;c&&"documentMode"in document&&(Pn=document.documentMode);var Mn=c&&"TextEvent"in window&&!Pn,Bn=c&&(!Fn||Pn&&8<Pn&&11>=Pn),Ln=String.fromCharCode(32),Wn=!1;function zn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Gn(e,t,n,r){Re(r),0<(t=qr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Kn=null;function Xn(e){Lr(e,0)}function $n(e){if(K(wo(e)))return e}function Yn(e,t){if("change"===e)return t}var Qn=!1;if(c){var Jn;if(c){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Jn=Zn}else Jn=!1;Qn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Kn=qn=null)}function nr(e){if("value"===e.propertyName&&$n(Kn)){var t=[];Gn(t,Kn,e,we(e)),Ae(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return $n(Kn)}function ar(e,t){if("click"===e)return $n(t)}function ir(e,t){if("input"===e||"change"===e)return $n(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!f.call(t,o)||!sr(e[o],t[o]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&fr(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=void 0===r.end?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=cr(n,a);var i=cr(n,r);o&&i&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=c&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,yr=null,xr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xr||null==mr||mr!==X(r)||("selectionStart"in(r=mr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=qr(gr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Cr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Er={},kr={};function Sr(e){if(Er[e])return Er[e];if(!Cr[e])return e;var t,n=Cr[e];for(t in n)if(n.hasOwnProperty(t)&&t in kr)return Er[e]=n[t];return e}c&&(kr=document.createElement("div").style,"AnimationEvent"in window||(delete Cr.animationend.animation,delete Cr.animationiteration.animation,delete Cr.animationstart.animation),"TransitionEvent"in window||delete Cr.transitionend.transition);var Rr=Sr("animationend"),Ir=Sr("animationiteration"),_r=Sr("animationstart"),Nr=Sr("transitionend"),Tr=new Map,Ar="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){Tr.set(e,t),u(t,[e])}for(var Or=0;Or<Ar.length;Or++){var Fr=Ar[Or];Dr(Fr.toLowerCase(),"on"+(Fr[0].toUpperCase()+Fr.slice(1)))}Dr(Rr,"onAnimationEnd"),Dr(Ir,"onAnimationIteration"),Dr(_r,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Nr,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pr));function Br(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,i,s,u,l){if(Ue.apply(this,arguments),Me){if(!Me)throw Error(a(198));var c=Be;Me=!1,Be=null,Le||(Le=!0,We=c)}}(r,t,void 0,e),e.currentTarget=null}function Lr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&o.isPropagationStopped())break e;Br(o,s,l),a=u}else for(i=0;i<r.length;i++){if(u=(s=r[i]).instance,l=s.currentTarget,s=s.listener,u!==a&&o.isPropagationStopped())break e;Br(o,s,l),a=u}}}if(Le)throw e=We,Le=!1,We=null,e}function Wr(e,t){var n=t[mo];void 0===n&&(n=t[mo]=new Set);var r=e+"__bubble";n.has(r)||(Vr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Vr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function jr(e){if(!e[Ur]){e[Ur]=!0,i.forEach(function(t){"selectionchange"!==t&&(Mr.has(t)||zr(t,!1,e),zr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,zr("selectionchange",!1,t))}}function Vr(e,t,n,r){switch(Yt(t)){case 1:var o=Gt;break;case 4:o=qt;break;default:o=Kt}n=o.bind(null,t,n,e),o=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,o){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===i)for(i=r.return;null!==i;){var u=i.tag;if((3===u||4===u)&&((u=i.stateNode.containerInfo)===o||8===u.nodeType&&u.parentNode===o))return;i=i.return}for(;null!==s;){if(null===(i=xo(s)))return;if(5===(u=i.tag)||6===u){r=a=i;continue e}s=s.parentNode}}r=r.return}Ae(function(){var r=a,o=we(n),i=[];e:{var s=Tr.get(e);if(void 0!==s){var u=cn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=In;break;case"focusin":l="focus",u=mn;break;case"focusout":l="blur",u=mn;break;case"beforeblur":case"afterblur":u=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Nn;break;case Rr:case Ir:case _r:u=gn;break;case Nr:u=Tn;break;case"scroll":u=dn;break;case"wheel":u=Dn;break;case"copy":case"cut":case"paste":u=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=_n}var c=0!==(4&t),f=!c&&"scroll"===e,d=c?null!==s?s+"Capture":null:s;c=[];for(var h,p=r;null!==p;){var v=(h=p).stateNode;if(5===h.tag&&null!==v&&(h=v,null!==d&&(null!=(v=De(p,d))&&c.push(Gr(p,v,h)))),f)break;p=p.return}0<c.length&&(s=new u(s,l,null,n,o),i.push({event:s,listeners:c}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(l=n.relatedTarget||n.fromElement)||!xo(l)&&!l[vo])&&(u||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(l=(l=n.relatedTarget||n.toElement)?xo(l):null)&&(l!==(f=je(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=r),u!==l)){if(c=pn,v="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=_n,v="onPointerLeave",d="onPointerEnter",p="pointer"),f=null==u?s:wo(u),h=null==l?s:wo(l),(s=new c(v,p+"leave",u,n,o)).target=f,s.relatedTarget=h,v=null,xo(o)===r&&((c=new c(d,p+"enter",l,n,o)).target=h,c.relatedTarget=f,v=c),f=v,u&&l)e:{for(d=l,p=0,h=c=u;h;h=Kr(h))p++;for(h=0,v=d;v;v=Kr(v))h++;for(;0<p-h;)c=Kr(c),p--;for(;0<h-p;)d=Kr(d),h--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break e;c=Kr(c),d=Kr(d)}c=null}else c=null;null!==u&&Xr(i,s,u,c,!1),null!==l&&null!==f&&Xr(i,f,l,c,!0)}if("select"===(u=(s=r?wo(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Yn;else if(Hn(s))if(Qn)m=ir;else{m=or;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ar);switch(m&&(m=m(e,r))?Gn(i,m,n,o):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?wo(r):window,e){case"focusin":(Hn(g)||"true"===g.contentEditable)&&(mr=g,gr=r,yr=null);break;case"focusout":yr=gr=mr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,br(i,n,o);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":br(i,n,o)}var y;if(Fn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else jn?zn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Bn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==x?"onCompositionEnd"===x&&jn&&(y=en()):(Jt="value"in(Qt=o)?Qt.value:Qt.textContent,jn=!0)),0<(g=qr(r,x)).length&&(x=new bn(x,e,null,n,o),i.push({event:x,listeners:g}),y?x.data=y:null!==(y=Un(n))&&(x.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Wn=!0,Ln);case"textInput":return(e=t.data)===Ln&&Wn?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!Fn&&zn(e,t)?(e=en(),Zt=Jt=Qt=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(o=new bn("onBeforeInput","beforeinput",null,n,o),i.push({event:o,listeners:r}),o.data=y))}Lr(i,t)})}function Gr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;5===o.tag&&null!==a&&(o=a,null!=(a=De(e,n))&&r.unshift(Gr(e,a,o)),null!=(a=De(e,t))&&r.push(Gr(e,a,o))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==l&&(s=l,o?null!=(u=De(n,a))&&i.unshift(Gr(n,u,s)):o||null!=(u=De(n,a))&&i.push(Gr(n,u,s))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var $r=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace($r,"\n").replace(Yr,"")}function Jr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(a(425))}function Zr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"===typeof setTimeout?setTimeout:void 0,oo="function"===typeof clearTimeout?clearTimeout:void 0,ao="function"===typeof Promise?Promise:void 0,io="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ao?function(e){return ao.resolve(null).then(e).catch(so)}:ro;function so(e){setTimeout(function(){throw e})}function uo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void jt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);jt(t)}function lo(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function co(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var fo=Math.random().toString(36).slice(2),ho="__reactFiber$"+fo,po="__reactProps$"+fo,vo="__reactContainer$"+fo,mo="__reactEvents$"+fo,go="__reactListeners$"+fo,yo="__reactHandles$"+fo;function xo(e){var t=e[ho];if(t)return t;for(var n=e.parentNode;n;){if(t=n[vo]||n[ho]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=co(e);null!==e;){if(n=e[ho])return n;e=co(e)}return t}n=(e=n).parentNode}return null}function bo(e){return!(e=e[ho]||e[vo])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function Co(e){return e[po]||null}var Eo=[],ko=-1;function So(e){return{current:e}}function Ro(e){0>ko||(e.current=Eo[ko],Eo[ko]=null,ko--)}function Io(e,t){ko++,Eo[ko]=e.current,e.current=t}var _o={},No=So(_o),To=So(!1),Ao=_o;function Do(e,t){var n=e.type.contextTypes;if(!n)return _o;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,a={};for(o in n)a[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Oo(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Fo(){Ro(To),Ro(No)}function Po(e,t,n){if(No.current!==_o)throw Error(a(168));Io(No,t),Io(To,n)}function Mo(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,V(e)||"Unknown",o));return B({},n,r)}function Bo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||_o,Ao=No.current,Io(No,e),Io(To,To.current),!0}function Lo(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Mo(e,t,Ao),r.__reactInternalMemoizedMergedChildContext=e,Ro(To),Ro(No),Io(No,e)):Ro(To),Io(To,n)}var Wo=null,zo=!1,Uo=!1;function jo(e){null===Wo?Wo=[e]:Wo.push(e)}function Vo(){if(!Uo&&null!==Wo){Uo=!0;var e=0,t=xt;try{var n=Wo;for(xt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Wo=null,zo=!1}catch(o){throw null!==Wo&&(Wo=Wo.slice(e+1)),Ke(Ze,Vo),o}finally{xt=t,Uo=!1}}return null}var Ho=[],Go=0,qo=null,Ko=0,Xo=[],$o=0,Yo=null,Qo=1,Jo="";function Zo(e,t){Ho[Go++]=Ko,Ho[Go++]=qo,qo=e,Ko=t}function ea(e,t,n){Xo[$o++]=Qo,Xo[$o++]=Jo,Xo[$o++]=Yo,Yo=e;var r=Qo;e=Jo;var o=32-it(r)-1;r&=~(1<<o),n+=1;var a=32-it(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,Qo=1<<32-it(t)+o|n<<o|r,Jo=a+e}else Qo=1<<a|n<<o|r,Jo=e}function ta(e){null!==e.return&&(Zo(e,1),ea(e,1,0))}function na(e){for(;e===qo;)qo=Ho[--Go],Ho[Go]=null,Ko=Ho[--Go],Ho[Go]=null;for(;e===Yo;)Yo=Xo[--$o],Xo[$o]=null,Jo=Xo[--$o],Xo[$o]=null,Qo=Xo[--$o],Xo[$o]=null}var ra=null,oa=null,aa=!1,ia=null;function sa(e,t){var n=Tl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ua(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,oa=lo(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,oa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yo?{id:Qo,overflow:Jo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Tl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,oa=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(aa){var t=oa;if(t){var n=t;if(!ua(e,t)){if(la(e))throw Error(a(418));t=lo(n.nextSibling);var r=ra;t&&ua(e,t)?sa(r,n):(e.flags=-4097&e.flags|2,aa=!1,ra=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,aa=!1,ra=e}}}function fa(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function da(e){if(e!==ra)return!1;if(!aa)return fa(e),aa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oa)){if(la(e))throw ha(),Error(a(418));for(;t;)sa(e,t),t=lo(t.nextSibling)}if(fa(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oa=lo(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oa=null}}else oa=ra?lo(e.stateNode.nextSibling):null;return!0}function ha(){for(var e=oa;e;)e=lo(e.nextSibling)}function pa(){oa=ra=null,aa=!1}function va(e){null===ia?ia=[e]:ia.push(e)}var ma=b.ReactCurrentBatchConfig;function ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var o=r,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=o.refs;null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ya(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function xa(e){return(0,e._init)(e._payload)}function ba(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Dl(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Ml(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===E?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&xa(a)===t.type)?((r=o(t,n.props)).ref=ga(e,t,n),r.return=e,r):((r=Ol(n.type,n.key,n.props,null,e.mode,r)).ref=ga(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bl(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function f(e,t,n,r,a){return null===t||7!==t.tag?((t=Fl(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ml(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Ol(t.type,t.key,t.props,null,e.mode,n)).ref=ga(e,null,t),n.return=e,n;case C:return(t=Bl(t,e.mode,n)).return=e,t;case D:return d(e,(0,t._init)(t._payload),n)}if(te(t)||P(t))return(t=Fl(t,e.mode,n,null)).return=e,t;ya(e,t)}return null}function h(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==o?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===o?l(e,t,n,r):null;case C:return n.key===o?c(e,t,n,r):null;case D:return h(e,t,(o=n._init)(n._payload),r)}if(te(n)||P(n))return null!==o?null:f(e,t,n,r,null);ya(e,n)}return null}function p(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,o);case C:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case D:return p(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||P(r))return f(t,e=e.get(n)||null,r,o,null);ya(t,r)}return null}function v(o,a,s,u){for(var l=null,c=null,f=a,v=a=0,m=null;null!==f&&v<s.length;v++){f.index>v?(m=f,f=null):m=f.sibling;var g=h(o,f,s[v],u);if(null===g){null===f&&(f=m);break}e&&f&&null===g.alternate&&t(o,f),a=i(g,a,v),null===c?l=g:c.sibling=g,c=g,f=m}if(v===s.length)return n(o,f),aa&&Zo(o,v),l;if(null===f){for(;v<s.length;v++)null!==(f=d(o,s[v],u))&&(a=i(f,a,v),null===c?l=f:c.sibling=f,c=f);return aa&&Zo(o,v),l}for(f=r(o,f);v<s.length;v++)null!==(m=p(f,o,v,s[v],u))&&(e&&null!==m.alternate&&f.delete(null===m.key?v:m.key),a=i(m,a,v),null===c?l=m:c.sibling=m,c=m);return e&&f.forEach(function(e){return t(o,e)}),aa&&Zo(o,v),l}function m(o,s,u,l){var c=P(u);if("function"!==typeof c)throw Error(a(150));if(null==(u=c.call(u)))throw Error(a(151));for(var f=c=null,v=s,m=s=0,g=null,y=u.next();null!==v&&!y.done;m++,y=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var x=h(o,v,y.value,l);if(null===x){null===v&&(v=g);break}e&&v&&null===x.alternate&&t(o,v),s=i(x,s,m),null===f?c=x:f.sibling=x,f=x,v=g}if(y.done)return n(o,v),aa&&Zo(o,m),c;if(null===v){for(;!y.done;m++,y=u.next())null!==(y=d(o,y.value,l))&&(s=i(y,s,m),null===f?c=y:f.sibling=y,f=y);return aa&&Zo(o,m),c}for(v=r(o,v);!y.done;m++,y=u.next())null!==(y=p(v,o,m,y.value,l))&&(e&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=i(y,s,m),null===f?c=y:f.sibling=y,f=y);return e&&v.forEach(function(e){return t(o,e)}),aa&&Zo(o,m),c}return function e(r,a,i,u){if("object"===typeof i&&null!==i&&i.type===E&&null===i.key&&(i=i.props.children),"object"===typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var l=i.key,c=a;null!==c;){if(c.key===l){if((l=i.type)===E){if(7===c.tag){n(r,c.sibling),(a=o(c,i.props.children)).return=r,r=a;break e}}else if(c.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===D&&xa(l)===c.type){n(r,c.sibling),(a=o(c,i.props)).ref=ga(r,c,i),a.return=r,r=a;break e}n(r,c);break}t(r,c),c=c.sibling}i.type===E?((a=Fl(i.props.children,r.mode,u,i.key)).return=r,r=a):((u=Ol(i.type,i.key,i.props,null,r.mode,u)).ref=ga(r,a,i),u.return=r,r=u)}return s(r);case C:e:{for(c=i.key;null!==a;){if(a.key===c){if(4===a.tag&&a.stateNode.containerInfo===i.containerInfo&&a.stateNode.implementation===i.implementation){n(r,a.sibling),(a=o(a,i.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Bl(i,r.mode,u)).return=r,r=a}return s(r);case D:return e(r,a,(c=i._init)(i._payload),u)}if(te(i))return v(r,a,i,u);if(P(i))return m(r,a,i,u);ya(r,i)}return"string"===typeof i&&""!==i||"number"===typeof i?(i=""+i,null!==a&&6===a.tag?(n(r,a.sibling),(a=o(a,i)).return=r,r=a):(n(r,a),(a=Ml(i,r.mode,u)).return=r,r=a),s(r)):n(r,a)}}var wa=ba(!0),Ca=ba(!1),Ea=So(null),ka=null,Sa=null,Ra=null;function Ia(){Ra=Sa=ka=null}function _a(e){var t=Ea.current;Ro(Ea),e._currentValue=t}function Na(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ta(e,t){ka=e,Ra=Sa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Aa(e){var t=e._currentValue;if(Ra!==e)if(e={context:e,memoizedValue:t,next:null},null===Sa){if(null===ka)throw Error(a(308));Sa=e,ka.dependencies={lanes:0,firstContext:e}}else Sa=Sa.next=e;return t}var Da=null;function Oa(e){null===Da?Da=[e]:Da.push(e)}function Fa(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,Oa(t)):(n.next=o.next,o.next=n),t.interleaved=n,Pa(e,r)}function Pa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ma=!1;function Ba(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function La(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Wa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function za(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Iu)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Pa(e,n)}return null===(o=r.interleaved)?(t.next=t,Oa(r)):(t.next=o.next,o.next=t),r.interleaved=t,Pa(e,n)}function Ua(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function ja(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Va(e,t,n,r){var o=e.updateQueue;Ma=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var u=s,l=u.next;u.next=null,null===i?a=l:i.next=l,i=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==i&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==a){var f=o.baseState;for(i=0,c=l=u=null,s=a;;){var d=s.lane,h=s.eventTime;if((r&d)===d){null!==c&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(d=t,h=n,v.tag){case 1:if("function"===typeof(p=v.payload)){f=p.call(h,f,d);break e}f=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=v.payload)?p.call(h,f,d):p)||void 0===d)break e;f=B({},f,d);break e;case 2:Ma=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=o.effects)?o.effects=[s]:d.push(s))}else h={eventTime:h,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=h,u=f):c=c.next=h,i|=d;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(d=s).next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}if(null===c&&(u=f),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,null!==(t=o.shared.interleaved)){o=t;do{i|=o.lane,o=o.next}while(o!==t)}else null===a&&(o.shared.lanes=0);Pu|=i,e.lanes=i,e.memoizedState=f}}function Ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!==typeof o)throw Error(a(191,o));o.call(r)}}}var Ga={},qa=So(Ga),Ka=So(Ga),Xa=So(Ga);function $a(e){if(e===Ga)throw Error(a(174));return e}function Ya(e,t){switch(Io(Xa,t),Io(Ka,e),Io(qa,Ga),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ro(qa),Io(qa,t)}function Qa(){Ro(qa),Ro(Ka),Ro(Xa)}function Ja(e){$a(Xa.current);var t=$a(qa.current),n=ue(t,e.type);t!==n&&(Io(Ka,e),Io(qa,n))}function Za(e){Ka.current===e&&(Ro(qa),Ro(Ka))}var ei=So(0);function ti(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ni=[];function ri(){for(var e=0;e<ni.length;e++)ni[e]._workInProgressVersionPrimary=null;ni.length=0}var oi=b.ReactCurrentDispatcher,ai=b.ReactCurrentBatchConfig,ii=0,si=null,ui=null,li=null,ci=!1,fi=!1,di=0,hi=0;function pi(){throw Error(a(321))}function vi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function mi(e,t,n,r,o,i){if(ii=i,si=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,oi.current=null===e||null===e.memoizedState?Zi:es,e=n(r,o),fi){i=0;do{if(fi=!1,di=0,25<=i)throw Error(a(301));i+=1,li=ui=null,t.updateQueue=null,oi.current=ts,e=n(r,o)}while(fi)}if(oi.current=Ji,t=null!==ui&&null!==ui.next,ii=0,li=ui=si=null,ci=!1,t)throw Error(a(300));return e}function gi(){var e=0!==di;return di=0,e}function yi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===li?si.memoizedState=li=e:li=li.next=e,li}function xi(){if(null===ui){var e=si.alternate;e=null!==e?e.memoizedState:null}else e=ui.next;var t=null===li?si.memoizedState:li.next;if(null!==t)li=t,ui=e;else{if(null===e)throw Error(a(310));e={memoizedState:(ui=e).memoizedState,baseState:ui.baseState,baseQueue:ui.baseQueue,queue:ui.queue,next:null},null===li?si.memoizedState=li=e:li=li.next=e}return li}function bi(e,t){return"function"===typeof t?t(e):t}function wi(e){var t=xi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=ui,o=r.baseQueue,i=n.pending;if(null!==i){if(null!==o){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(null!==o){i=o.next,r=r.baseState;var u=s=null,l=null,c=i;do{var f=c.lane;if((ii&f)===f)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:f,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(u=l=d,s=r):l=l.next=d,si.lanes|=f,Pu|=f}c=c.next}while(null!==c&&c!==i);null===l?s=r:l.next=u,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{i=o.lane,si.lanes|=i,Pu|=i,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ci(e){var t=xi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{i=e(i,s.action),s=s.next}while(s!==o);sr(i,t.memoizedState)||(xs=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Ei(){}function ki(e,t){var n=si,r=xi(),o=t(),i=!sr(r.memoizedState,o);if(i&&(r.memoizedState=o,xs=!0),r=r.queue,Mi(Ii.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==li&&1&li.memoizedState.tag){if(n.flags|=2048,Ai(9,Ri.bind(null,n,r,o,t),void 0,null),null===_u)throw Error(a(349));0!==(30&ii)||Si(n,t,o)}return o}function Si(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=si.updateQueue)?(t={lastEffect:null,stores:null},si.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ri(e,t,n,r){t.value=n,t.getSnapshot=r,_i(t)&&Ni(e)}function Ii(e,t,n){return n(function(){_i(t)&&Ni(e)})}function _i(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Ni(e){var t=Pa(e,1);null!==t&&tl(t,e,1,-1)}function Ti(e){var t=yi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bi,lastRenderedState:e},t.queue=e,e=e.dispatch=Xi.bind(null,si,e),[t.memoizedState,e]}function Ai(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=si.updateQueue)?(t={lastEffect:null,stores:null},si.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Di(){return xi().memoizedState}function Oi(e,t,n,r){var o=yi();si.flags|=e,o.memoizedState=Ai(1|t,n,void 0,void 0===r?null:r)}function Fi(e,t,n,r){var o=xi();r=void 0===r?null:r;var a=void 0;if(null!==ui){var i=ui.memoizedState;if(a=i.destroy,null!==r&&vi(r,i.deps))return void(o.memoizedState=Ai(t,n,a,r))}si.flags|=e,o.memoizedState=Ai(1|t,n,a,r)}function Pi(e,t){return Oi(8390656,8,e,t)}function Mi(e,t){return Fi(2048,8,e,t)}function Bi(e,t){return Fi(4,2,e,t)}function Li(e,t){return Fi(4,4,e,t)}function Wi(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zi(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Fi(4,4,Wi.bind(null,t,e),n)}function Ui(){}function ji(e,t){var n=xi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&vi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Vi(e,t){var n=xi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&vi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Hi(e,t,n){return 0===(21&ii)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),si.lanes|=n,Pu|=n,e.baseState=!0),t)}function Gi(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var r=ai.transition;ai.transition={};try{e(!1),t()}finally{xt=n,ai.transition=r}}function qi(){return xi().memoizedState}function Ki(e,t,n){var r=el(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},$i(e))Yi(t,n);else if(null!==(n=Fa(e,t,n,r))){tl(n,e,r,Zu()),Qi(n,t,r)}}function Xi(e,t,n){var r=el(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if($i(e))Yi(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,sr(s,i)){var u=t.interleaved;return null===u?(o.next=o,Oa(t)):(o.next=u.next,u.next=o),void(t.interleaved=o)}}catch(l){}null!==(n=Fa(e,t,o,r))&&(tl(n,e,r,o=Zu()),Qi(n,t,r))}}function $i(e){var t=e.alternate;return e===si||null!==t&&t===si}function Yi(e,t){fi=ci=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qi(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Ji={readContext:Aa,useCallback:pi,useContext:pi,useEffect:pi,useImperativeHandle:pi,useInsertionEffect:pi,useLayoutEffect:pi,useMemo:pi,useReducer:pi,useRef:pi,useState:pi,useDebugValue:pi,useDeferredValue:pi,useTransition:pi,useMutableSource:pi,useSyncExternalStore:pi,useId:pi,unstable_isNewReconciler:!1},Zi={readContext:Aa,useCallback:function(e,t){return yi().memoizedState=[e,void 0===t?null:t],e},useContext:Aa,useEffect:Pi,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Oi(4194308,4,Wi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Oi(4194308,4,e,t)},useInsertionEffect:function(e,t){return Oi(4,2,e,t)},useMemo:function(e,t){var n=yi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=yi();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ki.bind(null,si,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},yi().memoizedState=e},useState:Ti,useDebugValue:Ui,useDeferredValue:function(e){return yi().memoizedState=e},useTransition:function(){var e=Ti(!1),t=e[0];return e=Gi.bind(null,e[1]),yi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=si,o=yi();if(aa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===_u)throw Error(a(349));0!==(30&ii)||Si(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,Pi(Ii.bind(null,r,i,e),[e]),r.flags|=2048,Ai(9,Ri.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=yi(),t=_u.identifierPrefix;if(aa){var n=Jo;t=":"+t+"R"+(n=(Qo&~(1<<32-it(Qo)-1)).toString(32)+n),0<(n=di++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=hi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Aa,useCallback:ji,useContext:Aa,useEffect:Mi,useImperativeHandle:zi,useInsertionEffect:Bi,useLayoutEffect:Li,useMemo:Vi,useReducer:wi,useRef:Di,useState:function(){return wi(bi)},useDebugValue:Ui,useDeferredValue:function(e){return Hi(xi(),ui.memoizedState,e)},useTransition:function(){return[wi(bi)[0],xi().memoizedState]},useMutableSource:Ei,useSyncExternalStore:ki,useId:qi,unstable_isNewReconciler:!1},ts={readContext:Aa,useCallback:ji,useContext:Aa,useEffect:Mi,useImperativeHandle:zi,useInsertionEffect:Bi,useLayoutEffect:Li,useMemo:Vi,useReducer:Ci,useRef:Di,useState:function(){return Ci(bi)},useDebugValue:Ui,useDeferredValue:function(e){var t=xi();return null===ui?t.memoizedState=e:Hi(t,ui.memoizedState,e)},useTransition:function(){return[Ci(bi)[0],xi().memoizedState]},useMutableSource:Ei,useSyncExternalStore:ki,useId:qi,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=B({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:B({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Zu(),o=el(e),a=Wa(r,o);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=za(e,a,o))&&(tl(t,e,o,r),Ua(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zu(),o=el(e),a=Wa(r,o);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=za(e,a,o))&&(tl(t,e,o,r),Ua(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zu(),r=el(e),o=Wa(n,r);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=za(e,o,r))&&(tl(t,e,r,n),Ua(t,e,r))}};function as(e,t,n,r,o,a,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(o,a))}function is(e,t,n){var r=!1,o=_o,a=t.contextType;return"object"===typeof a&&null!==a?a=Aa(a):(o=Oo(t)?Ao:No.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Do(e,o):_o),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function us(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Ba(e);var a=t.contextType;"object"===typeof a&&null!==a?o.context=Aa(a):(a=Oo(t)?Ao:No.current,o.context=Do(e,a)),o.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&os.enqueueReplaceState(o,o.state,null),Va(e,n,o,r),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var o=n}catch(a){o="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:o,digest:null}}function cs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ds="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=Wa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vu||(Vu=!0,Hu=r),fs(0,t)},n}function ps(e,t,n){(n=Wa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){fs(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!==typeof r&&(null===Gu?Gu=new Set([this]):Gu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function vs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=kl.bind(null,e,t,n),t.then(e,e))}function ms(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function gs(e,t,n,r,o){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Wa(-1,1)).tag=2,za(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var ys=b.ReactCurrentOwner,xs=!1;function bs(e,t,n,r){t.child=null===e?Ca(t,null,n,r):wa(t,e.child,n,r)}function ws(e,t,n,r,o){n=n.render;var a=t.ref;return Ta(t,o),r=mi(e,t,n,r,a,o),n=gi(),null===e||xs?(aa&&n&&ta(t),t.flags|=1,bs(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vs(e,t,o))}function Cs(e,t,n,r,o){if(null===e){var a=n.type;return"function"!==typeof a||Al(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ol(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Es(e,t,a,r,o))}if(a=e.child,0===(e.lanes&o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(i,r)&&e.ref===t.ref)return Vs(e,t,o)}return t.flags|=1,(e=Dl(a,r)).ref=t.ref,e.return=t,t.child=e}function Es(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(ur(a,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=a,0===(e.lanes&o))return t.lanes=e.lanes,Vs(e,t,o);0!==(131072&e.flags)&&(xs=!0)}}return Rs(e,t,n,r,o)}function ks(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Io(Du,Au),Au|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Io(Du,Au),Au|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Io(Du,Au),Au|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Io(Du,Au),Au|=r;return bs(e,t,o,n),t.child}function Ss(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Rs(e,t,n,r,o){var a=Oo(n)?Ao:No.current;return a=Do(t,a),Ta(t,o),n=mi(e,t,n,r,a,o),r=gi(),null===e||xs?(aa&&r&&ta(t),t.flags|=1,bs(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vs(e,t,o))}function Is(e,t,n,r,o){if(Oo(n)){var a=!0;Bo(t)}else a=!1;if(Ta(t,o),null===t.stateNode)js(e,t),is(t,n,r),us(t,n,r,o),r=!0;else if(null===e){var i=t.stateNode,s=t.memoizedProps;i.props=s;var u=i.context,l=n.contextType;"object"===typeof l&&null!==l?l=Aa(l):l=Do(t,l=Oo(n)?Ao:No.current);var c=n.getDerivedStateFromProps,f="function"===typeof c||"function"===typeof i.getSnapshotBeforeUpdate;f||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(s!==r||u!==l)&&ss(t,i,r,l),Ma=!1;var d=t.memoizedState;i.state=d,Va(t,r,i,o),u=t.memoizedState,s!==r||d!==u||To.current||Ma?("function"===typeof c&&(rs(t,n,c,r),u=t.memoizedState),(s=Ma||as(t,n,s,r,d,u,l))?(f||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),i.props=r,i.state=u,i.context=l,r=s):("function"===typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,La(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),i.props=l,f=t.pendingProps,d=i.context,"object"===typeof(u=n.contextType)&&null!==u?u=Aa(u):u=Do(t,u=Oo(n)?Ao:No.current);var h=n.getDerivedStateFromProps;(c="function"===typeof h||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(s!==f||d!==u)&&ss(t,i,r,u),Ma=!1,d=t.memoizedState,i.state=d,Va(t,r,i,o);var p=t.memoizedState;s!==f||d!==p||To.current||Ma?("function"===typeof h&&(rs(t,n,h,r),p=t.memoizedState),(l=Ma||as(t,n,l,r,d,p,u)||!1)?(c||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(r,p,u),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),i.props=r,i.state=p,i.context=u,r=l):("function"!==typeof i.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return _s(e,t,n,r,a,o)}function _s(e,t,n,r,o,a){Ss(e,t);var i=0!==(128&t.flags);if(!r&&!i)return o&&Lo(t,n,!1),Vs(e,t,a);r=t.stateNode,ys.current=t;var s=i&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=wa(t,e.child,null,a),t.child=wa(t,null,s,a)):bs(e,t,s,a),t.memoizedState=r.state,o&&Lo(t,n,!0),t.child}function Ns(e){var t=e.stateNode;t.pendingContext?Po(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Po(0,t.context,!1),Ya(e,t.containerInfo)}function Ts(e,t,n,r,o){return pa(),va(o),t.flags|=256,bs(e,t,n,r),t.child}var As,Ds,Os,Fs={dehydrated:null,treeContext:null,retryLane:0};function Ps(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ms(e,t,n){var r,o=t.pendingProps,i=ei.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Io(ei,1&i),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=o.children,e=o.fallback,s?(o=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&o)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Pl(u,o,0,null),e=Fl(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ps(n),t.memoizedState=Fs,e):Bs(t,u));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,o,i,s){if(n)return 256&t.flags?(t.flags&=-257,Ls(e,t,s,r=cs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=Pl({mode:"visible",children:r.children},o,0,null),(i=Fl(i,o,s,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,0!==(1&t.mode)&&wa(t,e.child,null,s),t.child.memoizedState=Ps(s),t.memoizedState=Fs,i);if(0===(1&t.mode))return Ls(e,t,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var u=r.dgst;return r=u,Ls(e,t,s,r=cs(i=Error(a(419)),r,void 0))}if(u=0!==(s&e.childLanes),xs||u){if(null!==(r=_u)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(r.suspendedLanes|s))?0:o)&&o!==i.retryLane&&(i.retryLane=o,Pa(e,o),tl(r,e,o,-1))}return pl(),Ls(e,t,s,r=cs(Error(a(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Rl.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,oa=lo(o.nextSibling),ra=t,aa=!0,ia=null,null!==e&&(Xo[$o++]=Qo,Xo[$o++]=Jo,Xo[$o++]=Yo,Qo=e.id,Jo=e.overflow,Yo=t),t=Bs(t,r.children),t.flags|=4096,t)}(e,t,u,o,r,i,n);if(s){s=o.fallback,u=t.mode,r=(i=e.child).sibling;var l={mode:"hidden",children:o.children};return 0===(1&u)&&t.child!==i?((o=t.child).childLanes=0,o.pendingProps=l,t.deletions=null):(o=Dl(i,l)).subtreeFlags=14680064&i.subtreeFlags,null!==r?s=Dl(r,s):(s=Fl(s,u,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,u=null===(u=e.child.memoizedState)?Ps(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Fs,o}return e=(s=e.child).sibling,o=Dl(s,{mode:"visible",children:o.children}),0===(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Bs(e,t){return(t=Pl({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ls(e,t,n,r){return null!==r&&va(r),wa(t,e.child,null,n),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ws(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Na(e.return,t,n)}function zs(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Us(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(bs(e,t,r.children,n),0!==(2&(r=ei.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ws(e,n,t);else if(19===e.tag)Ws(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Io(ei,r),0===(1&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ti(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),zs(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ti(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}zs(t,!0,n,null,a);break;case"together":zs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function js(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Pu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Dl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!aa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qs(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Oo(t.type)&&Fo(),Gs(t),null;case 3:return r=t.stateNode,Qa(),Ro(To),Ro(No),ri(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ia&&(al(ia),ia=null))),Gs(t),null;case 5:Za(t);var o=$a(Xa.current);if(n=t.type,null!==e&&null!=t.stateNode)Ds(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Gs(t),null}if(e=$a(qa.current),da(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[ho]=t,r[po]=i,e=0!==(1&t.mode),n){case"dialog":Wr("cancel",r),Wr("close",r);break;case"iframe":case"object":case"embed":Wr("load",r);break;case"video":case"audio":for(o=0;o<Pr.length;o++)Wr(Pr[o],r);break;case"source":Wr("error",r);break;case"img":case"image":case"link":Wr("error",r),Wr("load",r);break;case"details":Wr("toggle",r);break;case"input":Y(r,i),Wr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Wr("invalid",r);break;case"textarea":oe(r,i),Wr("invalid",r)}for(var u in ye(n,i),o=null,i)if(i.hasOwnProperty(u)){var l=i[u];"children"===u?"string"===typeof l?r.textContent!==l&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,l,e),o=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,l,e),o=["children",""+l]):s.hasOwnProperty(u)&&null!=l&&"onScroll"===u&&Wr("scroll",r)}switch(n){case"input":q(r),Z(r,i,!0);break;case"textarea":q(r),ie(r);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(r.onclick=Zr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[ho]=t,e[po]=r,As(e,t),t.stateNode=e;e:{switch(u=xe(n,r),n){case"dialog":Wr("cancel",e),Wr("close",e),o=r;break;case"iframe":case"object":case"embed":Wr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Pr.length;o++)Wr(Pr[o],e);o=r;break;case"source":Wr("error",e),o=r;break;case"img":case"image":case"link":Wr("error",e),Wr("load",e),o=r;break;case"details":Wr("toggle",e),o=r;break;case"input":Y(e,r),o=$(e,r),Wr("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=B({},r,{value:void 0}),Wr("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),Wr("invalid",e)}for(i in ye(n,o),l=o)if(l.hasOwnProperty(i)){var c=l[i];"style"===i?me(e,c):"dangerouslySetInnerHTML"===i?null!=(c=c?c.__html:void 0)&&fe(e,c):"children"===i?"string"===typeof c?("textarea"!==n||""!==c)&&de(e,c):"number"===typeof c&&de(e,""+c):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(s.hasOwnProperty(i)?null!=c&&"onScroll"===i&&Wr("scroll",e):null!=c&&x(e,i,c,u))}switch(n){case"input":q(e),Z(e,r,!1);break;case"textarea":q(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)Os(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=$a(Xa.current),$a(qa.current),da(t)){if(r=t.stateNode,n=t.memoizedProps,r[ho]=t,(i=r.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ho]=t,t.stateNode=r}return Gs(t),null;case 13:if(Ro(ei),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(aa&&null!==oa&&0!==(1&t.mode)&&0===(128&t.flags))ha(),pa(),t.flags|=98560,i=!1;else if(i=da(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[ho]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),i=!1}else null!==ia&&(al(ia),ia=null),i=!0;if(!i)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ei.current)?0===Ou&&(Ou=3):pl())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return Qa(),null===e&&jr(t.stateNode.containerInfo),Gs(t),null;case 10:return _a(t.type._context),Gs(t),null;case 19:if(Ro(ei),null===(i=t.memoizedState))return Gs(t),null;if(r=0!==(128&t.flags),null===(u=i.rendering))if(r)Hs(i,!1);else{if(0!==Ou||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=ti(e))){for(t.flags|=128,Hs(i,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(u=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,e=u.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Io(ei,1&ei.current|2),t.child}e=e.sibling}null!==i.tail&&Qe()>Uu&&(t.flags|=128,r=!0,Hs(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ti(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(i,!0),null===i.tail&&"hidden"===i.tailMode&&!u.alternate&&!aa)return Gs(t),null}else 2*Qe()-i.renderingStartTime>Uu&&1073741824!==n&&(t.flags|=128,r=!0,Hs(i,!1),t.lanes=4194304);i.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=i.last)?n.sibling=u:t.child=u,i.last=u)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Qe(),t.sibling=null,n=ei.current,Io(ei,r?1&n|2:1&n),t):(Gs(t),null);case 22:case 23:return cl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Au)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ks(e,t){switch(na(t),t.tag){case 1:return Oo(t.type)&&Fo(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qa(),Ro(To),Ro(No),ri(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Za(t),null;case 13:if(Ro(ei),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ro(ei),null;case 4:return Qa(),null;case 10:return _a(t.type._context),null;case 22:case 23:return cl(),null;default:return null}}As=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,$a(qa.current);var a,i=null;switch(n){case"input":o=$(e,o),r=$(e,r),i=[];break;case"select":o=B({},o,{value:void 0}),r=B({},r,{value:void 0}),i=[];break;case"textarea":o=re(e,o),r=re(e,r),i=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(c in ye(n,r),n=null,o)if(!r.hasOwnProperty(c)&&o.hasOwnProperty(c)&&null!=o[c])if("style"===c){var u=o[c];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(u=null!=o?o[c]:void 0,r.hasOwnProperty(c)&&l!==u&&(null!=l||null!=u))if("style"===c)if(u){for(a in u)!u.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&u[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(i||(i=[]),i.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(i=i||[]).push(c,l)):"children"===c?"string"!==typeof l&&"number"!==typeof l||(i=i||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&Wr("scroll",e),i||u===l||(i=[])):(i=i||[]).push(c,l))}n&&(i=i||[]).push("style",n);var c=i;(t.updateQueue=c)&&(t.flags|=4)}},Os=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,$s=!1,Ys="function"===typeof WeakSet?WeakSet:Set,Qs=null;function Js(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){El(e,t,r)}else n.current=null}function Zs(e,t,n){try{n()}catch(r){El(e,t,r)}}var eu=!1;function tu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,void 0!==a&&Zs(t,n,a)}o=o.next}while(o!==r)}}function nu(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ru(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ou(e){var t=e.alternate;null!==t&&(e.alternate=null,ou(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ho],delete t[po],delete t[mo],delete t[go],delete t[yo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function au(e){return 5===e.tag||3===e.tag||4===e.tag}function iu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||au(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function su(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(su(e,t,n),e=e.sibling;null!==e;)su(e,t,n),e=e.sibling}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}var lu=null,cu=!1;function fu(e,t,n){for(n=n.child;null!==n;)du(e,t,n),n=n.sibling}function du(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(s){}switch(n.tag){case 5:$s||Js(n,t);case 6:var r=lu,o=cu;lu=null,fu(e,t,n),cu=o,null!==(lu=r)&&(cu?(e=lu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lu.removeChild(n.stateNode));break;case 18:null!==lu&&(cu?(e=lu,n=n.stateNode,8===e.nodeType?uo(e.parentNode,n):1===e.nodeType&&uo(e,n),jt(e)):uo(lu,n.stateNode));break;case 4:r=lu,o=cu,lu=n.stateNode.containerInfo,cu=!0,fu(e,t,n),lu=r,cu=o;break;case 0:case 11:case 14:case 15:if(!$s&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var a=o,i=a.destroy;a=a.tag,void 0!==i&&(0!==(2&a)||0!==(4&a))&&Zs(n,t,i),o=o.next}while(o!==r)}fu(e,t,n);break;case 1:if(!$s&&(Js(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){El(n,t,s)}fu(e,t,n);break;case 21:fu(e,t,n);break;case 22:1&n.mode?($s=(r=$s)||null!==n.memoizedState,fu(e,t,n),$s=r):fu(e,t,n);break;default:fu(e,t,n)}}function hu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ys),t.forEach(function(t){var r=Il.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function pu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:lu=u.stateNode,cu=!1;break e;case 3:case 4:lu=u.stateNode.containerInfo,cu=!0;break e}u=u.return}if(null===lu)throw Error(a(160));du(i,s,o),lu=null,cu=!1;var l=o.alternate;null!==l&&(l.return=null),o.return=null}catch(c){El(o,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vu(t,e),t=t.sibling}function vu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pu(t,e),mu(e),4&r){try{tu(3,e,e.return),nu(3,e)}catch(m){El(e,e.return,m)}try{tu(5,e,e.return)}catch(m){El(e,e.return,m)}}break;case 1:pu(t,e),mu(e),512&r&&null!==n&&Js(n,n.return);break;case 5:if(pu(t,e),mu(e),512&r&&null!==n&&Js(n,n.return),32&e.flags){var o=e.stateNode;try{de(o,"")}catch(m){El(e,e.return,m)}}if(4&r&&null!=(o=e.stateNode)){var i=e.memoizedProps,s=null!==n?n.memoizedProps:i,u=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===u&&"radio"===i.type&&null!=i.name&&Q(o,i),xe(u,s);var c=xe(u,i);for(s=0;s<l.length;s+=2){var f=l[s],d=l[s+1];"style"===f?me(o,d):"dangerouslySetInnerHTML"===f?fe(o,d):"children"===f?de(o,d):x(o,f,d,c)}switch(u){case"input":J(o,i);break;case"textarea":ae(o,i);break;case"select":var h=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var p=i.value;null!=p?ne(o,!!i.multiple,p,!1):h!==!!i.multiple&&(null!=i.defaultValue?ne(o,!!i.multiple,i.defaultValue,!0):ne(o,!!i.multiple,i.multiple?[]:"",!1))}o[po]=i}catch(m){El(e,e.return,m)}}break;case 6:if(pu(t,e),mu(e),4&r){if(null===e.stateNode)throw Error(a(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(m){El(e,e.return,m)}}break;case 3:if(pu(t,e),mu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{jt(t.containerInfo)}catch(m){El(e,e.return,m)}break;case 4:default:pu(t,e),mu(e);break;case 13:pu(t,e),mu(e),8192&(o=e.child).flags&&(i=null!==o.memoizedState,o.stateNode.isHidden=i,!i||null!==o.alternate&&null!==o.alternate.memoizedState||(zu=Qe())),4&r&&hu(e);break;case 22:if(f=null!==n&&null!==n.memoizedState,1&e.mode?($s=(c=$s)||f,pu(t,e),$s=c):pu(t,e),mu(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!f&&0!==(1&e.mode))for(Qs=e,f=e.child;null!==f;){for(d=Qs=f;null!==Qs;){switch(p=(h=Qs).child,h.tag){case 0:case 11:case 14:case 15:tu(4,h,h.return);break;case 1:Js(h,h.return);var v=h.stateNode;if("function"===typeof v.componentWillUnmount){r=h,n=h.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(m){El(r,n,m)}}break;case 5:Js(h,h.return);break;case 22:if(null!==h.memoizedState){bu(d);continue}}null!==p?(p.return=h,Qs=p):bu(d)}f=f.sibling}e:for(f=null,d=e;;){if(5===d.tag){if(null===f){f=d;try{o=d.stateNode,c?"function"===typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none":(u=d.stateNode,s=void 0!==(l=d.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,u.style.display=ve("display",s))}catch(m){El(e,e.return,m)}}}else if(6===d.tag){if(null===f)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){El(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:pu(t,e),mu(e),4&r&&hu(e);case 21:}}function mu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(au(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(de(o,""),r.flags&=-33),uu(e,iu(e),o);break;case 3:case 4:var i=r.stateNode.containerInfo;su(e,iu(e),i);break;default:throw Error(a(161))}}catch(s){El(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function gu(e,t,n){Qs=e,yu(e,t,n)}function yu(e,t,n){for(var r=0!==(1&e.mode);null!==Qs;){var o=Qs,a=o.child;if(22===o.tag&&r){var i=null!==o.memoizedState||Xs;if(!i){var s=o.alternate,u=null!==s&&null!==s.memoizedState||$s;s=Xs;var l=$s;if(Xs=i,($s=u)&&!l)for(Qs=o;null!==Qs;)u=(i=Qs).child,22===i.tag&&null!==i.memoizedState?wu(o):null!==u?(u.return=i,Qs=u):wu(o);for(;null!==a;)Qs=a,yu(a,t,n),a=a.sibling;Qs=o,Xs=s,$s=l}xu(e)}else 0!==(8772&o.subtreeFlags)&&null!==a?(a.return=o,Qs=a):xu(e)}}function xu(e){for(;null!==Qs;){var t=Qs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$s||nu(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$s)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Ha(t,i,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ha(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var f=c.memoizedState;if(null!==f){var d=f.dehydrated;null!==d&&jt(d)}}}break;default:throw Error(a(163))}$s||512&t.flags&&ru(t)}catch(h){El(t,t.return,h)}}if(t===e){Qs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qs=n;break}Qs=t.return}}function bu(e){for(;null!==Qs;){var t=Qs;if(t===e){Qs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qs=n;break}Qs=t.return}}function wu(e){for(;null!==Qs;){var t=Qs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{nu(4,t)}catch(u){El(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(u){El(t,o,u)}}var a=t.return;try{ru(t)}catch(u){El(t,a,u)}break;case 5:var i=t.return;try{ru(t)}catch(u){El(t,i,u)}}}catch(u){El(t,t.return,u)}if(t===e){Qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Qs=s;break}Qs=t.return}}var Cu,Eu=Math.ceil,ku=b.ReactCurrentDispatcher,Su=b.ReactCurrentOwner,Ru=b.ReactCurrentBatchConfig,Iu=0,_u=null,Nu=null,Tu=0,Au=0,Du=So(0),Ou=0,Fu=null,Pu=0,Mu=0,Bu=0,Lu=null,Wu=null,zu=0,Uu=1/0,ju=null,Vu=!1,Hu=null,Gu=null,qu=!1,Ku=null,Xu=0,$u=0,Yu=null,Qu=-1,Ju=0;function Zu(){return 0!==(6&Iu)?Qe():-1!==Qu?Qu:Qu=Qe()}function el(e){return 0===(1&e.mode)?1:0!==(2&Iu)&&0!==Tu?Tu&-Tu:null!==ma.transition?(0===Ju&&(Ju=vt()),Ju):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function tl(e,t,n,r){if(50<$u)throw $u=0,Yu=null,Error(a(185));gt(e,n,r),0!==(2&Iu)&&e===_u||(e===_u&&(0===(2&Iu)&&(Mu|=n),4===Ou&&il(e,Tu)),nl(e,r),1===n&&0===Iu&&0===(1&t.mode)&&(Uu=Qe()+500,zo&&Vo()))}function nl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-it(a),s=1<<i,u=o[i];-1===u?0!==(s&n)&&0===(s&r)||(o[i]=ht(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=dt(e,e===_u?Tu:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){zo=!0,jo(e)}(sl.bind(null,e)):jo(sl.bind(null,e)),io(function(){0===(6&Iu)&&Vo()}),n=null;else{switch(bt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=_l(n,rl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rl(e,t){if(Qu=-1,Ju=0,0!==(6&Iu))throw Error(a(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var r=dt(e,e===_u?Tu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=vl(e,r);else{t=r;var o=Iu;Iu|=2;var i=hl();for(_u===e&&Tu===t||(ju=null,Uu=Qe()+500,fl(e,t));;)try{gl();break}catch(u){dl(e,u)}Ia(),ku.current=i,Iu=o,null!==Nu?t=0:(_u=null,Tu=0,t=Ou)}if(0!==t){if(2===t&&(0!==(o=pt(e))&&(r=o,t=ol(e,o))),1===t)throw n=Fu,fl(e,0),il(e,r),nl(e,Qe()),n;if(6===t)il(e,r);else{if(o=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!sr(a(),o))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)&&(2===(t=vl(e,r))&&(0!==(i=pt(e))&&(r=i,t=ol(e,i))),1===t))throw n=Fu,fl(e,0),il(e,r),nl(e,Qe()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:bl(e,Wu,ju);break;case 3:if(il(e,r),(130023424&r)===r&&10<(t=zu+500-Qe())){if(0!==dt(e,0))break;if(((o=e.suspendedLanes)&r)!==r){Zu(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(bl.bind(null,e,Wu,ju),t);break}bl(e,Wu,ju);break;case 4:if(il(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-it(r);i=1<<s,(s=t[s])>o&&(o=s),r&=~i}if(r=o,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Eu(r/1960))-r)){e.timeoutHandle=ro(bl.bind(null,e,Wu,ju),r);break}bl(e,Wu,ju);break;default:throw Error(a(329))}}}return nl(e,Qe()),e.callbackNode===n?rl.bind(null,e):null}function ol(e,t){var n=Lu;return e.current.memoizedState.isDehydrated&&(fl(e,t).flags|=256),2!==(e=vl(e,t))&&(t=Wu,Wu=n,null!==t&&al(t)),e}function al(e){null===Wu?Wu=e:Wu.push.apply(Wu,e)}function il(e,t){for(t&=~Bu,t&=~Mu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function sl(e){if(0!==(6&Iu))throw Error(a(327));wl();var t=dt(e,0);if(0===(1&t))return nl(e,Qe()),null;var n=vl(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ol(e,r))}if(1===n)throw n=Fu,fl(e,0),il(e,t),nl(e,Qe()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bl(e,Wu,ju),nl(e,Qe()),null}function ul(e,t){var n=Iu;Iu|=1;try{return e(t)}finally{0===(Iu=n)&&(Uu=Qe()+500,zo&&Vo())}}function ll(e){null!==Ku&&0===Ku.tag&&0===(6&Iu)&&wl();var t=Iu;Iu|=1;var n=Ru.transition,r=xt;try{if(Ru.transition=null,xt=1,e)return e()}finally{xt=r,Ru.transition=n,0===(6&(Iu=t))&&Vo()}}function cl(){Au=Du.current,Ro(Du)}function fl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==Nu)for(n=Nu.return;null!==n;){var r=n;switch(na(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Fo();break;case 3:Qa(),Ro(To),Ro(No),ri();break;case 5:Za(r);break;case 4:Qa();break;case 13:case 19:Ro(ei);break;case 10:_a(r.type._context);break;case 22:case 23:cl()}n=n.return}if(_u=e,Nu=e=Dl(e.current,null),Tu=Au=t,Ou=0,Fu=null,Bu=Mu=Pu=0,Wu=Lu=null,null!==Da){for(t=0;t<Da.length;t++)if(null!==(r=(n=Da[t]).interleaved)){n.interleaved=null;var o=r.next,a=n.pending;if(null!==a){var i=a.next;a.next=o,r.next=i}n.pending=r}Da=null}return e}function dl(e,t){for(;;){var n=Nu;try{if(Ia(),oi.current=Ji,ci){for(var r=si.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}ci=!1}if(ii=0,li=ui=si=null,fi=!1,di=0,Su.current=null,null===n||null===n.return){Ou=1,Fu=t,Nu=null;break}e:{var i=e,s=n.return,u=n,l=t;if(t=Tu,u.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l,f=u,d=f.tag;if(0===(1&f.mode)&&(0===d||11===d||15===d)){var h=f.alternate;h?(f.updateQueue=h.updateQueue,f.memoizedState=h.memoizedState,f.lanes=h.lanes):(f.updateQueue=null,f.memoizedState=null)}var p=ms(s);if(null!==p){p.flags&=-257,gs(p,s,u,0,t),1&p.mode&&vs(i,c,t),l=c;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(l),t.updateQueue=m}else v.add(l);break e}if(0===(1&t)){vs(i,c,t),pl();break e}l=Error(a(426))}else if(aa&&1&u.mode){var g=ms(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),gs(g,s,u,0,t),va(ls(l,u));break e}}i=l=ls(l,u),4!==Ou&&(Ou=2),null===Lu?Lu=[i]:Lu.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,ja(i,hs(0,l,t));break e;case 1:u=l;var y=i.type,x=i.stateNode;if(0===(128&i.flags)&&("function"===typeof y.getDerivedStateFromError||null!==x&&"function"===typeof x.componentDidCatch&&(null===Gu||!Gu.has(x)))){i.flags|=65536,t&=-t,i.lanes|=t,ja(i,ps(i,u,t));break e}}i=i.return}while(null!==i)}xl(n)}catch(b){t=b,Nu===n&&null!==n&&(Nu=n=n.return);continue}break}}function hl(){var e=ku.current;return ku.current=Ji,null===e?Ji:e}function pl(){0!==Ou&&3!==Ou&&2!==Ou||(Ou=4),null===_u||0===(268435455&Pu)&&0===(268435455&Mu)||il(_u,Tu)}function vl(e,t){var n=Iu;Iu|=2;var r=hl();for(_u===e&&Tu===t||(ju=null,fl(e,t));;)try{ml();break}catch(o){dl(e,o)}if(Ia(),Iu=n,ku.current=r,null!==Nu)throw Error(a(261));return _u=null,Tu=0,Ou}function ml(){for(;null!==Nu;)yl(Nu)}function gl(){for(;null!==Nu&&!$e();)yl(Nu)}function yl(e){var t=Cu(e.alternate,e,Au);e.memoizedProps=e.pendingProps,null===t?xl(e):Nu=t,Su.current=null}function xl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qs(n,t,Au)))return void(Nu=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Nu=n);if(null===e)return Ou=6,void(Nu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nu=t);Nu=t=e}while(null!==t);0===Ou&&(Ou=5)}function bl(e,t,n){var r=xt,o=Ru.transition;try{Ru.transition=null,xt=1,function(e,t,n,r){do{wl()}while(null!==Ku);if(0!==(6&Iu))throw Error(a(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-it(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}(e,i),e===_u&&(Nu=_u=null,Tu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||qu||(qu=!0,_l(tt,function(){return wl(),null})),i=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||i){i=Ru.transition,Ru.transition=null;var s=xt;xt=1;var u=Iu;Iu|=4,Su.current=null,function(e,t){if(eo=Ht,hr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(w){n=null;break e}var s=0,u=-1,l=-1,c=0,f=0,d=e,h=null;t:for(;;){for(var p;d!==n||0!==o&&3!==d.nodeType||(u=s+o),d!==i||0!==r&&3!==d.nodeType||(l=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)h=d,d=p;for(;;){if(d===e)break t;if(h===n&&++c===o&&(u=s),h===i&&++f===r&&(l=s),null!==(p=d.nextSibling))break;h=(d=h).parentNode}d=p}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Ht=!1,Qs=t;null!==Qs;)if(e=(t=Qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qs=e;else for(;null!==Qs;){t=Qs;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var m=v.memoizedProps,g=v.memoizedState,y=t.stateNode,x=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:ns(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(w){El(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Qs=e;break}Qs=t.return}v=eu,eu=!1}(e,n),vu(n,e),pr(to),Ht=!!eo,to=eo=null,e.current=n,gu(n,e,o),Ye(),Iu=u,xt=s,Ru.transition=i}else e.current=n;if(qu&&(qu=!1,Ku=e,Xu=o),i=e.pendingLanes,0===i&&(Gu=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),nl(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Vu)throw Vu=!1,e=Hu,Hu=null,e;0!==(1&Xu)&&0!==e.tag&&wl(),i=e.pendingLanes,0!==(1&i)?e===Yu?$u++:($u=0,Yu=e):$u=0,Vo()}(e,t,n,r)}finally{Ru.transition=o,xt=r}return null}function wl(){if(null!==Ku){var e=bt(Xu),t=Ru.transition,n=xt;try{if(Ru.transition=null,xt=16>e?16:e,null===Ku)var r=!1;else{if(e=Ku,Ku=null,Xu=0,0!==(6&Iu))throw Error(a(331));var o=Iu;for(Iu|=4,Qs=e.current;null!==Qs;){var i=Qs,s=i.child;if(0!==(16&Qs.flags)){var u=i.deletions;if(null!==u){for(var l=0;l<u.length;l++){var c=u[l];for(Qs=c;null!==Qs;){var f=Qs;switch(f.tag){case 0:case 11:case 15:tu(8,f,i)}var d=f.child;if(null!==d)d.return=f,Qs=d;else for(;null!==Qs;){var h=(f=Qs).sibling,p=f.return;if(ou(f),f===c){Qs=null;break}if(null!==h){h.return=p,Qs=h;break}Qs=p}}}var v=i.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Qs=i}}if(0!==(2064&i.subtreeFlags)&&null!==s)s.return=i,Qs=s;else e:for(;null!==Qs;){if(0!==(2048&(i=Qs).flags))switch(i.tag){case 0:case 11:case 15:tu(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,Qs=y;break e}Qs=i.return}}var x=e.current;for(Qs=x;null!==Qs;){var b=(s=Qs).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,Qs=b;else e:for(s=x;null!==Qs;){if(0!==(2048&(u=Qs).flags))try{switch(u.tag){case 0:case 11:case 15:nu(9,u)}}catch(C){El(u,u.return,C)}if(u===s){Qs=null;break e}var w=u.sibling;if(null!==w){w.return=u.return,Qs=w;break e}Qs=u.return}}if(Iu=o,Vo(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(C){}r=!0}return r}finally{xt=n,Ru.transition=t}}return!1}function Cl(e,t,n){e=za(e,t=hs(0,t=ls(n,t),1),1),t=Zu(),null!==e&&(gt(e,1,t),nl(e,t))}function El(e,t,n){if(3===e.tag)Cl(e,e,n);else for(;null!==t;){if(3===t.tag){Cl(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Gu||!Gu.has(r))){t=za(t,e=ps(t,e=ls(n,e),1),1),e=Zu(),null!==t&&(gt(t,1,e),nl(t,e));break}}t=t.return}}function kl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Zu(),e.pingedLanes|=e.suspendedLanes&n,_u===e&&(Tu&n)===n&&(4===Ou||3===Ou&&(130023424&Tu)===Tu&&500>Qe()-zu?fl(e,0):Bu|=n),nl(e,t)}function Sl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=Zu();null!==(e=Pa(e,t))&&(gt(e,t,n),nl(e,n))}function Rl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Sl(e,n)}function Il(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Sl(e,n)}function _l(e,t){return Ke(e,t)}function Nl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tl(e,t,n,r){return new Nl(e,t,n,r)}function Al(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dl(e,t){var n=e.alternate;return null===n?((n=Tl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ol(e,t,n,r,o,i){var s=2;if(r=e,"function"===typeof e)Al(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case E:return Fl(n.children,o,i,t);case k:s=8,o|=8;break;case S:return(e=Tl(12,n,t,2|o)).elementType=S,e.lanes=i,e;case N:return(e=Tl(13,n,t,o)).elementType=N,e.lanes=i,e;case T:return(e=Tl(19,n,t,o)).elementType=T,e.lanes=i,e;case O:return Pl(n,o,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case R:s=10;break e;case I:s=9;break e;case _:s=11;break e;case A:s=14;break e;case D:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Tl(s,n,t,o)).elementType=e,t.type=r,t.lanes=i,t}function Fl(e,t,n,r){return(e=Tl(7,e,r,t)).lanes=n,e}function Pl(e,t,n,r){return(e=Tl(22,e,r,t)).elementType=O,e.lanes=n,e.stateNode={isHidden:!1},e}function Ml(e,t,n){return(e=Tl(6,e,null,t)).lanes=n,e}function Bl(e,t,n){return(t=Tl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ll(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Wl(e,t,n,r,o,a,i,s,u){return e=new Ll(e,t,n,s,u),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Tl(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ba(a),e}function zl(e){if(!e)return _o;e:{if(je(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Oo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Oo(n))return Mo(e,n,t)}return t}function Ul(e,t,n,r,o,a,i,s,u){return(e=Wl(n,r,!0,e,0,a,0,s,u)).context=zl(null),n=e.current,(a=Wa(r=Zu(),o=el(n))).callback=void 0!==t&&null!==t?t:null,za(n,a,o),e.current.lanes=o,gt(e,o,r),nl(e,r),e}function jl(e,t,n,r){var o=t.current,a=Zu(),i=el(o);return n=zl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Wa(a,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=za(o,t,i))&&(tl(e,o,i,a),Ua(e,o,i)),i}function Vl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gl(e,t){Hl(e,t),(e=e.alternate)&&Hl(e,t)}Cu=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||To.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:Ns(t),pa();break;case 5:Ja(t);break;case 1:Oo(t.type)&&Bo(t);break;case 4:Ya(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Io(Ea,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Io(ei,1&ei.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ms(e,t,n):(Io(ei,1&ei.current),null!==(e=Vs(e,t,n))?e.sibling:null);Io(ei,1&ei.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Us(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Io(ei,ei.current),r)break;return null;case 22:case 23:return t.lanes=0,ks(e,t,n)}return Vs(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,aa&&0!==(1048576&t.flags)&&ea(t,Ko,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;js(e,t),e=t.pendingProps;var o=Do(t,No.current);Ta(t,n),o=mi(null,t,r,e,o,n);var i=gi();return t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Oo(r)?(i=!0,Bo(t)):i=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Ba(t),o.updater=os,t.stateNode=o,o._reactInternals=t,us(t,r,e,n),t=_s(null,t,r,!0,i,n)):(t.tag=0,aa&&i&&ta(t),bs(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(js(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"===typeof e)return Al(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===_)return 11;if(e===A)return 14}return 2}(r),e=ns(r,e),o){case 0:t=Rs(null,t,r,e,n);break e;case 1:t=Is(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Cs(null,t,r,ns(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,Rs(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 1:return r=t.type,o=t.pendingProps,Is(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 3:e:{if(Ns(t),null===e)throw Error(a(387));r=t.pendingProps,o=(i=t.memoizedState).element,La(e,t),Va(t,r,null,n);var s=t.memoizedState;if(r=s.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Ts(e,t,r,n,o=ls(Error(a(423)),t));break e}if(r!==o){t=Ts(e,t,r,n,o=ls(Error(a(424)),t));break e}for(oa=lo(t.stateNode.containerInfo.firstChild),ra=t,aa=!0,ia=null,n=Ca(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pa(),r===o){t=Vs(e,t,n);break e}bs(e,t,r,n)}t=t.child}return t;case 5:return Ja(t),null===e&&ca(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,s=o.children,no(r,o)?s=null:null!==i&&no(r,i)&&(t.flags|=32),Ss(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&ca(t),null;case 13:return Ms(e,t,n);case 4:return Ya(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=wa(t,null,r,n):bs(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,ws(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,s=o.value,Io(Ea,r._currentValue),r._currentValue=s,null!==i)if(sr(i.value,s)){if(i.children===o.children&&!To.current){t=Vs(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var u=i.dependencies;if(null!==u){s=i.child;for(var l=u.firstContext;null!==l;){if(l.context===r){if(1===i.tag){(l=Wa(-1,n&-n)).tag=2;var c=i.updateQueue;if(null!==c){var f=(c=c.shared).pending;null===f?l.next=l:(l.next=f.next,f.next=l),c.pending=l}}i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),Na(i.return,n,t),u.lanes|=n;break}l=l.next}}else if(10===i.tag)s=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Na(s,n,t),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}bs(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Ta(t,n),r=r(o=Aa(o)),t.flags|=1,bs(e,t,r,n),t.child;case 14:return o=ns(r=t.type,t.pendingProps),Cs(e,t,r,o=ns(r.type,o),n);case 15:return Es(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ns(r,o),js(e,t),t.tag=1,Oo(r)?(e=!0,Bo(t)):e=!1,Ta(t,n),is(t,r,o),us(t,r,o,n),_s(null,t,r,!0,e,n);case 19:return Us(e,t,n);case 22:return ks(e,t,n)}throw Error(a(156,t.tag))};var ql="function"===typeof reportError?reportError:function(e){console.error(e)};function Kl(e){this._internalRoot=e}function Xl(e){this._internalRoot=e}function $l(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ql(){}function Jl(e,t,n,r,o){var a=n._reactRootContainer;if(a){var i=a;if("function"===typeof o){var s=o;o=function(){var e=Vl(i);s.call(e)}}jl(t,i,e,o)}else i=function(e,t,n,r,o){if(o){if("function"===typeof r){var a=r;r=function(){var e=Vl(i);a.call(e)}}var i=Ul(t,r,e,0,null,!1,0,"",Ql);return e._reactRootContainer=i,e[vo]=i.current,jr(8===e.nodeType?e.parentNode:e),ll(),i}for(;o=e.lastChild;)e.removeChild(o);if("function"===typeof r){var s=r;r=function(){var e=Vl(u);s.call(e)}}var u=Wl(e,0,!1,null,0,!1,0,"",Ql);return e._reactRootContainer=u,e[vo]=u.current,jr(8===e.nodeType?e.parentNode:e),ll(function(){jl(t,u,n,r)}),u}(n,t,e,o,r);return Vl(i)}Xl.prototype.render=Kl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));jl(e,t,null,null)},Xl.prototype.unmount=Kl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ll(function(){jl(null,e,null,null)}),t[vo]=null}},Xl.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ot.length&&0!==t&&t<Ot[n].priority;n++);Ot.splice(n,0,e),0===n&&Bt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ft(t.pendingLanes);0!==n&&(yt(t,1|n),nl(t,Qe()),0===(6&Iu)&&(Uu=Qe()+500,Vo()))}break;case 13:ll(function(){var t=Pa(e,1);if(null!==t){var n=Zu();tl(t,e,1,n)}}),Gl(e,1)}},Ct=function(e){if(13===e.tag){var t=Pa(e,134217728);if(null!==t)tl(t,e,134217728,Zu());Gl(e,134217728)}},Et=function(e){if(13===e.tag){var t=el(e),n=Pa(e,t);if(null!==n)tl(n,e,t,Zu());Gl(e,t)}},kt=function(){return xt},St=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},Ce=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=Co(r);if(!o)throw Error(a(90));K(r),J(r,o)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},_e=ul,Ne=ll;var Zl={usingClientEntryPoint:!1,Events:[bo,wo,Co,Re,Ie,ul]},ec={findFiberByHostInstance:xo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tc={bundleType:ec.bundleType,version:ec.version,rendererPackageName:ec.rendererPackageName,rendererConfig:ec.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:ec.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nc.isDisabled&&nc.supportsFiber)try{ot=nc.inject(tc),at=nc}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$l(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:C,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$l(e))throw Error(a(299));var n=!1,r="",o=ql;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Wl(e,1,!1,null,0,n,0,r,o),e[vo]=t.current,jr(8===e.nodeType?e.parentNode:e),new Kl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return ll(e)},t.hydrate=function(e,t,n){if(!Yl(t))throw Error(a(200));return Jl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$l(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,o=!1,i="",s=ql;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Ul(t,null,e,1,null!=n?n:null,o,0,i,s),e[vo]=t.current,jr(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Xl(t)},t.render=function(e,t,n){if(!Yl(t))throw Error(a(200));return Jl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yl(e))throw Error(a(40));return!!e._reactRootContainer&&(ll(function(){Jl(null,null,e,!1,function(){e._reactRootContainer=null,e[vo]=null})}),!0)},t.unstable_batchedUpdates=ul,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Yl(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Jl(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},853(e,t,n){"use strict";e.exports=n(234)},886(){},950(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o)return r;if("object"===typeof r&&r){if(4&o&&r.__esModule)return r;if(16&o&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&r;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>i[e]=()=>r[e]);return i.default=()=>r,n.d(a,i),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/LinkX/",(()=>{"use strict";var e={};n.r(e),n.d(e,{hasBrowserEnv:()=>Un,hasStandardBrowserEnv:()=>Vn,hasStandardBrowserWebWorkerEnv:()=>Hn,navigator:()=>jn,origin:()=>Gn});var t={};n.r(t),n.d(t,{AnchorPosition:()=>ZN,DrawBox:()=>iT,DrawBoxOptions:()=>aT,DrawTextField:()=>oT,DrawTextFieldOptions:()=>rT});var r={};n.r(r),n.d(r,{DrawFaceLandmarks:()=>hA,DrawFaceLandmarksOptions:()=>dA,drawContour:()=>jT,drawDetections:()=>qT,drawFaceExpressions:()=>sA,drawFaceLandmarks:()=>pA});var o,a=n(43),i=n.t(a,2),s=n(391),u=n(950),l=n.t(u,2);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(o||(o={}));const f="popstate";function d(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function h(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(vo){}}}function p(e,t){return{usr:e.state,key:e.key,idx:t}}function v(e,t,n,r){return void 0===n&&(n=null),c({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?g(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function m(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function g(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function y(e,t,n,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:i=!1}=r,s=a.history,u=o.Pop,l=null,h=g();function g(){return(s.state||{idx:null}).idx}function y(){u=o.Pop;let e=g(),t=null==e?null:e-h;h=e,l&&l({action:u,location:b.location,delta:t})}function x(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,n="string"===typeof e?e:m(e);return n=n.replace(/ $/,"%20"),d(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==h&&(h=0,s.replaceState(c({},s.state,{idx:h}),""));let b={get action(){return u},get location(){return e(a,s)},listen(e){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(f,y),l=e,()=>{a.removeEventListener(f,y),l=null}},createHref:e=>t(a,e),createURL:x,encodeLocation(e){let t=x(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){u=o.Push;let r=v(b.location,e,t);n&&n(r,e),h=g()+1;let c=p(r,h),f=b.createHref(r);try{s.pushState(c,"",f)}catch(d){if(d instanceof DOMException&&"DataCloneError"===d.name)throw d;a.location.assign(f)}i&&l&&l({action:u,location:b.location,delta:1})},replace:function(e,t){u=o.Replace;let r=v(b.location,e,t);n&&n(r,e),h=g();let a=p(r,h),c=b.createHref(r);s.replaceState(a,"",c),i&&l&&l({action:u,location:b.location,delta:0})},go:e=>s.go(e)};return b}var x;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(x||(x={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function b(e,t,n){return void 0===n&&(n="/"),w(e,t,n,!1)}function w(e,t,n,r){let o=P(("string"===typeof t?g(t):t).pathname||"/",n);if(null==o)return null;let a=C(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(a);let i=null;for(let s=0;null==i&&s<a.length;++s){let e=F(o);i=D(a[s],e,r)}return i}function C(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let o=(e,o,a)=>{let i={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:o,route:e};i.relativePath.startsWith("/")&&(d(i.relativePath.startsWith(r),'Absolute route path "'+i.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),i.relativePath=i.relativePath.slice(r.length));let s=V([r,i.relativePath]),u=n.concat(i);e.children&&e.children.length>0&&(d(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),C(e.children,t,u,s)),(null!=e.path||e.index)&&t.push({path:s,score:A(s,e.index),routesMeta:u})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of E(e.path))o(e,t,r);else o(e,t)}),t}function E(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,o=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===r.length)return o?[a,""]:[a];let i=E(r.join("/")),s=[];return s.push(...i.map(e=>""===e?a:[a,e].join("/"))),o&&s.push(...i),s.map(t=>e.startsWith("/")&&""===t?"/":t)}const k=/^:[\w-]+$/,S=3,R=2,I=1,_=10,N=-2,T=e=>"*"===e;function A(e,t){let n=e.split("/"),r=n.length;return n.some(T)&&(r+=N),t&&(r+=R),n.filter(e=>!T(e)).reduce((e,t)=>e+(k.test(t)?S:""===t?I:_),r)}function D(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,o={},a="/",i=[];for(let s=0;s<r.length;++s){let e=r[s],u=s===r.length-1,l="/"===a?t:t.slice(a.length)||"/",c=O({path:e.relativePath,caseSensitive:e.caseSensitive,end:u},l),f=e.route;if(!c&&u&&n&&!r[r.length-1].route.index&&(c=O({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!c)return null;Object.assign(o,c.params),i.push({params:o,pathname:V([a,c.pathname]),pathnameBase:H(V([a,c.pathnameBase])),route:f}),"/"!==c.pathnameBase&&(a=V([a,c.pathnameBase]))}return i}function O(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);h("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),o+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==e&&"/"!==e&&(o+="(?:(?=\\/|$))");let a=new RegExp(o,t?void 0:"i");return[a,r]}(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let a=o[0],i=a.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:o}=t;if("*"===r){let e=s[n]||"";i=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const u=s[n];return e[r]=o&&!u?void 0:(u||"").replace(/%2F/g,"/"),e},{}),pathname:a,pathnameBase:i,pattern:e}}function F(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return h(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function P(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}const M=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function B(e,t){void 0===t&&(t="/");let n,{pathname:r,search:o="",hash:a=""}="string"===typeof e?g(e):e;if(r)if(i=r,M.test(i))n=r;else{if(r.includes("//")){let e=r;r=r.replace(/\/\/+/g,"/"),h(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+r)}n=r.startsWith("/")?L(r.substring(1),"/"):L(r,t)}else n=t;var i;return{pathname:n,search:G(o),hash:q(a)}}function L(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function W(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function z(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function U(e,t){let n=z(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function j(e,t,n,r){let o;void 0===r&&(r=!1),"string"===typeof e?o=g(e):(o=c({},e),d(!o.pathname||!o.pathname.includes("?"),W("?","pathname","search",o)),d(!o.pathname||!o.pathname.includes("#"),W("#","pathname","hash",o)),d(!o.search||!o.search.includes("#"),W("#","search","hash",o)));let a,i=""===e||""===o.pathname,s=i?"/":o.pathname;if(null==s)a=n;else{let e=t.length-1;if(!r&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}a=e>=0?t[e]:"/"}let u=B(o,a),l=s&&"/"!==s&&s.endsWith("/"),f=(i||"."===s)&&n.endsWith("/");return u.pathname.endsWith("/")||!l&&!f||(u.pathname+="/"),u}const V=e=>e.join("/").replace(/\/\/+/g,"/"),H=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),G=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",q=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function K(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const X=["post","put","patch","delete"],$=(new Set(X),["get",...X]);new Set($),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Y.apply(this,arguments)}const Q=a.createContext(null);const J=a.createContext(null);const Z=a.createContext(null);const ee=a.createContext(null);const te=a.createContext({outlet:null,matches:[],isDataRoute:!1});const ne=a.createContext(null);function re(){return null!=a.useContext(ee)}function oe(){return re()||d(!1),a.useContext(ee).location}function ae(e){a.useContext(Z).static||a.useLayoutEffect(e)}function ie(){let{isDataRoute:e}=a.useContext(te);return e?function(){let{router:e}=ge(ve.UseNavigateStable),t=xe(me.UseNavigateStable),n=a.useRef(!1);ae(()=>{n.current=!0});let r=a.useCallback(function(r,o){void 0===o&&(o={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,Y({fromRouteId:t},o)))},[e,t]);return r}():function(){re()||d(!1);let e=a.useContext(Q),{basename:t,future:n,navigator:r}=a.useContext(Z),{matches:o}=a.useContext(te),{pathname:i}=oe(),s=JSON.stringify(U(o,n.v7_relativeSplatPath)),u=a.useRef(!1);ae(()=>{u.current=!0});let l=a.useCallback(function(n,o){if(void 0===o&&(o={}),!u.current)return;if("number"===typeof n)return void r.go(n);let a=j(n,JSON.parse(s),i,"path"===o.relative);null==e&&"/"!==t&&(a.pathname="/"===a.pathname?t:V([t,a.pathname])),(o.replace?r.replace:r.push)(a,o.state,o)},[t,r,s,i,e]);return l}()}const se=a.createContext(null);function ue(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=a.useContext(Z),{matches:o}=a.useContext(te),{pathname:i}=oe(),s=JSON.stringify(U(o,r.v7_relativeSplatPath));return a.useMemo(()=>j(e,JSON.parse(s),i,"path"===n),[e,s,i,n])}function le(e,t,n,r){re()||d(!1);let{navigator:i}=a.useContext(Z),{matches:s}=a.useContext(te),u=s[s.length-1],l=u?u.params:{},c=(u&&u.pathname,u?u.pathnameBase:"/");u&&u.route;let f,h=oe();if(t){var p;let e="string"===typeof t?g(t):t;"/"===c||(null==(p=e.pathname)?void 0:p.startsWith(c))||d(!1),f=e}else f=h;let v=f.pathname||"/",m=v;if("/"!==c){let e=c.replace(/^\//,"").split("/");m="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let y=b(e,{pathname:m});let x=pe(y&&y.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:V([c,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:V([c,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),s,n,r);return t&&x?a.createElement(ee.Provider,{value:{location:Y({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:o.Pop}},x):x}function ce(){let e=function(){var e;let t=a.useContext(ne),n=ye(me.UseRouteError),r=xe(me.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=K(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:r};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},t),n?a.createElement("pre",{style:o},n):null,null)}const fe=a.createElement(ce,null);class de extends a.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?a.createElement(te.Provider,{value:this.props.routeContext},a.createElement(ne.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function he(e){let{routeContext:t,match:n,children:r}=e,o=a.useContext(Q);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),a.createElement(te.Provider,{value:t},r)}function pe(e,t,n,r){var o;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var i;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(i=r)&&i.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let s=e,u=null==(o=n)?void 0:o.errors;if(null!=u){let e=s.findIndex(e=>e.route.id&&void 0!==(null==u?void 0:u[e.route.id]));e>=0||d(!1),s=s.slice(0,Math.min(s.length,e+1))}let l=!1,c=-1;if(n&&r&&r.v7_partialHydration)for(let a=0;a<s.length;a++){let e=s[a];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(c=a),e.route.id){let{loaderData:t,errors:r}=n,o=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||o){l=!0,s=c>=0?s.slice(0,c+1):[s[0]];break}}}return s.reduceRight((e,r,o)=>{let i,f=!1,d=null,h=null;var p;n&&(i=u&&r.route.id?u[r.route.id]:void 0,d=r.route.errorElement||fe,l&&(c<0&&0===o?(p="route-fallback",!1||be[p]||(be[p]=!0),f=!0,h=null):c===o&&(f=!0,h=r.route.hydrateFallbackElement||null)));let v=t.concat(s.slice(0,o+1)),m=()=>{let t;return t=i?d:f?h:r.route.Component?a.createElement(r.route.Component,null):r.route.element?r.route.element:e,a.createElement(he,{match:r,routeContext:{outlet:e,matches:v,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===o)?a.createElement(de,{location:n.location,revalidation:n.revalidation,component:d,error:i,children:m(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):m()},null)}var ve=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ve||{}),me=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(me||{});function ge(e){let t=a.useContext(Q);return t||d(!1),t}function ye(e){let t=a.useContext(J);return t||d(!1),t}function xe(e){let t=function(){let e=a.useContext(te);return e||d(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||d(!1),n.route.id}const be={};function we(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}i.startTransition;function Ce(e){return function(e){let t=a.useContext(te).outlet;return t?a.createElement(se.Provider,{value:e},t):t}(e.context)}function Ee(e){d(!1)}function ke(e){let{basename:t="/",children:n=null,location:r,navigationType:i=o.Pop,navigator:s,static:u=!1,future:l}=e;re()&&d(!1);let c=t.replace(/^\/*/,"/"),f=a.useMemo(()=>({basename:c,navigator:s,static:u,future:Y({v7_relativeSplatPath:!1},l)}),[c,l,s,u]);"string"===typeof r&&(r=g(r));let{pathname:h="/",search:p="",hash:v="",state:m=null,key:y="default"}=r,x=a.useMemo(()=>{let e=P(h,c);return null==e?null:{location:{pathname:e,search:p,hash:v,state:m,key:y},navigationType:i}},[c,h,p,v,m,y,i]);return null==x?null:a.createElement(Z.Provider,{value:f},a.createElement(ee.Provider,{children:n,value:x}))}function Se(e){let{children:t,location:n}=e;return le(Re(t),n)}new Promise(()=>{});a.Component;function Re(e,t){void 0===t&&(t=[]);let n=[];return a.Children.forEach(e,(e,r)=>{if(!a.isValidElement(e))return;let o=[...t,r];if(e.type===a.Fragment)return void n.push.apply(n,Re(e.props.children,o));e.type!==Ee&&d(!1),e.props.index&&e.props.children&&d(!1);let i={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=Re(e.props.children,o)),n.push(i)}),n}function Ie(){return Ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ie.apply(this,arguments)}function _e(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ne=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(vo){}new Map;const Te=i.startTransition;l.flushSync,i.useId;function Ae(e){let{basename:t,children:n,future:r,window:o}=e,i=a.useRef();var s;null==i.current&&(i.current=(void 0===(s={window:o,v5Compat:!0})&&(s={}),y(function(e,t){let{pathname:n="/",search:r="",hash:o=""}=g(e.location.hash.substr(1));return n.startsWith("/")||n.startsWith(".")||(n="/"+n),v("",{pathname:n,search:r,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){let n=e.document.querySelector("base"),r="";if(n&&n.getAttribute("href")){let t=e.location.href,n=t.indexOf("#");r=-1===n?t:t.slice(0,n)}return r+"#"+("string"===typeof t?t:m(t))},function(e,t){h("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")},s)));let u=i.current,[l,c]=a.useState({action:u.action,location:u.location}),{v7_startTransition:f}=r||{},d=a.useCallback(e=>{f&&Te?Te(()=>c(e)):c(e)},[c,f]);return a.useLayoutEffect(()=>u.listen(d),[u,d]),a.useEffect(()=>we(r),[r]),a.createElement(ke,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:u,future:r})}const De="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Oe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fe=a.forwardRef(function(e,t){let n,{onClick:r,relative:o,reloadDocument:i,replace:s,state:u,target:l,to:c,preventScrollReset:f,viewTransition:h}=e,p=_e(e,Ne),{basename:v}=a.useContext(Z),g=!1;if("string"===typeof c&&Oe.test(c)&&(n=c,De))try{let e=new URL(window.location.href),t=c.startsWith("//")?new URL(e.protocol+c):new URL(c),n=P(t.pathname,v);t.origin===e.origin&&null!=n?c=n+t.search+t.hash:g=!0}catch(vo){}let y=function(e,t){let{relative:n}=void 0===t?{}:t;re()||d(!1);let{basename:r,navigator:o}=a.useContext(Z),{hash:i,pathname:s,search:u}=ue(e,{relative:n}),l=s;return"/"!==r&&(l="/"===s?r:V([r,s])),o.createHref({pathname:l,search:u,hash:i})}(c,{relative:o}),x=function(e,t){let{target:n,replace:r,state:o,preventScrollReset:i,relative:s,viewTransition:u}=void 0===t?{}:t,l=ie(),c=oe(),f=ue(e,{relative:s});return a.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:m(c)===m(f);l(e,{replace:n,state:o,preventScrollReset:i,relative:s,viewTransition:u})}},[c,l,f,r,o,n,e,i,s,u])}(c,{replace:s,state:u,target:l,preventScrollReset:f,relative:o,viewTransition:h});return a.createElement("a",Ie({},p,{href:n||y,onClick:g||i?r:function(e){r&&r(e),e.defaultPrevented||x(e)},ref:t,target:l}))});var Pe,Me;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Pe||(Pe={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Me||(Me={}));var Be={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Le=a.createContext&&a.createContext(Be),We=["attr","size","title"];function ze(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Ue(){return Ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ue.apply(this,arguments)}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach(function(t){He(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function He(e,t,n){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e){return e&&e.map((e,t)=>a.createElement(e.tag,Ve({key:t},e.attr),Ge(e.child)))}function qe(e){return t=>a.createElement(Ke,Ue({attr:Ve({},e.attr)},t),Ge(e.child))}function Ke(e){var t=t=>{var n,{attr:r,size:o,title:i}=e,s=ze(e,We),u=o||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),a.createElement("svg",Ue({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,s,{className:n,style:Ve(Ve({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),i&&a.createElement("title",null,i),e.children)};return void 0!==Le?a.createElement(Le.Consumer,null,e=>t(e)):t(Be)}function Xe(e){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 19 5 12 12 5"},child:[]}]})(e)}function $e(e){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"},child:[]}]})(e)}function Ye(e){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"},child:[]},{tag:"polyline",attr:{points:"9 22 9 12 15 12 15 22"},child:[]}]})(e)}function Qe(e){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"},child:[]},{tag:"polyline",attr:{points:"21 15 16 10 5 21"},child:[]}]})(e)}function Je(e){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"},child:[]},{tag:"polyline",attr:{points:"22,6 12,13 2,6"},child:[]}]})(e)}function Ze(e){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}function et(e){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"},child:[]}]})(e)}var tt=n(579);function nt(){const e=oe();return(0,tt.jsxs)("div",{style:rt.nav,children:[(0,tt.jsx)(Fe,{to:"/",children:(0,tt.jsx)(Ye,{size:24,color:"/"===e.pathname?"#000":"#aaa"})}),(0,tt.jsx)(Fe,{to:"/upload",children:(0,tt.jsx)("div",{style:rt.plus,children:(0,tt.jsx)(Ze,{size:28,color:"/upload"===e.pathname?"#000":"#aaa"})})}),(0,tt.jsx)(Fe,{to:"/profile",children:(0,tt.jsx)(et,{size:24,color:"/profile"===e.pathname?"#000":"#aaa"})})]})}const rt={nav:{display:"flex",justifyContent:"space-around",alignItems:"center",padding:"10px 0",borderTop:"1px solid #ddd",position:"fixed",bottom:0,width:"100%",backgroundColor:"#fff"},plus:{backgroundColor:"#eee",borderRadius:"50%",padding:10,display:"flex",justifyContent:"center",alignItems:"center",marginTop:-20}};function ot(){return(0,tt.jsxs)("div",{style:{minHeight:"100vh"},children:[(0,tt.jsx)(Ce,{}),(0,tt.jsx)(nt,{})]})}function at(e){let{open:t,onClose:n}=e;const r=ie();return t?(0,tt.jsx)("div",{style:it.overlay,onClick:n,children:(0,tt.jsxs)("div",{style:it.menu,onClick:e=>e.stopPropagation(),children:[(0,tt.jsxs)("div",{style:it.header,children:[(0,tt.jsx)("div",{style:it.logo,children:"LinkX"}),(0,tt.jsx)("div",{style:it.cancel,onClick:n,children:"|||"})]}),(0,tt.jsx)("div",{style:it.menuItem,onClick:()=>{r("/inbox"),n()},children:"inbox"}),(0,tt.jsx)("div",{style:it.menuItem,onClick:()=>{r("/top-gigs"),n()},children:"top gigs"}),(0,tt.jsx)("div",{style:it.menuItem,onClick:()=>{r("/chatbot"),n()},children:"chatbot"}),(0,tt.jsx)("div",{style:it.menuItem,onClick:()=>{r("/dashboard"),n()},children:"dashboard"}),(0,tt.jsx)("div",{style:it.footer,children:"\u2699"})]})}):null}const it={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.15)",zIndex:5e3},menu:{width:"75%",height:"100%",background:"#fff",paddingTop:10},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",borderBottom:"1px solid #eee"},logo:{fontSize:22,fontWeight:"bold"},cancel:{fontSize:22,fontWeight:"bold",cursor:"pointer"},menuItem:{padding:"16px 14px",borderBottom:"1px solid #eee",fontSize:16,cursor:"pointer"},footer:{position:"absolute",bottom:20,left:14,fontSize:20}},st=n.p+"static/media/black.b76b2a99959eb9b836fd.jpg";function ut(e){let{gig:t}=e;const n=ie(),r="number"===typeof(null===t||void 0===t?void 0:t.price)?"\u20b9".concat(t.price):"Price not set",o="number"===typeof(null===t||void 0===t?void 0:t.delivery_days)?"".concat(t.delivery_days," days"):"Delivery time not set",a=Array.isArray(null===t||void 0===t?void 0:t.images)&&t.images.length>0?t.images:[st,st];return(0,tt.jsxs)("div",{className:"gig-post",children:[(0,tt.jsxs)("div",{className:"gig-post-header",children:[(0,tt.jsxs)("div",{className:"gig-user",children:[(0,tt.jsx)("img",{src:(null===t||void 0===t?void 0:t.user_avatar)||st,alt:"user",className:"gig-avatar"}),(0,tt.jsx)("span",{className:"gig-username",children:(null===t||void 0===t?void 0:t.username)||"freelancer"}),(0,tt.jsx)(Je,{className:"gig-dm-icon",onClick:()=>n("/chat/1")})]}),(0,tt.jsx)("span",{className:"gig-menu",children:"\u22ef"})]}),(0,tt.jsx)("div",{className:"gig-title",children:(null===t||void 0===t?void 0:t.title)||"Untitled gig"}),(0,tt.jsx)("div",{className:"gig-media",children:a.map((e,t)=>(0,tt.jsx)("div",{className:"gig-media-item",children:(0,tt.jsx)("img",{src:e,alt:"gig"})},t))}),(0,tt.jsxs)("div",{className:"gig-footer",children:[(0,tt.jsxs)("div",{children:[(0,tt.jsx)("div",{className:"label",children:"Price"}),(0,tt.jsx)("div",{className:"value",children:r})]}),(0,tt.jsxs)("div",{children:[(0,tt.jsx)("div",{className:"label",children:"Delivery time"}),(0,tt.jsx)("div",{className:"value",children:o})]}),(0,tt.jsx)("div",{className:"gig-rating",children:"\u2b50 0"})]})]})}function lt(e){let{gigs:t,hasMore:n,loadMore:r}=e;const o=(0,a.useRef)(null),i=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if(!n)return;const e=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting&&!i.current&&(i.current=!0,r(),setTimeout(()=>{i.current=!1},400))},{rootMargin:"100px"}),t=o.current;return t&&e.observe(t),()=>{t&&e.unobserve(t),e.disconnect()}},[t.length,n,r]),(0,tt.jsxs)("div",{className:"gigs-grid",children:[t.map(e=>(0,tt.jsx)(ut,{gig:e},e.id)),n&&(0,tt.jsx)("div",{ref:o,className:"observer"})]})}function ct(){const e=ie(),[t,n]=(0,a.useState)(!1),[r,o]=(0,a.useState)([]),[i,s]=(0,a.useState)(1),[u,l]=(0,a.useState)(!0);(0,a.useEffect)(()=>{localStorage.removeItem("accessToken");localStorage.getItem("accessToken")||e("/login")},[e]),(0,a.useEffect)(()=>{c()},[]);const c=()=>{if(!u)return;const e=Array.from({length:5},(e,t)=>({id:"".concat(i,"-").concat(t),username:"freelancer",price_level:3,delivery_level:3,cover_image:"/placeholder.png"}));o(t=>[...t,...e]),s(e=>e+1),i>=5&&l(!1)};return(0,tt.jsxs)(tt.Fragment,{children:[(0,tt.jsx)(at,{open:t,onClose:()=>n(!1)}),(0,tt.jsxs)("div",{style:ft.container,children:[(0,tt.jsxs)("div",{style:ft.topBar,children:[(0,tt.jsxs)("div",{style:ft.menu,onClick:()=>n(!0),children:[(0,tt.jsx)("div",{style:ft.line}),(0,tt.jsx)("div",{style:ft.line}),(0,tt.jsx)("div",{style:ft.line})]}),(0,tt.jsxs)("div",{style:ft.search,onClick:()=>e("/search"),children:[(0,tt.jsx)("div",{style:ft.searchCircle}),(0,tt.jsx)("div",{style:ft.searchHandle})]})]}),(0,tt.jsxs)("div",{style:ft.uploadRow,onClick:()=>e("/upload"),children:[(0,tt.jsx)("div",{style:ft.avatar}),(0,tt.jsxs)("div",{children:[(0,tt.jsx)("div",{style:ft.name,children:"freelancer"}),(0,tt.jsx)("div",{style:ft.uploadText,children:"upload gig"})]})]}),(0,tt.jsx)("div",{style:ft.divider}),(0,tt.jsx)("div",{style:ft.feed,children:(0,tt.jsx)(lt,{gigs:r,hasMore:u,loadMore:c})})]})]})}const ft={container:{paddingBottom:90},topBar:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 14px",position:"sticky",top:0,zIndex:2e3,background:"#fff"},menu:{cursor:"pointer"},line:{width:22,height:2,background:"black",marginBottom:4},search:{position:"relative",width:18,height:18,cursor:"pointer"},searchCircle:{width:12,height:12,border:"2px solid black",borderRadius:"50%",position:"absolute",top:0,left:0},searchHandle:{width:2,height:6,background:"black",position:"absolute",bottom:0,right:0,transform:"rotate(45deg)"},uploadRow:{display:"flex",alignItems:"center",padding:"10px 14px",cursor:"pointer"},avatar:{width:44,height:44,borderRadius:"50%",background:"black",marginRight:10},name:{fontWeight:"600",fontSize:15},uploadText:{fontSize:14,color:"#bbb"},divider:{height:1,background:"#eee",marginTop:6},feed:{minHeight:"100vh",display:"flex",justifyContent:"center"}};function dt(e){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dt(e)}function ht(e){var t=function(e,t){if("object"!=dt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=dt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==dt(t)?t:t+""}function pt(e,t,n){return(t=ht(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(n),!0).forEach(function(t){pt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function gt(){const e=ie(),[t,n]=(0,a.useState)(""),[r,o]=(0,a.useState)(""),[i,s]=(0,a.useState)(""),[u,l]=(0,a.useState)(""),[c,f]=(0,a.useState)([]),[d,h]=(0,a.useState)([]),p=e=>{const t=e.trim().toLowerCase();!t||c.includes(t)||c.length>=10||f(e=>[...e,t])},v=t.trim()&&r.trim()&&i.trim()&&c.length>=2;return(0,tt.jsxs)("div",{style:yt.container,children:[(0,tt.jsxs)("div",{style:yt.header,children:[(0,tt.jsx)("button",{style:yt.close,onClick:()=>e(-1),children:"\u2715"}),(0,tt.jsx)("h3",{style:yt.headerTitle,children:"New gig"}),(0,tt.jsx)("button",{disabled:!v,style:mt(mt({},yt.publish),{},{background:v?"#000":"#bdbdbd",cursor:v?"pointer":"not-allowed"}),children:"Publish"})]}),(0,tt.jsx)("textarea",{placeholder:"What's new gig",value:t,onChange:e=>n(e.target.value),style:yt.textarea}),(0,tt.jsxs)("div",{style:yt.imageRow,children:[d.map((e,t)=>(0,tt.jsxs)("div",{style:yt.imagePreview,children:[(0,tt.jsx)("img",{src:e.preview,alt:"preview",style:yt.previewImg}),(0,tt.jsx)("span",{style:yt.removeImg,onClick:()=>(e=>{h(d.filter((t,n)=>n!==e))})(t),children:"\xd7"})]},t)),d.length<2&&(0,tt.jsxs)("label",{style:yt.imageAdd,children:[(0,tt.jsx)(Qe,{size:24,color:"#666"}),(0,tt.jsx)("input",{type:"file",accept:"image/*",hidden:!0,onChange:e=>{var t;!(t=e.target.files[0])||d.length>=2||h(e=>[...e,{file:t,preview:URL.createObjectURL(t)}])}})]})]}),(0,tt.jsxs)("div",{style:yt.row,children:[(0,tt.jsx)("input",{placeholder:"Price (\u20b9, $, \u20ac)",value:r,onChange:e=>o(e.target.value),style:yt.input}),(0,tt.jsx)("input",{placeholder:"delivery time",value:i,onChange:e=>s(e.target.value),style:yt.input}),(0,tt.jsx)("input",{placeholder:"add tags",value:u,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key&&","!==e.key||(e.preventDefault(),p(u),l(""))},onBlur:()=>{p(u),l("")},style:yt.input})]}),(0,tt.jsx)("div",{style:yt.tagsContainer,children:c.map((e,t)=>(0,tt.jsxs)("div",{style:yt.tag,children:[e,(0,tt.jsx)("span",{style:yt.remove,onClick:()=>(e=>{f(c.filter((t,n)=>n!==e))})(t),children:"\xd7"})]},t))}),c.length>0&&c.length<2&&(0,tt.jsx)("p",{style:yt.error,children:"Minimum 2 tags required"}),10===c.length&&(0,tt.jsx)("p",{style:yt.error,children:"Maximum 10 tags allowed"})]})}const yt={container:{padding:16,maxWidth:360,margin:"0 auto",fontFamily:"sans-serif"},header:{height:48,display:"flex",alignItems:"center",justifyContent:"space-between",position:"relative",marginBottom:12},headerTitle:{position:"absolute",left:"50%",transform:"translateX(-50%)",margin:0,fontSize:16,fontWeight:600},close:{background:"none",border:"none",fontSize:22,padding:4},publish:{color:"white",border:"none",padding:"6px 16px",borderRadius:20,fontSize:14},textarea:{width:"100%",minHeight:60,border:"none",outline:"none",fontSize:16,marginBottom:14},imageRow:{display:"flex",gap:12,marginBottom:18},imagePreview:{width:100,height:100,borderRadius:18,background:"#f5f5f5",position:"relative",overflow:"hidden"},previewImg:{width:"100%",height:"100%",objectFit:"contain"},removeImg:{position:"absolute",top:4,right:6,background:"rgba(0,0,0,0.6)",color:"white",borderRadius:"50%",padding:"2px 6px",cursor:"pointer",fontSize:13},imageAdd:{width:100,height:100,borderRadius:18,border:"1px dashed #ccc",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},row:{display:"flex",gap:8,justifyContent:"center",marginBottom:14},input:{width:88,height:32,padding:"0 6px",borderRadius:999,border:"1px solid #9e9e9e",outline:"none",fontSize:12,textAlign:"center",background:"white",boxSizing:"border-box"},tagsContainer:{display:"flex",flexWrap:"wrap",gap:8,marginTop:8},tag:{background:"#f1f1f1",padding:"6px 12px",borderRadius:20,display:"flex",alignItems:"center",gap:6,fontSize:13},remove:{cursor:"pointer",fontWeight:"bold"},error:{color:"red",fontSize:12,marginTop:6}};function xt(){const e=ie(),[t,n]=(0,a.useState)("gigs");return(0,tt.jsxs)("div",{style:wt.container,children:[(0,tt.jsx)("div",{style:wt.cover}),(0,tt.jsxs)("div",{style:wt.profileSection,children:[(0,tt.jsx)("div",{style:wt.avatar}),(0,tt.jsxs)("div",{style:wt.buttons,children:[(0,tt.jsx)("button",{style:wt.editBtn,onClick:()=>e("/edit-profile"),children:"Edit profile"}),(0,tt.jsx)("button",{style:wt.subBtn,children:"subscribe"})]}),(0,tt.jsxs)("div",{style:wt.text,children:[(0,tt.jsx)("div",{style:wt.name,children:"freelancer"}),(0,tt.jsx)("div",{style:wt.handle,children:"@freelancerX11"})]})]}),(0,tt.jsx)("p",{style:wt.bio,children:"i'm fullstack developer i help solo devs startup founders and agencies increase productivity and time for them to rest Thank you!"}),(0,tt.jsxs)("div",{style:wt.tabs,children:[(0,tt.jsx)("div",{style:"gigs"===t?wt.activeTab:wt.inactiveTab,onClick:()=>n("gigs"),children:"gigs"}),(0,tt.jsx)("div",{style:"about"===t?wt.activeTab:wt.inactiveTab,onClick:()=>n("about"),children:"about"})]}),"gigs"===t&&(0,tt.jsxs)(tt.Fragment,{children:[(0,tt.jsx)(bt,{title:"i will build landing page",price:"\u20b91500-3000"}),(0,tt.jsx)(bt,{title:"i will debug your python code",price:"\u20b9500-3000"})]}),"about"===t&&(0,tt.jsx)("div",{style:wt.about,children:(0,tt.jsx)("p",{children:"Full-stack developer focused on building clean, scalable products for startups, solo founders, and agencies."})})]})}function bt(e){let{title:t,price:n}=e;return(0,tt.jsxs)("div",{style:wt.gig,children:[(0,tt.jsx)("div",{style:wt.gigAvatar}),(0,tt.jsxs)("div",{style:{flex:1},children:[(0,tt.jsx)("div",{style:wt.gigName,children:"freelancer"}),(0,tt.jsx)("div",{children:t}),(0,tt.jsx)("div",{style:wt.price,children:n})]}),(0,tt.jsx)("div",{style:wt.inbox,children:"\u2709"})]})}const wt={container:{paddingBottom:90,fontFamily:"sans-serif"},cover:{height:150,background:"#000"},profileSection:{padding:"0 16px",marginTop:-40},avatar:{width:80,height:80,borderRadius:"50%",background:"#ddd",border:"4px solid white"},buttons:{display:"flex",gap:10,marginTop:10},editBtn:{padding:"6px 14px",borderRadius:20,border:"1px solid #ccc",background:"white"},subBtn:{padding:"6px 14px",borderRadius:20,border:"none",background:"black",color:"white"},text:{marginTop:10},name:{fontSize:18,fontWeight:"bold"},handle:{color:"#777"},bio:{padding:"14px 16px",lineHeight:1.4},tabs:{display:"flex",gap:20,padding:"0 16px",borderBottom:"1px solid #eee"},activeTab:{fontWeight:"bold",borderBottom:"2px solid black",paddingBottom:6,cursor:"pointer"},inactiveTab:{color:"#999",paddingBottom:6,cursor:"pointer"},gig:{display:"flex",padding:16,borderBottom:"1px solid #eee",alignItems:"center"},gigAvatar:{width:50,height:50,borderRadius:"50%",background:"#ddd",marginRight:12},gigName:{fontWeight:"bold"},price:{marginTop:4},inbox:{fontSize:22},about:{padding:16,lineHeight:1.5}};function Ct(){const[e,t]=(0,a.useState)("chats"),n=ie();return(0,tt.jsxs)("div",{style:kt.page,children:[(0,tt.jsxs)("div",{style:kt.header,children:[(0,tt.jsx)("h2",{style:{margin:0},children:"Inbox"}),(0,tt.jsx)("div",{style:kt.back,onClick:()=>n("/"),children:">"})]}),(0,tt.jsxs)("div",{style:kt.tabs,children:[(0,tt.jsx)("span",{style:"notifications"===e?kt.active:kt.inactive,onClick:()=>t("notifications"),children:"Notifications"}),(0,tt.jsx)("span",{style:"chats"===e?kt.active:kt.inactive,onClick:()=>t("chats"),children:"Chats"})]}),"chats"===e?(0,tt.jsxs)("div",{children:[(0,tt.jsx)(Et,{name:"client_1",msg:"What copy pasting",time:"12:37 PM",onClick:()=>n("/chat/client_1")}),(0,tt.jsx)(Et,{name:"client_2",msg:"Portfolio link",time:"yesterday",onClick:()=>n("/chat/client_2")})]}):(0,tt.jsx)("div",{style:{height:"60vh",background:"#eee"}})]})}function Et(e){let{name:t,msg:n,time:r,onClick:o}=e;return(0,tt.jsxs)("div",{style:kt.chatItem,onClick:o,children:[(0,tt.jsx)("div",{style:kt.avatar}),(0,tt.jsxs)("div",{style:{flex:1},children:[(0,tt.jsx)("div",{style:kt.name,children:t}),(0,tt.jsxs)("div",{style:kt.msg,children:["You: ",n]})]}),(0,tt.jsx)("div",{style:kt.time,children:r})]})}const kt={page:{background:"#fff",minHeight:"100vh"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:12,borderBottom:"1px solid #ddd"},back:{fontSize:24,cursor:"pointer"},tabs:{display:"flex",gap:20,padding:"10px 12px",borderBottom:"1px solid #ddd"},active:{fontWeight:"bold",borderBottom:"2px solid black",cursor:"pointer"},inactive:{color:"#aaa",cursor:"pointer"},chatItem:{display:"flex",alignItems:"center",padding:12,borderBottom:"1px solid #eee",cursor:"pointer"},avatar:{width:40,height:40,borderRadius:"50%",background:"#ccc",marginRight:10},name:{fontWeight:"bold"},msg:{color:"#777",fontSize:14},time:{fontSize:12,color:"#999"}};function St(){const e=ie();return(0,tt.jsxs)("div",{style:Rt.page,children:[(0,tt.jsxs)("div",{style:Rt.header,children:[(0,tt.jsx)("div",{style:Rt.back,onClick:()=>e(-1),children:"\u2039"}),(0,tt.jsx)("div",{style:Rt.title,children:"Inbox"})]}),(0,tt.jsxs)("div",{style:Rt.tabs,children:[(0,tt.jsx)("div",{style:Rt.tabInactive,children:"Notifications"}),(0,tt.jsx)("div",{style:Rt.tabInactive,children:"Chats"})]}),(0,tt.jsx)("div",{style:Rt.body})]})}const Rt={page:{height:"100vh",background:"#fff",display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",padding:"12px",borderBottom:"1px solid #ddd"},back:{fontSize:26,marginRight:10,cursor:"pointer"},title:{fontSize:22,fontWeight:"600"},tabs:{display:"flex",borderBottom:"1px solid #eee"},tabInactive:{flex:1,textAlign:"center",padding:"12px 0",fontSize:16,color:"#aaa"},body:{flex:1,background:"#f1f1f1"}};function It(e){return qe({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"},child:[]}]})(e)}function _t(e){return qe({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M308 96c6.627 0 12-5.373 12-12V44c0-6.627-5.373-12-12-12H12C5.373 32 0 37.373 0 44v44.748c0 6.627 5.373 12 12 12h85.28c27.308 0 48.261 9.958 60.97 27.252H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h158.757c-6.217 36.086-32.961 58.632-74.757 58.632H12c-6.627 0-12 5.373-12 12v53.012c0 3.349 1.4 6.546 3.861 8.818l165.052 152.356a12.001 12.001 0 0 0 8.139 3.182h82.562c10.924 0 16.166-13.408 8.139-20.818L116.871 319.906c76.499-2.34 131.144-53.395 138.318-127.906H308c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-58.69c-3.486-11.541-8.28-22.246-14.252-32H308z"},child:[]}]})(e)}function Nt(e){return qe({tag:"svg",attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M22.436 0l-11.91 7.773-1.174 4.276 6.625-4.297L11.65 24h4.391l6.395-24zM14.26 10.098L3.389 17.166 1.564 24h9.008l3.688-13.902Z"},child:[]}]})(e)}function Tt(e){return qe({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"},child:[]},{tag:"path",attr:{d:"M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"},child:[]}]})(e)}function At(){const e=ie(),t=(0,a.useRef)(null),n=(0,a.useRef)(null),[r,o]=(0,a.useState)(null),[i,s]=(0,a.useState)(null),[u,l]=(0,a.useState)(""),[c,f]=(0,a.useState)(""),[d,h]=(0,a.useState)(""),[p,v]=(0,a.useState)([]),[m,g]=(0,a.useState)(!1),[y,x]=(0,a.useState)({razorpay:"",instamojo:"",upi:"",custom:"",qr:null}),b=[];y.razorpay&&b.push("razorpay"),y.instamojo&&b.push("instamojo"),y.upi&&b.push("upi"),y.custom&&b.push("custom"),y.qr&&b.push("qr");const w=(e,t)=>{const n=new FileReader;n.onload=()=>t(n.result),n.readAsDataURL(e)};return(0,tt.jsxs)("div",{style:Dt.page,children:[(0,tt.jsxs)("div",{style:Dt.header,children:[(0,tt.jsx)(Xe,{size:20,onClick:()=>e(-1)}),(0,tt.jsx)("div",{children:"Edit Profile"}),(0,tt.jsx)("button",{style:Dt.save,children:"Save"})]}),(0,tt.jsxs)("div",{style:mt(mt({},Dt.banner),{},{backgroundImage:r?"url(".concat(r,")"):"none"}),children:[(0,tt.jsx)("button",{type:"button",style:Dt.bannerBtn,onClick:()=>t.current.click(),children:(0,tt.jsx)($e,{})}),(0,tt.jsx)("input",{ref:t,type:"file",accept:"image/*",hidden:!0,onChange:e=>e.target.files[0]&&w(e.target.files[0],o)})]}),(0,tt.jsxs)("div",{style:Dt.avatarWrap,children:[(0,tt.jsx)("div",{style:mt(mt({},Dt.avatar),{},{backgroundImage:i?"url(".concat(i,")"):"none"})}),(0,tt.jsx)("button",{type:"button",style:Dt.avatarBtn,onClick:()=>n.current.click(),children:(0,tt.jsx)($e,{size:14})}),(0,tt.jsx)("input",{ref:n,type:"file",accept:"image/*",hidden:!0,onChange:e=>e.target.files[0]&&w(e.target.files[0],s)})]}),(0,tt.jsx)("input",{style:Dt.input,placeholder:"name --optional",value:u,onChange:e=>l(e.target.value)}),(0,tt.jsx)("p",{style:Dt.hint,children:"this will be displayed to clients and does not change your username"}),(0,tt.jsxs)("div",{style:Dt.keywordBox,children:[p.map(e=>(0,tt.jsxs)("span",{style:Dt.pill,children:[e,(0,tt.jsx)("span",{onClick:()=>(e=>v(p.filter(t=>t!==e)))(e),children:"\xd7"})]},e)),(0,tt.jsx)("input",{style:Dt.keywordInput,placeholder:"add keywords",value:d,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&d.trim()&&(e.preventDefault(),p.includes(d.trim())||v([...p,d.trim()]),h(""))}})]}),(0,tt.jsx)("h4",{children:"Payments method (max 5)"}),(0,tt.jsx)("p",{style:Dt.hint,children:"client can pay using these methods"}),(0,tt.jsxs)("div",{style:Dt.paymentRow,children:[(0,tt.jsx)("button",{style:Dt.addPayBtn,onClick:()=>g(!0),children:"+ add payment"}),b.map(e=>(0,tt.jsxs)("span",{style:Dt.payIcon,children:["razorpay"===e&&(0,tt.jsx)(Nt,{}),"instamojo"===e&&(0,tt.jsx)("img",{src:"/instamojo/instamojo.svg",alt:"instamojo",style:{height:18}}),"upi"===e&&(0,tt.jsx)(_t,{}),"custom"===e&&(0,tt.jsx)(Tt,{}),"qr"===e&&(0,tt.jsx)(It,{})]},e))]}),(0,tt.jsx)("textarea",{style:Dt.desc,placeholder:"description --optional",value:c,onChange:e=>f(e.target.value)}),m&&(0,tt.jsxs)("div",{style:Dt.sheet,children:[(0,tt.jsx)("h3",{children:"Add payment method"}),(0,tt.jsx)("input",{style:Dt.input,placeholder:"Razorpay link",onChange:e=>x(mt(mt({},y),{},{razorpay:e.target.value}))}),(0,tt.jsx)("input",{style:Dt.input,placeholder:"Instamojo link",onChange:e=>x(mt(mt({},y),{},{instamojo:e.target.value}))}),(0,tt.jsx)("input",{style:Dt.input,placeholder:"UPI ID",onChange:e=>x(mt(mt({},y),{},{upi:e.target.value}))}),(0,tt.jsx)("input",{style:Dt.input,placeholder:"Custom payment",onChange:e=>x(mt(mt({},y),{},{custom:e.target.value}))}),(0,tt.jsxs)("label",{style:Dt.qrBox,children:[(0,tt.jsx)(It,{size:34}),(0,tt.jsx)("div",{style:{fontWeight:600},children:"Upload QR code"}),(0,tt.jsx)("span",{style:{fontSize:12,color:"#666"},children:"PNG or JPG"}),(0,tt.jsx)("input",{type:"file",hidden:!0,onChange:e=>e.target.files[0]&&x(mt(mt({},y),{},{qr:e.target.files[0]}))})]}),(0,tt.jsx)("button",{style:Dt.close,onClick:()=>g(!1),children:"Done"})]})]})}const Dt={page:{paddingBottom:140,paddingLeft:16,paddingRight:16},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:14,fontWeight:"bold"},save:{border:"none",padding:"6px 14px",borderRadius:20,background:"#eee"},banner:{height:140,background:"#000",backgroundSize:"cover",backgroundPosition:"center",position:"relative"},bannerBtn:{position:"absolute",right:12,bottom:12,background:"#fff",borderRadius:"50%",padding:8,border:"none"},avatarWrap:{position:"relative",width:90,margin:"-45px auto 10px"},avatar:{width:90,height:90,borderRadius:"50%",background:"#ddd",backgroundSize:"cover",border:"4px solid white"},avatarBtn:{position:"absolute",right:0,bottom:0,background:"#fff",borderRadius:"50%",padding:6,border:"none"},input:{width:"100%",marginTop:10,padding:7,borderRadius:20,background:"#f1f1f1",fontSize:16,border:"none"},desc:{width:"100%",height:120,marginTop:10,padding:7,border:"none",background:"#f1f1f1",fontSize:16,borderRadius:20},hint:{fontSize:12,color:"#777",marginTop:6},keywordBox:{width:"100%",marginTop:10,background:"#f1f1f1",borderRadius:20,padding:7,display:"flex",flexWrap:"wrap",gap:8},pill:{background:"#ddd",padding:"6px 12px",borderRadius:20,display:"flex",gap:6,alignItems:"center"},keywordInput:{border:"none",background:"transparent",flex:1,minWidth:120,outline:"none"},paymentRow:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap",marginTop:10},addPayBtn:{border:"none",padding:"6px 14px",borderRadius:20,background:"#eee"},payIcon:{background:"#eee",padding:8,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},sheet:{position:"fixed",bottom:0,left:0,right:0,background:"#fff",borderTopLeftRadius:20,borderTopRightRadius:20,padding:20,maxHeight:"80vh",overflowY:"auto",zIndex:1e3,paddingBottom:120,border:"2px solid #000",boxShadow:"0 -8px 20px rgba(0,0,0,0.15)"},qrBox:{border:"2px dashed #000",borderRadius:16,padding:24,marginTop:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,background:"#fafafa"},close:{width:"100%",marginTop:16,padding:12,borderRadius:20,border:"none",background:"#000",color:"#fff"}};function Ot(){const e=ie();return(0,tt.jsxs)("div",{style:Ft.page,children:[(0,tt.jsxs)("div",{style:Ft.header,children:[(0,tt.jsx)("span",{style:Ft.back,onClick:()=>e(-1),children:"\u3008"}),(0,tt.jsx)("h2",{style:Ft.title,children:"Search"})]}),(0,tt.jsxs)("div",{style:Ft.searchBox,children:[(0,tt.jsx)("span",{style:Ft.icon,children:"\ud83d\udd0d"}),(0,tt.jsx)("input",{placeholder:"Search gigs",style:Ft.input})]})]})}const Ft={page:{padding:16,fontFamily:"sans-serif",background:"#fff",minHeight:"100vh"},header:{display:"flex",alignItems:"center",gap:10,marginBottom:14},back:{fontSize:22,cursor:"pointer"},title:{margin:0,fontSize:22},searchBox:{display:"flex",alignItems:"center",gap:10,background:"#f2f2f2",padding:"12px 14px",borderRadius:20},icon:{fontSize:16,opacity:.6},input:{border:"none",outline:"none",background:"transparent",width:"100%",fontSize:16}},Pt="https://Linkx1.pythonanywhere.com";function Mt(){const e=ie(),[t,n]=(0,a.useState)(""),[r,o]=(0,a.useState)(""),[i,s]=(0,a.useState)(""),[u,l]=(0,a.useState)(!1);return(0,tt.jsx)("div",{className:"login-wrapper",children:(0,tt.jsxs)("div",{className:"login-card",children:[(0,tt.jsx)("h2",{children:"Login to continue using LinkX"}),(0,tt.jsx)("input",{type:"email",placeholder:"Email",value:t,onChange:e=>n(e.target.value)}),(0,tt.jsx)("input",{type:"password",placeholder:"Password",value:r,onChange:e=>o(e.target.value)}),i&&(0,tt.jsx)("p",{className:"error",children:i}),(0,tt.jsxs)("div",{className:"links",children:[(0,tt.jsx)("span",{onClick:async()=>{if(t){s(""),l(!0);try{const n=await fetch("".concat(Pt,"/api/accounts/forgot-password/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}),r=await n.json();if(!n.ok)return void s((null===r||void 0===r?void 0:r.message)||"User does not exist");sessionStorage.setItem("resetEmail",t),e("/forgot-password")}catch(n){s("Something went wrong")}finally{l(!1)}}else s("Enter email first")},children:"forgot password"}),(0,tt.jsx)("span",{onClick:()=>e("/signup"),children:"i don't have an account signup"})]}),(0,tt.jsx)("button",{onClick:async()=>{s(""),l(!0);try{const n=await fetch("".concat(Pt,"/api/accounts/login/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}),o=await n.json();if(!n.ok||!o.access)return void s((null===o||void 0===o?void 0:o.message)||"Invalid credentials");localStorage.setItem("accessToken",o.access),o.refresh&&localStorage.setItem("refreshToken",o.refresh),localStorage.setItem("username",o.username||"unknown"),localStorage.setItem("email",t),setTimeout(()=>{e("/")},50)}catch(n){s("Server error. Try again.")}finally{l(!1)}},disabled:u,children:u?"Please wait...":"Login"})]})})}function Bt(e,t){return function(){return e.apply(t,arguments)}}const{toString:Lt}=Object.prototype,{getPrototypeOf:Wt}=Object,{iterator:zt,toStringTag:Ut}=Symbol,jt=(Vt=Object.create(null),e=>{const t=Lt.call(e);return Vt[t]||(Vt[t]=t.slice(8,-1).toLowerCase())});var Vt;const Ht=e=>(e=e.toLowerCase(),t=>jt(t)===e),Gt=e=>t=>typeof t===e,{isArray:qt}=Array,Kt=Gt("undefined");function Xt(e){return null!==e&&!Kt(e)&&null!==e.constructor&&!Kt(e.constructor)&&Qt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const $t=Ht("ArrayBuffer");const Yt=Gt("string"),Qt=Gt("function"),Jt=Gt("number"),Zt=e=>null!==e&&"object"===typeof e,en=e=>{if("object"!==jt(e))return!1;const t=Wt(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Ut in e)&&!(zt in e)},tn=Ht("Date"),nn=Ht("File"),rn=Ht("Blob"),on=Ht("FileList"),an=Ht("URLSearchParams"),[sn,un,ln,cn]=["ReadableStream","Request","Response","Headers"].map(Ht);function fn(e,t){let n,r,{allOwnKeys:o=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),qt(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{if(Xt(e))return;const r=o?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let i;for(n=0;n<a;n++)i=r[n],t.call(null,e[i],i,e)}}function dn(e,t){if(Xt(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}const hn="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:n.g,pn=e=>!Kt(e)&&e!==hn;const vn=(mn="undefined"!==typeof Uint8Array&&Wt(Uint8Array),e=>mn&&e instanceof mn);var mn;const gn=Ht("HTMLFormElement"),yn=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),xn=Ht("RegExp"),bn=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};fn(n,(n,o)=>{let a;!1!==(a=t(n,o,e))&&(r[o]=a||n)}),Object.defineProperties(e,r)};const wn=Ht("AsyncFunction"),Cn=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),r=[],hn.addEventListener("message",e=>{let{source:t,data:o}=e;t===hn&&o===n&&r.length&&r.shift()()},!1),e=>{r.push(e),hn.postMessage(n,"*")}):e=>setTimeout(e);var n,r})("function"===typeof setImmediate,Qt(hn.postMessage)),En="undefined"!==typeof queueMicrotask?queueMicrotask.bind(hn):"undefined"!==typeof process&&process.nextTick||Cn,kn={isArray:qt,isArrayBuffer:$t,isBuffer:Xt,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||Qt(e.append)&&("formdata"===(t=jt(e))||"object"===t&&Qt(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&$t(e.buffer),t},isString:Yt,isNumber:Jt,isBoolean:e=>!0===e||!1===e,isObject:Zt,isPlainObject:en,isEmptyObject:e=>{if(!Zt(e)||Xt(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(vo){return!1}},isReadableStream:sn,isRequest:un,isResponse:ln,isHeaders:cn,isUndefined:Kt,isDate:tn,isFile:nn,isBlob:rn,isRegExp:xn,isFunction:Qt,isStream:e=>Zt(e)&&Qt(e.pipe),isURLSearchParams:an,isTypedArray:vn,isFileList:on,forEach:fn,merge:function e(){const{caseless:t,skipUndefined:n}=pn(this)&&this||{},r={},o=(o,a)=>{const i=t&&dn(r,a)||a;en(r[i])&&en(o)?r[i]=e(r[i],o):en(o)?r[i]=e({},o):qt(o)?r[i]=o.slice():n&&Kt(o)||(r[i]=o)};for(let a=0,i=arguments.length;a<i;a++)arguments[a]&&fn(arguments[a],o);return r},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return fn(t,(t,r)=>{n&&Qt(t)?Object.defineProperty(e,r,{value:Bt(t,n),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(e,r,{value:t,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let o,a,i;const s={};if(t=t||{},null==e)return t;do{for(o=Object.getOwnPropertyNames(e),a=o.length;a-- >0;)i=o[a],r&&!r(i,e,t)||s[i]||(t[i]=e[i],s[i]=!0);e=!1!==n&&Wt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:jt,kindOfTest:Ht,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(qt(e))return e;let t=e.length;if(!Jt(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[zt]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:gn,hasOwnProperty:yn,hasOwnProp:yn,reduceDescriptors:bn,freezeMethods:e=>{bn(e,(t,n)=>{if(Qt(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Qt(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return qt(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:dn,global:hn,isContextDefined:pn,isSpecCompliantForm:function(e){return!!(e&&Qt(e.append)&&"FormData"===e[Ut]&&e[zt])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(Zt(e)){if(t.indexOf(e)>=0)return;if(Xt(e))return e;if(!("toJSON"in e)){t[r]=e;const o=qt(e)?[]:{};return fn(e,(e,t)=>{const a=n(e,r+1);!Kt(a)&&(o[t]=a)}),t[r]=void 0,o}}return e};return n(e,0)},isAsyncFn:wn,isThenable:e=>e&&(Zt(e)||Qt(e))&&Qt(e.then)&&Qt(e.catch),setImmediate:Cn,asap:En,isIterable:e=>null!=e&&Qt(e[zt])};class Sn extends Error{static from(e,t,n,r,o,a){const i=new Sn(e.message,t||e.code,n,r,o);return i.cause=e,i.name=e.name,a&&Object.assign(i,a),i}constructor(e,t,n,r,o){super(e),this.name="AxiosError",this.isAxiosError=!0,t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o,this.status=o.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:kn.toJSONObject(this.config),code:this.code,status:this.status}}}Sn.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE",Sn.ERR_BAD_OPTION="ERR_BAD_OPTION",Sn.ECONNABORTED="ECONNABORTED",Sn.ETIMEDOUT="ETIMEDOUT",Sn.ERR_NETWORK="ERR_NETWORK",Sn.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS",Sn.ERR_DEPRECATED="ERR_DEPRECATED",Sn.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE",Sn.ERR_BAD_REQUEST="ERR_BAD_REQUEST",Sn.ERR_CANCELED="ERR_CANCELED",Sn.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT",Sn.ERR_INVALID_URL="ERR_INVALID_URL";const Rn=Sn;function In(e){return kn.isPlainObject(e)||kn.isArray(e)}function _n(e){return kn.endsWith(e,"[]")?e.slice(0,-2):e}function Nn(e,t,n){return e?e.concat(t).map(function(e,t){return e=_n(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const Tn=kn.toFlatObject(kn,{},null,function(e){return/^is[A-Z]/.test(e)});const An=function(e,t,n){if(!kn.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=kn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!kn.isUndefined(t[e])})).metaTokens,o=n.visitor||l,a=n.dots,i=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&kn.isSpecCompliantForm(t);if(!kn.isFunction(o))throw new TypeError("visitor must be a function");function u(e){if(null===e)return"";if(kn.isDate(e))return e.toISOString();if(kn.isBoolean(e))return e.toString();if(!s&&kn.isBlob(e))throw new Rn("Blob is not supported. Use a Buffer instead.");return kn.isArrayBuffer(e)||kn.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,o){let s=e;if(e&&!o&&"object"===typeof e)if(kn.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(kn.isArray(e)&&function(e){return kn.isArray(e)&&!e.some(In)}(e)||(kn.isFileList(e)||kn.endsWith(n,"[]"))&&(s=kn.toArray(e)))return n=_n(n),s.forEach(function(e,r){!kn.isUndefined(e)&&null!==e&&t.append(!0===i?Nn([n],r,a):null===i?n:n+"[]",u(e))}),!1;return!!In(e)||(t.append(Nn(o,n,a),u(e)),!1)}const c=[],f=Object.assign(Tn,{defaultVisitor:l,convertValue:u,isVisitable:In});if(!kn.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!kn.isUndefined(n)){if(-1!==c.indexOf(n))throw Error("Circular reference detected in "+r.join("."));c.push(n),kn.forEach(n,function(n,a){!0===(!(kn.isUndefined(n)||null===n)&&o.call(t,n,kn.isString(a)?a.trim():a,r,f))&&e(n,r?r.concat(a):[a])}),c.pop()}}(e),t};function Dn(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function On(e,t){this._pairs=[],e&&An(e,this,t)}const Fn=On.prototype;Fn.append=function(e,t){this._pairs.push([e,t])},Fn.toString=function(e){const t=e?function(t){return e.call(this,t,Dn)}:Dn;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const Pn=On;function Mn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Bn(e,t,n){if(!t)return e;const r=n&&n.encode||Mn,o=kn.isFunction(n)?{serialize:n}:n,a=o&&o.serialize;let i;if(i=a?a(t,o):kn.isURLSearchParams(t)?t.toString():new Pn(t,o).toString(r),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}const Ln=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){kn.forEach(this.handlers,function(t){null!==t&&e(t)})}},Wn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zn={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Pn,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Un="undefined"!==typeof window&&"undefined"!==typeof document,jn="object"===typeof navigator&&navigator||void 0,Vn=Un&&(!jn||["ReactNative","NativeScript","NS"].indexOf(jn.product)<0),Hn="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Gn=Un&&window.location.href||"http://localhost",qn=mt(mt({},e),zn);const Kn=function(e){function t(e,n,r,o){let a=e[o++];if("__proto__"===a)return!0;const i=Number.isFinite(+a),s=o>=e.length;if(a=!a&&kn.isArray(r)?r.length:a,s)return kn.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!i;r[a]&&kn.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],o)&&kn.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const o=n.length;let a;for(r=0;r<o;r++)a=n[r],t[a]=e[a];return t}(r[a])),!i}if(kn.isFormData(e)&&kn.isFunction(e.entries)){const n={};return kn.forEachEntry(e,(e,r)=>{t(function(e){return kn.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null};const Xn={transitional:Wn,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=kn.isObject(e);o&&kn.isHTMLForm(e)&&(e=new FormData(e));if(kn.isFormData(e))return r?JSON.stringify(Kn(e)):e;if(kn.isArrayBuffer(e)||kn.isBuffer(e)||kn.isStream(e)||kn.isFile(e)||kn.isBlob(e)||kn.isReadableStream(e))return e;if(kn.isArrayBufferView(e))return e.buffer;if(kn.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return An(e,new qn.classes.URLSearchParams,mt({visitor:function(e,t,n,r){return qn.isNode&&kn.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=kn.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return An(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),function(e,t,n){if(kn.isString(e))try{return(t||JSON.parse)(e),kn.trim(e)}catch(vo){if("SyntaxError"!==vo.name)throw vo}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Xn.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(kn.isResponse(e)||kn.isReadableStream(e))return e;if(e&&kn.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(vo){if(n){if("SyntaxError"===vo.name)throw Rn.from(vo,Rn.ERR_BAD_RESPONSE,this,null,this.response);throw vo}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:qn.classes.FormData,Blob:qn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};kn.forEach(["delete","get","head","post","put","patch"],e=>{Xn.headers[e]={}});const $n=Xn,Yn=kn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Qn=Symbol("internals");function Jn(e){return e&&String(e).trim().toLowerCase()}function Zn(e){return!1===e||null==e?e:kn.isArray(e)?e.map(Zn):String(e)}function er(e,t,n,r,o){return kn.isFunction(r)?r.call(this,t,n):(o&&(t=n),kn.isString(t)?kn.isString(r)?-1!==t.indexOf(r):kn.isRegExp(r)?r.test(t):void 0:void 0)}class tr{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function o(e,t,n){const o=Jn(t);if(!o)throw new Error("header name must be a non-empty string");const a=kn.findKey(r,o);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=Zn(e))}const a=(e,t)=>kn.forEach(e,(e,n)=>o(e,n,t));if(kn.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(kn.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let n,r,o;return e&&e.split("\n").forEach(function(e){o=e.indexOf(":"),n=e.substring(0,o).trim().toLowerCase(),r=e.substring(o+1).trim(),!n||t[n]&&Yn[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(kn.isObject(e)&&kn.isIterable(e)){let n,r,o={};for(const t of e){if(!kn.isArray(t))throw TypeError("Object iterator must return a key-value pair");o[r=t[0]]=(n=o[r])?kn.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}a(o,t)}else null!=e&&o(t,e,n);return this}get(e,t){if(e=Jn(e)){const n=kn.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(kn.isFunction(t))return t.call(this,e,n);if(kn.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Jn(e)){const n=kn.findKey(this,e);return!(!n||void 0===this[n]||t&&!er(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function o(e){if(e=Jn(e)){const o=kn.findKey(n,e);!o||t&&!er(0,n[o],o,t)||(delete n[o],r=!0)}}return kn.isArray(e)?e.forEach(o):o(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const o=t[n];e&&!er(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const t=this,n={};return kn.forEach(this,(r,o)=>{const a=kn.findKey(n,o);if(a)return t[a]=Zn(r),void delete t[o];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(o):String(o).trim();i!==o&&delete t[o],t[i]=Zn(r),n[i]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return kn.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&kn.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[Qn]=this[Qn]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Jn(e);t[r]||(!function(e,t){const n=kn.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,o){return this[r].call(this,t,e,n,o)},configurable:!0})})}(n,e),t[r]=!0)}return kn.isArray(e)?e.forEach(r):r(e),this}}tr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),kn.reduceDescriptors(tr.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}}),kn.freezeMethods(tr);const nr=tr;function rr(e,t){const n=this||$n,r=t||n,o=nr.from(r.headers);let a=r.data;return kn.forEach(e,function(e){a=e.call(n,a,o.normalize(),t?t.status:void 0)}),o.normalize(),a}function or(e){return!(!e||!e.__CANCEL__)}const ar=class extends Rn{constructor(e,t,n){super(null==e?"canceled":e,Rn.ERR_CANCELED,t,n),this.name="CanceledError",this.__CANCEL__=!0}};function ir(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Rn("Request failed with status code "+n.status,[Rn.ERR_BAD_REQUEST,Rn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const sr=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let o,a=0,i=0;return t=void 0!==t?t:1e3,function(s){const u=Date.now(),l=r[i];o||(o=u),n[a]=s,r[a]=u;let c=i,f=0;for(;c!==a;)f+=n[c++],c%=e;if(a=(a+1)%e,a===i&&(i=(i+1)%e),u-o<t)return;const d=l&&u-l;return d?Math.round(1e3*f/d):void 0}};const ur=function(e,t){let n,r,o=0,a=1e3/t;const i=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();o=a,n=null,r&&(clearTimeout(r),r=null),e(...t)};return[function(){const e=Date.now(),t=e-o;for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];t>=a?i(u,e):(n=u,r||(r=setTimeout(()=>{r=null,i(n)},a-t)))},()=>n&&i(n)]},lr=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const o=sr(50,250);return ur(n=>{const a=n.loaded,i=n.lengthComputable?n.total:void 0,s=a-r,u=o(s);r=a;e({loaded:a,total:i,progress:i?a/i:void 0,bytes:s,rate:u||void 0,estimated:u&&i&&a<=i?(i-a)/u:void 0,event:n,lengthComputable:null!=i,[t?"download":"upload"]:!0})},n)},cr=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},fr=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return kn.asap(()=>e(...n))},dr=qn.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,qn.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(qn.origin),qn.navigator&&/(msie|trident)/i.test(qn.navigator.userAgent)):()=>!0,hr=qn.hasStandardBrowserEnv?{write(e,t,n,r,o,a,i){if("undefined"===typeof document)return;const s=["".concat(e,"=").concat(encodeURIComponent(t))];kn.isNumber(n)&&s.push("expires=".concat(new Date(n).toUTCString())),kn.isString(r)&&s.push("path=".concat(r)),kn.isString(o)&&s.push("domain=".concat(o)),!0===a&&s.push("secure"),kn.isString(i)&&s.push("SameSite=".concat(i)),document.cookie=s.join("; ")},read(e){if("undefined"===typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function pr(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const vr=e=>e instanceof nr?mt({},e):e;function mr(e,t){t=t||{};const n={};function r(e,t,n,r){return kn.isPlainObject(e)&&kn.isPlainObject(t)?kn.merge.call({caseless:r},e,t):kn.isPlainObject(t)?kn.merge({},t):kn.isArray(t)?t.slice():t}function o(e,t,n,o){return kn.isUndefined(t)?kn.isUndefined(e)?void 0:r(void 0,e,0,o):r(e,t,0,o)}function a(e,t){if(!kn.isUndefined(t))return r(void 0,t)}function i(e,t){return kn.isUndefined(t)?kn.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,o,a){return a in t?r(n,o):a in e?r(void 0,n):void 0}const u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(e,t,n)=>o(vr(e),vr(t),0,!0)};return kn.forEach(Object.keys(mt(mt({},e),t)),function(r){const a=u[r]||o,i=a(e[r],t[r],r);kn.isUndefined(i)&&a!==s||(n[r]=i)}),n}const gr=e=>{const t=mr({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:a,headers:i,auth:s}=t;if(t.headers=i=nr.from(i),t.url=Bn(pr(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&i.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),kn.isFormData(n))if(qn.hasStandardBrowserEnv||qn.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(kn.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[n,r]=e;t.includes(n.toLowerCase())&&i.set(n,r)})}if(qn.hasStandardBrowserEnv&&(r&&kn.isFunction(r)&&(r=r(t)),r||!1!==r&&dr(t.url))){const e=o&&a&&hr.read(a);e&&i.set(o,e)}return t},yr="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=gr(e);let o=r.data;const a=nr.from(r.headers).normalize();let i,s,u,l,c,{responseType:f,onUploadProgress:d,onDownloadProgress:h}=r;function p(){l&&l(),c&&c(),r.cancelToken&&r.cancelToken.unsubscribe(i),r.signal&&r.signal.removeEventListener("abort",i)}let v=new XMLHttpRequest;function m(){if(!v)return;const r=nr.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders());ir(function(e){t(e),p()},function(e){n(e),p()},{data:f&&"text"!==f&&"json"!==f?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:r,config:e,request:v}),v=null}v.open(r.method.toUpperCase(),r.url,!0),v.timeout=r.timeout,"onloadend"in v?v.onloadend=m:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(m)},v.onabort=function(){v&&(n(new Rn("Request aborted",Rn.ECONNABORTED,e,v)),v=null)},v.onerror=function(t){const r=t&&t.message?t.message:"Network Error",o=new Rn(r,Rn.ERR_NETWORK,e,v);o.event=t||null,n(o),v=null},v.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const o=r.transitional||Wn;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new Rn(t,o.clarifyTimeoutError?Rn.ETIMEDOUT:Rn.ECONNABORTED,e,v)),v=null},void 0===o&&a.setContentType(null),"setRequestHeader"in v&&kn.forEach(a.toJSON(),function(e,t){v.setRequestHeader(t,e)}),kn.isUndefined(r.withCredentials)||(v.withCredentials=!!r.withCredentials),f&&"json"!==f&&(v.responseType=r.responseType),h&&([u,c]=lr(h,!0),v.addEventListener("progress",u)),d&&v.upload&&([s,l]=lr(d),v.upload.addEventListener("progress",s),v.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(i=t=>{v&&(n(!t||t.type?new ar(null,e,v):t),v.abort(),v=null)},r.cancelToken&&r.cancelToken.subscribe(i),r.signal&&(r.signal.aborted?i():r.signal.addEventListener("abort",i)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);g&&-1===qn.protocols.indexOf(g)?n(new Rn("Unsupported protocol "+g+":",Rn.ERR_BAD_REQUEST,e)):v.send(o||null)})},xr=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const o=function(e){if(!n){n=!0,i();const t=e instanceof Error?e:this.reason;r.abort(t instanceof Rn?t:new ar(t instanceof Error?t.message:t))}};let a=t&&setTimeout(()=>{a=null,o(new Rn("timeout of ".concat(t,"ms exceeded"),Rn.ETIMEDOUT))},t);const i=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(o):e.removeEventListener("abort",o)}),e=null)};e.forEach(e=>e.addEventListener("abort",o));const{signal:s}=r;return s.unsubscribe=()=>kn.asap(i),s}};function br(e,t){this.v=e,this.k=t}function wr(e){return function(){return new Cr(e.apply(this,arguments))}}function Cr(e){var t,n;function r(t,n){try{var a=e[t](n),i=a.value,s=i instanceof br;Promise.resolve(s?i.v:i).then(function(n){if(s){var u="return"===t?"return":"next";if(!i.k||n.done)return r(u,n);n=e[u](n).value}o(a.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){o("throw",e)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,o){return new Promise(function(a,i){var s={key:e,arg:o,resolve:a,reject:i,next:null};n?n=n.next=s:(t=n=s,r(e,o))})},"function"!=typeof e.return&&(this.return=void 0)}function Er(e){return new br(e,0)}function kr(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise(function(n){n(e[t](r))}),{done:!1,value:new br(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function Sr(e){var t,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Rr(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Rr(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Rr=function(e){this.s=e,this.n=e.next},Rr.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Rr(e)}Cr.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Cr.prototype.next=function(e){return this._invoke("next",e)},Cr.prototype.throw=function(e){return this._invoke("throw",e)},Cr.prototype.return=function(e){return this._invoke("return",e)};const Ir=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,o=0;for(;o<n;)r=o+t,yield e.slice(o,r),o=r},_r=function(){var e=wr(function*(e,t){var n,r=!1,o=!1;try{for(var a,i=Sr(Nr(e));r=!(a=yield Er(i.next())).done;r=!1){const e=a.value;yield*kr(Sr(Ir(e,t)))}}catch(s){o=!0,n=s}finally{try{r&&null!=i.return&&(yield Er(i.return()))}finally{if(o)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),Nr=function(){var e=wr(function*(e){if(e[Symbol.asyncIterator])return void(yield*kr(Sr(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield Er(t.read());if(e)break;yield n}}finally{yield Er(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Tr=(e,t,n,r)=>{const o=_r(e,t);let a,i=0,s=e=>{a||(a=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await o.next();if(t)return s(),void e.close();let a=r.byteLength;if(n){let e=i+=a;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw s(t),t}},cancel:e=>(s(e),o.return())},{highWaterMark:2})},{isFunction:Ar}=kn,Dr=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(kn.global),{ReadableStream:Or,TextEncoder:Fr}=kn.global,Pr=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(vo){return!1}},Mr=e=>{e=kn.merge.call({skipUndefined:!0},Dr,e);const{fetch:t,Request:n,Response:r}=e,o=t?Ar(t):"function"===typeof fetch,a=Ar(n),i=Ar(r);if(!o)return!1;const s=o&&Ar(Or),u=o&&("function"===typeof Fr?(l=new Fr,e=>l.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var l;const c=a&&s&&Pr(()=>{let e=!1;const t=new n(qn.origin,{body:new Or,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),f=i&&s&&Pr(()=>kn.isReadableStream(new r("").body)),d={stream:f&&(e=>e.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!d[e]&&(d[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new Rn("Response type '".concat(e,"' is not supported"),Rn.ERR_NOT_SUPPORT,n)})});const h=async(e,t)=>{const r=kn.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(kn.isBlob(e))return e.size;if(kn.isSpecCompliantForm(e)){const t=new n(qn.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return kn.isArrayBufferView(e)||kn.isArrayBuffer(e)?e.byteLength:(kn.isURLSearchParams(e)&&(e+=""),kn.isString(e)?(await u(e)).byteLength:void 0)})(t):r};return async e=>{let{url:o,method:i,data:s,signal:u,cancelToken:l,timeout:p,onDownloadProgress:v,onUploadProgress:m,responseType:g,headers:y,withCredentials:x="same-origin",fetchOptions:b}=gr(e),w=t||fetch;g=g?(g+"").toLowerCase():"text";let C=xr([u,l&&l.toAbortSignal()],p),E=null;const k=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let S;try{if(m&&c&&"get"!==i&&"head"!==i&&0!==(S=await h(y,s))){let e,t=new n(o,{method:"POST",body:s,duplex:"half"});if(kn.isFormData(s)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,n]=cr(S,lr(fr(m)));s=Tr(t.body,65536,e,n)}}kn.isString(x)||(x=x?"include":"omit");const t=a&&"credentials"in n.prototype,u=mt(mt({},b),{},{signal:C,method:i.toUpperCase(),headers:y.normalize().toJSON(),body:s,duplex:"half",credentials:t?x:void 0});E=a&&new n(o,u);let l=await(a?w(E,b):w(o,u));const p=f&&("stream"===g||"response"===g);if(f&&(v||p&&k)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=l[t]});const t=kn.toFiniteNumber(l.headers.get("content-length")),[n,o]=v&&cr(t,lr(fr(v),!0))||[];l=new r(Tr(l.body,65536,n,()=>{o&&o(),k&&k()}),e)}g=g||"text";let R=await d[kn.findKey(d,g)||"text"](l,e);return!p&&k&&k(),await new Promise((t,n)=>{ir(t,n,{data:R,headers:nr.from(l.headers),status:l.status,statusText:l.statusText,config:e,request:E})})}catch(R){if(k&&k(),R&&"TypeError"===R.name&&/Load failed|fetch/i.test(R.message))throw Object.assign(new Rn("Network Error",Rn.ERR_NETWORK,e,E),{cause:R.cause||R});throw Rn.from(R,R&&R.code,e,E)}}},Br=new Map,Lr=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:o}=t,a=[r,o,n];let i,s,u=a.length,l=Br;for(;u--;)i=a[u],s=l.get(i),void 0===s&&l.set(i,s=u?new Map:Mr(t)),l=s;return s},Wr=(Lr(),{http:null,xhr:yr,fetch:{get:Lr}});kn.forEach(Wr,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(vo){}Object.defineProperty(e,"adapterName",{value:t})}});const zr=e=>"- ".concat(e),Ur=e=>kn.isFunction(e)||null===e||!1===e;const jr={getAdapter:function(e,t){e=kn.isArray(e)?e:[e];const{length:n}=e;let r,o;const a={};for(let i=0;i<n;i++){let n;if(r=e[i],o=r,!Ur(r)&&(o=Wr[(n=String(r)).toLowerCase()],void 0===o))throw new Rn("Unknown adapter '".concat(n,"'"));if(o&&(kn.isFunction(o)||(o=o.get(t))))break;a[n||"#"+i]=o}if(!o){const e=Object.entries(a).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});let t=n?e.length>1?"since :\n"+e.map(zr).join("\n"):" "+zr(e[0]):"as no adapter specified";throw new Rn("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return o},adapters:Wr};function Vr(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ar(null,e)}function Hr(e){Vr(e),e.headers=nr.from(e.headers),e.data=rr.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return jr.getAdapter(e.adapter||$n.adapter,e)(e).then(function(t){return Vr(e),t.data=rr.call(e,e.transformResponse,t),t.headers=nr.from(t.headers),t},function(t){return or(t)||(Vr(e),t&&t.response&&(t.response.data=rr.call(e,e.transformResponse,t.response),t.response.headers=nr.from(t.response.headers))),Promise.reject(t)})}const Gr="1.13.4",qr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{qr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Kr={};qr.transitional=function(e,t,n){function r(e,t){return"[Axios v"+Gr+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,o,a)=>{if(!1===e)throw new Rn(r(o," has been removed"+(t?" in "+t:"")),Rn.ERR_DEPRECATED);return t&&!Kr[o]&&(Kr[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}},qr.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const Xr={assertOptions:function(e,t,n){if("object"!==typeof e)throw new Rn("options must be an object",Rn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const a=r[o],i=t[a];if(i){const t=e[a],n=void 0===t||i(t,a,e);if(!0!==n)throw new Rn("option "+a+" must be "+n,Rn.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new Rn("Unknown option "+a,Rn.ERR_BAD_OPTION)}},validators:qr},$r=Xr.validators;class Yr{constructor(e){this.defaults=e||{},this.interceptors={request:new Ln,response:new Ln}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(vo){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=mr(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;void 0!==n&&Xr.assertOptions(n,{silentJSONParsing:$r.transitional($r.boolean),forcedJSONParsing:$r.transitional($r.boolean),clarifyTimeoutError:$r.transitional($r.boolean)},!1),null!=r&&(kn.isFunction(r)?t.paramsSerializer={serialize:r}:Xr.assertOptions(r,{encode:$r.function,serialize:$r.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Xr.assertOptions(t,{baseUrl:$r.spelling("baseURL"),withXsrfToken:$r.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&kn.merge(o.common,o[t.method]);o&&kn.forEach(["delete","get","head","post","put","patch","common"],e=>{delete o[e]}),t.headers=nr.concat(a,o);const i=[];let s=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});const u=[];let l;this.interceptors.response.forEach(function(e){u.push(e.fulfilled,e.rejected)});let c,f=0;if(!s){const e=[Hr.bind(this),void 0];for(e.unshift(...i),e.push(...u),c=e.length,l=Promise.resolve(t);f<c;)l=l.then(e[f++],e[f++]);return l}c=i.length;let d=t;for(;f<c;){const e=i[f++],t=i[f++];try{d=e(d)}catch(h){t.call(this,h);break}}try{l=Hr.call(this,d)}catch(h){return Promise.reject(h)}for(f=0,c=u.length;f<c;)l=l.then(u[f++],u[f++]);return l}getUri(e){return Bn(pr((e=mr(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}kn.forEach(["delete","get","head","options"],function(e){Yr.prototype[e]=function(t,n){return this.request(mr(n||{},{method:e,url:t,data:(n||{}).data}))}}),kn.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,o){return this.request(mr(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Yr.prototype[e]=t(),Yr.prototype[e+"Form"]=t(!0)});const Qr=Yr;class Jr{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,o){n.reason||(n.reason=new ar(e,r,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new Jr(function(t){e=t});return{token:t,cancel:e}}}const Zr=Jr;const eo={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(eo).forEach(e=>{let[t,n]=e;eo[n]=t});const to=eo;const no=function e(t){const n=new Qr(t),r=Bt(Qr.prototype.request,n);return kn.extend(r,Qr.prototype,n,{allOwnKeys:!0}),kn.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(mr(t,n))},r}($n);no.Axios=Qr,no.CanceledError=ar,no.CancelToken=Zr,no.isCancel=or,no.VERSION=Gr,no.toFormData=An,no.AxiosError=Rn,no.Cancel=no.CanceledError,no.all=function(e){return Promise.all(e)},no.spread=function(e){return function(t){return e.apply(null,t)}},no.isAxiosError=function(e){return kn.isObject(e)&&!0===e.isAxiosError},no.mergeConfig=mr,no.AxiosHeaders=nr,no.formToJSON=e=>Kn(kn.isHTMLForm(e)?new FormData(e):e),no.getAdapter=jr.getAdapter,no.HttpStatusCode=to,no.default=no;const ro=no,oo=ro.create({baseURL:"https://linkx1.pythonanywhere.com",headers:{"Content-Type":"application/json"},withCredentials:!0}),ao=()=>{const e=ie(),[t,n]=(0,a.useState)({username:"",email:"",password:"",agree:!1}),r=e=>{const{name:t,value:r,type:o,checked:a}=e.target;n(e=>mt(mt({},e),{},{[t]:"checkbox"===o?a:r}))};return(0,tt.jsx)("div",{className:"signup-wrapper",children:(0,tt.jsxs)("div",{className:"signup-card",children:[(0,tt.jsx)("h2",{children:"Sign up"}),(0,tt.jsx)("input",{name:"username",placeholder:"Username",value:t.username,onChange:r}),(0,tt.jsx)("input",{name:"email",placeholder:"Email",value:t.email,onChange:r}),(0,tt.jsx)("input",{name:"password",type:"password",placeholder:"Create password",value:t.password,onChange:r}),(0,tt.jsxs)("label",{children:[(0,tt.jsx)("input",{type:"checkbox",name:"agree",checked:t.agree,onChange:r}),"I agree to LinkX terms"]}),(0,tt.jsx)("button",{onClick:async()=>{if(t.username&&t.email&&t.password)if(t.agree)try{const n=await oo.post("/api/accounts/send-signup-otp/",{email:t.email.trim(),username:t.username.trim(),password:t.password});console.log("OTP sent:",n.data),sessionStorage.setItem("email",t.email.trim()),e("/verify-otp")}catch(r){var n;console.log("FULL ERROR:",r),console.log("FULL ERROR:",r.response),alert(JSON.stringify((null===(n=r.response)||void 0===n?void 0:n.data)||r.message,null,2))}else alert("You must agree to LinkX user agreement");else alert("All fields are required")},children:"Send OTP"})]})})};ro.defaults.baseURL="https://Linkx1.pythonanywhere.com",ro.defaults.withCredentials=!0;const io=()=>{const e=ie(),t=sessionStorage.getItem("email"),[n,r]=(0,a.useState)(["","","",""]),o=(0,a.useRef)([]);return(0,tt.jsxs)("div",{children:[(0,tt.jsxs)("p",{children:["OTP sent to ",t]}),(0,tt.jsx)("div",{style:{display:"flex",gap:"10px"},children:n.map((e,t)=>(0,tt.jsx)("input",{ref:e=>o.current[t]=e,value:e,onChange:e=>((e,t)=>{if(!/^\d?$/.test(e))return;const a=[...n];var i;a[t]=e,r(a),e&&t<3&&(null===(i=o.current[t+1])||void 0===i||i.focus())})(e.target.value,t),maxLength:1,style:{width:"50px",height:"50px",textAlign:"center"}},t))}),(0,tt.jsx)("button",{onClick:async()=>{const r=n.join("");if(4===r.length)try{await ro.post("/api/accounts/verify-signup-otp/",{email:t,otp:r}),e("/FaceVerification")}catch(i){var o,a;alert((null===(o=i.response)||void 0===o||null===(a=o.data)||void 0===a?void 0:a.error)||"OTP verification failed")}else alert("Enter complete OTP")},children:"Verify OTP"})]})};var so=function(e,t){return so=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},so(e,t)};function uo(e,t){function n(){this.constructor=e}so(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var lo=function(){return lo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},lo.apply(this,arguments)};function co(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(vo){a(vo)}}function s(e){try{u(r.throw(e))}catch(vo){a(vo)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})}function fo(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(vo){a=[6,vo],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function ho(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}var po=function(e,t){return(po=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function vo(e,t){function n(){this.constructor=e}po(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var mo=function(){return(mo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function go(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function yo(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var xo=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=bo(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],o=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,o)})}},e}();function bo(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")}),t}var wo=null;function Co(e){wo=e}Object.freeze({Environment:xo,getQueryParams:bo,get ENV(){return wo},setEnvironmentGlobal:Co});function Eo(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function ko(e,t,n){return Math.max(e,Math.min(t,n))}function So(e){return e%2==0?e:e+1}function Ro(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function Io(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function _o(e,t,n){void 0===n&&(n=""),Io(Do(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function No(e){Io(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function To(e,t){if(void 0===t&&(t=[]),null==t&&(t=[]),Array.isArray(e)||Ko(e))for(var n=0;n<e.length;++n)To(e[n],t);else t.push(e);return t}function Ao(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Do(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Oo(e){return e%1==0}function Fo(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Po(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Mo(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Bo(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{var s=t(++a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function Lo(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function Wo(e,t){var n=t.length;return Io((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),Io(e.every(function(e){return Oo(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function zo(e,t){for(var n=[],r=[],o=null==t?null:Wo(t,e).sort(),a=0,i=0;i<e.length;++i){if(null!=o){if(o[a]===i&&1!==e[i])throw new Error("Can't squeeze axis "+i+" since its dim '"+e[i]+"' is not 1");(null==o[a]||o[a]>i)&&1===e[i]&&(n.push(e[i]),r.push(i)),o[a]<=i&&a++}1!==e[i]&&(n.push(e[i]),r.push(i))}return{newShape:n,keptDims:r}}function Uo(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function jo(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Vo(e,t,n){if("float32"===t)for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+n+"' is "+o+".")}}function Ho(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Go(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function qo(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function Ko(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Xo(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function $o(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=2*e.length}),t}function Yo(e){return"string"==typeof e||e instanceof String}function Qo(e){return"boolean"==typeof e}function Jo(e){return"number"==typeof e}function Zo(e){return Array.isArray(e)?Zo(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Jo(e)?"float32":Yo(e)?"string":Qo(e)?"bool":"float32"}function ea(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ta(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function na(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function ra(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=To(e)),n&&Ho(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function oa(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[t+i];else{a=n[0];var s=n.slice(1),u=s.reduce(function(e,t){return e*t});for(i=0;i<a;i++)o[i]=e(t+i*u,s,r)}return o}(0,e,t)}function aa(e,t){for(var n=ia(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ia(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function sa(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof process){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function ua(e){e.forEach(function(t){Io(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function la(e,t){return wo.platform.fetch(e,t)}Object.freeze({shuffle:Eo,clamp:ko,nearestLargerEven:So,sum:Ro,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:Io,assertShapesMatch:_o,assertNonNull:No,flatten:To,sizeFromShape:Ao,isScalarShape:function(e){return 0===e.length},arraysEqual:Do,isInt:Oo,tanh:Fo,sizeToSquarishShape:Po,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return Eo(t),t},rightPad:Mo,repeatedTry:Bo,inferFromImplicitShape:Lo,parseAxisParam:Wo,squeezeShape:zo,getTypedArrayFromDType:Uo,getArrayFromDType:jo,checkComputationForErrors:Vo,checkConversionForErrors:Ho,isValidDtype:Go,hasEncodingLoss:qo,isTypedArray:Ko,bytesPerElement:Xo,bytesFromStringArray:$o,isString:Yo,isBoolean:Qo,isNumber:Jo,inferDtype:Zo,isFunction:ea,nearestDivisor:ta,computeStrides:na,toTypedArray:ra,toNestedArray:oa,makeOnesTypedArray:aa,makeZerosTypedArray:ia,now:sa,assertNonNegativeIntegerDimensions:ua,fetch:la});var ca=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new fa)}return e.prototype.profileKernel=function(e,t){var n,r=this,o=this.backendTimer.time(function(){n=t()});return(Array.isArray(n)?n:[n]).forEach(function(t){var n=t.dataSync();Vo(n,t.dtype,e),o.then(function(o){var a="";null!=o.getExtraProfileInfo&&(a=o.getExtraProfileInfo()),r.logger.logKernelProfile(e,t,n,o.kernelMs,a)})}),n},e}(),fa=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o){var a=Mo(r+"ms",9),i=Mo(e,25),s=t.rank,u=t.size,l=Mo(t.shape.toString(),14);console.log("%c"+i+"\t%c"+a+"\t%c"+s+"D "+l+"\t%c"+u+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},e}();function da(e,t,n){return Mo(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Yo(e)?"'"+e+"'":"bool"===n?ha(e):parseFloat(e.toFixed(7)).toString(),t)}function ha(e){return 0===e?"false":"true"}function pa(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var va=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=Ao(e),null!=n){var o=n.length;Io(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||jo(t,this.size),this.strides=na(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Io(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return xa.make(this.shape,{values:this.values},this.dtype)},e}(),ma=null,ga=null,ya=null,xa=function(){function e(e,t,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ao(e),this.strides=na(e),this.dataId=null!=r?r:{},this.id=ma().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",ma().registerTensor(this,o),null!=n&&ma().write(o,this.dataId,n)}return e.make=function(t,n,r,o){return new e(t,r,n.values,n.dataId,o)},e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),Io(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),ga.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return go(this,void 0,void 0,function(){var e;return yo(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ga.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return ga.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return go(this,void 0,void 0,function(){var e;return yo(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,oa(this.shape,e)]}})})},e.prototype.arraySync=function(){return oa(this.shape,this.dataSync())},e.prototype.data=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){return this.throwIfDisposed(),[2,ma().read(this.dataId)]})})},e.prototype.dataSync=function(){return this.throwIfDisposed(),ma().readSync(this.dataId)},e.prototype.dispose=function(){this.isDisposed||(ma().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ga.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ga.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ga.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ga.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ga.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ga.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),ga.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var o=na(t),a=function(e,t,n,r){var o=Ao(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?pa(e):e;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,f=0;f<a;f++)i[f]=Math.max(i[f],da(u[c+f],0,n).length);return i}(e,t,n,o),i=t.length,s=function e(t,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[da(pa(t)[0],0,r)]:"bool"===r?[ha(t[0])]:[t[0].toString()];if(1===l){if(u>20){var c=3*s,f=Array.from(t.slice(0,c)),d=Array.from(t.slice(u-3*s,u));return"complex64"===r&&(f=pa(f),d=pa(d)),["["+f.map(function(e,t){return da(e,a[t],r)}).join(", ")+", ..., "+d.map(function(e,t){return da(e,a[u-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?pa(t):Array.from(t)).map(function(e,t){return da(e,a[t],r)}).join(", ")+"]"]}var h=n.slice(1),p=o.slice(1),v=o[0]*s,m=[];if(u>20){for(var g=0;g<3;g++){var y=(x=g*v)+v;m.push.apply(m,e(t.slice(x,y),h,r,p,a,!1))}for(m.push("..."),g=u-3;g<u;g++)y=(x=g*v)+v,m.push.apply(m,e(t.slice(x,y),h,r,p,a,g===u-1))}else for(g=0;g<u;g++){var x;y=(x=g*v)+v,m.push.apply(m,e(t.slice(x,y),h,r,p,a,g===u-1))}var b=2===l?",":"";for(m[0]="["+m[0]+b,g=1;g<m.length-1;g++)m[g]=" "+m[g]+b;var w=",\n";for(g=2;g<l;g++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":w),m}(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),ga.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ga.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ga.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ga.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ga.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ga.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ga.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ga.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ga.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ga.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ga.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),ga.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),ya("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.batchNorm=function(e,t,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),ga.batchNorm(this,e,t,n,r,o)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ga.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ga.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ga.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ga.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),ga.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ga.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ga.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ga.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ga.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ga.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ga.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ga.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ga.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),ga.div(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ga.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ga.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ga.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ga.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ga.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ga.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ga.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ga.modStrict(this,e)},e.prototype.squaredDifference=function(e){return this.throwIfDisposed(),ga.squaredDifference(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ga.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),ga.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ga.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ga.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ga.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ga.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ga.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ga.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ga.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ga.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ga.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ga.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ga.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ga.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ga.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ga.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ga.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ga.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ga.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ga.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ga.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ga.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ga.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),ga.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),ga.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),ga.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ga.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ga.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ga.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ga.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ga.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ga.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ga.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ga.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ga.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ga.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ga.relu(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ga.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ga.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ga.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ga.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ga.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ga.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ga.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ga.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ga.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ga.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ga.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ga.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ga.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ga.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ga.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ga.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ga.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ga.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ga.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ga.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ga.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ga.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ga.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ga.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ga.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ga.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ga.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ga.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),ga.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ga.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),ga.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ga.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),ga.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ga.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ga.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ga.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),ga.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),ba.variable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ga.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ga.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ga.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ga.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),ga.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ga.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ga.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ga.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ga.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ga.spectral.irfft(this)},e}();Object.defineProperty(xa,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var ba=function(e){function t(t,n,r){void 0===n&&(n=!0);var o=e.call(this,t.shape,t.dtype,null,t.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=ma().nextVariableId().toString());try{ma().registerVariable(o)}catch(e){throw ma().disposeTensor(o),e}return o}return vo(t,e),t.variable=function(e,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==e.dtype&&(e=e.asType(o)),new t(e,n,r)},t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Do(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");ma().disposeTensor(this),this.dataId=e.dataId,ma().registerTensor(this)},t.prototype.dispose=function(){ma().disposeVariable(this),this.isDisposedInternal=!0},t}(xa);Object.defineProperty(ba,Symbol.hasInstance,{value:function(e){return e instanceof xa&&null!=e.assign&&e.assign instanceof Function}});var wa,Ca,Ea,ka,Sa;ba.variable;!function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(wa||(wa={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ca||(Ca={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Ea||(Ea={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(ka||(ka={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Sa||(Sa={}));var Ra={float32:ka,int32:Ca,bool:Ea,complex64:Sa};function Ia(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Ra[e][t]}function _a(e){return Ia(e,"int32")}function Na(e,t){if(e.dtype===t.dtype)return[e,t];var n=Ia(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ta(e,t){Io(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function Aa(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof xa)n.push(t);else if(o=t,Array.isArray(o)||"object"==typeof o){var o,a=t;for(var i in a){var s=a[i];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:Na,assertTypesMatch:Ta,isTensorInList:function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1},getTensorsInContainer:Aa});var Da,Oa=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Fa=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Oa}return e.prototype.ready=function(){return go(this,void 0,void 0,function(){var e,t,n;return yo(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return go(this,void 0,void 0,function(){var t,n,r;return yo(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.profiler=new ca(this.backendInstance),[2,!0]}})})},e.prototype.initializeBackend=function(e){var t=this,n=Pa.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then(function(n){return!(o<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)}).catch(function(n){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){this.write(e,t,this.readSync(t))},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=xa.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(e){return[e.toFloat()]}),t},e.prototype.runKernel=function(e,t,n){var r,o=this,a=[],i=this.isTapeOn(),s=null!=this.state.activeScope?this.state.activeScope.name:"",u=function(e){i&&(a=e.map(function(e){return o.keep(o.clone(e))}))},l=this.state.numBytes,c=this.state.numTensors;if(this.scopedRun(function(){return o.state.kernelDepth++},function(){return o.state.kernelDepth--},function(){r=o.ENV.getBool("DEBUG")?o.profiler.profileKernel(s,function(){return e(o.backend,u)}):e(o.backend,u)}),i){var f={id:this.state.nextTapeNodeId++,name:s,inputs:t,outputs:Array.isArray(r)?r:[r],saved:a};null!=n&&(f.gradient=function(e){return n(e,a)}),this.state.activeTape.push(f)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-l,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-c,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShape:Array.isArray(r)?r.map(function(e){return e.shape}):r.shape}),r},e.prototype.registerTensor=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Xo(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:null!=t?t:this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r,null!=t?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof ba||this.track(e)},e.prototype.registerVariable=function(e){if(null!=this.state.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.state.registeredVariables[e.name]=e},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return go(this,void 0,void 0,function(){var t,n;return yo(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n){var r={};e.forEach(function(e,t){r[t]=e});var o={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:r,outputs:[t],gradient:function(e){var t=n(e),r={};return t.forEach(function(e,t){r[t]=function(){return e}}),r}};this.state.activeTape.push(o)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Aa(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==i.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),Io(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});Io(a instanceof xa,function(){return"The result y returned by f() must be a tensor."});var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(p=e[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){p.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,o[p.id]=!0;break}if(l)break}}var f={};f[n.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(i=(p=e[a]).inputs,c=0;c<p.outputs.length;c++)if(f[p.outputs[c].id]){for(var s in i)f[i[s].id]=!0,d[p.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var p;if(o[(p=e[a]).id]&&d[p.id]){var v={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,h.push(g)}}return h}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[a.id]=null==n?(r=aa(Ao(e=a.shape),"float32"),xa.make(e,{values:r})):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach(function(t){var n=e[t.id];if(null!=n)a.push(n);else{var r=xa.make(t.shape,{values:ia(t.size,t.dtype)},t.dtype);a.push(r)}}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var i=o.gradient(1===o.outputs.length?a[0]:a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n(function(){return i[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.name+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!Do(r.shape,a.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(s,i,function(e){return o.tidy(e)});var u=t.map(function(e){return s[e.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(e){for(var t in e.saved)e.saved[t].dispose()}),o.state.activeTape=null),{value:a,grads:u}})},e.prototype.customGrad=function(e){var t=this;return Io(ea(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Io(r.every(function(e){return e instanceof xa}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return r.forEach(function(e,t){a[t]=e}),t.runKernel(function(t,o){return Io((n=e.apply(void 0,r.concat([o]))).value instanceof xa,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Io(ea(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];Io(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Io(a.every(function(e){return e instanceof xa}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(e,t){i[t]=function(){return e}}),i})}},e.prototype.write=function(e,t,n){var r=this.state.tensorInfo.get(t),o=r.backend;if(e=e||this.backend,"string"===r.dtype){var a=$o(n);this.state.numBytes+=a-r.bytes,r.bytes=a}e!==o&&(o.disposeData(t),r.backend=e,e.register(t,r.shape,r.dtype)),e.write(t,n)},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},e.prototype.time=function(e){return go(this,void 0,void 0,function(){var t,n;return yo(this,function(r){switch(r.label){case 0:return t=sa(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=sa()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Oa,this.registry)this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),Pa=function(){var e=function(){if(null==Da){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Da=e}return Da}();if(null==e._tfengine){var t=new xo(e);e._tfengine=new Fa(t)}return Co(e._tfengine.ENV),ma=function(){return e._tfengine},e._tfengine}();function Ma(){return"undefined"!=typeof window||"undefined"!=typeof WorkerGlobalScope}wo.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),wo.registerFlag("IS_BROWSER",function(){return Ma()}),wo.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),wo.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),wo.registerFlag("PROD",function(){return!1}),wo.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return wo.getBool("DEBUG")}),wo.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),wo.registerFlag("IS_TEST",function(){return!1});var Ba={},La={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Wa(e,t){Ba[e]=t}function za(e){e in Ba||(Ba[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Ba[e]},!1),1===e?t.getContext("webgl",La)||t.getContext("experimental-webgl",La):t.getContext("webgl2",La)}(e));var t=Ba[e];return t.isContextLost()?(delete Ba[e],za(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ba[e])}function Ua(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Va(e,t))}(e),r}function ja(e){return!!(wo.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Va(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Ha(e,t,n){return hi(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Ga(e,t,n){var r=hi(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Ua(e,t,function(){return e.shaderSource(r,n)}),Ua(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function qa(e,t,n){var r=hi(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Ua(e,t,function(){return e.shaderSource(r,n)}),Ua(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=$a.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map(function(e,t){return Mo((t+1).toString(),a)+e}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),f=i.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+Mo(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Ka,Xa,$a=/ERROR: [0-9]+:([0-9]+):/g;function Ya(e,t){return hi(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function Qa(e,t,n){if(Ua(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Ja(e,t,n){if(Ua(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function Za(e,t,n){var r=hi(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Ua(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Ua(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function ei(e,t,n){var r=hi(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Ua(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),Ua(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function ti(e,t){return hi(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function ni(e,t){var n=wo.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function ri(e,t){return hi(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function oi(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Ua(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),Ua(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),Ua(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function ai(e,t,n,r){pi(e,r),Ua(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),Ua(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function ii(e,t,n,r){return hi(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function si(e,t,n){return e.getUniformLocation(t,n)}function ui(e,t,n,r,o,a){Ua(e,t,function(){return ai(e,t,r,a)}),Ua(e,t,function(){return e.uniform1i(o,a)})}function li(e,t,n,r){Ua(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),Ua(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function ci(e,t,n){Ua(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),Ua(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function fi(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+di(e,t))}function di(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function hi(e,t,n,r){var o=Ua(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function pi(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function vi(e,t){return void 0===t&&(t=2),Ao(e.slice(0,e.length-t))}function mi(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function gi(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[vi(e)].concat(mi(e))),t}function yi(e,t){var n;void 0===t&&(t=!1);var r=wo.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?So(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=zo(e);e=o.newShape}var a=Ao(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=vi(e),s=2,u=2;return e.length&&(s=(n=mi(e))[0],u=n[1]),Po(a=i*(s/2)*(u/2)).map(function(e){return 2*e})}return Po(a)}function xi(e){return e%2==0}function bi(e,t){if(Do(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(xi(n)&&xi(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&xi(e[0])&&xi(t[0])}function wi(e){if(null==Ka){var t=za(e);Ka=t.getParameter(t.MAX_TEXTURE_SIZE)}return Ka}function Ci(e){if(null==Xa){var t=za(e);Xa=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Xa)}function Ei(e){if(0===e)return 0;var t=za(e);return ki(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:ki(t,"EXT_disjoint_timer_query")?1:0}function ki(e,t){return null!=e.getExtension(t)}function Si(e){try{if(null!=za(e))return!0}catch(e){return!1}return!1}function Ri(e){if(0===e)return!1;var t=za(e);if(1===e){if(!ki(t,"OES_texture_float"))return!1}else if(!ki(t,"EXT_color_buffer_float"))return!1;return _i(t,e)}function Ii(e){if(0===e)return!1;var t=za(e);if(1===e){if(!ki(t,"OES_texture_float"))return!1;if(!ki(t,"WEBGL_color_buffer_float"))return!1}else if(!ki(t,"EXT_color_buffer_float"))return!1;return _i(t,e)}function _i(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var o=2===t?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,o,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(n),a}function Ni(e){return 2===e&&null!=za(e).fenceSync}var Ti=Object.freeze({callAndCheck:Ua,canBeRepresented:ja,getWebGLErrorMessage:Va,getExtensionOrThrow:Ha,createVertexShader:Ga,createFragmentShader:qa,createProgram:Ya,linkProgram:Qa,validateProgram:Ja,createStaticVertexBuffer:Za,createStaticIndexBuffer:ei,getNumChannels:function(){return 2===wo.getNumber("WEBGL_VERSION")?1:4},createTexture:ti,validateTextureSize:ni,createFramebuffer:ri,bindVertexBufferToProgramAttribute:oi,bindTextureUnit:ai,unbindTextureUnit:function(e,t,n){pi(e,n),Ua(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),Ua(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:ii,getProgramUniformLocation:si,bindTextureToProgramUniformSampler:ui,bindCanvasToFramebuffer:function(e,t){Ua(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Ua(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),Ua(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:li,unbindColorTextureFromFramebuffer:ci,validateFramebuffer:fi,getFramebufferErrorMessage:di,getBatchDim:vi,getRowsCols:mi,getShapeAs3D:gi,getTextureShapeFromLogicalShape:yi,isReshapeFree:bi,get MAX_TEXTURE_SIZE(){return Ka},get MAX_TEXTURES_IN_SHADER(){return Xa},getWebGLMaxTextureSize:wi,getMaxTexturesInShader:Ci,getWebGLDisjointQueryTimerVersion:Ei,isWebGLVersionEnabled:Si,isRenderToFloatTextureEnabled:Ri,isDownloadFloatTextureEnabled:Ii,isWebGLFenceEnabled:Ni});function Ai(e){wo.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Di(e,t){return Pa.tidy(e,t)}function Oi(e){Aa(e).forEach(function(e){return e.dispose()})}function Fi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];wo.getBool("IS_TEST")||console.warn.apply(console,e)}function Pi(e){var t=e;if(Ko(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];Array.isArray(t)||Ko(t);)n.push(t.length),t=t[0];return Array.isArray(e)&&wo.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Ko(t)){Io(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),Io(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var o=n.slice(1),a=0;a<t.length;++a)e(t[a],o,r.concat(a))}else Io(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,n,[]),n}function Mi(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function Bi(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof xa)return Mi(r,e.dtype,t,n),e;var o=Zo(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Mi(r,o,t,n),null==e||!Ko(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=Pi(e);Ko(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?ra(e,o,wo.getBool("DEBUG")):To(e);return xa.make(i,{values:s},o)}function Li(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return Bi(e,t+"["+r+"]",n)},r)}function Wi(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function zi(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}function Ui(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function ji(e,t){return zi(e,t.map(function(e){return 1}),t)}function Vi(e,t,n){Io(Wi(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function Hi(e,t){if(Wi(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function Gi(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function qi(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Ki(e,t){var n=e[0].length;e.forEach(function(e,t){Io(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),Io(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var a=0;a<n;a++)Io(a===t||e[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Xi(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function $i(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Pa.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Pa.endScope(o),o}catch(e){throw Pa.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}wo.registerFlag("HAS_WEBGL",function(){return wo.getNumber("WEBGL_VERSION")>0}),wo.registerFlag("WEBGL_VERSION",function(){return Si(2)?2:Si(1)?1:0}),wo.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===wo.get("WEBGL_VERSION")}),wo.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),wo.registerFlag("WEBGL_PACK",function(){return wo.getBool("HAS_WEBGL")}),wo.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_PACK_CLIP",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),wo.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_PACK_REDUCE",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_LAZILY_UNPACK",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_CONV_IM2COL",function(){return wo.getBool("WEBGL_PACK")}),wo.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return wi(wo.getNumber("WEBGL_VERSION"))}),wo.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Ci(wo.getNumber("WEBGL_VERSION"))}),wo.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=wo.getNumber("WEBGL_VERSION");return 0===e?0:Ei(e)}),wo.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),wo.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Ri(wo.getNumber("WEBGL_VERSION"))}),wo.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Ii(wo.getNumber("WEBGL_VERSION"))}),wo.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ni(wo.getNumber("WEBGL_VERSION"))}),wo.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return wo.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),ya=Ai;var Yi=$i({complex_:function(e,t){var n=Bi(e,"real","complex"),r=Bi(t,"imag","complex");return _o(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Pa.runKernel(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),Qi=$i({real_:function(e){var t=Bi(e,"input","real");return Pa.runKernel(function(e){return e.real(t)},{$input:t})}}),Ji=$i({imag_:function(e){var t=Bi(e,"input","imag");return Pa.runKernel(function(e){return e.imag(t)},{$input:t})}});function Zi(e,t,n){return es(e,t,Pi(e),n)}function es(e,t,n,r){if(null==r&&(r=Zo(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ko(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){ua(t);var o=Ao(t),a=Ao(n);Io(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==Ao(t.slice(i));Io(n[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return Ko(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?ra(e,r,wo.getBool("DEBUG")):To(e),xa.make(t,{values:e},r)}function ts(e,t){if((Ko(e)||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return es(e,[],[],t)}function ns(e,t){No(e);var n=Pi(e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return es(e,null,n,t)}function rs(e,t,n){if(No(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Pi(e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return es(e,t,r,n)}function os(e,t,n){if(No(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Pi(e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return es(e,t,r,n)}function as(e,t,n){if(No(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Pi(e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return es(e,t,r,n)}function is(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=is(e,"float32"),r=ss(e,"float32");return Yi(n,r)}var o=aa(Ao(e),t);return xa.make(e,{values:o},t)}function ss(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=ss(e,"float32"),r=ss(e,"float32");return Yi(n,r)}var o=ia(Ao(e),t);return xa.make(e,{values:o},t)}function us(e,t,n){return Pa.runKernel(function(r){return r.fill(e,t,n)},{})}function ls(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return ss([0],r);var o=ia(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return ns(o,r)}var cs=$i({onesLike_:function(e){var t=Bi(e,"x","onesLike");if("complex64"===t.dtype){var n=cs(Qi(t)),r=fs(Ji(t));return Yi(n,r)}return Pa.runKernel(function(e){return e.onesLike(t)},{$x:t},function(e,t){return{$x:function(){return fs(e)}}})}}),fs=$i({zerosLike_:function(e){var t=Bi(e,"x","zerosLike");return Pa.runKernel(function(e){return e.zerosLike(t)},{$x:t},function(e,t){return{$x:function(){return fs(e)}}})}}),ds=$i({concat_:function(e,t){void 0===t&&(t=0),Io(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=Li(e,"tensors","concat");t=Wo(t,n[0].shape)[0];var r=Xi(n.map(function(e){return e.shape}),t);if(0===Ao(r))return Zi([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});Ki(o,t);var a=n;return Pa.runKernel(function(e){return e.concat(n,t)},a,function(e){var n=o.map(function(e){return e[t]});return gs(e,n,t).map(function(e){return function(){return e}})})}}),hs=$i({concat1d_:function(e){return ds(e,0)}}),ps=$i({concat2d_:function(e,t){return ds(e,t)}}),vs=$i({concat3d_:function(e,t){return ds(e,t)}}),ms=$i({concat4d_:function(e,t){return ds(e,t)}}),gs=$i({split_:function(e,t,n){void 0===n&&(n=0);var r,o=Bi(e,"x","split");return n=Wo(n,o.shape)[0],"number"==typeof t?(Io(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(Io(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),Pa.runKernel(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return ds(e,n)}}})}});function ys(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var xs=ys(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var o=new n(e),a=t&&t.state,i=o.next;return i.int32=function(){return 4294967296*o.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.alea=o}(0,e)}),bs=ys(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor128=o}(0,e)}),ws=ys(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)}),Cs=ys(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.x&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)}),Es=ys(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.X&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)}),ks=ys(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.tychei=o}(0,e)}),Ss=ys(function(e){!function(t,r){var o,a=this,i=256,s="random",u=r.pow(i,6),l=r.pow(2,52),c=2*l,f=255;function d(e,n,f){var d=[],g=v(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,m(t)]}}():e,3),d),y=new h(d),x=function(){for(var e=y.g(6),t=u,n=0;e<l;)e=(e+n)*i,t*=i,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,v(m(y.S),t),(n.pass||f||function(e,t,n,o){return o&&(o.S&&p(o,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(x,g,"global"in n?n.global:this==r,n.state)}function h(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=f&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=f&o+1],n=n*i+s[f&(s[o]=s[a=f&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){for(var n,r=e+"",o=0;o<r.length;)t[f&o]=f&(n^=19*t[f&o])+r.charCodeAt(o++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=d,v(r.random(),t),e.exports){e.exports=d;try{o=n(Object(function(){var e=new Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(e){}}}([],Math)});Ss.alea=xs,Ss.xor128=bs,Ss.xorwow=ws,Ss.xorshift7=Cs,Ss.xor4096=Es,Ss.tychei=ks;var Rs=Ss.alea,Is=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Rs(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),_s=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=1);var o=this;if(this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Rs(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Ns(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",ua(e),new va(e,t,n)}var Ts=$i({batchToSpaceND_:function(e,t,n){var r=Bi(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return Io(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),Io(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),Io(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),Pa.runKernel(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),As=$i({cast_:function(e,t){var n=Bi(e,"x","cast");if(!Go(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Pa.runKernel(function(e){return e.cast(n,t)},{$x:n},function(e){return{$x:function(){return e.clone()}}})}}),Ds=$i({clone_:function(e){var t=Bi(e,"x","clone",null);return Pa.runKernel(function(e){return xa.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),Os=$i({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=Bi(e,"x","cumsum"),a=Hi([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=qi(1,o.rank)[0],u=Pa.runKernel(function(e){return e.cumsum(i,s,n,r)},{permutedX:i},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=a&&(u=u.transpose(a)),u}}),Fs=$i({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=Bi(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return Io(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),Io(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),Io(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),Pa.runKernel(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),Ps=$i({expandDims_:function(e,t){void 0===t&&(t=0);var n=Bi(e,"x","expandDims",null);Io(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(Io(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Ks(n,r)}}),Ms=$i({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=Ns([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Qs(Ps(s,0),[n[0],1,1]);if(2===n.length)return Qs(Ps(Ps(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Qs(Ps(Ps(Ps(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Bs=$i({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=Bi(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=Pa.runKernel(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===i?u.as1D():u}}),Ls=$i({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=Bi(e,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),Pa.runKernel(function(e){return e.oneHot(o,t,n,r)},{$indices:o},function(e){return{$indices:function(){return ss(o.shape,"float32")}}}).reshape(a)}}),Ws=$i({pad_:function(e,t,n){void 0===n&&(n=0);var r=Bi(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=t.map(function(e){return e[0]});return Pa.runKernel(function(e){return e.pad(r,t,n)},{$x:r},function(e){return{$x:function(){return e.slice(o,r.shape)}}})}}),zs=$i({pad1d_:function(e,t,n){return void 0===n&&(n=0),Io(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),Ws(e,[t],n)}}),Us=$i({pad2d_:function(e,t,n){return void 0===n&&(n=0),Io(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ws(e,t,n)}}),js=$i({pad3d_:function(e,t,n){return void 0===n&&(n=0),Io(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ws(e,t,n)}}),Vs=$i({pad4d_:function(e,t,n){return void 0===n&&(n=0),Io(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ws(e,t,n)}}),Hs=$i({rand_:function(e,t,n){var r=Ao(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return xa.make(e,{values:o},n)}}),Gs=$i({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Is(t,n,r,!1,o),i=Ns(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),qs=$i({randomUniform_:function(e,t,n,r,o){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Ns(e,r),i=new _s(t,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Ks=$i({reshape_:function(e,t){var n=Bi(e,"x","reshape",null);return t=Lo(t,n.size),Io(n.size===Ao(t),function(){return"new shape and old shape must have the same number of elements."}),Pa.runKernel(function(e){return e.reshape(n,t)},{$x:n},function(e){return{$x:function(){return e.reshape(n.shape)}}})}}),Xs=$i({spaceToBatchND_:function(e,t,n){var r=Bi(e,"x","spaceToBatchND");return Io(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),Io(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),Io(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),Pa.runKernel(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),$s=$i({squeeze_:function(e,t){var n=Bi(e,"x","squeeze");return Ks(n,zo(n.shape,t).newShape)}}),Ys=$i({stack_:function(e,t){void 0===t&&(t=0);var n=Li(e,"tensors","stack");if(Io(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;Io(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){_o(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){Io(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(e){return e.expandDims(t)});return ds(i,t)}}),Qs=$i({tile_:function(e,t){var n=Bi(e,"x","tile",null);return Io(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}),Pa.runKernel(function(e,r){var o=e.tile(n,t);return r([n]),o},{$x:n},function(e,n){var r=n[0];return{$x:function(){var n=fs(r);if(1===r.rank)for(var o=0;o<t[0];++o)n=n.add(e.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<t[0];++o)for(var a=0;a<t[1];++a)n=n.add(e.slice([o*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(var i=0;i<t[2];++i)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(i=0;i<t[2];++i)for(var s=0;s<t[3];++s)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}})}}),Js=$i({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Is(t,n,r,!0,o),i=Ns(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Zs=$i({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=Bi(e,"x","unstack");return Io(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length),Pa.runKernel(function(e){return e.unstack(n,t)},{$x:n},function(e){return{$x:function(){return Ys(e,t)}}})}});function eu(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function tu(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function nu(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function ru(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function ou(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function au(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=na(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,l]}function iu(e){return e<=30?e:ta(e,Math.floor(Math.sqrt(e)))}function su(e,t,n){for(var r=t.rank>1?t.shape[t.rank-1]:1,o=n.length,a=1,i=r;i<o;++i)a*=n[i];var s=r<1?1:r;return{sliceRank:r,numUpdates:t.size/s,sliceSize:a,strides:na(n.slice(0,r)).concat([1]),outputSize:Ao(n)}}function uu(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==i)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],f=[],d=0;d<e.length;d++)l[d]=lu(o,t,r,e,d),c[d]=cu(a,n,r,e,d),u&1<<d&&(c[d]=l[d]+1,f.push(d));var h=new Array(e.length).fill(0);return h=h.map(function(e,t){for(var n=0,o=r[t]||1,a=l[t];!(o>0?a>=c[t]:a<=c[t]);a+=o)n+=1;return n}),[l,h,f]}function lu(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),ko(0,a,s-1)}function cu(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?ko(0,a,s):ko(-1,a,s-1)}function fu(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function du(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function hu(e){return Pa.customGrad(e)}var pu=$i({softmax_:function(e,t){void 0===t&&(t=-1);var n=Bi(e,"logits","softmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return hu(function(e,n){var r=e.logSumExp([t],!0),o=e.toFloat().sub(r).exp();return n([o]),{value:o,gradFunc:function(e,n){var r=n[0],o=e.mul(r);return o.sub(o.sum([t],!0).mul(r))}}})(n)}}),vu=$i({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=Bi(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return hu(function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),mu=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.data.delete(e)},e}();!function(){function e(){}e.prototype.time=function(e){throw new Error("Not yet implemented.")},e.prototype.read=function(e){throw new Error("Not yet implemented.")},e.prototype.readSync=function(e){throw new Error("Not yet implemented.")},e.prototype.disposeData=function(e){throw new Error("Not yet implemented.")},e.prototype.write=function(e,t){throw new Error("Not yet implemented.")},e.prototype.fromPixels=function(e,t){throw new Error("Not yet implemented.")},e.prototype.register=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.memory=function(){throw new Error("Not yet implemented.")},e.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.slice=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){throw new Error("Not yet implemented")},e.prototype.unstack=function(e,t){throw new Error("Not yet implemented")},e.prototype.reverse=function(e,t){throw new Error("Not yet implemented")},e.prototype.concat=function(e,t){throw new Error("Not yet implemented")},e.prototype.neg=function(e){throw new Error("Not yet implemented")},e.prototype.add=function(e,t){throw new Error("Not yet implemented")},e.prototype.addN=function(e){throw new Error("Not yet implemented")},e.prototype.subtract=function(e,t){throw new Error("Not yet implemented")},e.prototype.multiply=function(e,t){throw new Error("Not yet implemented")},e.prototype.realDivide=function(e,t){throw new Error("Not yet implemented")},e.prototype.floorDiv=function(e,t){throw new Error("Not yet implemented")},e.prototype.sum=function(e,t){throw new Error("Not yet implemented")},e.prototype.prod=function(e,t){throw new Error("Not yet implemented")},e.prototype.unsortedSegmentSum=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.argMin=function(e,t){throw new Error("Not yet implemented")},e.prototype.argMax=function(e,t){throw new Error("Not yet implemented")},e.prototype.equal=function(e,t){throw new Error("Not yet implemented")},e.prototype.notEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.less=function(e,t){throw new Error("Not yet implemented")},e.prototype.lessEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.greater=function(e,t){throw new Error("Not yet implemented")},e.prototype.greaterEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalNot=function(e){throw new Error("Not yet implemented")},e.prototype.logicalAnd=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalOr=function(e,t){throw new Error("Not yet implemented")},e.prototype.where=function(e){throw new Error("Not yet implemented")},e.prototype.select=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.topk=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.min=function(e,t){throw new Error("Not yet implemented")},e.prototype.minimum=function(e,t){throw new Error("Not yet implemented")},e.prototype.mod=function(e,t){throw new Error("Not yet implemented")},e.prototype.max=function(e,t){throw new Error("Not yet implemented")},e.prototype.maximum=function(e,t){throw new Error("Not yet implemented")},e.prototype.all=function(e,t){throw new Error("Not yet implemented")},e.prototype.any=function(e,t){throw new Error("Not yet implemented")},e.prototype.squaredDifference=function(e,t){throw new Error("Not yet implemented")},e.prototype.ceil=function(e){throw new Error("Not yet implemented")},e.prototype.floor=function(e){throw new Error("Not yet implemented")},e.prototype.round=function(e){throw new Error("Not yet implemented")},e.prototype.sign=function(e){throw new Error("Not yet implemented")},e.prototype.isNaN=function(e){throw new Error("Not yet implemented")},e.prototype.isInf=function(e){throw new Error("Not yet implemented")},e.prototype.isFinite=function(e){throw new Error("Not yet implemented")},e.prototype.pow=function(e,t){throw new Error("Not yet implemented")},e.prototype.exp=function(e){throw new Error("Not yet implemented")},e.prototype.expm1=function(e){throw new Error("Not yet implemented")},e.prototype.log=function(e){throw new Error("Not yet implemented")},e.prototype.log1p=function(e){throw new Error("Not yet implemented")},e.prototype.sqrt=function(e){throw new Error("Not yet implemented")},e.prototype.rsqrt=function(e){throw new Error("Not yet implemented")},e.prototype.square=function(e){throw new Error("Not yet implemented")},e.prototype.reciprocal=function(e){throw new Error("Not yet implemented")},e.prototype.relu=function(e){throw new Error("Not yet implemented")},e.prototype.prelu=function(e,t){throw new Error("Not yet implemented")},e.prototype.elu=function(e){throw new Error("Not yet implemented")},e.prototype.eluDer=function(e,t){throw new Error("Not yet implemented")},e.prototype.selu=function(e){throw new Error("Not yet implemented")},e.prototype.int=function(e){throw new Error("Not yet implemented")},e.prototype.clip=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.abs=function(e){throw new Error("Not yet implemented")},e.prototype.complexAbs=function(e){throw new Error("Not yet implemented")},e.prototype.sigmoid=function(e){throw new Error("Not yet implemented")},e.prototype.softplus=function(e){throw new Error("Not yet implemented")},e.prototype.sin=function(e){throw new Error("Not yet implemented")},e.prototype.cos=function(e){throw new Error("Not yet implemented")},e.prototype.tan=function(e){throw new Error("Not yet implemented")},e.prototype.asin=function(e){throw new Error("Not yet implemented")},e.prototype.acos=function(e){throw new Error("Not yet implemented")},e.prototype.atan=function(e){throw new Error("Not yet implemented")},e.prototype.atan2=function(e,t){throw new Error("Not yet implemented")},e.prototype.sinh=function(e){throw new Error("Not yet implemented")},e.prototype.cosh=function(e){throw new Error("Not yet implemented")},e.prototype.tanh=function(e){throw new Error("Not yet implemented")},e.prototype.asinh=function(e){throw new Error("Not yet implemented")},e.prototype.acosh=function(e){throw new Error("Not yet implemented")},e.prototype.atanh=function(e){throw new Error("Not yet implemented")},e.prototype.erf=function(e){throw new Error("Not yet implemented")},e.prototype.step=function(e,t){throw new Error("Not yet implemented")},e.prototype.conv2d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2D=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.maxPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.maxPoolBackprop=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.avgPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.avgPoolBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.reshape=function(e,t){throw new Error("Not yet implemented")},e.prototype.cast=function(e,t){throw new Error("Not yet implemented")},e.prototype.tile=function(e,t){throw new Error("Not yet implemented")},e.prototype.pad=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.transpose=function(e,t){throw new Error("Not yet implemented")},e.prototype.gather=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.gatherND=function(e,t){throw new Error("Not yet implemented")},e.prototype.scatterND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchToSpaceND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.spaceToBatchND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeBilinear=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeBilinearBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchNormalization=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){throw new Error("Not yet implemented")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){throw new Error("Not yet implemented")},e.prototype.multinomial=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.oneHot=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.cumsum=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){throw new Error("Not yet implemented")},e.prototype.fft=function(e){throw new Error("Not yet implemented")},e.prototype.ifft=function(e){throw new Error("Not yet implemented")},e.prototype.complex=function(e,t){throw new Error("Not yet implemented")},e.prototype.real=function(e){throw new Error("Not yet implemented")},e.prototype.imag=function(e){throw new Error("Not yet implemented")},e.prototype.cropAndResize=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.depthToSpace=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.split=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.sparseToDense=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fill=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.onesLike=function(e){throw new Error("Not yet implemented")},e.prototype.zerosLike=function(e){throw new Error("Not yet implemented")},e.prototype.linspace=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.dispose=function(){throw new Error("Not yet implemented")}}();function gu(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function yu(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function xu(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function bu(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=ku(t),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return wu(e,s,n,r,o,a,!1,i)}function wu(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3];if("channelsLast"===s)l=e[0],c=e[1],f=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],d=e[1],c=e[2],f=e[3]}var h,p=t[0],v=t[1],m=t[3],g=ku(n),y=g[0],x=g[1],b=ku(r),w=b[0],C=b[1],E=Ru(p,w),k=Ru(v,C),S=function(e,t,n,r,o,a,i,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,o,a){null==o&&(o=Eu(e,t,r));var i=e[1],s=Iu((e[0]-t+2*o)/r+1,a);Io(Oo(s),function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"});var u=Iu((i-t+2*o)/r+1,a);return Io(Oo(u),function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"}),[s,u,1]}([t,n,1],a,0,r,e,s);l=f[0],c=f[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/o);var d=Math.max(0,(l-1)*r+a-t),h=Math.max(0,(c-1)*o+i-n),p=Math.floor(d/2),v=d-p,m=Math.floor(h/2);u={top:p,bottom:v,left:m,right:h-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,f,y,x,E,k,a),R=S.padInfo,I=S.outHeight,_=S.outWidth,N=i?m*d:m;return"channelsFirst"===s?h=[l,N,I,_]:"channelsLast"===s&&(h=[l,I,_,N]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:f,inChannels:d,outHeight:I,outWidth:_,outChannels:N,padInfo:R,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:k,dilationHeight:w,dilationWidth:C,inShape:e,outShape:h,filterShape:t}}function Cu(e,t,n,r,o,a,i){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],f=s[3],d=s[4];if("channelsLast"===i)u=e[0],l=e[1],c=e[2],f=e[3],d=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);u=e[0],d=e[1],l=e[2],c=e[3],f=e[4]}var h,p=t[0],v=t[1],m=t[2],g=t[4],y=Su(n),x=y[0],b=y[1],w=y[2],C=Su(r),E=C[0],k=C[1],S=C[2],R=function(e,t,n,r,o,a,i,s,u,l){var c,f,d,h;if("same"===e){var p=((f=Math.ceil(t/o))-1)*o+s-t,v=((d=Math.ceil(n/a))-1)*a+u-n,m=((h=Math.ceil(r/i))-1)*i+l-r,g=Math.floor(p/2),y=p-g,x=Math.floor(v/2),b=v-x,w=Math.floor(m/2);c={top:x,bottom:b,left:w,right:m-w,front:g,back:y,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/o),d=Math.ceil((n-u+1)/a),h=Math.ceil((r-l+1)/i)}return{padInfo:c,outDepth:f,outHeight:d,outWidth:h}}(o,l,c,f,x,b,w,Ru(p,E),Ru(v,k),Ru(m,S)),I=R.padInfo,_=R.outDepth,N=R.outHeight,T=R.outWidth,A=a?g*d:g;return"channelsFirst"===i?h=[u,A,_,N,T]:"channelsLast"===i&&(h=[u,_,N,T,A]),{batchSize:u,dataFormat:i,inDepth:l,inHeight:c,inWidth:f,inChannels:d,outDepth:_,outHeight:N,outWidth:T,outChannels:A,padInfo:I,strideDepth:x,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:v,filterWidth:m,dilationDepth:E,dilationHeight:k,dilationWidth:S,inShape:e,outShape:h,filterShape:t}}function Eu(e,t,n,r){void 0===r&&(r=1);var o=Ru(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function ku(e){return"number"==typeof e?[e,e]:e}function Su(e){return"number"==typeof e?[e,e,e]:e}function Ru(e,t){return t<=1?e:e+(e-1)*(t-1)}function Iu(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function _u(e){var t=ku(e),n=t[0],r=t[1];return 1===n&&1===r}function Nu(e,t){return _u(e)||_u(t)}function Tu(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=ss(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!qo(e.dtype,t))return xa.make(e.shape,{dataId:e.dataId},t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=ts(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Au(e,t){return xa.make(t,{dataId:e.dataId},e.dtype)}function Du(e,t,n){var r=(t-e)/(n-1),o=ia(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return ns(o,"float32")}Object.freeze({castTensor:Tu,reshapeTensor:Au,linspaceImpl:Du,upcastType:Ia,axesAreInnerMostDims:Wi,combineLocations:zi,computeOutAndReduceShapes:Ui,expandShapeToKeepDim:ji,assertAxesAreInnerMostDims:Vi,getAxesPermutation:Hi,getUndoAxesPermutation:Gi,getInnerMostAxes:qi,getBroadcastDims:gu,getReductionAxes:yu,assertAndGetBroadcastShape:xu,assertParamsConsistent:Ki,computeOutShape:Xi,computePool2DInfo:bu,computeConv2DInfo:wu,computeConv3DInfo:Cu,computeDefaultPad:Eu,tupleValuesAreOne:_u,eitherStridesOrDilationsAreOne:Nu});function Ou(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Fu(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Pu(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Mu(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Bu(e,t,n,r,o){for(var a=Array.from(t).map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),i=[],s=0;s<a.length;s++){var u=a[s],l=u.score,c=u.boxIndex;if(l<o)break;for(var f=!1,d=i.length-1;d>=0;--d)if(Lu(e,c,i[d])>=r){f=!0;break}if(!f&&(i.push(c),i.length>=n))break}return ns(i,"int32")}function Lu(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-a)*(u-i),p=(f-l)*(d-c);if(h<=0||p<=0)return 0;var v=Math.max(a,l),m=Math.max(i,c),g=Math.min(s,f),y=Math.min(u,d),x=Math.max(g-v,0)*Math.max(y-m,0);return x/(h+p-x)}function Wu(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a})}function zu(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Ns(n,e.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(e.rank),s=0;s<i.length;s++)i[s]=a[s]%e.shape[s];var u=e.locToIndex(i);o.values[r]=e.values[u]}return o.toTensor()}function Uu(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=Uo(n,s*r),c=Uo("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=e.subarray(d,d+u),p=[],v=0;v<h.length;v++)p.push({value:h[v],index:v});p.sort(function(e,t){return t.value-e.value});var m=f*r,g=l.subarray(m,m+r),y=c.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var x=t.slice();return x[x.length-1]=r,[Zi(l,x,n),Zi(c,x,"int32")]}function ju(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Ns(e,"int32"),a=Ns([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var Vu=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Hu=function(e,t){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Gu=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function qu(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function Ku(e,t){return 1===t?[e]:qu(e,t)}function Xu(){var e,t,n,r,o,a,i,s,u,l;return 2===wo.getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 0. || val == 0.) ? false : true;\n      }\n    ",u="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function $u(e,t,n){void 0===n&&(n="index");var r=na(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function Yu(e){var t=na(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Qu="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Ju(e,t,n,r){var o=[];e.forEach(function(e){var t=Ao(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var a,i,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?el(e):Zu(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=gu(e.shapeInfo.logicalShape,t.logicalShape),l=sl(s),c=s-i,f=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+f[e+c]+" = 0;"}).join("\n");var d;d=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+c]}).join(", ");var h="return outputValue;",p=1===Ao(e.shapeInfo.logicalShape),v=1===Ao(t.logicalShape);if(1!==i||p||v){if(p&&!v)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=i-2,g=i-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?h="return vec4(outputValue.x);":u.indexOf(m)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Do(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l,c=sl(u),f=gu(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,h=["x","y","z","w","u","v"];l=0===s?"":u<2&&f.length>=1?"coords = 0;":f.map(function(e){return"coords."+h[e+d]+" = 0;"}).join("\n");var p;return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+h[t+d]}).join(", "),"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+l+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,c=Xu(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    #define isnan(value) isnan_custom(value)\n    "+e.defineSpecialNaN+"\n    bvec4 isnan_custom(vec4 val) {\n      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n    }\n\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+tl+"\n    "+nl+"\n    "+rl+"\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Do(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,o,a,i}(t.logicalShape,l),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return Do(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=$u(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=$u(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=$u(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=$u(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,l),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(d+=ol),[d,f,i,s,a,u,n].join("\n")}function Zu(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+al(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+il(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=al(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&Do(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=zo(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n      "+Zu(ul(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+ll(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+il(e)+"\n      }\n    ";var c=o[0],f=o[1],d=al(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+c+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=zo(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n        "+Zu(ul(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+ll(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+il(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,f=c[0],d=c[1],h=e.shapeInfo.flatOffset;return d===o&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===a&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+al(n)+";\n        vec2 uv = uvFromFlat("+f+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=zo(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return"\n      "+Zu(ul(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+ll(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+il(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],h=f[1];return h===i&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===o&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+h+", index + "+al(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=zo(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return"\n      "+Zu(ul(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+ll(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+il(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1];return p===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+al(n)+";\n      vec2 uv = uvFromFlat("+h+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=zo(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+Zu(ul(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+ll(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,f=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+c+", "+l+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+il(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],v=h[1];return v===f&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+l+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":v===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+al(n)+";\n      vec2 uv = uvFromFlat("+p+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function el(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+Xu().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=Xu();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=Xu();if(null!=o&&Do(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+el(ul(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+ll(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+Xu().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),f="int b, int row, int col",d="b * "+c+" + (row / 2) * "+l+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,d="b"+h+" * "+(c*=t[n-h-1])+" + "+d;return"\n    vec4 "+o+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Xu().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var tl="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",nl="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",rl="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ol="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function al(e){return"offset"+e}function il(e){var t=e.name,n=Ao(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function sl(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function ul(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function ll(e,t){return t.map(function(t){return e[t]}).join(", ")}var cl=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,Io(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=sl(l),f=Ku("coords",l);if(1===a){var d=sl(s=l+1);i="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[l-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[l-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[l-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+f[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+f[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+f[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+f[l-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],v=h.map(function(e){return"int "+e}),m=Ku("sourceLocR",s-1).concat("inIdx.r"),g=Ku("sourceLocG",s-1).concat("inIdx.g"),y=Ku("sourceLocB",s-1).concat("inIdx.b"),x=Ku("sourceLocA",s-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+")));",C="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+x.join()+") : 0.)",E=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+E+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+f[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+f[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+C+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+C+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},fl=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},dl=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],xu(e,t),xu(e,n);var i="0.0";null!=r&&(xu(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(xu(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},hl=function(e,t,n,r,o,a){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],xu(e,t),xu(e,n);var i="vec4(0.0)";null!=r&&(xu(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(xu(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},pl=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xu(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},vl="return a + b;",ml="return a - b;",gl="return a * b;",yl=function(e,t,n){this.variableNames=["A","B"],this.outputShape=xu(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},xl=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=xu(t,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===Ao(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+sl(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=Ku("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},bl=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),wl=function(){function e(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Cl=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},El=function(e){this.outputShape=[],this.outputShape=Xi(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},kl=function(e,t){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Xi(e,t);var n=this.outputShape,r=n.length,o=sl(r),a=Ku("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c="vec2("+i.slice(-2).join()+")",f=i.join(),d="if ("+l+" < "+s[0]+")\n          return getChannel(getT0("+f+"), "+c+");";for(u=1;u<s.length;u++){var h=s[u-1];d+="\n        else if ("+l+" < "+s[u]+") {\n          "+l+" -= "+h+";\n          return getChannel(getT"+u+"("+f+"), "+c+");\n        }"}var p=s.length;d+="\n        else {\n          "+l+" -= "+s[s.length-1]+";\n          return getChannel(getT"+p+"("+f+"), "+c+");\n        }",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n        if (++"+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n        if (++"+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            --"+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "},Sl=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Rl=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Il=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_l=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Nl=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Tl=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Al=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.filterHeight,u=e.filterWidth,l=4*Math.floor(e.inChannels/4),c=e.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+t+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+a+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+i+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Dl=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ol=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Fl=function(e){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=e.outShape;for(var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=c,d="int xR; int xC; int xCOffset;",h=0;h<l;h++)for(var p=0;p<c;p++)d+="\n          vec4 xTexelR"+h+"C"+2*p+" = vec4(0.);\n          vec4 wR"+h+"C"+p+" = vec4(0.);\n          vec4 xR"+h+"C"+p+" = vec4(0.);";for(h=0;h<l;h++)for(var v=0;v<f;v++){if(d+="\n          xR = xRCorner + "+h*s+";\n          xC = xCCorner + "+(p=2*v)*u+";\n        ",1===i){if(p<c&&(d+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+h+"C"+p+" = vec4(previous.zw, xTexelR"+h+"C"+p+".xy);\n                } else {\n                  xR"+h+"C"+p+" = vec4(0, 0, xTexelR"+h+"C"+p+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+t+" && xC >= 0 && xC < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = xTexelR"+h+"C"+p+";\n              ",p+1<c)){var m=o%2==0?So(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(d+="\n                  xCOffset = xC + "+o%2+" + "+m+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",u>1&&(d+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+t+" &&\n                      xCOffset >= 0 && xCOffset < "+n+") {\n                      xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+h+"C"+p+" = vec4(0.);\n                    }\n                  "),d+="\n                  xR"+h+"C"+(p+1)+" = vec4(\n                    xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".xy);\n                "):d+="\n                  xCOffset = xC + "+m+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+h+"C"+(p+1)+" = xTexelR"+h+"C"+(p+2)+";\n                "}}else p<c&&(d+="\n              if(xR >= 0 && xR < "+t+") {\n            ",o%2==1?(d+="\n                xCOffset = xC + 1 - "+i+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+n+") {\n                  xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+h+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = vec4(\n                  xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".zw);\n              ",p+1<c&&(d+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+i+";\n                  if(xCOffset >= 0 && xCOffset < "+n+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+h+"C"+(p+1)+" = vec4(xTexelR"+h+"C"+(p+2)+".xy, final.xy);\n                ")):(d+="\n                if(xC >= 0 && xC < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+i+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = vec4(\n                  xTexelR"+h+"C"+p+".xy, xTexelR"+h+"C"+(p+2)+".xy);\n              ",p+1<c&&(d+="\n                  xR"+h+"C"+(p+1)+" = vec4(\n                    xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".zw);\n                ")),d+="}");p<c&&(d+="\n            vec4 wTexelR"+h+"C"+p+" = getW("+h+", "+p+", d1, q);\n            wR"+h+"C"+p+" = vec4(wTexelR"+h+"C"+p+".xz, wTexelR"+h+"C"+p+".xz);\n          ",p+1<c&&(d+="\n              vec4 wTexelR"+h+"C"+(p+1)+" = getW("+h+", "+(p+1)+", d1, q);\n              wR"+h+"C"+(p+1)+" =\n                vec4(wTexelR"+h+"C"+(p+1)+".xz, wTexelR"+h+"C"+(p+1)+".xz);"))}for(h=0;h<l;h++)for(p=0;p<c;p++)d+="result += xR"+h+"C"+p+" * wR"+h+"C"+p+";";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},Pl=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],f=n[1];this.outputShape=[l,c,f,u];var d="bilinear"===r?1:0,h=[i-1+".0",s-1+".0"],p=h[0],v=h[1],m=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],y=m[1],x=m[2],b=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=b[0],C=b[1],E=b[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+C+";\n\n        float in_y = "+x+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+E+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Ml=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+sl(r)+" coords = getOutputCoords();\n        int end = "+Bl(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Bl(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Bl(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var Ll,Wl,zl=function(e,t){this.variableNames=["A"];var n=Xu();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+$u(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Ul=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0;var n=Xu();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+$u(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},jl=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),Vl=function(e){this.variableNames=["A"];var t=Xu();this.outputShape=e,this.userCode="\n      "+Qu+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},Hl=function(e){this.variableNames=["A"],this.usesPackedTextures=!0;var t=Xu();this.outputShape=e,this.userCode="\n      "+Qu+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},Gl=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Xu(),o=t[0],a=t[1];this.outputShape=e;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+Yu(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex /= 4;\n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},ql=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Xu(),o=t[0],a=t[1];this.outputShape=e;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+e[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n    \n              flatIndex /= 4;\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Yu(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n        \n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Kl=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Xl=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),$l=function(e){this.variableNames=["A"];var t=Xu(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Yl=function(e){this.variableNames=["A"];var t=Xu(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},Ql=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=sl(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Jl=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=sl(t.length),o=sl(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Zl(e,t){return[t,e]}function ec(e){var t=Ao(e);return Po(Math.ceil(t/4))}function tc(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function nc(e,t){var n=Xu();return Ga(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function rc(e,t){return Za(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function oc(e,t){return ei(e,t,new Uint16Array([0,1,2,2,1,3]))}function ac(e,t){var n,r,o,a,i,s,u,l,c=e;return 2===wo.getNumber("WEBGL_VERSION")?(n=c.R32F,r=c.R16F,o=c.RGBA16F,a=c.RGBA32F,i=c.RED,s=4,u=1,l=c.HALF_FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=c.RGBA,i=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function ic(e,t,n,r,o,a,i){ni(n,r);var s=ti(e,t),u=e.TEXTURE_2D;return Ua(e,t,function(){return e.bindTexture(u,s)}),Ua(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),Ua(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),Ua(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),Ua(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),Ua(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),Ua(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function sc(e,t,n,r,o){var a=Zl(n,r);return ic(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function uc(e,t,n,r,o){var a=Zl(n,r);return ic(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function lc(e,t,n,r,o){var a=Zl(n,r);return ic(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function cc(e,t,n,r,o){var a=tc(n,r);return ic(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function fc(e,t,n,r,o){var a=tc(n,r);return ic(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function dc(e,t,n,r){return Ua(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),oi(e,t,n,"clipSpacePos",r,3,20,0)&&oi(e,t,n,"uv",r,2,20,12)}function hc(e,t,n,r,o,a,i){var s,u,l;Ua(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),Ua(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),Ua(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function pc(e,t,n,r){Ua(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Ua(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):Ua(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),Ua(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function vc(e,t,n,r,o){var a=e.createBuffer();Ua(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*n*r;return Ua(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),Ua(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),Ua(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}function mc(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function gc(e,t,n,r,o){var a=Zl(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return Ua(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function yc(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(function(e,t){var n=tc(e,t);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function xc(e,t,n,r){var o=new Float32Array(n*r*4);return Ua(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}!function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Ll||(Ll={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Wl||(Wl={}));var bc=Object.freeze({createVertexShader:nc,createVertexBuffer:rc,createIndexBuffer:oc,getTextureConfig:ac,createFloat32MatrixTexture:sc,createFloat16MatrixTexture:uc,createUnsignedBytesMatrixTexture:lc,createPackedMatrixTexture:cc,createFloat16PackedMatrixTexture:fc,bindVertexProgramAttributeStreams:dc,uploadDenseMatrixToTexture:hc,uploadPixelDataToTexture:pc,createBufferFromOutputTexture:vc,downloadFloat32MatrixFromBuffer:mc,downloadByteEncodedFloatMatrixFromOutputTexture:gc,downloadPackedMatrixFromBuffer:yc,downloadMatrixFromPackedOutputTexture:xc}),wc=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=wo.getNumber("WEBGL_VERSION");null!=e?(this.gl=e,Wa(t,e)):this.gl=za(t),1===wo.getNumber("WEBGL_VERSION")?(this.textureFloatExtension=Ha(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),wo.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Ha(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Ha(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=rc(this.gl,this.debug),this.indexBuffer=oc(this.gl,this.debug),this.framebuffer=ri(this.gl,this.debug),this.textureConfig=ac(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return wo.getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ua(t,this.debug,function(){return t.finish()}),Ua(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Ua(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Ua(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Ua(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Ua(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),sc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),uc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),lc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),pc(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),hc(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),fc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),cc(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(ci(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ua(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return gc(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return yc(this.gl,e,0,0,0,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return mc(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=vc(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(wo.getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return xc(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=qa(t,this.debug,e),r=nc(t,this.debug),o=Ya(t,this.debug);return Ua(t,this.debug,function(){return t.attachShader(o,r)}),Ua(t,this.debug,function(){return t.attachShader(o,n)}),Qa(t,this.debug,o),this.debug&&Ja(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=dc(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Ua(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Ja(this.gl,this.debug,this.program),Ua(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?ii(this.gl,this.debug,e,t):si(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Ua(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),ui(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=tc(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&Ja(this.gl,this.debug,this.program),fi(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Ua(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Ua(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Ha(this.gl,this.debug,2===wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return go(this,void 0,void 0,function(){var t=this;return yo(this,function(n){switch(n.label){case 0:return[4,Bo(function(){return t.disposed||t.isQueryAvailable(e,wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Bo(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),li(this.gl,this.debug,e,this.framebuffer),this.debug&&fi(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(li(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&fi(this.gl)):ci(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;li(r,this.debug,e,this.framebuffer),this.debug&&fi(r),this.outputTexture=e,Ua(r,this.debug,function(){return r.viewport(0,0,t,n)}),Ua(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),Ua(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Cc(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!Do(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!Do(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var Ec=function(e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,f=s.left,d=s.top,h=o*r,p=Xu();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+e[1]+" || pos >= "+e[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+u+")) * "+i+" - "+d+";\n            int d0 = offsetY + "+c+" * (pos / "+h+");\n\n            if(d0 >= "+t[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+f+".);\n            int d1 = offsetX + "+l+" * (int(mod(float(pos), "+h+".) / "+o+".));\n\n            if(d1 >= "+t[1]+" || d1 < 0) continue;\n\n            vec2 innerDims = vec2(d1, int(mod(float(pos), "+o+".)));\n            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),\n                                              int(innerDims.y)), innerDims);\n          }\n        }\n\n        "+p.output+" = result;\n      }\n    "},kc=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Sc=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Rc=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},Ic=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_c=function(e,t,n,r,o,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=t;var i=n?e[1]:e[2],s=Math.ceil(i/2),u=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",h="";a&&(d="vec4 activation(vec4 x) {\n        "+a+"\n      }",h="result = activation(result);");var p=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),this.userCode="\n      "+d+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          result += ("+c[0]+" * "+f[0]+") + ("+c[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+p+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},Nc=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),Tc=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},Ac=function(e){this.variableNames=["A"],this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Ku("rc",t),r=sl(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},Dc=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=sl(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Oc=function(e,t,n){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=sl(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=Ku("rc",r),u=Ku("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,v=1===r?2:4;p<v;p++)h+="\n        "+f[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},Fc=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,h="0.0";if(d||(h="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+c+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+c+", "+f+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Pc=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},Mc=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+$u(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Yu(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Bc=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],h=1/f,p=1/d,v=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Lc=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Wc=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+"; \n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},zc=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],h=1/f,p=1/d,v=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Uc=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},jc=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=sl(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},Vc=function(e,t){this.variableNames=["x"],this.usesPackedTextures=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Ku("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=sl(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Hc=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=sl(o.length),u=sl(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices("+l+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var d="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Gc=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},qc=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=sl(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},Kc=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=sl(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return Xc.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+Xc[t]+" = start["+t+"] + coords."+Xc[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Xc=["x","y","z","w","u","v"],$c=function(){function e(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=sl(this.rank),n=Ku("coords",this.rank),r=Ku("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+" \n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Yc=function(e,t,n,r){this.variableNames=["x"];var o=n.filter(function(e,t){return-1===r.indexOf(t)});this.outputShape=o;var a=n.length,i=sl(n.length),s=sl(o.length),u="";if(1===a)u="coords * strides + begin";else{var l=0;u=n.map(function(e,t){return-1===r.indexOf(t)?(l++,1===o.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(l-1)+"] * strides["+t+"] + begin["+t+"]"):"begin["+t+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},Qc=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=Jc(t,n),a=Zc(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Wl.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Wl.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Wl.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Wl.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Wl.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=Zc(t,Jc(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Jc(e,t){if(e===Ll.UPLOAD)return Wl.PACKED_2X2_FLOAT32;if(e===Ll.RENDER||null==e)return t?wo.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Wl.PACKED_2X2_FLOAT32:Wl.PACKED_2X2_FLOAT16:wo.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Wl.UNPACKED_FLOAT32:Wl.UNPACKED_FLOAT16;if(e===Ll.DOWNLOAD||e===Ll.PIXELS)return Wl.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Zc(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var ef=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=sl(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},tf=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=sl(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},nf=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=sl(this.rank),a=qu("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},rf=1.7580993408473768,of=1.0507009873554805,af=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},sf="if (isnan(x)) return x;",uf=sf+"\n  return (x < 0.0) ? 0.0 : x;\n",lf="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+rf+";\n  float scale = "+of+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",cf="return exp(x);",ff=sf+"\n  return sin(x);\n",df=sf+"\n  return cos(x);\n",hf=sf+"\n  return atan(x);\n",pf=sf+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",vf=sf+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",mf="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",gf=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},yf=function(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var t=e.length,n=Ku("rc",t),r=sl(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},xf={},bf=function(){function e(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!wo.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var t=za(wo.getNumber("WEBGL_VERSION"));this.binaryCache=((n=wo.getNumber("WEBGL_VERSION"))in xf||(xf[n]={}),xf[n]),this.gpgpu=new wc(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var n;this.textureManager=new Qc(this.gpgpu),this.numMBBeforeWarning=null==wo.global.screen?1024:wo.global.screen.height*wo.global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new mu(this,Pa)}return e.prototype.register=function(e,t,n){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:n})},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[e.height,e.width],r=[e.height,e.width,t];if(wo.getBool("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e.data instanceof Uint8Array))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var o,a,i=this.makeTensorHandle(n,"int32");if(this.texData.get(i.dataId).usage=Ll.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),e),wo.getBool("WEBGL_PACK")){o=new Yl(r);var s=this.makePackedTensor(o.outputShape,i.dtype);a=this.compileAndRun(o,[i],s)}else o=new $l(r),a=this.compileAndRun(o,[i]);return this.disposeData(i.dataId),a},e.prototype.makeTensorHandle=function(e,t){var n={};return this.register(n,e,t),{dataId:n,shape:e,dtype:t}},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");if(wo.getBool("DEBUG"))for(var n=0;n<t.length;n++){var r=t[n];if(!ja(r))throw Error("The value "+r+" cannot be represented on this device.")}var o=this.texData.get(e);if("complex64"===o.dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(e),o.usage=Ll.UPLOAD,o.values=t},e.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape;if(null!=a){var s=new af(i,"return x;"),u=this.compileAndRun(s,[{dataId:e,shape:i,dtype:r}]),l=this.readSync(u.dataId);return u.dispose(),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var c,f,d=null!=this.activeTimers;return d&&(c=performance.now()),f="complex64"===r?Ou(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),d&&(this.downloadWaitMs+=performance.now()-c),this.convertAndCacheOnCPU(e,f)},e.prototype.read=function(e){return go(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f,d,h,p,v,m,g,y,x,b,w;return yo(this,function(C){switch(C.label){case 0:if(this.pendingRead.has(e))return n=this.pendingRead.get(e),[2,new Promise(function(e){return n.push(e)})];if(r=this.texData.get(e),o=r.values,a=r.shape,i=r.slice,s=r.dtype,u=r.complexTensors,null!=i)return l=new af(a,"return x;"),c=this.compileAndRun(l,[{dataId:e,shape:a,dtype:s}]),f=this.read(c.dataId),c.dispose(),[2,f];if(null!=o)return[2,this.convertAndCacheOnCPU(e)];if(!wo.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===wo.getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==s&&wo.get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(e),e=h.dataId,p=this.texData.get(h.dataId),d=(t=this.gpgpu).createBufferFromTexture.apply(t,[p.texture].concat(ec(a)))),this.pendingRead.set(e,[]),"complex64"===s?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return"complex64"!==s?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return m=C.sent(),g=m[0],y=m[1],v=Ou(g,y),[3,5];case 4:null==d?v=this.getValuesFromTexture(e):(x=Ao(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x),this.disposeData(e)),C.label=5;case 5:return b=this.convertAndCacheOnCPU(e,v),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach(function(e){return e(b)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,b]}})})},e.prototype.getValuesFromTexture=function(e){var t,n=this,r=this.texData.get(e),o=r.shape,a=r.dtype,i=r.isPacked,s=Ao(o);if(wo.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(e),l=this.texData.get(u.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[l.texture].concat(ec(o))).subarray(0,s);return this.disposeData(u.dataId),c}var f=wo.getBool("WEBGL_PACK")&&!0===i,d=f?gi(o):o,h=this.makeTensorHandle(d,"float32");h.size=Ao(o),this.texData.get(h.dataId).usage=Ll.DOWNLOAD;var p=Di(function(){var t=f?new Hl(d):new Vl(d);return n.compileAndRun(t,[{shape:d,dtype:a,dataId:e}],h,null)}),v=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,s);return this.disposeData(h.dataId),m},e.prototype.time=function(e){return go(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return yo(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=To(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),a=To(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return i=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:Ro(i),getExtraProfileInfo:function(){return i.map(function(e,t){return{name:a[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},e.prototype.getQueryTime=function(e){return go(this,void 0,void 0,function(){var t;return yo(this,function(n){return wo.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},e.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e))if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}},e.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.isPacked,s=t.slice,u=s&&s.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getCPUBackend=function(){return wo.getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Pa.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&e.size<t})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(e,t){var n=this.makeOutputArray(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Pa.keep(e.clone()),imag:Pa.keep(t.clone())},n},e.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},e.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===Ao(n))return Zi([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,o=fu(e.shape,t,n);if(r||!o){var a=wo.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $c(n):new Kc(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},e.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=xa.make(n,{},e.dtype,this),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=du(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r,o,a,i,s,u);var l=uu(e.shape,t,n,r,o,a,i,s,u),c=l[0],f=l[1],d=l[2],h=f.filter(function(e,t){return-1===d.indexOf(t)});if(h.some(function(e){return 0===e}))return Zi([],h);var p=new Yc(c,r,f,d);return this.compileAndRun(p,[e])},e.prototype.reverse=function(e,t){var n=wo.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vc(e.shape,t):new jc(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>wo.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),r=this.concat(e.slice(0,n),t),o=this.concat(e.slice(n),t);return this.concat([r,o],t)}if(wo.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new kl(e.map(function(e){return e.shape}),t);return this.compileAndRun(a,e)}var i=Xi(e.map(function(e){return e.shape}),t),s=e.map(function(e){return e.as2D(-1,Ao(e.shape.slice(t)))}),u=new El(s.map(function(e){return e.shape}));return this.compileAndRun(u,s).reshape(i)},e.prototype.neg=function(e){var t=new af(e.shape,"return -x;");return this.compileAndRun(t,[e])},e.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,i,1),l=1===a?2:1,c=1===a?t.as3D(s,1,i):t;return this.multiply(u,c).sum(l,!0)}var f=Ia(e.dtype,t.dtype),d=new _c(e.shape,[s,o,a],n,r),h=this.makePackedTensor(d.outputShape,f);return this.compileAndRun(d,[e,t],h)},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){var i=n?e.shape[2]:e.shape[1],s=r?t.shape[1]:t.shape[2],u=e.shape[0],l=Ia(e.dtype,t.dtype),c=new _c(e.shape,[u,i,s],n,r,!!o,a?function(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?mf:uf;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}(a,!0):null),f=this.makePackedTensor(c.outputShape,l),d=[e,t];return o&&d.push(o),this.compileAndRun(c,d,f)},e.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new pl("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new pl("return areal * bimag + aimag * breal;",e.shape,t.shape),i=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag),this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,gl,e.dtype);var c=new yl(gl,e.shape,t.shape),f=this.makeOutputArray(c.outputShape,e.dtype);return this.compileAndRun(c,[e,t],f)},e.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),wo.getBool("WEBGL_PACK_NORMALIZATION")){var l=new hl(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)}var c=new dl(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=wo.getBool("WEBGL_PACK_NORMALIZATION")?new Rc(e.shape,t,n,r,o):new kc(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new Sc(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},e.prototype.tile=function(e,t){if("string"===e.dtype)return zu(Ns(e.shape,e.dtype,this.readSync(e.dataId)),t);var n=new ef(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.pad=function(e,t,n){var r=wo.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Oc(e.shape,t,n):new Dc(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=wo.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nf(e.shape,t):new tf(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new Ql(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},e.prototype.batchToSpaceND=function(e,t,n){Io(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=eu(e.shape,t,r),a=tu(o.length,t.length),i=nu(e.shape,t,r),s=ru(n,t.length),u=ou(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){Io(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=eu(i.shape,t,r,!1),u=tu(s.length,t.length,!1),l=nu(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=iu(o),i=new Pc({windowSize:a,inSize:o,batchSize:r},t),s=i.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],n);return this.compileAndRun(i,[e],c),1===c.shape[1]?c:this.reduce(c,t,n)},e.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=iu(o),i=new Gu({windowSize:a,inSize:o,batchSize:r},t,null==n),s=i.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],"int32"),f=[e];return null!=n&&f.push(n),this.compileAndRun(i,f,c),1===c.shape[1]?c:this.argReduce(e,t,c)},e.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=iu(r[r.length-1]),a=new cl(r,o,t,null==n),i=this.makePackedTensor(a.outputShape,"int32"),s=null==n?[e]:[e,n];return this.compileAndRun(a,s,i),i.rank===e.rank?this.argReducePacked(e,t,i):i},e.prototype.sum=function(e,t){Vi("sum",t,e.rank);var n=Ui(e.shape,t),r=n[0],o=Ao(n[1]),a=e.as2D(-1,o),i=_a(e.dtype);return this.reduce(a,"sum",i).reshape(r)},e.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=Ui(e.shape,t),r=n[0],o=Ao(n[1]),a=e.as2D(-1,o),i=_a(e.dtype);return this.reduce(a,"prod",i).reshape(r)},e.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=Hi([r],e.rank),a=e;null!=o&&(a=e.transpose(o),r=qi(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=Ao([a.shape[r]]),u=a.as2D(-1,s),l=_a(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(i);return null!=o&&(c=c.transpose(Gi(o))),c},e.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=ta(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ta(e,n+1);return n}(i,o),u=new Gc({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),l=u.outputShape,c=l[0],f=l[1],d=this.makeOutputArray([c,f],r);return this.compileAndRun(u,[e,n],d),d.shape[1]===o?d:(n=ls(0,o).tile([i/s]),this.segOpCompute(d,t,n,r,o))},e.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Vi("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!wo.getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Ui(e.shape,r),a=o[0],i=Ao(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},e.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},e.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},e.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new Ml(e.shape,n,r);return this.compileAndRun(o,[e])},e.prototype.equal=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new yl("return float(a == b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.notEqual=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new yl("return float(a != b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new yl("return float(a < b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.lessEqual=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new yl("return float(a <= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new yl("return float(a > b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greaterEqual=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new yl("return float(a >= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalNot=function(e){var t=new af(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new yl("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalOr=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new yl("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.select=function(e,t,n){var r=new qc(e.rank,t.shape,t.rank),o=this.makeOutputArray(r.outputShape,Ia(t.dtype,n.dtype));return this.compileAndRun(r,[e,t,n],o)},e.prototype.where=function(e){Fi("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return ju(e.shape,t)},e.prototype.topk=function(e,t,n){return Uu(e.dataSync(),e.shape,e.dtype,t)},e.prototype.min=function(e,t){Vi("min",t,e.rank);var n=Ui(e.shape,t),r=n[0],o=Ao(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yl("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.mod=function(e,t){var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yl("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Vi("max",t,e.rank);var n=Ui(e.shape,t),r=n[0],o=Ao(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yl("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.all=function(e,t){Vi("all",t,e.rank);var n=Ui(e.shape,t),r=n[0],o=Ao(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(e,t){Vi("any",t,e.rank);var n=Ui(e.shape,t),r=n[0],o=Ao(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.squaredDifference=function(e,t){var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("return (a - b) * (a - b);",e.shape,t.shape):new yl("return (a - b) * (a - b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.realDivide=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(b.x == 0.0) {\n    result.x = NAN;\n  } else if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(b.y == 0.0) {\n    result.y = NAN;\n  } else if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(b.z == 0.0) {\n    result.z = NAN;\n  } else if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(b.w == 0.0) {\n    result.w = NAN;\n  } else if(a.w == b.w) {\n    result.w = 1.;\n  }\n  \n  return result;\n","float32",!0);var n=new yl("\nif (b == 0.0) {\n  return NAN;\n} \nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e,t],r)},e.prototype.floorDiv=function(e,t){if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new yl("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[e,t],r)},e.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,vl);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Ia(e.dtype,t.dtype);if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,vl,n);var r=new yl(vl,e.shape,t.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],o)},e.prototype.packedBinaryOp=function(e,t,n,r,o){void 0===o&&(o=!1);var a=new xl(n,e.shape,t.shape,o),i=this.makePackedTensor(a.outputShape,r);return this.compileAndRun(a,[e,t],i)},e.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorHandle(e,a),u=r.makeComplexComponentTensorHandle(t,i),l=new yl(n,e.shape,t.shape),c=r.makeOutputArray(l.outputShape,Ia(a.dtype,i.dtype));return r.compileAndRun(l,[s,u],c)}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},e.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},e.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>wo.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var o=e.map(function(e){return e.dtype}).reduce(function(e,t){return Ia(e,t)}),a=e.map(function(e){return e.shape}),i=wo.getBool("WEBGL_PACK"),s=i?new Hu(e[0].shape,a):new Vu(e[0].shape,a),u=i?this.makePackedTensor(s.outputShape,o):this.makeOutputArray(s.outputShape,o);return this.compileAndRun(s,e,u)},e.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,ml);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Ia(e.dtype,t.dtype);if(wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ml,e.dtype);var r=new yl(ml,e.shape,t.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],o)},e.prototype.pow=function(e,t){var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS"),r=n?new xl("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yl("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),o=Ia(e.dtype,t.dtype),a=n?this.makePackedTensor(r.outputShape,o):this.makeOutputArray(r.outputShape,o);return this.compileAndRun(r,[e,t],a)},e.prototype.ceil=function(e){var t=new af(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new af(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},e.prototype.sign=function(e){var t=new af(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},e.prototype.isNaN=function(e){var t=new af(e.shape,"return float(isnan(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isInf=function(e){var t=new af(e.shape,"return float(isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isFinite=function(e){var t=new af(e.shape,"return float(!isnan(x) && !isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.round=function(e){var t=new af(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t;return t=wo.getBool("WEBGL_PACK")?new gf(e.shape,cf):new af(e.shape,cf),this.compileAndRun(t,[e])},e.prototype.expm1=function(e){var t=new af(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t;return t=wo.getBool("WEBGL_PACK")?new gf(e.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new af(e.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(t,[e])},e.prototype.log1p=function(e){var t=new af(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new af(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},e.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new af(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new af(e.shape,"return x * x;");return this.compileAndRun(t,[e])},e.prototype.reciprocal=function(e){var t=new af(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t;return t=wo.getBool("WEBGL_PACK")?new gf(e.shape,mf):new af(e.shape,uf),this.compileAndRun(t,[e])},e.prototype.prelu=function(e,t){var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",e.shape,t.shape):new yl("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.elu=function(e){var t=new af(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e,t){var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new yl("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.selu=function(e){var t=new af(e.shape,lf);return this.compileAndRun(t,[e])},e.prototype.int=function(e){var t=new af(e.shape,"return float(int(x));"),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],n)},e.prototype.clip=function(e,t,n){var r,o=(r=wo.getBool("WEBGL_PACK_CLIP")?new wl(e.shape):new bl(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},e.prototype.abs=function(e){var t=new af(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},e.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Cl(e.shape),r=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(e){var t=new af(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},e.prototype.softplus=function(e){var t=new af(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new af(e.shape,ff);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new af(e.shape,df);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new af(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new af(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new af(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new af(e.shape,hf);return this.compileAndRun(t,[e])},e.prototype.atan2=function(e,t){var n=wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yl("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.sinh=function(e){var t=new af(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new af(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new af(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},e.prototype.asinh=function(e){var t=new af(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},e.prototype.acosh=function(e){var t=new af(e.shape,pf);return this.compileAndRun(t,[e])},e.prototype.atanh=function(e){var t=new af(e.shape,vf);return this.compileAndRun(t,[e])},e.prototype.erf=function(e){var t=new af(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var n=new af(e.shape,function(e){return void 0===e&&(e=0),sf+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},e.prototype.conv2dByMatMul=function(e,t,n){var r=e.shape,o=this.texData.get(e.dataId),a=n.inChannels,i=r[0]*r[1]*r[2],s=n.outChannels,u=(1===i||1===s)&&a>1e3,l=r[2]%2!=0&&!!o.isPacked;if(u||!wo.getBool("WEBGL_LAZILY_UNPACK")||!wo.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!l){var c=this.reshape(e,[1,r[0]*r[1]*r[2],n.inChannels]),f=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(c,f,!1,!1),n.outShape)}var d=xa.make([1,r[0]*r[1]*(r[2]+1),n.inChannels],{dataId:e.dataId},e.dtype,this),h=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,Io(bi(o.shape,d.shape),function(){return"packed reshape "+o.shape+" to "+d.shape+" isn't free"});var p=this.reshape(t,[1,n.inChannels,n.outChannels]),v=this.batchMatMul(d,p,!1,!1),m=this.texData.get(v.dataId);return Io(m.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=h,m.shape=n.outShape,xa.make(n.outShape,{dataId:v.dataId},v.dtype,this)},e.prototype.conv2dWithIm2Row=function(e,t,n){var r=n.filterWidth,o=n.filterHeight,a=n.inChannels,i=n.outWidth,s=n.outHeight,u=r*o*a,l=s*i,c=[u,l],f=e.squeeze([0]),d=t.reshape([1,u,-1]),h=new Ec(c,f.shape,n),p=this.compileAndRun(h,[f]).reshape([1,c[0],c[1]]),v=new _c(p.shape,[1,l,n.outChannels],!0,!1);return this.compileAndRun(v,[p,d]).reshape([1,s,i,n.outChannels])},e.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(wo.getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new Al(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerInput=function(e,t,n){var r=new Rl(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerFilter=function(e,t,n){var r=new Sl(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2D=function(e,t,n){var r;return wo.getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Fl(n),this.compileAndRun(r,[e,t],this.makePackedTensor(n.outShape,e.dtype))):(r=new Ol(n),this.compileAndRun(r,[e,t]))},e.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new Tl(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new Nl(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3d=function(e,t,n){var r=new Dl(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerInput=function(e,t,n){var r=new _l(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerFilter=function(e,t,n){var r=new Il(n);return this.compileAndRun(r,[e,t])},e.prototype.maxPool=function(e,t){var n=new Fc(t,"max",!1),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[e],r)},e.prototype.avgPool=function(e,t){var n=new Fc(t,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e],r)},e.prototype.maxPoolBackprop=function(e,t,n,r){var o=new Fc(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Ic(r),s=this.makeOutputArray(i.outputShape,t.dtype),u=this.compileAndRun(i,[e,a],s);return a.dispose(),u},e.prototype.avgPoolBackprop=function(e,t,n){var r=new fl(n),o=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[e],o)},e.prototype.cast=function(e,t){return Tu(e,t,this)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},e.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);return!n.isPacked||bi(e.shape,t)||null!==n.texture&&bi(n.shape,t)?Au(e,t):this.packedReshape(e,t)},e.prototype.resizeBilinear=function(e,t,n,r){var o=wo.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Wc(e.shape,t,n,r):new Lc(e.shape,t,n,r);return this.compileAndRun(o,[e])},e.prototype.resizeBilinearBackprop=function(e,t,n){var r=new Bc(e,t,n);return this.compileAndRun(r,[e])},e.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new Uc(e.shape,t,n,r);return this.compileAndRun(o,[e])},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new zc(e,t,n);return this.compileAndRun(r,[e])},e.prototype.multinomial=function(e,t,n,r){var o=t?e:pu(e),a=o.shape[0],i=o.shape[1],s=new Nc(a,i,n),u=this.makeOutputArray(s.outputShape,"int32"),l=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],u,l)},e.prototype.oneHot=function(e,t,n,r){var o=new Tc(e.size,t,n,r);return this.compileAndRun(o,[e])},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return Fi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Bu(e.dataSync(),t.dataSync(),n,r,o)},e.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new Pl(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n])},e.prototype.depthToSpace=function(e,t,n){Io(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,l=i/(t*t),c=new jl("NHWC"===n?[r,s,u,l]:[r,l,s,u],t,n);return this.compileAndRun(c,[e])},e.prototype.split=function(e,t,n){return Wu(e,t,n)},e.prototype.scatterND=function(e,t,n){var r=su(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/i,i],c=e.reshape([a,o]),f=t.reshape([a,i]);if(0===u)return Au(Zi([]),n);var d=ts(0),h=new Hc(a,o,c.rank,f.rank,s,l);return this.compileAndRun(h,[f,c,d]).reshape(n)},e.prototype.sparseToDense=function(e,t,n,r){var o=su(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new Hc(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},e.prototype.fft=function(e){return this.fftImpl(e,!1)},e.prototype.ifft=function(e){return this.fftImpl(e,!0)},e.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Kl("return real * expR - imag * expI;",e.shape,t),o=new Kl("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=au(e,t),a=o[0],i=o[1],s=o[2],u=o[3],l=t.reshape([i,r]),c=e.reshape([e.size/s,s]),f=new Jl(r,u,[i,s]);return this.compileAndRun(f,[c,l]).reshape(a)},e.prototype.fill=function(e,t,n){if("string"===(n=n||Zo(t))){var r=jo(n,Ao(e));return r.fill(t),xa.make(e,{values:r},n)}var o=new Xl(e,t),a=o.getCustomSetupFunc(t),i=this.makeOutputArray(e,n);return this.compileAndRun(o,[],i,a)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},e.prototype.linspace=function(e,t,n){return Du(e,t,n)},e.prototype.makeOutputArray=function(e,t){return xa.make(e,{},t,this)},e.prototype.makePackedTensor=function(e,t){var n=xa.make(e,{},t,this);return this.texData.get(n.dataId).isPacked=!0,n},e.prototype.unpackTensor=function(e){var t=new yf(e.shape);return this.compileAndRun(t,[e],xa.make(t.outputShape,{},e.dtype,this))},e.prototype.packTensor=function(e){var t=new Ac(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype),null,!0)},e.prototype.packedReshape=function(e,t){var n=e.reshape([vi(e.shape)].concat(mi(e.shape))),r=[vi(t)].concat(mi(t)),o=new Mc(r,n.shape);return this.compileAndRun(o,[n]).reshape(t)},e.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,o=n.shape,a=n.dtype,i=gi(o),s=ec(o),u=this.makeTensorHandle(o,"float32");return this.texData.get(u.dataId).isPacked=!0,this.texData.get(u.dataId).dtype=a,this.texData.get(u.dataId).texShape=s.map(function(e){return 2*e}),t=r?new Ul(i,s):new zl(i,s),this.compileAndRun(t,[{shape:i,dtype:a,dataId:e}],u,null,!0),u},e.prototype.compileAndRun=function(e,t,n,r,o){var a=this;if(void 0===o&&(o=!1),null==n&&(n=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=Uo(n.dtype,0),n;var i=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.usesPackedTextures&&Ao(t.shape)<=wo.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.usesPackedTextures&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.usesPackedTextures)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!bi(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,u={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},l=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,i,u),c=this.getAndSaveBinary(l,function(){return function(e,t,n,r){var o=t.userCode,a=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Ju(a,s,o,t.usesPackedTextures),l=e.createProgram(u),c=null,f=e.getUniformLocation(l,"NAN",!1);1===wo.getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var d={},h=0;h<t.variableNames.length;h++){var p=t.variableNames[h];d[p]=e.getUniformLocation(l,p,!1),d["offset"+p]=e.getUniformLocation(l,"offset"+p,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:d,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:f}}(a.gpgpu,e,i,u)}),f=null!=this.activeTimers;return f&&(s=this.startTimer()),function(e,t,n,r,o){Cc(t.inShapeInfos,n),Cc([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===wo.getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(Ao(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,c,i,u,r),f&&(s=this.endTimer(s),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(s)})),!wo.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(n.dataId).isPacked&&!1===o?this.unpackTensor(n):n},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),null!=this.canvas&&null!=this.canvas.remove?this.canvas.remove():this.canvas=null,null!=this.fromPixels2DContext&&null!=this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Di(function(){var t=wo.getBool("DEBUG");wo.set("DEBUG",!1);var n=e.abs(ts(1e-8)).dataSync()[0];return wo.set("DEBUG",t),n>0?32:16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=performance.now());var f=n.texShape;if(null==f&&(f=yi(r,u),n.texShape=f),null!=a){var d=gi(r),h=void 0,p=f[1],v=f[0],m=a instanceof Uint8Array;u?(p=(t=tc(f[0],f[1]))[0],v=t[1],h=new ql(d,[v,p],m)):h=new Gl(d,[v,p],m);var g=this.makeTensorHandle([v,p],o);this.texData.get(g.dataId).usage=m?Ll.PIXELS:Ll.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,v,a);var y=this.makeTensorHandle(h.outputShape,g.dtype);y.size=Ao(h.outputShape),this.texData.get(y.dataId).isPacked=u,this.compileAndRun(h,[g],y);var x=this.texData.get(y.dataId);n.texture=x.texture,n.texShape=x.texShape,n.isPacked=x.isPacked,n.usage=x.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,c&&(this.uploadWaitMs+=performance.now()-l)}else{var b=this.acquireTexture(f,s,o,u);n.texture=b}}},e.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},e.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},e.prototype.computeBytes=function(e,t){return e[0]*e[1]*Xo(t)},e}();Ma()&&Pa.registerBackend("webgl",function(){return new bf},2);var wf=$i({abs_:function(e){var t=Bi(e,"x","abs");return"complex64"===t.dtype?Pa.runKernel(function(e){return e.complexAbs(t)},{$x:t}):Pa.runKernel(function(e,n){var r=e.abs(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().step(-1))}}})}}),Cf=$i({acos_:function(e){var t=Bi(e,"x","acos");return Pa.runKernel(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(ts(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Ef=$i({acosh_:function(e){var t=Bi(e,"x","acosh");return Pa.runKernel(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),kf=$i({asin_:function(e){var t=Bi(e,"x","asin");return Pa.runKernel(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(ts(1).sub(n.toFloat().square()).sqrt())}}})}}),Sf=$i({asinh_:function(e){var t=Bi(e,"x","asinh");return Pa.runKernel(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(ts(1).add(n.toFloat().square()).sqrt())}}})}}),Rf=$i({atan_:function(e){var t=Bi(e,"x","atan");return Pa.runKernel(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),If=$i({atanh_:function(e){var t=Bi(e,"x","atanh");return Pa.runKernel(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(ts(1).sub(n.toFloat().square()))}}})}}),_f=$i({ceil_:function(e){var t=Bi(e,"x","ceil");return Pa.runKernel(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return fs(e)}}})}}),Nf=$i({clipByValue_:function(e,t,n){var r=Bi(e,"x","clipByValue");return Io(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}),Pa.runKernel(function(e,o){var a=e.clip(r,t,n);return o([r]),a},{$x:r},function(e,r){var o=r[0];return{$x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),fs(e))}}})}}),Tf=$i({cos_:function(e){var t=Bi(e,"x","cos");return Pa.runKernel(function(e,n){var r=e.cos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sin().neg().mul(e)}}})}}),Af=$i({cosh_:function(e){var t=Bi(e,"x","cosh");return Pa.runKernel(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),Df=$i({erf_:function(e){var t=Bi(e,"x","erf");return Io("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),Pa.runKernel(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Of=$i({exp_:function(e){var t=Bi(e,"x","exp");return Pa.runKernel(function(e,n){var r=e.exp(t);return n([r]),r},{$x:t},function(e,t){return{$x:function(){return e.mulStrict(t[0])}}})}}),Ff=$i({expm1_:function(e){var t=Bi(e,"x","expm1");return Pa.runKernel(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),Pf=$i({floor_:function(e){var t=Bi(e,"x","floor");return Pa.runKernel(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return fs(e)}}})}}),Mf=$i({log_:function(e){var t=Bi(e,"x","log");return Pa.runKernel(function(e,n){var r=e.log(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat())}}})}}),Bf=$i({log1p_:function(e){var t=Bi(e,"x","log1p");return Pa.runKernel(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),Lf=$i({logSigmoid_:function(e){var t=Bi(e,"x","logSigmoid");return Pa.runKernel(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),Wf=$i({neg_:function(e){var t=Bi(e,"x","neg");return Pa.runKernel(function(e){return e.neg(t)},{$x:t},function(e){return{$x:function(){return e.neg()}}})}}),zf=$i({reciprocal_:function(e){var t=Bi(e,"x","reciprocal");return Pa.runKernel(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),Uf=$i({round_:function(e){var t=Bi(e,"x","round");return Pa.runKernel(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return fs(e)}}})}}),jf=$i({rsqrt_:function(e){var t=Bi(e,"x","rsqrt");return Pa.runKernel(function(e,n){var r=e.rsqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}})}}),Vf=$i({sigmoid_:function(e){var t=Bi(e,"x","sigmoid");return Pa.runKernel(function(e,n){var r=e.sigmoid(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.mul(ts(1).sub(n)))}}})}}),Hf=$i({sign_:function(e){var t=Bi(e,"x","sign");return Pa.runKernel(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return fs(e)}}})}}),Gf=$i({isNaN_:function(e){var t=Bi(e,"x","isNaN");return Pa.runKernel(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return fs(e)}}})}}),qf=$i({isInf_:function(e){var t=Bi(e,"x","isInf");return Pa.runKernel(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return fs(e)}}})}}),Kf=$i({isFinite_:function(e){var t=Bi(e,"x","isFinite");return Pa.runKernel(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return fs(e)}}})}}),Xf=$i({sin_:function(e){var t=Bi(e,"x","sin");return Pa.runKernel(function(e,n){var r=e.sin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cos().mul(e)}}})}}),$f=$i({sinh_:function(e){var t=Bi(e,"x","sinh");return Pa.runKernel(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),Yf=$i({softplus_:function(e){var t=Bi(e,"x","softplus");return Pa.runKernel(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),Qf=$i({sqrt_:function(e){var t=Bi(e,"x","sqrt");return Pa.runKernel(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),Jf=$i({square_:function(e){var t=Bi(e,"x","square");return Pa.runKernel(function(e,n){return n([t]),e.square(t)},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().mul(2))}}})}}),Zf=$i({step_:function(e,t){void 0===t&&(t=0);var n=Bi(e,"x","step");return Pa.runKernel(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return fs(e)}}})}}),ed=$i({tan_:function(e){var t=Bi(e,"x","tan");return Pa.runKernel(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),td=$i({tanh_:function(e){var t=Bi(e,"x","tanh");return Pa.runKernel(function(e,n){var r=e.tanh(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return ts(1).sub(n.square()).mulStrict(e)}}})}});function nd(e,t,n,r,o,a){var i,s,u=Bi(e,"x","batchNorm"),l=Bi(t,"mean","batchNorm"),c=Bi(n,"variance","batchNorm");return null!=o&&(i=Bi(o,"scale","batchNorm")),null!=r&&(s=Bi(r,"offset","batchNorm")),Io(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Io(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),Io(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&Io(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&Io(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),ad(u,l,c,s,i,a)}function rd(e,t,n,r,o,a){var i,s,u=Bi(e,"x","batchNorm"),l=Bi(t,"mean","batchNorm"),c=Bi(n,"variance","batchNorm");return null!=o&&(i=Bi(o,"scale","batchNorm")),null!=r&&(s=Bi(r,"offset","batchNorm")),Io(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Io(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),Io(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&Io(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&Io(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),ad(u,l,c,s,i,a)}function od(e,t,n,r,o,a){var i,s,u=Bi(e,"x","batchNorm"),l=Bi(t,"mean","batchNorm"),c=Bi(n,"variance","batchNorm");return null!=o&&(i=Bi(o,"scale","batchNorm")),null!=r&&(s=Bi(r,"offset","batchNorm")),Io(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),Io(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),Io(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&Io(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&Io(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),ad(u,l,c,s,i,a)}function ad(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u,l=Bi(e,"x","batchNorm"),c=Bi(t,"mean","batchNorm"),f=Bi(n,"variance","batchNorm");return null!=o&&(i=Bi(o,"scale","batchNorm")),null!=r&&(s=Bi(r,"offset","batchNorm")),Io(c.rank===f.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Io(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Io(null==i||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,Pa.runKernel(function(e,t){var n=e.batchNormalization(u,id(c),id(f),a,id(i),id(s));return t([l,c,f,i]),n},{$x:l,$mean:c,$variance:f,$scale:i,$offset:s},function(e,t){var n=t,r=n[0],o=n[1],i=n[2],s=n[3],l=null==s?ts(1):s,c=yu(o.shape,u.shape),f=[];if(1===o.rank){for(var d=0;d<u.shape.length-1;++d)f.push(u.shape[d]);f.push(1)}var h=r.sub(o),p=e.mul(l),v=jf(i.add(ts(a))),m=v.mul(v).mul(v).mul(ts(-.5));return{$x:function(){return 1===o.rank?e.mul(Qs(v.as4D(1,1,1,o.shape[0]),f)).mul(l).reshape(r.shape):e.mul(v).mul(l).reshape(r.shape)},$mean:function(){var e=v.mul(ts(-1)).mul(p);return 1===o.rank&&(e=e.sum(c)),e.reshape(o.shape)},$variance:function(){var e=m.mul(h).mul(p);return 1===o.rank&&(e=e.sum(c)),e.reshape(o.shape)},$scale:function(){var t=h.mul(v),n=e.mul(t);return 1===o.rank&&(n=n.sum(c)),n.reshape(o.shape)},$offset:function(){var t=e;return 1===o.rank&&(t=t.sum(c)),t.reshape(o.shape)}}}).reshape(l.shape)}function id(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function sd(){Ai("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var ud=$i({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),sd(),nd(e,t,n,a,o,r)}}),ld=$i({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),sd(),rd(e,t,n,a,o,r)}}),cd=$i({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),sd(),od(e,t,n,a,o,r)}}),fd=$i({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),sd(),ad(e,t,n,a,o,r)}}),dd=$i({batchNorm_:ad}),hd=$i({batchNorm2d_:nd}),pd=$i({batchNorm3d_:rd}),vd=$i({batchNorm4d_:od});function md(e,t,n,r,o,a){Io(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,s=t,u=!1;3===t.rank&&(u=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),i=[1,e[0],e[1],e[2]]);var l=i[3],c=s.shape[3];Io(4===i.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+i.length+"."}),Io(4===s.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),Io(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}),Io(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),Io(c===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&Io(Oo(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=wu(i,n.shape,r,1,o,a),d=Pa.runKernel(function(e,t){var r=e.conv2dDerInput(s,n,f);return t([n,s]),r},{dy4D:s,filter:n},function(e,t){var n=t[0],i=t[1];return{dy4D:function(){return bd(e,n,r,o,"NHWC",1,a)},filter:function(){return Cd(e,i,n.shape,r,o,a)}}});return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function gd(e,t,n,r,o,a){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=t;3===s.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Io(4===i.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+i.shape+"."}),Io(4===s.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),Io(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}),Io(i.shape[3]===n[2],function(){return"Error in conv2dDerFilter: depth of input "+i.shape[3]+") must match input depth in filter ("+n[2]+"."}),Io(s.shape[3]===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."}),null!=a&&Io(Oo(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var u=wu(i.shape,n,r,1,o,a);return Pa.runKernel(function(e){return e.conv2dDerFilter(i,s,u)},{x4D:i,dy4D:s})}function yd(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}var xd=$i({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=Bi(e,"x","conv1d"),u=Bi(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),Io(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),Io(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&Io(Oo(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),Io(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),Io(Nu(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),Io("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),h=bd(d,f,[1,n],r,"NHWC",[1,a],i);return c?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),bd=$i({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Bi(e,"x","conv2d"),u=Bi(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Io(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),Io(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&Io(Oo(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),Io(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),Io(Nu(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),Io("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var f=wu(l.shape,u.shape,n,a,r,i),d=Pa.runKernel(function(e,t){var n=e.conv2d(l,u,f);return t([u,l]),n},{x:l,$filter:u},function(e,t){var o=t,i=o[0],s=o[1];return Io(_u(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return md(s.shape,e,i,n,r)},$filter:function(){return gd(s,e,i.shape,n,r)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),wd=$i({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=Bi(e,"x","conv3d"),s=Bi(t,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),Io(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Io(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),Io(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),Io(function(e,t){return yd(e)||yd(t)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),Io("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=Cu(u.shape,s.shape,n,a,r),f=Pa.runKernel(function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n},{x:u,$filter:s},function(e,t){Io(yd(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=t[0],i=t[1];return{x:function(){return function(e,t,n,r,o){Io(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];Io(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),Io(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),Io(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),Io(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),Io(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Cu(a,n.shape,r,1,o),f=Pa.runKernel(function(e){return e.conv3dDerInput(i,n,c)},{dy5D:i});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),Io(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),Io(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),Io(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),Io(a.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."}),Io(i.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=Cu(a.shape,n,r,1,o);return Pa.runKernel(function(e){return e.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Cd=$i({conv2dDerFilter_:gd}),Ed=$i({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Bi(e,"x","depthwiseConv2d"),u=Bi(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Io(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),Io(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),Io(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),Io(Nu(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&Io(Oo(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f=wu(l.shape,u.shape,n,a,r,i,!0),d=Pa.runKernel(function(e,t){var n=e.depthwiseConv2D(l,u,f);return t([l,u]),n},{x:l,$filter:u},function(e,t){Io(_u(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var n=t[0],r=t[1];return{x:function(){return function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=Pa.runKernel(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}(n.shape,e,r,f)},$filter:function(){return function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Pa.runKernel(function(e){return e.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}(n,e,r.shape,f)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),kd=$i({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=Bi(e,"x","separableConv2d"),u=Bi(t,"depthwiseFilter","separableConv2d"),l=Bi(n,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(3===s.rank&&(f=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Io(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),Io(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),Io(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),Io(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),Io(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],h=u.shape[3];Io(l.shape[2]===d*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+l.shape[2]+"."});var p=Ed(c,u,r,o,i,a),v=bd(p,l,1,"valid",i);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Sd=$i({conv2dTranspose_:function(e,t,n,r,o,a){return md(n,Bi(e,"x","conv2dTranspose"),Bi(t,"filter","conv2dTranspose"),r,o,a)}}),Rd=$i({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=Bi(e,"a","matMul"),i=Bi(t,"b","matMul");o=Na(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],f=a.shape.slice(0,-2),d=i.shape.slice(0,-2),h=Ao(f),p=Ao(d);Io(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),Io(Do(f,d),function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),Io(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=a.shape.slice(0,-2).concat([l,c]),m=n?a.as3D(h,s,l):a.as3D(h,l,s),g=r?i.as3D(p,c,u):i.as3D(p,u,c);return Pa.runKernel(function(e,t){var o=e.batchMatMul(m,g,n,r);return t([m,g]),o},{$a:m,$b:g},function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{$a:function(){return e.matMul(i,!1,!1)},$b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{$a:function(){return i.matMul(e,!1,!0)},$b:function(){return a.matMul(e,!1,!1)}}:{$a:function(){return i.matMul(e,!0,!0)},$b:function(){return e.matMul(a,!0,!0)}}:{$a:function(){return e.matMul(i,!1,!0)},$b:function(){return a.matMul(e,!0,!1)}}}).reshape(v)}}),Id=$i({dot_:function(e,t){var n=Bi(e,"t1","dot"),r=Bi(t,"t2","dot");Io(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return Io(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),_d=$i({outerProduct_:function(e,t){var n=Bi(e,"v1","outerProduct"),r=Bi(t,"v2","outerProduct");return Io(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Nd=$i({reverse_:function(e,t){var n=Bi(e,"x","reverse");if(0===n.rank)return n.clone();var r=Wo(t,n.shape);return Pa.runKernel(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),Td=$i({reverse1d_:function(e){var t=Bi(e,"x","reverse");return Io(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Nd(t,0)}}),Ad=$i({reverse2d_:function(e,t){var n=Bi(e,"x","reverse");return Io(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Nd(n,t)}}),Dd=$i({reverse3d_:function(e,t){var n=Bi(e,"x","reverse");return Io(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Nd(n,t)}}),Od=$i({reverse4d_:function(e,t){var n=Bi(e,"x","reverse");return Io(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Nd(n,t)}});function Fd(e,t,n,r,o,a){var i=Bi(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),Io(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Io(Nu(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=a&&Io(Oo(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=bu(s.shape,t,n,r,o,a),c=Pa.runKernel(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=Bi(e,"dy","maxPoolBackprop"),l=Bi(t,"input","maxPoolBackprop"),c=Bi(n,"output","maxPoolBackprop");Io(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),Io(Nu(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),Io(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),Io(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var f=bu(l.shape,r,o,a,i,s);return Pa.runKernel(function(e){return e.maxPoolBackprop(u,l,c,f)},{$dy:u,$input:l})}(e,i,s,t,n,r,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Pd(e,t,n,r,o,a){var i=Bi(e,"x","avgPool","float32");null==r&&(r=[1,1]),Io(Nu(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Io(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&Io(Oo(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=bu(s.shape,t,n,r,o,a),c=Pa.runKernel(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,a){var i=Bi(e,"dy","avgPoolBackprop"),s=Bi(t,"input","avgPoolBackprop");Io(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),Io(Nu(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Io(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),Io(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var f=bu(u.shape,n,r,o,a),d=Pa.runKernel(function(e){return e.avgPoolBackprop(l,u,f)},{dy4D:l,input4D:u});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,o)}}});return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Md=$i({maxPool_:function(e,t,n,r,o){return Fd(e,t,n,1,r,o)}}),Bd=$i({avgPool_:function(e,t,n,r,o){return Pd(e,t,n,1,r,o)}}),Ld=$i({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=Bi(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),Io(Nu(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=bu(s.shape,t,a,o,r),f=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([c.filterHeight,c.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),a=e.concat(r,o),i=t.map(function(e,t){return(e-a[t]%e)%e}),s=o.map(function(e,t){return e+i[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,i[t]]})]}([c.inHeight,c.inWidth],f,l),p=h[0],v=h[1],m=d?r:"valid",g=d?s:Xs(s,f,p),y=("avg"===n?function(){return Pd(g,t,a,1,m)}:function(){return Fd(g,t,a,1,m)})(),x=d?y:Ts(y,f,v);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Wd=$i({slice_:function(e,t,n){var r,o,a=Bi(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice(),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(Io(-1===e,function(){return"Bad value in size"}),a.shape[t]-r[t])}),function(e,t,n){Io(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),Io(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){Io(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}(a,r,o);var i=a.shape;return Pa.runKernel(function(e){return e.slice(a,r,o)},{$x:a},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{$x:function(){return e.pad(t)}}})}}),zd=$i({slice1d_:function(e,t,n){var r=Bi(e,"x","slice1d");return Io(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Wd(r,[t],[n])}}),Ud=$i({slice2d_:function(e,t,n){var r=Bi(e,"x","slice2d");return Io(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Wd(r,t,n)}}),jd=$i({slice3d_:function(e,t,n){var r=Bi(e,"x","slice3d");return Io(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Wd(r,t,n)}}),Vd=$i({slice4d_:function(e,t,n){var r=Bi(e,"x","slice4d");return Io(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Wd(r,t,n)}});function Hd(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(ji(t.shape,r))),e.rank<n.rank&&(e=e.reshape(ji(e.shape,r))),{$x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var Gd=$i({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","all","bool"),o=Wo(t,r.shape),a=o,i=Hi(a,r.rank);null!=i&&(r=r.transpose(i),a=qi(a.length,r.rank));var s=Pa.runKernel(function(e){return e.all(r,a)},{$x:r});if(n){var u=ji(s.shape,o);return s.reshape(u)}return s}}),qd=$i({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","any","bool"),o=Wo(t,r.shape),a=o,i=Hi(a,r.rank);null!=i&&(r=r.transpose(i),a=qi(a.length,r.rank));var s=Pa.runKernel(function(e){return e.any(r,a)},{$x:r});if(n){var u=ji(s.shape,o);return s.reshape(u)}return s}}),Kd=$i({argMax_:function(e,t){void 0===t&&(t=0);var n=Bi(e,"x","argMax");null==t&&(t=0);var r=Wo(t,n.shape),o=Hi(r,n.rank);return null!=o&&(n=n.transpose(o),r=qi(r.length,n.rank)),Pa.runKernel(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return fs(n)}}})}}),Xd=$i({argMin_:function(e,t){void 0===t&&(t=0);var n=Bi(e,"x","argMin");null==t&&(t=0);var r=Wo(t,n.shape),o=Hi(r,n.rank);return null!=o&&(n=n.transpose(o),r=qi(r.length,n.rank)),Pa.runKernel(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return fs(n)}}})}}),$d=$i({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","logSumExp"),o=Wo(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=ji(s.shape,o);return s.reshape(u)}return s}}),Yd=$i({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","max"),o=r,a=Wo(t,r.shape),i=a,s=Hi(i,r.rank);null!=s&&(r=r.transpose(s),i=qi(i.length,r.rank));var u=Pa.runKernel(function(e,t){var n=e.max(r,i);return t([o,n]),n},{$x:r},function(e,t){return Hd(e,t[1],t[0],a,s)});if(n){var l=ji(u.shape,a);u=u.reshape(l)}return u}}),Qd=$i({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","mean"),o=Wo(t,r.shape),a=Ao(Ui(r.shape,o)[1]);return hu(function(e){var r=ts(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(is(e.shape,"float32")).div(a)}}})(r)}}),Jd=$i({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","min"),o=r,a=Wo(t,r.shape),i=a,s=Hi(i,r.rank);null!=s&&(r=r.transpose(s),i=qi(i.length,r.rank));var u=Pa.runKernel(function(e,t){var n=e.min(r,i);return t([o,n]),n},{$x:r},function(e,t){return Hd(e,t[1],t[0],a,s)});if(n){var l=ji(u.shape,a);u=u.reshape(l)}return u}}),Zd=$i({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wo(t,(e=Bi(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;n||(a=ji(o.shape,r));var i=e.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),eh=$i({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=Wo(t,r.shape);return hu(function(e){var t=Hi(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=qi(r.length,e.rank));var i=Pa.runKernel(function(e){return e.sum(a,r)},{permutedX:a});if(n){var s=ji(i.shape,o);i=i.reshape(s)}return{value:i,gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(is(e.shape,"float32"))}}})(r)}}),th=$i({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Bi(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=Wo(t,r.shape),a=Hi(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=qi(i.length,r.rank));var u=Pa.runKernel(function(e){return e.prod(s,i)},{permutedX:s});if(n){var l=ji(u.shape,o);u=u.reshape(l)}return u}}),nh=$i({equal_:function(e,t){var n,r=Bi(e,"a","equal"),o=Bi(t,"b","equal");return n=Na(r,o),r=n[0],o=n[1],xu(r.shape,o.shape),Pa.runKernel(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),rh=$i({equalStrict_:function(e,t){var n=Bi(e,"a","equalStrict"),r=Bi(t,"b","equalStrict");return _o(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),oh=$i({greater_:function(e,t){var n,r=Bi(e,"a","greater"),o=Bi(t,"b","greater");return n=Na(r,o),r=n[0],o=n[1],xu(r.shape,o.shape),Pa.runKernel(function(e){return e.greater(r,o)},{$a:r,$b:o})}}),ah=$i({greaterEqual_:function(e,t){var n,r=Bi(e,"a","greaterEqual"),o=Bi(t,"b","greaterEqual");return n=Na(r,o),r=n[0],o=n[1],xu(r.shape,o.shape),Pa.runKernel(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return fs(n)},$b:function(){return fs(r)}}})}}),ih=$i({greaterEqualStrict_:function(e,t){var n=Bi(e,"a","greaterEqualStrict"),r=Bi(t,"b","greaterEqualStrict");return _o(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),sh=$i({greaterStrict_:function(e,t){var n=Bi(e,"a","greaterStrict"),r=Bi(t,"b","greaterStrict");return _o(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),uh=$i({less_:function(e,t){var n,r=Bi(e,"a","less"),o=Bi(t,"b","less");return n=Na(r,o),r=n[0],o=n[1],xu(r.shape,o.shape),Pa.runKernel(function(e){return e.less(r,o)},{$a:r,$b:o})}}),lh=$i({lessEqual_:function(e,t){var n,r=Bi(e,"a","lessEqual"),o=Bi(t,"b","lessEqual");return n=Na(r,o),r=n[0],o=n[1],xu(r.shape,o.shape),Pa.runKernel(function(e){return e.lessEqual(r,o)},{$a:r,$b:o})}}),ch=$i({lessEqualStrict_:function(e,t){var n=Bi(e,"a","lessEqualStrict"),r=Bi(t,"b","lessEqualStrict");return _o(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),fh=$i({lessStrict_:function(e,t){var n=Bi(e,"a","lessStrict"),r=Bi(t,"b","lessStrict");return _o(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),dh=$i({notEqual_:function(e,t){var n,r=Bi(e,"a","notEqual"),o=Bi(t,"b","notEqual");return n=Na(r,o),r=n[0],o=n[1],xu(r.shape,o.shape),Pa.runKernel(function(e){return e.notEqual(r,o)},{$a:r,$b:o})}}),hh=$i({notEqualStrict_:function(e,t){var n=Bi(e,"a","notEqualStrict"),r=Bi(t,"b","notEqualStrict");return _o(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}}),ph=$i({add_:function(e,t){var n,r=Bi(e,"a","add"),o=Bi(t,"b","add");n=Na(r,o),r=n[0],o=n[1];var a=xu(r.shape,o.shape);return Pa.runKernel(function(e){return e.add(r,o)},{$a:r,$b:o},function(e){return{$a:function(){var t=e,n=yu(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=yu(o.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)}}})}}),vh=$i({addN_:function(e){Io(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Io(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return Bi(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Do(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return Pa.runKernel(function(e){return e.addN(t)},r,function(e){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n})}}),mh=$i({addStrict_:function(e,t){var n=Bi(e,"a","addStrict"),r=Bi(t,"b","addStrict");return _o(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),gh=$i({atan2_:function(e,t){var n,r=Bi(e,"a","atan2"),o=Bi(t,"b","atan2");n=Na(r,o),r=n[0],o=n[1];var a=xu(r.shape,o.shape);return Pa.runKernel(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=ph(n.square(),r.square()),o=e.mul(r.div(t)),i=yu(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=ph(n.square(),r.square()),o=Wf(e.mul(n.div(t))),i=yu(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),yh=$i({div_:function(e,t){var n,r=Bi(e,"a","div"),o=Bi(t,"b","div");if(n=Na(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return bh(r,o);var a=xu(r.shape,o.shape);return Pa.runKernel(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),o=yu(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=yu(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}})}}),xh=$i({divStrict_:function(e,t){var n=Bi(e,"a","div"),r=Bi(t,"b","div");return _o(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),bh=$i({floorDiv_:function(e,t){var n,r=Bi(e,"a","floorDiv"),o=Bi(t,"b","floorDiv");n=Na(r,o),r=n[0],o=n[1];var a=xu(r.shape,o.shape);return Pa.runKernel(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),o=yu(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=yu(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}})}}),wh=$i({maximum_:function(e,t){var n,r=Bi(e,"a","maximum"),o=Bi(t,"b","maximum");return n=Na(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),xu(r.shape,o.shape),Pa.runKernel(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.greaterEqual(r).toFloat())},$b:function(){return e.mul(n.less(r).toFloat())}}})}}),Ch=$i({maximumStrict_:function(e,t){var n=Bi(e,"a","maximumStrict"),r=Bi(t,"b","maximumStrict");return _o(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Eh=$i({minimum_:function(e,t){var n,r=Bi(e,"a","minimum"),o=Bi(t,"b","minimum");return n=Na(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),xu(r.shape,o.shape),Pa.runKernel(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.lessEqual(r).toFloat())},$b:function(){return e.mul(n.greater(r).toFloat())}}})}}),kh=$i({minimumStrict_:function(e,t){var n=Bi(e,"a","minimumStrict"),r=Bi(t,"b","minimumStrict");return _o(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Sh=$i({mod_:function(e,t){var n,r=Bi(e,"a","mod"),o=Bi(t,"b","mod");n=Na(r,o),r=n[0],o=n[1];var a=xu(r.shape,o.shape);return Pa.runKernel(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=yu(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=yu(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),Rh=$i({modStrict_:function(e,t){var n=Bi(e,"a","modStrict"),r=Bi(t,"b","modStrict");return _o(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Ih=$i({mul_:function(e,t){var n,r=Bi(e,"a","mul"),o=Bi(t,"b","mul");n=Na(r,o),r=n[0],o=n[1];var a=xu(r.shape,o.shape);return Pa.runKernel(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.mul(r.toFloat()),o=yu(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=yu(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),_h=$i({mulStrict_:function(e,t){var n=Bi(e,"a","mul"),r=Bi(t,"b","mul");return _o(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Nh=$i({pow_:function(e,t){var n=Bi(e,"base","pow"),r=Bi(t,"exp","pow"),o=xu(n.shape,r.shape);return e=n.cast(Ia(n.dtype,r.dtype)),t=r.cast(Ia(n.dtype,r.dtype)),Pa.runKernel(function(e,t){var o=e.pow(n,r);return t([n,r,o]),o},{$base:n,$exp:r},function(e,t){var n=t[0],r=t[1],a=t[2];return{$base:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(ts(1))))),i=yu(n.shape,o);return i.length>0&&(a=a.sum(i)),a.reshape(n.shape)},$exp:function(){var t=n.greater(0),i=n.log().where(t,fs(n)),s=e.mul(a.mul(i)),u=yu(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}})}}),Th=$i({powStrict_:function(e,t){return _o(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Ah=$i({squaredDifference_:function(e,t){var n,r=Bi(e,"a","squaredDifference"),o=Bi(t,"b","squaredDifference");return n=Na(r,o),r=n[0],o=n[1],xu(r.shape,o.shape),Pa.runKernel(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1],o=ts(2);return{$a:function(){return e.mul(n.sub(r).mul(o))},$b:function(){return e.mul(r.sub(n).mul(o))}}})}}),Dh=$i({squaredDifferenceStrict_:function(e,t){var n=Bi(e,"a","squaredDifferenceStrict"),r=Bi(t,"b","squaredDifferenceStrict");return _o(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Oh=$i({sub_:function(e,t){var n,r=Bi(e,"a","sub"),o=Bi(t,"b","sub");n=Na(r,o),r=n[0],o=n[1];var a=xu(r.shape,o.shape);return Pa.runKernel(function(e){return e.subtract(r,o)},{$a:r,$b:o},function(e){return{$a:function(){var t=e,n=yu(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=yu(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}})}}),Fh=$i({subStrict_:function(e,t){var n=Bi(e,"a","subStrict"),r=Bi(t,"b","subStrict");return _o(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Ph=$i({logicalAnd_:function(e,t){var n=Bi(e,"a","logicalAnd","bool"),r=Bi(t,"b","logicalAnd","bool");return xu(n.shape,r.shape),Pa.runKernel(function(e){return e.logicalAnd(n,r)},{$a:n,$b:r})}}),Mh=$i({logicalNot_:function(e){var t=Bi(e,"x","logicalNot","bool");return Pa.runKernel(function(e){return e.logicalNot(t)},{$x:t})}}),Bh=$i({logicalOr_:function(e,t){var n=Bi(e,"a","logicalOr","bool"),r=Bi(t,"b","logicalOr","bool");return xu(n.shape,r.shape),Pa.runKernel(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),Lh=$i({logicalXor_:function(e,t){var n=Bi(e,"a","logicalXor","bool"),r=Bi(t,"b","logicalXor","bool");return xu(n.shape,r.shape),Bh(e,t).logicalAnd(Ph(e,t).logicalNot())}}),Wh=$i({where_:function(e,t,n){var r=Bi(t,"a","where"),o=Bi(n,"b","where"),a=Bi(e,"condition","where","bool");return _o(r.shape,o.shape,"Error in where: "),1===a.rank?Io(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):_o(a.shape,o.shape,"Error in where: "),Pa.runKernel(function(e,t){var n=e.select(a,r,o);return t([a]),n},{$condition:a,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return fs(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),zh=$i({elu_:function(e){var t=Bi(e,"x","elu");return Pa.runKernel(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return Pa.runKernel(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),Uh=$i({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=Bi(e,"x","leakyRelu");return wh(ts(t).mul(n),n)}}),jh=$i({prelu_:function(e,t){var n=Bi(e,"x","prelu"),r=Bi(t,"alpha","prelu");return Pa.runKernel(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{$x:n,$alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{$x:function(){return Wh(o,e,e.mul(r))},$alpha:function(){var t=Wh(o,fs(e),e.mul(n)),a=yu(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}})}}),Vh=$i({relu_:function(e){var t=Bi(e,"x","relu");return"bool"===t.dtype?t.toInt():Pa.runKernel(function(e,n){var r=e.relu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n.step().toFloat())}}})}}),Hh=$i({selu_:function(e){var t=Bi(e,"x","selu");return Pa.runKernel(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(ts(0)),r=ts(rf),o=ts(of),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return Wh(t,a,i)}}})}}),Gh=$i({transpose_:function(e,t){var n=Bi(e,"x","transpose");return null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),Io(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){Io(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1?n.clone():Pa.runKernel(function(e){return e.transpose(n,t)},{$x:n},function(e){var n=Gi(t);return{$x:function(){return e.transpose(n)}}})}}),qh=$i({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=Bi(e,"x","localResponseNormalization");Io(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),Io(Oo(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=Pa.runKernel(function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return Pa.runKernel(function(a){return a.LRNGrad(e,i,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Kh=$i({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(ts(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Bi(e,"x","norm"),t,n),a=o.shape;if(r){var i=Wo(n,e.shape);a=ji(o.shape,i)}return o.reshape(a)}});function Xh(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function $h(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Yh=$i({gather_:function(e,t,n){void 0===n&&(n=0);var r=Bi(e,"x","gather"),o=Bi(t,"indices","gather","int32");n=Wo(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return Pa.runKernel(function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a},{$x:r},function(e,t){var o=t[0];return{$x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),l=u.length,c=Xh(0,s),f=Xh(s+1,s+1+l),d=$h([i,[a],u]),h=e.reshape(d),p=o.reshape([a]),v=$h([[s],c,f]),m=h.transpose(v),g=Qh(m,p,r.shape[n]),y=Gi(v);return g.transpose(y)}}}).reshape(a.outputShape)}}),Qh=$i({unsortedSegmentSum_:function(e,t,n){var r=Bi(e,"x","unsortedSegmentSum"),o=Bi(t,"segmentIds","unsortedSegmentSum","int32");return Io(Oo(n),function(){return"numSegments must be of dtype int"}),Pa.runKernel(function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=wh(t,fs(t)),r=Yh(e,n),o=ah(t,ts(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=Ps(o,i+1);o=Ph(o,is(r.shape,"bool"));var s=fs(r);return Wh(o,r,s)}(e,n)}}})}}),Jh=$i({basicLSTMCell_:function(e,t,n,r,o,a){var i=Bi(e,"forgetBias","basicLSTMCell"),s=Bi(t,"lstmKernel","basicLSTMCell"),u=Bi(n,"lstmBias","basicLSTMCell"),l=Bi(r,"data","basicLSTMCell"),c=Bi(o,"c","basicLSTMCell"),f=Bi(a,"h","basicLSTMCell"),d=l.concat(f,1).matMul(s).add(u),h=d.shape[0],p=d.shape[1]/4,v=[h,p],m=d.slice([0,0],v),g=d.slice([0,p],v),y=d.slice([0,2*p],v),x=d.slice([0,3*p],v),b=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(i.add(y).sigmoid())),w=b.tanh().mulStrict(x.sigmoid());return[b,w]}}),Zh=$i({multiRNNCell_:function(e,t,n,r){for(var o=Bi(t,"data","multiRNNCell"),a=Li(n,"c","multiRNNCell"),i=Li(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var f=[],d=[];for(l=0;l<u.length;l+=2)f.push(u[l]),d.push(u[l+1]);return[f,d]}}),ep=$i({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=Bi(e,"v","movingAverage"),i=Bi(t,"x","movingAverage"),s=Bi(n,"decay","movingAverage");Ta(a,i),Io(Do(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=ts(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){Io(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=Bi(r,"step","movingAverage");c=c.div(u.sub(Nh(s,f)))}return a.add(c)}}),tp=$i({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==i)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var l=Bi(e,"x","stridedSlice");if(r.every(function(e){return 1===e})){var c=uu(l.shape,t,n,r,o,a,i,s,u),f=c[0],d=c[1],h=c[2],p=d.filter(function(e,t){return-1===h.indexOf(t)});return Wd(l,f,d).reshape(p)}return Pa.runKernel(function(e){return e.stridedSlice(l,t,n,r,o,a,i,s,u)},{$x:l})}}),np=$i({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=Bi(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=Pa.runKernel(function(e){return e.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}}),rp=$i({scatterND_:function(e,t,n){var r=Bi(e,"indices","scatterND","int32"),o=Bi(t,"updates","scatterND");return function(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}(n,t,e)}(o,r,n),Pa.runKernel(function(e){return e.scatterND(r,o,n)},{$indices:r,$updates:o})}}),op=$i({fft_:function(e){Io("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Pa.runKernel(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),ap=$i({ifft_:function(e){Io("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Pa.runKernel(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),ip=$i({rfft_:function(e,t){Io("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(null!=t&&t<r){var a=e.shape.map(function(e){return 0}),i=e.shape.map(function(e){return e});i[e.shape.length-1]=t,n=e.slice(a,i),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(ss(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=Yi(n,u).as2D(o,r),c=op(l),f=Math.floor(r/2)+1,d=Qi(c),h=Ji(c),p=d.split([f,r-f],d.shape.length-1),v=h.split([f,r-f],h.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,Yi(p[0],v[0]).reshape(m)}}),sp=$i({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=ap(r);return Qi(o)}var a=[n,2*(t-1)],i=Qi(e).as2D(n,t),s=Ji(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(ts(-1)),c=i.concat(u,1),f=s.concat(l,1);return r=Yi(c,f).as2D(a[0],a[1]),o=ap(r),Qi(o)}}),up=Object.freeze({fft:op,ifft:ap,rfft:ip,irfft:sp}),lp=$i({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=Bi(e,"sparseIndices","sparseToDense","int32"),a=Bi(t,"sparseValues","sparseToDense"),i=Bi(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),Pa.runKernel(function(e){return e.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),cp=$i({gatherND_:function(e,t){var n=Bi(t,"indices","gatherND","int32"),r=Bi(e,"x","gatherND");return Pa.runKernel(function(e){return e.gatherND(r,n)},{$x:r,$indices:n})}}),fp=$i({dropout_:function(e,t,n,r){if(null!=n&&!Do(e.shape,n))throw new Error("Non-default noise shape is not implemented yet: "+JSON.stringify(n));var o=qs(e.shape,0,1,"float32",r).greater(t);return o=o.div(Oh(1,t)),e.mul(o)}});function dp(e,t,n){for(var r=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var i=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(i)}return ns(o,"float32")}var hp,pp=$i({hannWindow_:function(e){return dp(e,.5,.5)}}),vp=$i({hammingWindow_:function(e){return dp(e,.54,.46)}}),mp=$i({frame_:function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+t<=e.size;)i.push(Wd(e,a,t)),a+=n;if(r){var s=a+t-e.size,u=ds([Wd(e,a,t-s),us([s],o)]);i.push(u)}return 0===i.length?rs([],[0,t]):ds(i).as2D(i.length,t)}}),gp=Object.freeze({hannWindow:pp,hammingWindow:vp,frame:mp});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(hp||(hp={}));var yp=$i({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=hp.SUM_BY_NONZERO_WEIGHTS);var o=Bi(e,"labels","absoluteDifference"),a=Bi(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=Bi(n,"weights","absoluteDifference")),_o(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return xp(s,i,r)}}),xp=$i({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=hp.SUM_BY_NONZERO_WEIGHTS);var r=Bi(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=Bi(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===hp.NONE)return a;if(n===hp.SUM)return a.sum();if(n===hp.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(ts(i)):s}if(n===hp.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(ts(r.size));var u=o.mul(is(r.shape)).notEqual(ts(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),bp=$i({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=hp.SUM_BY_NONZERO_WEIGHTS);var a=Bi(e,"labels","cosineDistance"),i=Bi(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Bi(r,"weights","cosineDistance")),_o(a.shape,i.shape,"Error in cosineDistance: ");var u=ts(1).sub(a.mul(i).sum(n,!0));return xp(u,s,o)}}),wp=$i({hingeLoss_:function(e,t,n,r){void 0===r&&(r=hp.SUM_BY_NONZERO_WEIGHTS);var o=Bi(e,"labels","hingeLoss"),a=Bi(t,"predictions","hingeLoss"),i=null;null!=n&&(i=Bi(n,"weights","hingeLoss")),_o(o.shape,a.shape,"Error in hingeLoss: ");var s=ts(1);o=ts(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return xp(u,i,r)}}),Cp=$i({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=hp.SUM_BY_NONZERO_WEIGHTS);var a=Bi(e,"labels","huberLoss"),i=Bi(t,"predictions","huberLoss"),s=null;null!=n&&(s=Bi(n,"weights","huberLoss")),_o(a.shape,i.shape,"Error in huberLoss: ");var u=ts(r),l=i.sub(a).abs(),c=Eh(l,u),f=l.sub(c),d=ts(.5).mul(c.square()).add(u.mul(f));return xp(d,s,o)}}),Ep=$i({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=hp.SUM_BY_NONZERO_WEIGHTS);var a=Bi(e,"labels","logLoss"),i=Bi(t,"predictions","logLoss"),s=null;null!=n&&(s=Bi(n,"weights","logLoss")),_o(a.shape,i.shape,"Error in logLoss: ");var u=ts(1),l=ts(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return xp(c,s,o)}}),kp=$i({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=hp.SUM_BY_NONZERO_WEIGHTS);var o=Bi(e,"labels","meanSquaredError"),a=Bi(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=Bi(n,"weights","meanSquaredError")),_o(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return xp(s,i,r)}}),Sp=$i({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=hp.SUM_BY_NONZERO_WEIGHTS);var a=Bi(e,"multiClassLabels","sigmoidCrossEntropy"),i=Bi(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Bi(n,"weights","sigmoidCrossEntropy")),_o(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ts(r),l=ts(1),c=ts(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var f=function(e,t){var n=Bi(e,"labels","sigmoidCrossEntropyWithLogits"),r=Bi(t,"logits","sigmoidCrossEntropyWithLogits");_o(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return xp(f,s,o)}}),Rp=$i({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=hp.SUM_BY_NONZERO_WEIGHTS);var a=Bi(e,"onehotLabels","softmaxCrossEntropy"),i=Bi(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Bi(n,"weights","softmaxCrossEntropy")),_o(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ts(r),l=ts(1),c=ts(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return hu(function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=ji(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(a,i);return xp(f,s,o)}}),Ip=Object.freeze({get Reduction(){return hp},absoluteDifference:yp,computeWeightedLoss:xp,cosineDistance:bp,hingeLoss:wp,huberLoss:Cp,logLoss:Ep,meanSquaredError:kp,sigmoidCrossEntropy:Sp,softmaxCrossEntropy:Rp});function _p(e,t){return void 0===t&&(t=!1),Pa.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=Ms(n),a=e.clone(),i=rs([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=o;t=Pa.tidy(function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=l.sign().neg(),f=l.sub(c.mul(u)),d=t.div(f);s=1===d.shape[0]?i.clone():i.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var h=c.matMul(f).div(u).neg(),p=a.slice([e,0],[n-e,r]),v=h.mul(s);a=0===e?p.sub(v.matMul(s.transpose().matMul(p))):a.slice([0,0],[e,r]).concat(p.sub(v.matMul(s.transpose().matMul(p))),0);var m=o.slice([0,e],[n,o.shape[1]-e]);return o=0===e?m.sub(m.matMul(s).matMul(v.transpose())):o.slice([0,0],[n,e]).concat(m.sub(m.matMul(s).matMul(v.transpose())),1),[s,a,o]}),s=t[0],a=t[1],o=t[2],Oi([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var Np=$i({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,Io(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){Io(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=gs(e,e.shape[0],0).map(function(e){return $s(e,[0])});Io(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(e){a.push(Pa.tidy(function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=eh(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(Kh(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?Ys(a,0):a}}),Tp=$i({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return _p(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=Zs(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return r.forEach(function(e){var n=_p(e,t),r=n[0],i=n[1];o.push(r),a.push(i)}),[Ys(o,0).reshape(e.shape),Ys(a,0).reshape(e.shape)]}}),Ap=Object.freeze({gramSchmidt:Np,qr:Tp});function Dp(e,t,n,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var a=e.shape[0];return n=Math.min(n,a),Io(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),Io(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),Io(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),Io(1===t.rank,function(){return"scores must be a 1D tensor"}),Io(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}var Op=$i({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=Bi(e,"images","resizeBilinear");Io(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),Io(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Pa.runKernel(function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return Pa.runKernel(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Fp=$i({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=Bi(e,"images","resizeNearestNeighbor");Io(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),Io(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),Io("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Pa.runKernel(function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return Pa.runKernel(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Pp=$i({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=Bi(e,"boxes","nonMaxSuppression"),i=Bi(t,"scores","nonMaxSuppression"),s=Dp(a,i,n,r,o);return n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,Pa.runKernel(function(e){return e.nonMaxSuppression(a,i,n,r,o)},{$boxes:a})}}),Mp=$i({cropAndResize_:function(e,t,n,r,o,a){var i=Bi(e,"image","cropAndResize","float32"),s=Bi(t,"boxes","cropAndResize","float32"),u=Bi(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return Io(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),Io(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),Io(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),Io(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),Io(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),Io("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),Pa.runKernel(function(e,t){return e.cropAndResize(i,s,u,r,o,a)},{$image:i,$boxes:s})}}),Bp=Object.freeze({resizeBilinear:Op,resizeNearestNeighbor:Fp,nonMaxSuppression:Pp,nonMaxSuppressionAsync:function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),go(this,void 0,void 0,function(){var a,i,s,u,l,c;return yo(this,function(f){switch(f.label){case 0:return a=Bi(e,"boxes","nonMaxSuppressionAsync"),i=Bi(t,"scores","nonMaxSuppressionAsync"),s=Dp(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,a.data()];case 1:return u=f.sent(),[4,i.data()];case 2:return l=f.sent(),c=Bu(u,l,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,c]}})})},cropAndResize:Mp}),Lp=$i({matMul_:function(e,t,n,r,o,a){var i;void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a="linear");var s=Bi(e,"a","fused matMul"),u=Bi(t,"b","fused matMul");i=Na(s,u),s=i[0],u=i[1];var l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],f=n?s.shape[s.rank-1]:s.shape[s.rank-2],d=r?u.shape[u.rank-2]:u.shape[u.rank-1],h=s.shape.slice(0,-2),p=u.shape.slice(0,-2),v=Ao(h),m=Ao(p);Io(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),Io(Do(h,p),function(){return"Error in fused matMul: outer dimensions ("+h+") and ("+p+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),Io(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var g,y=s.shape.slice(0,-2).concat([f,d]),x=n?s.as3D(v,l,f):s.as3D(v,f,l),b=r?u.as3D(m,d,c):u.as3D(m,c,d);null!=o&&xu(y,(g=Na(g=Bi(o,"bias","fused matMul"),s)[0]).shape);var w={$a:x,$b:b};return null!=o&&(w.$bias=g),Pa.runKernel(function(e,t){var o=e.fusedBatchMatMul(x,b,n,r,g,a);return t([x,b,o]),o},w,function(e,t){var i,s=t[0],u=t[1],l=t[2];if(null==a||"linear"===a)i=e;else{if("relu"!==a)throw new Error("Gradient for activation "+a+" has not been implemented yet.");i=e.mul(l.step())}var c={};return null!=o&&(c={$bias:function(){var e=i,t=yu(g.shape,i.shape);return t.length>0&&(e=e.sum(t)),e.reshape(g.shape)}}),n||r?!n&&r?Object.assign({$a:function(){return i.matMul(u,!1,!1)},$b:function(){return i.matMul(s,!0,!1)}},c):n&&!r?Object.assign({$a:function(){return u.matMul(i,!1,!0)},$b:function(){return s.matMul(i,!1,!1)}},c):Object.assign({$a:function(){return u.matMul(i,!0,!0)},$b:function(){return i.matMul(s,!0,!0)}},c):Object.assign({$a:function(){return i.matMul(u,!1,!0)},$b:function(){return s.matMul(i,!0,!1)}},c)}).reshape(y)}}),Wp=Object.freeze({matMul:Lp}),zp=Object.freeze({image:Bp,linalg:Ap,losses:Ip,spectral:up,fused:Wp,signal:gp,op:$i,batchNormalization2d:ud,batchNormalization3d:ld,batchNormalization4d:cd,batchNormalization:fd,batchNorm:dd,batchNorm2d:hd,batchNorm3d:pd,batchNorm4d:vd,complex:Yi,real:Qi,imag:Ji,concat:ds,concat1d:hs,concat2d:ps,concat3d:vs,concat4d:ms,split:gs,conv1d:xd,conv2d:bd,conv3d:wd,conv2dDerFilter:Cd,depthwiseConv2d:Ed,separableConv2d:kd,conv2dTranspose:Sd,matMul:Rd,dot:Id,outerProduct:_d,reverse:Nd,reverse1d:Td,reverse2d:Ad,reverse3d:Dd,reverse4d:Od,maxPool:Md,avgPool:Bd,pool:Ld,slice:Wd,slice1d:zd,slice2d:Ud,slice3d:jd,slice4d:Vd,abs:wf,acos:Cf,acosh:Ef,asin:kf,asinh:Sf,atan:Rf,atanh:If,ceil:_f,clipByValue:Nf,cos:Tf,cosh:Af,erf:Df,exp:Of,expm1:Ff,floor:Pf,log:Mf,log1p:Bf,logSigmoid:Lf,neg:Wf,reciprocal:zf,round:Uf,rsqrt:jf,sigmoid:Vf,sign:Hf,isNaN:Gf,isInf:qf,isFinite:Kf,sin:Xf,sinh:$f,softplus:Yf,sqrt:Qf,square:Jf,step:Zf,tan:ed,tanh:td,all:Gd,any:qd,argMax:Kd,argMin:Xd,logSumExp:$d,max:Yd,mean:Qd,min:Jd,moments:Zd,sum:eh,prod:th,equal:nh,equalStrict:rh,greater:oh,greaterEqual:ah,greaterEqualStrict:ih,greaterStrict:sh,less:uh,lessEqual:lh,lessEqualStrict:ch,lessStrict:fh,notEqual:dh,notEqualStrict:hh,add:ph,addN:vh,addStrict:mh,atan2:gh,div:yh,divStrict:xh,floorDiv:bh,maximum:wh,maximumStrict:Ch,minimum:Eh,minimumStrict:kh,mod:Sh,modStrict:Rh,mul:Ih,mulStrict:_h,pow:Nh,powStrict:Th,squaredDifference:Ah,squaredDifferenceStrict:Dh,sub:Oh,subStrict:Fh,elu:zh,leakyRelu:Uh,prelu:jh,relu:Vh,selu:Hh,logicalAnd:Ph,logicalNot:Mh,logicalOr:Bh,logicalXor:Lh,where:Wh,whereAsync:function(e){return go(this,void 0,void 0,function(){var t,n,r;return yo(this,function(o){switch(o.label){case 0:return[4,(t=Bi(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=ju(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},buffer:Ns,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Ts,cast:As,clone:Ds,cumsum:Os,depthToSpace:Fs,expandDims:Ps,eye:Ms,multinomial:Bs,oneHot:Ls,pad:Ws,pad1d:zs,pad2d:Us,pad3d:js,pad4d:Vs,rand:Hs,randomNormal:Gs,randomUniform:qs,reshape:Ks,spaceToBatchND:Xs,squeeze:$s,stack:Ys,tile:Qs,truncatedNormal:Js,unstack:Zs,setdiff1dAsync:function(e,t){return go(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f;return yo(this,function(d){switch(d.label){case 0:return n=Bi(e,"x","setdiff1d"),r=Bi(t,"y","setdiff1d"),Io(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),Io(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),Io(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(a=d.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new va([s],n.dtype),l=new va([s],"int32"),c=0,f=0;c<o.length;c++)i.has(o[c])||(u.values[f]=o[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})},fill:us,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Pa.runKernel(function(r){return r.linspace(e,t,n)},{})},ones:is,range:ls,scalar:ts,tensor:Zi,tensor1d:ns,tensor2d:rs,tensor3d:os,tensor4d:as,tensor5d:function(e,t,n){if(No(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Pi(e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return es(e,t,r,n)},tensor6d:function(e,t,n){if(No(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Pi(e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return es(e,t=t||r,r,n)},zeros:ss,onesLike:cs,zerosLike:fs,transpose:Gh,softmax:pu,logSoftmax:vu,localResponseNormalization:qh,norm:Kh,gather:Yh,unsortedSegmentSum:Qh,basicLSTMCell:Jh,multiRNNCell:Zh,movingAverage:ep,stridedSlice:tp,topk:np,scatterND:rp,fft:op,ifft:ap,rfft:ip,irfft:sp,sparseToDense:lp,gatherND:cp,dropout:fp,hannWindow:pp,hammingWindow:vp,frame:mp}),Up=function(){function e(){if(this.blockSize=48,this.firstUse=!0,wo.get("IS_BROWSER")){var e=function(){if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}();this.fromPixels2DContext=e.getContext("2d")}this.data=new mu(this,Pa)}return e.prototype.register=function(e,t,n){if(this.firstUse&&(this.firstUse=!1,wo.get("IS_NODE")&&Fi("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:n})},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,r;if(wo.get("IS_NODE")&&null==e.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=e.getContext)n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData||e.data instanceof Uint8Array)n=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),n=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(4===t)r=new Int32Array(n);else{var o=e.width*e.height;r=new Int32Array(o*t);for(var a=0;a<o;a++)for(var i=0;i<t;++i)r[a*t+i]=n[4*a+i]}return os(r,[e.height,e.width,t],"int32")},e.prototype.read=function(e){return go(this,void 0,void 0,function(){return yo(this,function(t){return[2,this.readSync(e)]})})},e.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Ou(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},e.prototype.bufferSync=function(e){return Ns(e.shape,e.dtype,this.readSync(e.dataId))},e.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},e.prototype.time=function(e){return go(this,void 0,void 0,function(){var t;return yo(this,function(n){return t=sa(),e(),[2,{kernelMs:sa()-t}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(e,t){var n=xa.make(e.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:Pa.keep(e.clone()),imag:Pa.keep(t.clone())},n},e.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},e.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&Io("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})},e.prototype.slice=function(e,t,n){if(this.assertNotComplex(e,"slice"),fu(e.shape,t,n)){var r=du(t,e.strides),o=Ao(n);return Zi(this.readSync(e.dataId).subarray(r,r+o),n,e.dtype)}for(var a=Ns(n,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(e,n){return e+t[n]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){this.assertNotComplex(e,"stridedSlice");var l=uu(e.shape,t,n,r,o,a,i,s,u),c=l[0],f=l[1],d=l[2],h=f.filter(function(e,t){return-1===d.indexOf(t)});if(h.some(function(e){return 0===e}))return Zi([],h);for(var p=Ns(f,e.dtype),v=this.bufferSync(e),m=0;m<p.size;m++){for(var g=p.indexToLoc(m),y=new Array(g.length),x=0;x<y.length;x++)y[x]=g[x]*r[x]+c[x];p.set.apply(p,[v.get.apply(v,y)].concat(g))}return p.toTensor().reshape(h)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},e.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var n=Ns(e.shape,e.dtype),r=this.bufferSync(e),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},e.prototype.concat=function(e,t){var n=this;this.assertNotComplex(e,"concat");var r=e.map(function(e){var n=Ao(e.shape.slice(t));return e.as2D(-1,n)}),o=Xi(r.map(function(e){return e.shape}),1),a=Ns(o,e[0].dtype).values;if(1===r[0].shape[0]){var i=0;r.forEach(function(e){a.set(n.readSync(e.dataId),i),i+=e.size})}else{var s=0;r.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var u=i*o[1]+s,l=0;l<e.shape[1];++l)a[u+l]=t[r++];s+=e.shape[1]})}var u=Xi(e.map(function(e){return e.shape}),t);return Zi(a,u,e[0].dtype)},e.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(ts(-1),e)},e.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,Ia(e.dtype,t.dtype),function(e,t){return e+t})},e.prototype.addN=function(e){var t=this;this.assertNotComplex(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=Ns(e[0].shape,e[0].dtype),o=r.values,a=0;a<e.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},e.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,Ia(e.dtype,t.dtype),function(e,t){return e-t})},e.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},e.prototype.batchMatMul=function(e,t,n,r){this.assertNotComplex([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=c[0],d=c[1],h=c[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=p[0],m=p[1],g=p[2],y=a*i,x=Ns([s,a,i],e.dtype),b=x.values,w=this.blockSize,C=0;C<s;C++)for(var E=0;E<a;E+=w)for(var k=0;k<i;k+=w)for(var S=0;S<o;S+=w)for(var R=Math.min(E+w,a),I=Math.min(k+w,i),_=Math.min(S+w,o),N=E;N<R;N++)for(var T=k;T<I;T++){for(var A=0,D=S;D<_;D++)A+=u[C*f+N*d+D*h]*l[D*v+T*m+C*g];b[C*y+(N*i+T)]+=A}return x.toTensor()},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){var i=this.batchMatMul(e,t,n,r);return o&&(i=this.add(i,o)),a&&(i=function(e,t,n){if("linear"===t)return e.linear(n);if("relu"===t)return e.relu(n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}(this,a,i)),i},e.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,Ia(e.dtype,t.dtype),function(e,t){return e*t})},e.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},e.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},e.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),Vi("sum",t,e.rank);for(var n=Ui(e.shape,t),r=n[0],o=n[1],a=ss(r,Ia(e.dtype,"int32")),i=Ao(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=0,d=0;d<i;++d)f+=u[c+d];s[l]=f}return a},e.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var n=Ui(e.shape,t),r=n[0],o=n[1],a=ss(r,Ia(e.dtype,"int32")),i=Ao(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=1,d=0;d<i;++d)f*=u[c+d];s[l]=f}return a},e.prototype.unsortedSegmentSum=function(e,t,n){this.assertNotComplex(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=ts(a,"int32"),s=nh(i,t).asType("float32").mul(e).sum(0);r.push(s)}return Ys(r)},e.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var n=[t];Vi("argMin",n,e.rank);for(var r=Ui(e.shape,n),o=r[0],a=r[1],i=ss(o,"int32"),s=Ao(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,d=l[f],h=0,p=0;p<s;++p){var v=l[f+p];v<d&&(d=v,h=p)}u[c]=h}return i},e.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var n=[t];Vi("argMax",n,e.rank);for(var r=Ui(e.shape,n),o=r[0],a=r[1],i=ss(o,"int32"),s=Ao(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,d=l[f],h=0,p=0;p<s;++p){var v=l[f+p];v>d&&(d=v,h=p)}u[c]=h}return i},e.prototype.cumsum=function(e,t,n,r){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=Ia(e.dtype,"int32"),a=ss(e.shape,o),i=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var f=0;f<u;f++){var d=l(c,f);if(0===f)i[d]=n?0:s[d];else{var h=l(c,f-1);i[d]=n?s[h]+i[h]:s[d]+i[h]}}return a},e.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},e.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},e.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},e.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},e.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},e.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},e.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return xa.make(e.shape,{values:n},"bool")},e.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},e.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},e.prototype.select=function(e,t,n){this.assertNotComplex([e,t,n],"select");for(var r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(n.dataId),i=ss(t.shape,Ia(t.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:t.shape[1],c=0;c<r.length;c++)for(var f=0;f<l;f++)1===r[c]?s[u++]=o[c]:s[u++]=a[c];return i},e.prototype.where=function(e){this.assertNotComplex([e],"where");var t=this.readSync(e.dataId);return ju(e.shape,t)},e.prototype.topk=function(e,t,n){return this.assertNotComplex(e,"topk"),Uu(this.readSync(e.dataId),e.shape,e.dtype,t)},e.prototype.min=function(e,t){this.assertNotComplex(e,"min"),Vi("min",t,e.rank);for(var n=Ui(e.shape,t),r=n[0],o=n[1],a=ss(r,e.dtype),i=Ao(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];h<f&&(f=h)}s[l]=f}return a},e.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},e.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},e.prototype.max=function(e,t){this.assertNotComplex(e,"max"),Vi("max",t,e.rank);for(var n=Ui(e.shape,t),r=n[0],o=n[1],a=ss(r,e.dtype),i=Ao(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];h>f&&(f=h)}s[l]=f}return a},e.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},e.prototype.all=function(e,t){this.assertNotComplex(e,"all"),Vi("all",t,e.rank);for(var n=Ui(e.shape,t),r=n[0],o=n[1],a=ss(r,e.dtype),i=Ao(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];f=f&&h}s[l]=f}return a},e.prototype.any=function(e,t){this.assertNotComplex(e,"any"),Vi("any",t,e.rank);for(var n=Ui(e.shape,t),r=n[0],o=n[1],a=ss(r,e.dtype),i=Ao(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];f=f||h}s[l]=f}return a},e.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},e.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return xa.make(e.shape,{values:n})},e.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return xa.make(e.shape,{values:n})},e.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return xa.make(e.shape,{values:n})},e.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return xa.make(e.shape,{values:n},"bool")},e.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return xa.make(e.shape,{values:n},"bool")},e.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return xa.make(e.shape,{values:n},"bool")},e.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return xa.make(e.shape,{values:n})},e.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return xa.make(e.shape,{values:n})},e.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return xa.make(e.shape,{values:n})},e.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return xa.make(e.shape,{values:n})},e.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return xa.make(e.shape,{values:n})},e.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return xa.make(e.shape,{values:n})},e.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return xa.make(e.shape,{values:n})},e.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=o*o}return xa.make(e.shape,{values:n})},e.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return xa.make(e.shape,{values:n})},e.prototype.linear=function(e){return e},e.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=ss(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},e.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},e.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return xa.make(e.shape,{values:t})},e.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return xa.make(t.shape,{values:n})},e.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=rf,n=of,r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?n*i:t*(Math.exp(i)-1)}return xa.make(e.shape,{values:r})},e.prototype.clip=function(e,t,n){this.assertNotComplex(e,"clip");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return xa.make(e.shape,{values:r})},e.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return xa.make(e.shape,{values:t})},e.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return xa.make(e.shape,{values:t})},e.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return xa.make(e.shape,{values:t},"int32")},e.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return xa.make(e.shape,{values:t})},e.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return xa.make(e.shape,{values:n})},e.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return xa.make(e.shape,{values:t})},e.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return xa.make(e.shape,{values:t})},e.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return xa.make(e.shape,{values:t})},e.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return xa.make(e.shape,{values:t})},e.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return xa.make(e.shape,{values:t})},e.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return xa.make(e.shape,{values:t})},e.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},e.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return xa.make(e.shape,{values:t})},e.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return xa.make(e.shape,{values:t})},e.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Fo(n[r]);return xa.make(e.shape,{values:t})},e.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return xa.make(e.shape,{values:t})},e.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return xa.make(e.shape,{values:t})},e.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return xa.make(e.shape,{values:t})},e.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r],a=1/(1+.3275911*o);t[r]=1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-o*o)}return xa.make(e.shape,{values:t})},e.prototype.step=function(e,t){void 0===t&&(t=0),this.assertNotComplex(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return xa.make(e.shape,{values:n})},e.prototype.conv2d=function(e,t,n){this.assertNotComplex([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=Ns(n.outShape,e.dtype),c=this.readSync(e.dataId),f=this.readSync(t.dataId),d=l.values,h=0;h<n.batchSize;++h)for(var p=h*e.strides[0],v=h*l.strides[0],m=0;m<n.outHeight;++m)for(var g=v+m*l.strides[1],y=m*n.strideHeight-u,x=0;x<r;x++){var b=y+x*a;if(!(b<0||b>=n.inHeight))for(var w=x*t.strides[0],C=p+b*e.strides[1],E=0;E<n.outWidth;++E)for(var k=g+E*n.outChannels,S=E*n.strideWidth-s,R=0;R<o;R++){var I=S+R*i;if(!(I<0||I>=n.inWidth))for(var _=w+R*t.strides[1],N=C+I*n.inChannels,T=_,A=0;A<n.inChannels;++A){for(var D=c[N+A],O=0;O<n.outChannels;++O)d[k+O]+=D*f[T+O];T+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,f=n.padInfo.top,d=Ns(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),v=d.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*d.strides[0],x=0;x<n.outDepth;++x)for(var b=y+x*d.strides[1],w=x*n.strideDepth-l,C=0;C<r;C++){var E=w+C*i;if(!(E<0||E>=n.inDepth))for(var k=C*t.strides[0],S=g+E*e.strides[1],R=0;R<n.outHeight;++R)for(var I=b+R*d.strides[2],_=R*n.strideHeight-f,N=0;N<o;N++){var T=_+N*s;if(!(T<0||T>=n.inHeight))for(var A=k+N*t.strides[1],D=S+T*e.strides[2],O=0;O<n.outWidth;++O)for(var F=I+O*n.outChannels,P=O*n.strideWidth-c,M=0;M<a;M++){var B=P+M*u;if(!(B<0||B>=n.inWidth))for(var L=A+M*t.strides[2],W=D+B*n.inChannels,z=L,U=0;U<n.inChannels;++U){for(var j=h[W+U],V=0;V<n.outChannels;++V)v[F+V]+=j*p[z+V];z+=n.outChannels}}}}return d.toTensor()},e.prototype.conv2dDerInput=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerInput");for(var r=Ns(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=this.readSync(e.dataId),c=e.strides,f=c[0],d=c[1],h=c[2],p=this.readSync(t.dataId),v=t.strides,m=v[0],g=v[1],y=v[2],x=n.batchSize,b=n.filterHeight,w=n.filterWidth,C=n.inChannels,E=n.inHeight,k=n.inWidth,S=n.outChannels,R=n.outHeight,I=n.outWidth,_=n.strideHeight,N=n.strideWidth,T=b-1-n.padInfo.top,A=w-1-n.padInfo.left,D=0;D<x;++D)for(var O=0;O<C;++O)for(var F=0;F<E;++F)for(var P=F-T,M=Math.max(0,Math.ceil(P/_)),B=Math.min(R,(b+P)/_),L=0;L<k;++L){for(var W=L-A,z=Math.max(0,Math.ceil(W/N)),U=Math.min(I,(w+W)/N),j=0,V=M;V<B;++V)for(var H=V*_-P,G=z;G<U;++G)for(var q=f*D+d*V+h*G,K=m*(b-1-H)+g*(w-1-(G*N-W))+y*O,X=0;X<S;++X)j+=l[q+X]*p[K+X];o[i*D+s*F+u*L+O]=j}return r.toTensor()},e.prototype.conv3dDerInput=function(e,t,n){for(var r=Ns(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=this.readSync(e.dataId),f=e.strides,d=f[0],h=f[1],p=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],x=g[1],b=g[2],w=g[3],C=n.batchSize,E=n.filterDepth,k=n.filterHeight,S=n.filterWidth,R=n.inChannels,I=n.inDepth,_=n.inHeight,N=n.inWidth,T=n.outChannels,A=n.outDepth,D=n.outHeight,O=n.outWidth,F=n.strideDepth,P=n.strideHeight,M=n.strideWidth,B=E-1-n.padInfo.front,L=k-1-n.padInfo.top,W=S-1-n.padInfo.left,z=0;z<C;++z)for(var U=0;U<R;++U)for(var j=0;j<I;++j)for(var V=j-B,H=Math.max(0,Math.ceil(V/F)),G=Math.min(A,(E+V)/F),q=0;q<_;++q)for(var K=q-L,X=Math.max(0,Math.ceil(K/P)),$=Math.min(D,(k+K)/P),Y=0;Y<N;++Y){for(var Q=Y-W,J=Math.max(0,Math.ceil(Q/M)),Z=Math.min(O,(S+Q)/M),ee=0,te=H;te<G;++te)for(var ne=te*F-V,re=X;re<$;++re)for(var oe=re*P-K,ae=J;ae<Z;++ae)for(var ie=d*z+h*te+p*re+v*ae,se=y*(E-1-ne)+x*(k-1-oe)+b*(S-1-(ae*M-Q))+w*U,ue=0;ue<T;++ue)ee+=c[ie+ue]*m[se+ue];o[i*z+s*j+u*q+l*Y+U]=ee}return r.toTensor()},e.prototype.conv2dDerFilter=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Ns(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=this.bufferSync(e),f=this.bufferSync(t),d=0;d<a;++d)for(var h=Math.max(0,Math.ceil((l-d)/r)),p=Math.min(n.outHeight,(n.inHeight+l-d)/r),v=0;v<i;++v)for(var m=Math.max(0,Math.ceil((u-v)/o)),g=Math.min(n.outWidth,(n.inWidth+u-v)/o),y=0;y<n.inChannels;++y)for(var x=0;x<n.outChannels;++x){for(var b=0,w=0;w<n.batchSize;++w)for(var C=h;C<p;++C)for(var E=d+C*r-l,k=m;k<g;++k){var S=v+k*o-u;b+=c.get(w,E,S,y)*f.get(w,C,k,x)}s.set(b,d,v,y,x)}return s.toTensor()},e.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=Ns(n.filterShape,"float32"),c=l.values,f=l.strides,d=f[0],h=f[1],p=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],x=g[1],b=g[2],w=g[3],C=this.readSync(e.dataId),E=e.strides,k=E[0],S=E[1],R=E[2],I=E[3],_=n.padInfo.front,N=n.padInfo.left,T=n.padInfo.top,A=0;A<i;++A)for(var D=Math.max(0,Math.ceil((_-A)/r)),O=Math.min(n.outDepth,(n.inDepth+_-A)/r),F=A*d,P=0;P<s;++P)for(var M=Math.max(0,Math.ceil((T-P)/o)),B=Math.min(n.outHeight,(n.inHeight+T-P)/o),L=P*h+F,W=0;W<u;++W)for(var z=Math.max(0,Math.ceil((N-W)/a)),U=Math.min(n.outWidth,(n.inWidth+N-W)/a),j=W*p+L,V=0;V<n.inChannels;++V)for(var H=V*v+j,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*k,$=K*y,Y=D;Y<O;++Y)for(var Q=(A+Y*r-_)*S+X,J=Y*x+$,Z=M;Z<B;++Z)for(var ee=(P+Z*o-T)*R+Q,te=Z*b+J,ne=z;ne<U;++ne){var re=ne*w+te;q+=C[(W+ne*a-N)*I+ee+V]*m[re+G]}c[H+G]=q}return l.toTensor()},e.prototype.depthwiseConv2D=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=Ns(n.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),h=c.values,p=0;p<n.batchSize;++p)for(var v=p*e.strides[0],m=p*c.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*c.strides[1],x=g*n.strideHeight-s,b=0;b<r;++b){var w=x+b*a;if(!(w<0||w>=n.inHeight))for(var C=b*t.strides[0],E=v+w*e.strides[1],k=0;k<n.outWidth;++k)for(var S=y+k*c.strides[2],R=k*n.strideWidth-u,I=0;I<o;++I){var _=R+I*i;if(!(_<0||_>=n.inWidth))for(var N=C+I*t.strides[1],T=E+_*n.inChannels,A=S,D=N,O=0;O<n.inChannels;++O){for(var F=f[T+O],P=0;P<l;++P)h[A+P]+=F*d[D+P];A+=l,D+=l}}}return c.toTensor()},e.prototype.depthwiseConv2DDerInput=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var r=Ns(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=this.readSync(e.dataId),c=e.strides,f=c[0],d=c[1],h=c[2],p=this.readSync(t.dataId),v=t.strides,m=v[0],g=v[1],y=v[2],x=n.batchSize,b=n.filterHeight,w=n.filterWidth,C=n.inChannels,E=n.inHeight,k=n.inWidth,S=n.outChannels,R=n.outHeight,I=n.outWidth,_=n.strideHeight,N=n.strideWidth,T=b-1-n.padInfo.top,A=w-1-n.padInfo.left,D=S/C,O=0;O<x;++O)for(var F=0;F<C;++F)for(var P=0;P<E;++P)for(var M=P-T,B=Math.max(0,Math.ceil(M/_)),L=Math.min(R,(b+M)/_),W=0;W<k;++W){for(var z=W-A,U=Math.max(0,Math.ceil(z/N)),j=Math.min(I,(w+z)/N),V=0,H=B;H<L;++H)for(var G=H*_-M,q=U;q<j;++q)for(var K=f*O+d*H+h*q,X=m*(b-1-G)+g*(w-1-(q*N-z))+y*F,$=0;$<D;++$)V+=l[K+(F*D+$)]*p[X+$];o[i*O+s*P+u*W+F]=V}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Ns(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((l-h)/r)),v=Math.min(n.outHeight,(n.inHeight+l-h)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),x=0;x<n.outChannels;++x){for(var b=Math.trunc(x/c),w=x%c,C=0,E=0;E<n.batchSize;++E)for(var k=p;k<v;++k)for(var S=h+k*r-l,R=g;R<y;++R){var I=m+R*o-u;C+=f.get(E,S,I,b)*d.get(E,k,R,x)}s.set(C,h,m,b,w)}return s.toTensor()},e.prototype.tile=function(e,t){return this.assertNotComplex(e,"tile"),zu(this.bufferSync(e),t)},e.prototype.pad=function(e,t,n){this.assertNotComplex(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),a=this.bufferSync(e),i=Ns(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map(function(e,t){return e+o[t]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},e.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var o=this.readSync(e.dataId),a=Ns(n,e.dtype),i=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=i.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[t[l]];var c=a.locToIndex(u);a.values[c]=o[r]}return a.toTensor()},e.prototype.gather=function(e,t,n){this.assertNotComplex([e,t],"gather");var r=e.shape.slice(),o=this.readSync(t.dataId);r[n]=o.length;for(var a=Ns(r,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},e.prototype.batchToSpaceND=function(e,t,n){this.assertNotComplex([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=eu(e.shape,t,r),a=tu(o.length,t.length),i=nu(e.shape,t,r),s=ru(n,t.length),u=ou(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){this.assertNotComplex([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=eu(i.shape,t,r,!1),u=tu(s.length,t.length,!1),l=nu(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.pool=function(e,t,n){this.assertNotComplex(e,"pool");for(var r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(e.dataId),h=Ns(t.outShape,e.dtype),p=h.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var x=y*v,b=y*e.strides[0],w=0;w<t.inChannels;++w)for(var C=0;C<t.outHeight;++C)for(var E=C*r-l,k=Math.max(0,E),S=Math.min(t.inHeight,s+E),R=x+C*m,I=0;I<t.outWidth;++I){for(var _=I*o-c,N=Math.max(0,_),T=Math.min(t.inWidth,u+_),A=f,D=0,O=0,F=k;F<S;F+=a){for(var P=b+F*e.strides[1],M=N;M<T;M+=i){var B=d[P+M*e.strides[2]+w];"max"===n&&B>A?A=B:"avg"===n&&(D+=B,O++)}if(isNaN(A))break}p[R+I*g+w]="avg"===n?D/O:A}return h.toTensor()},e.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},e.prototype.maxPoolPositions=function(e,t){for(var n=Ns(t.outShape,"int32"),r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,f=this.bufferSync(e),d=0;d<t.batchSize;++d)for(var h=0;h<t.inChannels;++h)for(var p=0;p<t.outHeight;++p){for(var v=p*r-l,m=v;m<0;)m+=a;for(var g=Math.min(t.inHeight,s+v),y=0;y<t.outWidth;++y){for(var x=y*o-c,b=x;b<0;)b+=i;for(var w=Math.min(t.inWidth,u+x),C=Number.NEGATIVE_INFINITY,E=-1,k=m;k<g;k+=a)for(var S=k-v,R=b;R<w;R+=i){var I=R-x,_=f.get(d,k,R,h);_>C&&(C=_,E=S*u+I)}n.set(E,d,p,y,h)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(e,t,n,r){this.assertNotComplex([t,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,r),a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,f=c-1-r.padInfo.left,d=l-1-r.padInfo.top,h=Ns(t.shape,"float32"),p=this.bufferSync(o),v=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var x=0;x<r.inWidth;++x){for(var b=y-d,w=x-f,C=0,E=0;E<l;E+=s){var k=(b+E)/a;if(!(k<0||k>=r.outHeight||Math.floor(k)!==k))for(var S=0;S<c;S+=u){var R=(w+S)/i;if(!(R<0||R>=r.outWidth||Math.floor(R)!==R)){var I=l*c-1-p.get(m,k,R,g)===E*c+S?1:0;0!==I&&(C+=v.get(m,k,R,g)*I)}}}h.set(C,m,y,x,g)}return h.toTensor()},e.prototype.avgPoolBackprop=function(e,t,n){this.assertNotComplex([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,f=c-1-n.padInfo.left,d=l-1-n.padInfo.top,h=Ns(t.shape,"float32"),p=1/(a*i),v=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var x=0;x<n.inWidth;++x){for(var b=y-d,w=x-f,C=0,E=0;E<l;E+=s){var k=(b+E)/r;if(!(k<0||k>=n.outHeight||Math.floor(k)!==k))for(var S=0;S<c;S+=u){var R=(w+S)/o;R<0||R>=n.outWidth||Math.floor(R)!==R||(C+=v.get(m,k,R,g))}}h.set(C*p,m,y,x,g)}return h.toTensor()},e.prototype.cast=function(e,t){return Tu(e,t,this)},e.prototype.reshape=function(e,t){return Au(e,t)},e.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},e.prototype.resizeBilinear=function(e,t,n,r){this.assertNotComplex(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(Ao([a,t,n,u])),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,p=f[0]/d[0],v=f[1]/d[1],m=0;m<a;m++)for(var g=0;g<t;g++)for(var y=p*g,x=Math.floor(y),b=y-x,w=Math.min(i-1,Math.ceil(y)),C=m*e.strides[0]+x*e.strides[1],E=m*e.strides[0]+w*e.strides[1],k=0;k<n;k++)for(var S=v*k,R=Math.floor(S),I=S-R,_=Math.min(s-1,Math.ceil(S)),N=C+R*e.strides[2],T=E+R*e.strides[2],A=C+ +_*e.strides[2],D=E+_*e.strides[2],O=0;O<u;O++){var F=l[N+O],P=l[T+O],M=F+(l[A+O]-F)*I,B=M+(P+(l[D+O]-P)*I-M)*b;c[h++]=B}return Zi(c,[a,t,n,u])},e.prototype.resizeBilinearBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=[n&&l>1?a-1:a,n&&c>1?i-1:i],h=[n&&l>1?l-1:l,n&&c>1?c-1:c],p=d[0]/h[0],v=d[1]/h[1],m=this.readSync(e.dataId),g=0,y=0;y<o;y++)for(var x=y*t.strides[0],b=0;b<l;b++)for(var w=b*p,C=Math.floor(w),E=Math.min(Math.ceil(w),a-1),k=x+C*t.strides[1],S=x+E*t.strides[1],R=w-C,I=1-R,_=0;_<c;_++)for(var N=_*v,T=Math.floor(N),A=Math.min(Math.ceil(N),i-1),D=N-T,O=1-D,F=k+T*t.strides[2],P=k+A*t.strides[2],M=S+T*t.strides[2],B=S+A*t.strides[2],L=I*O,W=I*D,z=R*O,U=R*D,j=0;j<s;j++){var V=m[g++];f[F+j]+=V*L,f[P+j]+=V*W,f[M+j]+=V*z,f[B+j]+=V*U}return as(f,[o,i,a,s],t.dtype)},e.prototype.resizeNearestNeighbor=function(e,t,n,r){this.assertNotComplex(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(a*t*n*u),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/d[0],p=f[1]/d[1],v=0,m=0;m<a;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var x=h*y,b=g+Math.min(i-1,r?Math.round(x):Math.floor(x))*e.strides[1],w=0;w<n;w++)for(var C=p*w,E=b+Math.min(s-1,r?Math.round(C):Math.floor(C))*e.strides[2],k=0;k<u;k++){var S=l[E+k];c[v++]=S}return Zi(c,[a,t,n,u],e.dtype)},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=this.readSync(e.dataId),h=[n&&l>1?a-1:a,n&&c>1?i-1:i],p=[n&&l>1?l-1:l,n&&c>1?c-1:c],v=h[0]/p[0],m=h[1]/p[1],g=1/v,y=1/m,x=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2,w=0;w<o;w++)for(var C=w*t.strides[0],E=0;E<a;E++)for(var k=C+E*t.strides[1],S=Math.floor(E*g),R=Math.floor(S-x/2),I=0;I<i;I++)for(var _=k+I*t.strides[2],N=Math.floor(I*y),T=Math.floor(N-b/2),A=0;A<s;A++){for(var D=0,O=0;O<x;O++){var F=O+R;if(!(F<0||F>=l)){var P=C+F*e.strides[1],M=F*v;if(E===Math.min(a-1,n?Math.round(M):Math.floor(M)))for(var B=0;B<b;B++){var L=B+T;if(!(L<0||L>=c)){var W=P+L*e.strides[2],z=L*m;I===Math.min(i-1,n?Math.round(z):Math.floor(z))&&(D+=d[W+A])}}}}f[_+A]=D}return as(f,t.shape,t.dtype)},e.prototype.batchNormalization=function(e,t,n,r,o,a){this.assertNotComplex([e,t,n,o,a],"batchNorm");for(var i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(i.length),d=c.length,h=l.length,p=u.length,v=s.length,m=0,g=0,y=0,x=0,b=0;b<i.length;++b)f[b]=c[m++]+(i[b]-s[g++])*l[y++]/Math.sqrt(u[x++]+r),m>=d&&(m=0),g>=v&&(g=0),y>=h&&(y=0),x>=p&&(x=0);return as(f,e.shape)},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=this.readSync(e.dataId),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var f=0;f<u;f++){var d=c(f),h=s[f]*Math.pow(n+r*d,-o);l[f]=h}return as(l,e.shape)},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){this.assertNotComplex(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=this.readSync(n.dataId),f=new Float32Array(e.size),d=e.size,h=0;h<d;h++){for(var p=h%s,v=h-p+Math.max(0,p-r),m=h-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(l[y],2);for(g=a*g+o,y=v;y<m;y++){var x=-2*a*i*l[y]*c[h]/g;h===y&&(x+=Math.pow(g,-i)),x*=u[h],f[y]+=x}}return as(f,e.shape)},e.prototype.multinomial=function(e,t,n,r){this.assertNotComplex(e,"multinomial");for(var o=t?e:pu(e),a=o.shape[0],i=o.shape[1],s=ss([a,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<a;++c){var f=c*i,d=new Float32Array(i-1);d[0]=l[f];for(var h=1;h<d.length;++h)d[h]=d[h-1]+l[f+h];for(var p=Rs(r.toString()),v=c*n,m=0;m<n;++m){var g=p();u[v+m]=d.length;for(var y=0;y<d.length;y++)if(g<d[y]){u[v+m]=y;break}}}return s},e.prototype.oneHot=function(e,t,n,r){this.assertNotComplex(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=this.readSync(e.dataId),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return rs(o,[e.size,t],"int32")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return this.assertNotComplex(e,"nonMaxSuppression"),Bu(this.readSync(e.dataId),this.readSync(t.dataId),n,r,o)},e.prototype.fft=function(e){return this.fftBatch(e,!1)},e.prototype.ifft=function(e){return this.fftBatch(e,!0)},e.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=Ns(e.shape,"float32"),a=Ns(e.shape,"float32"),i=Qi(e).as2D(n,r),s=Ji(e).as2D(n,r),u=0;u<n;u++)for(var l=i.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),f=Yi(l,c),d=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var p=Fu(d,h);o.values[u*r+h]=p.real,a.values[u*r+h]=p.imag}return Yi(o.toTensor(),a.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=Yi(Qi(o).div(ts(r)),Ji(o).div(ts(r)))),o}var a=this.readSync(e.dataId),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return Yi(i.real,i.imag).as2D(e.shape[0],e.shape[1])},e.prototype.isExponentOf2=function(e){return 0==(e&e-1)},e.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=Yi(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=Yi(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=Yi(l.real,l.imag).mul(u),f=i.add(c),d=i.sub(c),h=Qi(f).concat(Qi(d)),p=Ji(f).concat(Ji(d));return Yi(h,p).as1D()},e.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=Mu(o*s,t,n),l=Fu(e,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}n&&(a/=t,i/=t),Pu(r,a,i,o)}return r},e.prototype.depthToSpace=function(e,t,n){Io("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),Io(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,l=i/(t*t),c=this.readSync(e.dataId),f=new Float32Array(r*s*u*l),d=0,h=0;h<r;++h)for(var p=0;p<s;++p)for(var v=Math.floor(p/t),m=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),x=(m*t+g%t)*l,b=0;b<l;++b){var w=b+x+i*(y+a*(v+o*h));f[d++]=c[w]}return as(f,[r,s,u,l])},e.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=xu(e.shape,t.shape),a=Ns(o,n),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=gu(e.shape,o),l=gu(t.shape,o),c=a.values;if(u.length+l.length===0)for(var f=0;f<c.length;++f)c[f]=r(i[f%i.length],s[f%s.length]);else{var d=this.bufferSync(e),h=this.bufferSync(t),p=function(n){var o=a.indexToLoc(n),f=o.slice(-e.rank);u.forEach(function(e){return f[e]=0});var p=d.locToIndex(f),v=o.slice(-t.rank);l.forEach(function(e){return v[e]=0});var m=h.locToIndex(v);c[n]=r(i[p],s[m])};for(f=0;f<c.length;++f)p(f)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=xu(e.shape,t.shape),o=Ns(r,"float32"),a=Ns(r,"float32"),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=gu(e.shape,r),l=gu(t.shape,r),c=o.values,f=a.values;if(u.length+l.length===0)for(var d=0;d<c.length;d++){var h=d%i.length,p=d%s.length,v=n(i[2*h],i[2*h+1],s[2*p],s[2*p+1]);c[d]=v.real,f[d]=v.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),d=a.slice(-e.rank);u.forEach(function(e){return d[e]=0});var h=m.locToIndex(d),p=a.slice(-t.rank);l.forEach(function(e){return p[e]=0});var v=g.locToIndex(p),y=n(i[2*h],i[2*h+1],s[2*v],s[2*v+1]);c[r]=y.real,f[r]=y.imag};for(d=0;d<c.length;d++)y(d)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(e,t,n){return Wu(e,t,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],f=t.shape[0],d=r[0],h=r[1],p=Ns([f,d,h,c],e.dtype),v=this.readSync(t.dataId),m=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,x=p.strides,b=0;b<f;b++){var w=4*b,C=v[w],E=v[w+1],k=v[w+2],S=v[w+3],R=m[b];if(!(R>=s))for(var I=d>1?(k-C)*(u-1)/(d-1):0,_=h>1?(S-E)*(l-1)/(h-1):0,N=0;N<d;N++){var T=d>1?C*(u-1)+N*I:.5*(C+k)*(u-1);if(T<0||T>u-1)for(var A=0;A<h;A++)for(var D=0;D<c;D++){var O=D+A*x[2]+N*x[1]+b*x[0];p.values[O]=a}else if("bilinear"===o){var F=Math.floor(T),P=Math.ceil(T),M=T-F;for(A=0;A<h;A++)if((G=h>1?E*(l-1)+A*_:.5*(E+S)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*x[2]+N*x[1]+b*x[0],p.values[O]=a;else{var B=Math.floor(G),L=Math.ceil(G),W=G-B;for(D=0;D<c;D++){var z=g[O=D+B*y[2]+F*y[1]+R*y[0]],U=g[O=D+L*y[2]+F*y[1]+R*y[0]],j=g[O=D+B*y[2]+P*y[1]+R*y[0]],V=z+(U-z)*W,H=j+(g[O=D+L*y[2]+P*y[1]+R*y[0]]-j)*W;O=D+A*x[2]+N*x[1]+b*x[0],p.values[O]=V+(H-V)*M}}}else for(A=0;A<h;++A){var G;if((G=h>1?E*(l-1)+A*_:.5*(E+S)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*x[2]+N*x[1]+b*x[0],p.values[O]=a;else{var q=Math.round(G),K=Math.round(T);for(D=0;D<c;D++){var X=D+q*y[2]+K*y[1]+R*y[0],$=D+A*x[2]+N*x[1]+b*x[0];p.values[$]=g[X]}}}}}return p.toTensor()},e.prototype.sparseToDense=function(e,t,n,r){var o=su(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(e,t,n,l,s,i,a,u,r,!1)},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=au(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return Zi([],a,e.dtype);for(var l=new va([i,s],e.dtype),c=this.readSync(t.dataId),f=this.readSync(e.dataId),d=0;d<i;d++){for(var h=[],p=0,v=0;v<r;v++){var m=c[d*r+v];p+=m*u[v],h.push(m)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[d*s+g]=f[p*s+g]}return l.toTensor().reshape(a)},e.prototype.scatterND=function(e,t,n){var r=su(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=ts(0);return this.scatter(e,t,n,u,i,a,o,s,l,!0)},e.prototype.fill=function(e,t,n){var r=jo(n=n||Zo(t),Ao(e));return r.fill(t),xa.make(e,{values:r},n)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){var t=jo(e.dtype,Ao(e.shape));return xa.make(e.shape,{values:t},e.dtype)},e.prototype.linspace=function(e,t,n){return Du(e,t,n)},e.prototype.scatter=function(e,t,n,r,o,a,i,s,u,l){var c=[r/o,o],f=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return Zi([],n,t.dtype);var h=new va(c,t.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var v=[],m=0,g=0;g<i;g++){var y=f[p*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var x=0;x<o;x++)l?h.values[m*o+x]+=d[p*o+x]:h.values[m*o+x]=0===t.rank?d[0]:d[p*o+x]}return h.toTensor().reshape(n)},e}();Pa.registerBackend("cpu",function(){return new Up},1);var jp=function(){function e(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}return e.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},e.prototype.decodeUTF8=function(e){return this.textDecoder.decode(e)},e.prototype.fetch=function(e,t){return fetch(e,t)},e}();wo.get("IS_BROWSER")&&wo.setPlatform("browser",new jp);var Vp,Hp=function(){function e(){var e=n(886);this.textEncoder=new e.TextEncoder,this.textDecoder=new e.TextDecoder}return e.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},e.prototype.decodeUTF8=function(e){return 0===e.length?"":this.textDecoder.decode(e)},e.prototype.fetch=function(e,t){return null!=wo.global.fetch?wo.global.fetch(e,t):(null==Vp&&(Vp=n(65)),Vp(e,t))},e}();wo.get("IS_NODE")&&wo.setPlatform("node",new Hp);var Gp={float32:4,int32:4,uint16:2,uint8:1,bool:1};function qp(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=Ao(i),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=Gp[l.dtype],f=e.slice(r,r+s*c),d="uint8"===l.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(d,function(e){return e*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(d,function(e){return Math.round(e*l.scale+l.min)})}r+=s*c}else if("string"===a){var h=t,p=new Uint8Array(e.slice(r,r+h.byteLength));u=wo.platform.decodeUTF8(p).split(h.delimiter),r+=h.byteLength}else{var v=Gp[a];if(f=e.slice(r,r+s*v),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(f)}r+=s*v}n[o]=Zi(u,i,a)},a=0,i=t;a<i.length;a++)o(i[a]);return n}function Kp(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var Xp="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function $p(e){return Xp?Buffer.byteLength(e):new Blob([e]).size}function Yp(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function Qp(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Jp(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:$p(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:$p(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var Zp=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),ev="://",tv=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){Io(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(ev)&&(t=t.slice(0,t.indexOf(ev))),Io(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();Io(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function nv(e){if(-1===e.indexOf(ev))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+tv.getSchemes().join(","));return{scheme:e.split(ev)[0],path:e.split(ev)[1]}}function rv(e,t,n){return void 0===n&&(n=!1),go(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f;return yo(this,function(d){switch(d.label){case 0:return Io(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),Io((r=Zp.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),Io(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],Io((a=Zp.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),Io(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=nv(e).scheme,u=nv(e).path,l=s===nv(e).scheme,[4,o.load()];case 1:return c=d.sent(),n&&l?[4,tv.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,i.save(c)];case 4:return f=d.sent(),!n||l?[3,6]:[4,tv.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var ov="models_store",av="model_info_store";function iv(){if(!wo.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function sv(e){var t=e.result;t.createObjectStore(ov,{keyPath:"modelPath"}),t.createObjectStore(av,{keyPath:"modelPath"})}var uv=function(){function e(e){if(this.indexedDB=iv(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return go(this,void 0,void 0,function(){return yo(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return sv(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(ov,"readonly"),s=i.objectStore(ov).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=Jp(t),c=a.transaction(av,"readwrite"),f=c.objectStore(av),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:l});d.onsuccess=function(){var o=(u=a.transaction(ov,"readwrite")).objectStore(ov).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});o.onsuccess=function(){return e({modelArtifactsInfo:l})},o.onerror=function(e){var t=(f=c.objectStore(av)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},d.onerror=function(e){return a.close(),r(d.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),lv=function(e){return wo.getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(uv.URL_SCHEME)?(t=e.slice(uv.URL_SCHEME.length),new uv(t)):null;var t};Zp.registerSaveRouter(lv),Zp.registerLoadRouter(lv);var cv=function(){function e(){this.indexedDB=iv()}return e.prototype.listModels=function(){return go(this,void 0,void 0,function(){var e=this;return yo(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return sv(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(av,"readonly"),a=o.objectStore(av).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return go(this,void 0,void 0,function(){var t=this;return yo(this,function(n){var r;return e=(r=e).startsWith(uv.URL_SCHEME)?r.slice(uv.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return sv(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(av,"readwrite"),s=i.objectStore(av),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(ov,"readwrite")).objectStore(ov).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if(wo.getBool("IS_BROWSER"))try{tv.registerManager(uv.URL_SCHEME,new cv)}catch(po){}var fv="/",dv="tensorflowjs_models",hv="info",pv="model_topology",vv="weight_specs",mv="weight_data",gv="model_metadata";function yv(e){return{info:[dv,e,hv].join(fv),topology:[dv,e,pv].join(fv),weightSpecs:[dv,e,vv].join(fv),weightData:[dv,e,mv].join(fv),modelMetadata:[dv,e,gv].join(fv)}}function xv(e){var t=e.split(fv);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(fv)}var bv=function(){function e(e){if(!wo.getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=yv(this.modelPath)}return e.prototype.save=function(e){return go(this,void 0,void 0,function(){var t,n,r;return yo(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=Jp(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(a=e.weightData,Xp?Buffer.from(a).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(a))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}var a})})},e.prototype.load=function(){return go(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return yo(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(Xp){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),wv=function(e){return wo.getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(bv.URL_SCHEME)?(t=e.slice(bv.URL_SCHEME.length),new bv(t)):null;var t};Zp.registerSaveRouter(wv),Zp.registerLoadRouter(wv);var Cv=function(){function e(){Io(wo.getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Io(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return go(this,void 0,void 0,function(){var e,t,n,r,o,a;return yo(this,function(i){for(e={},t=dv+fv,n=fv+hv,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=xv(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return go(this,void 0,void 0,function(){var t,n;return yo(this,function(r){var o;if(e=(o=e).startsWith(bv.URL_SCHEME)?o.slice(bv.URL_SCHEME.length):o,t=yv(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(wo.getBool("IS_BROWSER"))try{tv.registerManager(bv.URL_SCHEME,new Cv)}catch(po){}function Ev(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var kv=function(){function e(t){if(!wo.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return go(this,void 0,void 0,function(){var t,n,r,o,a,i;return yo(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,Ev(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,Ev(function(){return i.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:Jp(e)}]}})})},e.URL_SCHEME="downloads://",e}(),Sv=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return go(this,void 0,void 0,function(){var e,t,n=this;return yo(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var c=[],f=[],d=[];u.forEach(function(e){e.paths.forEach(function(e){f.push(e),d.push(null)}),c.push.apply(c,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=f.indexOf(e);d[o]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:Yp(d)})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return Qp(e.name)}),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach(function(e){var a=Qp(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function Rv(e,t,n,r){!function(e){Io(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){Io(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),Io(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),Io(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var i=n+ ++o/e.length*(r-n);return t(i),a}),a}))}function Iv(e,t){return go(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return yo(this,function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?la:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit)}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=f.sent(),[3,4];case 2:return[4,Rv(r,t.onProgress,o,a)];case 3:i=f.sent(),f.label=4;case 4:return s=i.map(function(e){return e.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=f.sent(),[3,8];case 6:return[4,Rv(s,t.onProgress,u,l)];case 7:c=f.sent(),f.label=8;case 8:return[2,c]}})})}function _v(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),go(t,void 0,void 0,function(){var t,a,i,s,u,l,c,f,d,h;return yo(this,function(p){switch(p.label){case 0:if(t=n.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,l=Gp[u]*Ao(e.shape),c=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=o?o.forEach(function(t,n){t===e.name&&(c(),i[n]=!0)}):c(),s.push(e.name),r+=l})}),!i.every(function(e){return e}))throw u=o.filter(function(e,t){return!i[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),c=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)})}),[4,e(c)];case 1:return f=p.sent(),d={},h=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=f[h+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,l=0;l<t;l++){var c=new Uint8Array(f[h+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(e){var t=qp(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]}),h+=t}),[2,d]}})})}}Zp.registerSaveRouter(function(e){return wo.getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(kv.URL_SCHEME)?(void 0===(t=e.slice(kv.URL_SCHEME.length))&&(t="model"),new kv(t)):null;var t});var Nv=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(Io("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=la,Io(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Io(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return go(this,void 0,void 0,function(){var t,n,r,o;return yo(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:Jp(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return go(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s;return yo(this,function(u){switch(u.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,e.json()];case 3:return t=u.sent(),[3,5];case 4:throw u.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:s=u.sent(),a=s[0],i=s[1],u.label=7;case 7:return[2,{modelTopology:r,weightSpecs:a,weightData:i}]}})})},e.prototype.loadWeights=function(e){return go(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f;return yo(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,u=e;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],e.forEach(function(e){e.paths.forEach(function(e){c.push(a+e+o)})}),[4,Iv(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[i,Yp(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Tv(e){return null!=e.match(Nv.URL_SCHEME_REGEX)}var Av=function(e,t){return(Array.isArray(e)?e.every(function(e){return Tv(e)}):Tv(e))?Dv(e,{onProgress:t}):null};function Dv(e,t){return new Nv(e,t)}Zp.registerSaveRouter(Av),Zp.registerLoadRouter(Av);var Ov=function(){function e(e,t,n,r){this.modelTopology=e,this.weightSpecs=t,this.weightData=n,this.trainingConfig=r}return e.prototype.load=function(){return go(this,void 0,void 0,function(){var e;return yo(this,function(t){return e={},null!=this.modelTopology&&(e=mo({modelTopology:this.modelTopology},e)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(e=mo({weightSpecs:this.weightSpecs},e)),null!=this.weightData&&this.weightData.byteLength>0&&(e=mo({weightData:this.weightData},e)),null!=this.trainingConfig&&(e=mo({trainingConfig:this.trainingConfig},e)),[2,e]})})},e}(),Fv=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return go(this,void 0,void 0,function(){return yo(this,function(t){return[2,this.saveHandler(e)]})})},e}(),Pv=(Object.freeze({browserFiles:function(e){return new Sv(e)},browserHTTPRequest:function(e,t){return Dv(e,t)},concatenateArrayBuffers:Yp,decodeWeights:qp,encodeWeights:function(e,t){return go(this,void 0,void 0,function(){var n,r,o,a,i,s=this;return yo(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),a=function(a){var i=o[a],u=Array.isArray(e)?e[a].tensor:e[i];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+u.dtype);var l={name:i,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(e){return go(s,void 0,void 0,function(){var t,n,r;return yo(this,function(o){switch(o.label){case 0:return t=l,[4,u.data()];case 1:return n=o.sent(),r=wo.platform.encodeUTF8(n.join("\0")),t.byteLength=r.length,t.delimiter="\0",e(r),[2]}})})});r.push(c)}else r.push(u.data());null!=t&&(l.group=t),n.push(l)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:Kp(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return new Ov(e,t,n,r)},getLoadHandlers:function(e,t){return Zp.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:Jp,getSaveHandlers:function(e){return Zp.getSaveHandlers(e)},http:Dv,isHTTPScheme:Tv,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),go(this,void 0,void 0,function(){return yo(this,function(o){return[2,_v(function(e){return Iv(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return Zp.registerLoadRouter(e)},registerSaveRouter:function(e){return Zp.registerSaveRouter(e)},weightsLoaderFactory:_v,withSaveHandler:function(e){return new Fv(e)},copyModel:function(e,t){return go(this,void 0,void 0,function(){return yo(this,function(n){return[2,rv(e,t,!1)]})})},listModels:function(){return go(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return yo(this,function(s){switch(s.label){case 0:e=tv.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,tv.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+ev+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return go(this,void 0,void 0,function(){return yo(this,function(n){return[2,rv(e,t,!0)]})})},removeModel:function(e){return go(this,void 0,void 0,function(){var t;return yo(this,function(n){return t=nv(e),[2,tv.getManager(t.scheme).removeModel(t.path)]})})}}),$i({confusionMatrix_:function(e,t,n){var r=Bi(e,"labels","confusionMatrix"),o=Bi(t,"predictions","confusionMatrix");Io(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),Io(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),Io(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),Io(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),Io(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=Ls(r.asType("int32"),n),i=Ls(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}})),Mv=(Object.freeze({confusionMatrix:Pv}),$i({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return Pa.fromPixels(e,t)}})),Bv=Object.freeze({toPixels:function(e,t){return go(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,h,p,v,m,g,y,x,b,w,C,E,k;return yo(this,function(S){switch(S.label){case 0:if(n=Bi(e,"img","toPixels"),e instanceof xa||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,n.data()];case 1:return s=S.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=S.sent(),f=c[0],d=c[1],h=f[0],p=d[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(v="float32"===n.dtype?255:1,m=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)y=void 0,x=void 0,b=void 0,w=void 0,1===i?(y=s[g]*v,x=s[g]*v,b=s[g]*v,w=255):3===i?(y=s[3*g]*v,x=s[3*g+1]*v,b=s[3*g+2]*v,w=255):4===i&&(y=s[4*g]*v,x=s[4*g+1]*v,b=s[4*g+2]*v,w=s[4*g+3]*v),m[0+(C=4*g)]=Math.round(y),m[C+1]=Math.round(x),m[C+2]=Math.round(b),m[C+3]=Math.round(w);return null!=t&&(t.width=a,t.height=o,E=t.getContext("2d"),k=new ImageData(m,a,o),E.putImageData(k,0,0)),n!==e&&n.dispose(),[2,m]}})})},fromPixels:Mv}),Lv=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),Wv=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function zv(e){Io(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),Io("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),Io(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Wv.register(e)}Object.freeze({Serializable:Lv,SerializationMap:Wv,registerClass:zv});function Uv(){return 32===Pa.backend.floatPrecision()?.001:.1}function jv(e,t,n){var r=!0;if((Ko(e)||Ko(t))&&(r=!1),Ko(e)&&Ko(t)&&(r=!0),r){var o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var i=Pi(e),s=Pi(t);if(!Do(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=Ko(e)?e:To(e),l=Ko(t)?t:To(t);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var f=u[c],d=l[c];if(!n(f,d))throw new Error("Arrays differ: actual["+c+"] = "+f+", expected["+c+"] = "+d+".\nActual:   "+u+".\nExpected: "+l+".")}}function Vv(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=Uv()),jv(e,t,function(e,t){return Vv(e,t,n)})},testEpsilon:Uv,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Yo(e)||Yo(e[0])||Yo(t)||Yo(t[0])?jv(e,n,function(e,t){return e==t}):jv(e,t,function(e,t){return Vv(e,t,0)})},expectNumbersClose:function(e,t,n){if(null==n&&(n=Uv()),!Vv(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:bc,webgl_util:Ti,MathBackendWebGL:bf,setWebGLContext:Wa,GPGPUContext:wc});var Hv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vo(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;if(null!=n){var i=n.map(function(e){return{name:e.name,tensor:a[e.name]}});this.applyGradients(i)}else this.applyGradients(a);return Oi(a),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){Io(ea(e),function(){return"The f passed in variableGrads(f) must be a function"}),Io(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof ba}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],Pa.registeredVariables)t.push(Pa.registeredVariables[r]);var o=n?t.filter(function(e){return!e.trainable}):null,a=t.length;Io((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=Pa.gradients(e,t,null,!0),s=i.value,u=i.grads;Io(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Io(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(e,t){null!=u[t]&&(l[e.name]=u[t])}),null!=o&&o.forEach(function(e){return l[e.name]=null}),{value:s,grads:l}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Oi(this.iterations_)},t.prototype.saveIterations=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:ts(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){return yo(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return go(this,void 0,void 0,function(){var t;return yo(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(Lv);Object.defineProperty(Hv,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Gv=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=Pa.backend.epsilon()),o}return vo(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Pa.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Di(function(){return fs(o).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Di(function(){return fs(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Di(function(){var e=i.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(i.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));i.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Oi(this.accumulatedGrads.map(function(e){return e.variable})),Oi(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){var e;return yo(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){var t;return yo(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="AdadeltaOptimizer",t}(Hv);zv(Gv);var qv=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return vo(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Pa.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Di(function(){return us(o.shape,t.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable;Di(function(){var e=i.add(a.square());i.assign(e);var n=a.div(e.add(Pa.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Oi(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){return yo(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(Hv);zv(qv);var Kv=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Di(function(){a.accBeta1=ts(n).variable(),a.accBeta2=ts(r).variable()}),null==o&&(a.epsilon=Pa.backend.epsilon()),a}return vo(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Di(function(){var r=Oh(1,t.accBeta1),o=Oh(1,t.accBeta2);n.forEach(function(n,a){var i=Pa.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Di(function(){return fs(i).variable(!1)})}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Di(function(){return fs(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedSecondMoment[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=c.div(r),h=f.div(o);u.assign(c),l.assign(f);var p=d.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(i);i.assign(p)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Oi(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Oi(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){var e;return yo(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){var t,n=this;return yo(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Di(function(){n.accBeta1.assign(Nh(n.beta1,n.iterations_+1)),n.accBeta2.assign(Nh(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(Hv);zv(Kv);var Xv=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Di(function(){i.iteration=ts(0).variable(),i.accBeta1=ts(n).variable()}),null==o&&(i.epsilon=Pa.backend.epsilon()),i}return vo(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Di(function(){var r=Oh(1,t.accBeta1),o=yh(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,a){var i=Pa.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:fs(i).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:fs(i).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedWeightedInfNorm[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2),d=s.abs(),h=f.maximum(d);u.assign(c),l.assign(h);var p=o.div(r).mul(c.div(h.add(t.epsilon))).add(i);i.assign(p)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Oi(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Oi(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){return yo(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(Hv);zv(Xv);var $v=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return vo(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=Pa.registeredVariables[n];Di(function(){var e=t.c.mul(o).add(a);a.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return Pa.keep(e)}(ts(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){return yo(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(Hv);zv($v);var Yv=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=ts(o.momentum),o}return vo(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Pa.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Di(function(){return fs(o).variable(!1)})});var a=t.accumulations[r].variable,i=Array.isArray(e)?e[r].tensor:e[n];null!=i&&Di(function(){var e,n=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(n.mul(t.m))).add(o):t.c.mul(n).add(o),a.assign(n),o.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Oi(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){return yo(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){return yo(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="MomentumOptimizer",t}($v);zv(Yv);var Qv=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;return i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=Pa.backend.epsilon()),i}return vo(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Pa.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Di(function(){return fs(o).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Di(function(){return fs(o).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Di(function(){return fs(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Di(function(){var e=i.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),l=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));i.assign(e),n.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var f=i.mul(t.decay).add(a.square().mul(1-t.decay));l=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),i.assign(f),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Oi(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Oi(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Oi(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return go(this,void 0,void 0,function(){var e;return yo(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return go(this,void 0,void 0,function(){var t;return yo(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(Hv);zv(Qv);var Jv=function(){function e(){}return e.sgd=function(e){return new $v(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new Yv(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new Qv(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new Kv(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new Gv(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new Xv(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new qv(e,t)},e}();Jv.sgd,Jv.momentum,Jv.adadelta,Jv.adagrad,Jv.rmsprop,Jv.adamax,Jv.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;ga=zp;var Zv=function(e,t){return(Zv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function em(e,t){function n(){this.constructor=e}Zv(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function tm(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function nm(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var rm=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],o=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,o)})}},e}();function om(){return am}var am=null,im=new Map,sm=new Map;function um(e,t){var n=hm(e,t);return im.get(n)}function lm(e){return sm.get(e)}function cm(e){for(var t=im.entries(),n=[];;){var r=t.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===e&&n.push(s)}return n}function fm(e){var t=e.kernelName,n=e.backendName,r=hm(t,n);if(im.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");im.set(r,e)}function dm(e){var t=e.kernelName;sm.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),sm.set(t,e)}function hm(e,t){return t+"_"+e}function pm(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function vm(e,t,n){return Math.max(e,Math.min(t,n))}function mm(e){return e%2==0?e:e+1}function gm(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function ym(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function xm(e,t,n){void 0===n&&(n=""),ym(Em(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function bm(e){ym(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function wm(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||Bm(e)&&!n)for(var r=0;r<e.length;++r)wm(e[r],t,n);else t.push(e);return t}function Cm(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Em(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function km(e){return e%1==0}function Sm(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Rm(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Im(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function _m(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function Nm(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function Tm(e,t){var n=t.length;return ym((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),ym(e.every(function(e){return km(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function Am(e,t){for(var n=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||o?null:Tm(t,e).sort(),i=0,s=0;s<e.length;++s){if(null!=a){if(a[i]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[i]<=s&&i++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Dm(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Om(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Fm(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Pm(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Mm(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function Bm(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Lm(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Wm(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}function zm(e){return"string"==typeof e||e instanceof String}function Um(e){return"boolean"==typeof e}function jm(e){return"number"==typeof e}function Vm(e){return Array.isArray(e)?Vm(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":jm(e)?"float32":zm(e)?"string":Um(e)?"bool":"float32"}function Hm(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Gm(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function qm(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Km(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=wm(e)),n&&Fm(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function Xm(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[t+i];else{a=n[0];var s=n.slice(1),u=s.reduce(function(e,t){return e*t});for(i=0;i<a;i++)o[i]=e(t+i*u,s,r)}return o}(0,e,t)}function $m(e,t){for(var n=Ym(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Ym(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Qm(){return om().platform.now()}function Jm(e){e.forEach(function(t){ym(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function Zm(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",om().platform.encode(e,t)}function eg(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",om().platform.decode(e,t)}function tg(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function ng(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}Object.freeze({shuffle:pm,clamp:vm,nearestLargerEven:mm,sum:gm,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:ym,assertShapesMatch:xm,assertNonNull:bm,flatten:wm,sizeFromShape:Cm,isScalarShape:function(e){return 0===e.length},arraysEqual:Em,isInt:km,tanh:Sm,sizeToSquarishShape:Rm,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return pm(t),t},rightPad:Im,repeatedTry:_m,inferFromImplicitShape:Nm,parseAxisParam:Tm,squeezeShape:Am,getTypedArrayFromDType:Dm,getArrayFromDType:Om,checkConversionForErrors:Fm,isValidDtype:Pm,hasEncodingLoss:Mm,isTypedArray:Bm,bytesPerElement:Lm,bytesFromStringArray:Wm,isString:zm,isBoolean:Um,isNumber:jm,inferDtype:Vm,isFunction:Hm,nearestDivisor:Gm,computeStrides:qm,toTypedArray:Km,toNestedArray:Xm,makeOnesTypedArray:$m,makeZerosTypedArray:Ym,now:Qm,assertNonNegativeIntegerDimensions:Jm,fetch:function(e,t){return om().platform.fetch(e,t)},encodeString:Zm,decodeString:eg,locToIndex:tg,indexToLoc:ng});var rg=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new og)}return e.prototype.profileKernel=function(e,t,n){var r,o=this,a=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then(function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(e,n,r,a.kernelMs,t,i)})})}),r},e}(),og=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o,a){var i="number"==typeof r?Im(r+"ms",9):r.error,s=Im(e,25),u=t.rank,l=t.size,c=Im(t.shape.toString(),14),f="";for(var d in o){var h=o[d].shape||t.shape,p=h.length;f+=d+": "+p+"D "+(p>0?h:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function ag(e,t,n){return Im(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":zm(e)?"'"+e+"'":"bool"===n?ig(e):parseFloat(e.toFixed(7)).toString(),t)}function ig(e){return 0===e?"false":"true"}function sg(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var ug=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=Cm(e),null!=n){var o=n.length;ym(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Om(t,this.size),this.strides=qm(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),ym(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return lg().makeTensor(this.values,this.shape,this.dtype)},e}(),lg=null,cg=null,fg=null,dg=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Cm(e),this.strides=qm(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),ym(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),cg.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return tm(this,void 0,void 0,function(){var e;return nm(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,cg.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return cg.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return tm(this,void 0,void 0,function(){var e;return nm(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Xm(this.shape,e)]}})})},e.prototype.arraySync=function(){return Xm(this.shape,this.dataSync())},e.prototype.data=function(){return tm(this,void 0,void 0,function(){var e,t;return nm(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=lg().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(e){return eg(e)})]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=lg().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return eg(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return tm(this,void 0,void 0,function(){var e;return nm(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,lg().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(lg().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),cg.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),cg.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),cg.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),cg.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),cg.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),cg.clone(this)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var o=qm(t),a=function(e,t,n,r){var o=Cm(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?sg(e):e;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,f=0;f<a;f++)i[f]=Math.max(i[f],ag(u[c+f],0,n).length);return i}(e,t,n,o),i=t.length,s=function e(t,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[ag(sg(t)[0],0,r)]:"bool"===r?[ig(t[0])]:[t[0].toString()];if(1===l){if(u>20){var c=3*s,f=Array.from(t.slice(0,c)),d=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(f=sg(f),d=sg(d)),["["+f.map(function(e,t){return ag(e,a[t],r)}).join(", ")+", ..., "+d.map(function(e,t){return ag(e,a[u-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?sg(t):Array.from(t)).map(function(e,t){return ag(e,a[t],r)}).join(", ")+"]"]}var h=n.slice(1),p=o.slice(1),v=o[0]*s,m=[];if(u>20){for(var g=0;g<3;g++){var y=(x=g*v)+v;m.push.apply(m,e(t.slice(x,y),h,r,p,a,!1))}for(m.push("..."),g=u-3;g<u;g++)y=(x=g*v)+v,m.push.apply(m,e(t.slice(x,y),h,r,p,a,g===u-1))}else for(g=0;g<u;g++){var x;y=(x=g*v)+v,m.push.apply(m,e(t.slice(x,y),h,r,p,a,g===u-1))}var b=2===l?",":"";for(m[0]="["+m[0]+b,g=1;g<m.length-1;g++)m[g]=" "+m[g]+b;var w=",\n";for(g=2;g<l;g++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":w),m}(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),cg.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),cg.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),cg.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),cg.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),cg.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),cg.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),cg.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),cg.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),cg.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),cg.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),fg("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),cg.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),cg.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),cg.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),cg.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),cg.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),cg.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),cg.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),cg.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),cg.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),cg.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),cg.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),cg.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),cg.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),cg.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),cg.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),cg.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),cg.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),cg.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),cg.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),cg.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),cg.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),cg.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),cg.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),cg.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),cg.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),cg.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),cg.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),cg.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),cg.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),cg.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),cg.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),cg.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),cg.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),cg.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),cg.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),cg.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),cg.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),cg.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),cg.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),cg.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),cg.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),cg.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),cg.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),cg.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),cg.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),cg.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),cg.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),cg.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),cg.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),cg.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),cg.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),cg.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),cg.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),cg.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),cg.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),cg.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),cg.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),cg.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),cg.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),cg.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),cg.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),cg.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),cg.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),cg.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),cg.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),cg.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),cg.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),cg.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),cg.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),cg.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),cg.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),cg.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),cg.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),cg.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),cg.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),cg.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),cg.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),cg.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),cg.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),cg.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),cg.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),cg.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),cg.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),cg.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),cg.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),cg.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),cg.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),cg.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),cg.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),cg.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),cg.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),cg.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),cg.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),cg.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),lg().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),cg.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),cg.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),cg.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),cg.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),cg.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),cg.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),cg.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),cg.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),cg.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),cg.spectral.irfft(this)},e}();Object.defineProperty(dg,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var hg,pg,vg,mg,gg,yg=function(e){function t(t,n,r,o){var a=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=n,a.name=r,a}return em(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Em(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");lg().disposeTensor(this),this.dataId=e.dataId,lg().incRef(this,null)},t.prototype.dispose=function(){lg().disposeVariable(this),this.isDisposedInternal=!0},t}(dg);Object.defineProperty(yg,Symbol.hasInstance,{value:function(e){return e instanceof dg&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(hg||(hg={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(pg||(pg={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(vg||(vg={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(mg||(mg={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(gg||(gg={}));var xg={float32:mg,int32:pg,bool:vg,complex64:gg};function bg(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return xg[e][t]}function wg(e){return bg(e,"int32")}function Cg(e,t){if(e.dtype===t.dtype)return[e,t];var n=bg(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Eg(e,t){ym(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function kg(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof dg)n.push(t);else if(o=t,Array.isArray(o)||"object"==typeof o){var o,a=t;for(var i in a){var s=a[i];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:Cg,assertTypesMatch:Eg,isTensorInList:function(e,t){return t.some(function(t){return t.id===e.id})},getTensorsInContainer:kg});var Sg,Rg=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Ig=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Rg}return e.prototype.ready=function(){return tm(this,void 0,void 0,function(){var e,t,n;return nm(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return tm(this,void 0,void 0,function(){var t,n,r;return nm(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new rg(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;cm(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;cm(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then(function(n){return!(o<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)}).catch(function(n){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,o=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(e){return{x:function(){return e.toFloat()}}},[],{}),t},e.prototype.runKernel=function(e,t,n,r,o){return this.runKernelFunc(null,t,null,e,n,r,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),o=0;n.forEach(function(e){o+="complex64"===e.dtype?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-t-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,o,a,i){var s,u=this,l=[],c=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,d=this.state.numBytes,h=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,v=um(r,this.backendName);if(null!=v)f=function(){var e=u.backend.numDataIds();p=v.kernelFunc({inputs:t,attrs:o,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map(function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)});if(c){var f=u.getTensorsForGradient(r,t,s);if(null==f){null==i&&(i=[]);var d=s.filter(function(e,t){return i[t]});f=(a||[]).slice().concat(d)}l=u.saveTensorsForBackwardMode(f)}return s};else{var m=function(e){c&&(l=e.map(function(e){return u.keep(u.clone(e))}))};f=function(){var t=u.backend.numDataIds();p=u.tidy(function(){return e(u.backend,m)});var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,function(){return f()}):f()}),c&&this.addTapeNode(r,t,s,n,l,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShapes:s.map(function(e){return e.shape})}),Array.isArray(p)?s:s[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map(function(e){return t.keep(t.clone(e))})},e.prototype.getTensorsForGradient=function(e,t,n){var r=lm(e);if(null!=r){var o=r.inputsToSave||[],a=r.outputsToSave||[],i=void 0;r.saveAllInputs?(ym(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),i=Object.keys(t).map(function(e){return t[e]})):i=o.map(function(e){return t[e]});var s=n.filter(function(e,t){return a[t]});return i.concat(s)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=e;"string"===n&&zm(e[0])&&(o=e.map(function(e){return Zm(e)}));var a=r.write(o,t,n),i=new dg(t,n,a,this.nextTensorId());if(this.incRef(i,r),"string"===n){var s=this.state.tensorInfo.get(a),u=Wm(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},e.prototype.makeTensorFromDataId=function(e,t,n,r){var o=new dg(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,r),o},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var o=new yg(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Lm(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof yg||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return tm(this,void 0,void 0,function(){var t,n;return nm(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,o,a){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},u=lm(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],o=Ym(r.size,r.dtype);return i.makeTensor(o,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],o,a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=kg(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==i.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),ym(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});ym(a instanceof dg,function(){return"The result y returned by f() must be a tensor."});var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(p=e[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){p.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,o[p.id]=!0;break}if(l)break}}var f={};f[n.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(i=(p=e[a]).inputs,c=0;c<p.outputs.length;c++)if(f[p.outputs[c].id]){for(var s in i)f[i[s].id]=!0,d[p.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var p;if(o[(p=e[a]).id]&&d[p.id]){var v={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,h.push(g)}}return h}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[a.id]=null==n?(r=$m(Cm(e=a.shape),"float32"),_g.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach(function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var i=o.gradient(a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n(function(){return i[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!Em(r.shape,a.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(s,i,function(e){return o.tidy(e)});var u=t.map(function(e){return s[e.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()}),o.state.activeTape=null),{value:a,grads:u}})},e.prototype.customGrad=function(e){var t=this;return ym(Hm(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];ym(r.every(function(e){return e instanceof dg}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return r.forEach(function(e,t){a[t]=e}),t.runKernelFunc(function(t,o){return ym((n=e.apply(void 0,r.concat([o]))).value instanceof dg,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),ym(Hm(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];ym(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),ym(a.every(function(e){return e instanceof dg}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(e,t){i[t]=function(){return e}}),i})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return tm(this,void 0,void 0,function(){var t,n;return nm(this,function(r){switch(r.label){case 0:return t=Qm(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=Qm()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Rg,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),_g=function(){var e=function(){if(null==Sg){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Sg=e}return Sg}();if(null==e._tfengine){var t=new rm(e);e._tfengine=new Ig(t)}return function(e){am=e}(e._tfengine.ENV),lg=function(){return e._tfengine},e._tfengine}();function Ng(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Tg=om();Tg.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Tg.registerFlag("IS_BROWSER",function(){return Ng()}),Tg.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Tg.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Tg.registerFlag("PROD",function(){return!1}),Tg.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Tg.getBool("DEBUG")}),Tg.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Tg.registerFlag("IS_TEST",function(){return!1});var Ag,Dg,Og,Fg={},Pg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Mg(e,t){Fg[e]=t}function Bg(e){e in Fg||(Fg[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Fg[e]},!1),1===e?t.getContext("webgl",Pg)||t.getContext("experimental-webgl",Pg):t.getContext("webgl2",Pg)}(e));var t=Fg[e];return t.isContextLost()?(delete Fg[e],Bg(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Fg[e])}function Lg(e,t){return[t,e]}function Wg(e){var t=Cm(e);return Rm(Math.ceil(t/4))}function zg(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Ug(e,t){var n,r,o,a,i,s,u,l,c,f=e;return 2===om().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,o=f.RGBA16F,a=f.RGBA32F,i=f.RED,s=4,u=1,l=f.HALF_FLOAT,c=f.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=f.RGBA,i=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function jg(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Hg(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Ag||(Ag={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Dg||(Dg={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Og||(Og={}));function Vg(e){return!!(om().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Hg(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Gg(e,t,n){return py(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function qg(e,t,n){var r=py(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(jg(e,t,function(){return e.shaderSource(r,n)}),jg(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Kg(e,t,n){var r=py(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(jg(e,t,function(){return e.shaderSource(r,n)}),jg(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=Yg.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map(function(e,t){return Im((t+1).toString(),a)+e}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),f=i.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+Im(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Xg,$g,Yg=/ERROR: [0-9]+:([0-9]+):/g;function Qg(e,t){return py(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function Jg(e,t,n){if(jg(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Zg(e,t,n){if(jg(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function ey(e,t,n){var r=py(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return jg(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),jg(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function ty(e,t,n){var r=py(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return jg(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),jg(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function ny(e,t){return py(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function ry(e,t){var n=om().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function oy(e,t){return py(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function ay(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(jg(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),jg(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),jg(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function iy(e,t,n,r){vy(e,r),jg(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),jg(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function sy(e,t,n,r){return py(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function uy(e,t,n){return e.getUniformLocation(t,n)}function ly(e,t,n,r,o,a){jg(e,t,function(){return iy(e,t,r,a)}),jg(e,t,function(){return e.uniform1i(o,a)})}function cy(e,t,n,r){jg(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),jg(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function fy(e,t,n){jg(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),jg(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function dy(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+hy(e,t))}function hy(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function py(e,t,n,r){var o=jg(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function vy(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function my(e,t){return void 0===t&&(t=2),Cm(e.slice(0,e.length-t))}function gy(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function yy(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[my(e)].concat(gy(e))),t}function xy(e,t){var n;void 0===t&&(t=!1);var r=om().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?mm(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=Am(e);e=o.newShape}var a=Cm(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=my(e),s=2,u=2;return e.length&&(s=(n=gy(e))[0],u=n[1]),Rm(a=i*(s/2)*(u/2)).map(function(e){return 2*e})}return Rm(a)}function by(e){return e%2==0}function wy(e,t){if(Em(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(by(n)&&by(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&by(e[0])&&by(t[0])}function Cy(e){if(null==Xg){var t=Bg(e);Xg=t.getParameter(t.MAX_TEXTURE_SIZE)}return Xg}function Ey(e){if(null==$g){var t=Bg(e);$g=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,$g)}function ky(e){if(0===e)return 0;var t=Bg(e);return Sy(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Sy(t,"EXT_disjoint_timer_query")?1:0}function Sy(e,t){return null!=e.getExtension(t)}function Ry(e){try{if(null!=Bg(e))return!0}catch(e){return!1}return!1}function Iy(e){if(0===e)return!1;var t=Bg(e);if(1===e){if(!Sy(t,"OES_texture_float"))return!1}else if(!Sy(t,"EXT_color_buffer_float"))return!1;return Ny(t)}function _y(e){if(0===e)return!1;var t=Bg(e);if(1!==e){if(Sy(t,"EXT_color_buffer_float"))return Ny(t);if(Sy(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=Ug(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}(t,n)}return!1}return!!Sy(t,"OES_texture_float")&&!!Sy(t,"WEBGL_color_buffer_float")&&Ny(t)}function Ny(e){var t=Ug(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function Ty(e){return 2===e&&null!=Bg(e).fenceSync}var Ay=Object.freeze({callAndCheck:jg,canBeRepresented:Vg,getWebGLErrorMessage:Hg,getExtensionOrThrow:Gg,createVertexShader:qg,createFragmentShader:Kg,createProgram:Qg,linkProgram:Jg,validateProgram:Zg,createStaticVertexBuffer:ey,createStaticIndexBuffer:ty,getNumChannels:function(){return 2===om().getNumber("WEBGL_VERSION")?1:4},createTexture:ny,validateTextureSize:ry,createFramebuffer:oy,bindVertexBufferToProgramAttribute:ay,bindTextureUnit:iy,unbindTextureUnit:function(e,t,n){vy(e,n),jg(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),jg(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:sy,getProgramUniformLocation:uy,bindTextureToProgramUniformSampler:ly,bindCanvasToFramebuffer:function(e,t){jg(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),jg(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),jg(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:cy,unbindColorTextureFromFramebuffer:fy,validateFramebuffer:dy,getFramebufferErrorMessage:hy,getBatchDim:my,getRowsCols:gy,getShapeAs3D:yy,getTextureShapeFromLogicalShape:xy,isReshapeFree:wy,getWebGLMaxTextureSize:Cy,resetMaxTextureSize:function(){Xg=null},resetMaxTexturesInShader:function(){$g=null},getMaxTexturesInShader:Ey,getWebGLDisjointQueryTimerVersion:ky,hasExtension:Sy,isWebGLVersionEnabled:Ry,isCapableOfRenderingToFloatTexture:Iy,isDownloadFloatTextureEnabled:_y,isWebGLFenceEnabled:Ty}),Dy=om();function Oy(e){om().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Fy(e,t){return _g.tidy(e,t)}function Py(e){kg(e).forEach(function(e){return e.dispose()})}function My(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];om().getBool("IS_TEST")||console.warn.apply(console,e)}function By(e,t){var n=e;if(Bm(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Bm(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&om().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Bm(t)){ym(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),ym(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var o=n.slice(1),a=0;a<t.length;++a)e(t[a],o,r.concat(a))}else ym(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,r,[]),r}function Ly(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function Wy(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof dg)return Ly(r,e.dtype,t,n),e;var o=Vm(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Ly(r,o,t,n),null==e||!Bm(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=By(e,o);Bm(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?Km(e,o,om().getBool("DEBUG")):wm(e,[],!0);return _g.makeTensor(s,i,o)}function zy(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return Wy(e,t+"["+r+"]",n)},r)}function Uy(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function jy(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}function Vy(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function Hy(e,t){return jy(e,t.map(function(e){return 1}),t)}function Gy(e,t,n){ym(Uy(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function qy(e,t){if(Uy(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function Ky(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Xy(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function $y(e,t){var n=e[0].length;e.forEach(function(e,t){ym(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),ym(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var a=0;a<n;a++)ym(a===t||e[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Yy(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Qy(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];_g.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),_g.endScope(o),o}catch(e){throw _g.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Dy.registerFlag("HAS_WEBGL",function(){return Dy.getNumber("WEBGL_VERSION")>0}),Dy.registerFlag("WEBGL_VERSION",function(){return Ry(2)?2:Ry(1)?1:0}),Dy.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Dy.get("WEBGL_VERSION")}),Dy.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Dy.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Dy.registerFlag("WEBGL_PACK",function(){return Dy.getBool("HAS_WEBGL")}),Dy.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_PACK_CLIP",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Dy.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_PACK_REDUCE",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_CONV_IM2COL",function(){return Dy.getBool("WEBGL_PACK")}),Dy.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Cy(Dy.getNumber("WEBGL_VERSION"))}),Dy.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Ey(Dy.getNumber("WEBGL_VERSION"))}),Dy.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=Dy.getNumber("WEBGL_VERSION");return 0===e?0:ky(e)}),Dy.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Dy.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),Dy.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Iy(Dy.getNumber("WEBGL_VERSION"))}),Dy.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Dy.getBool("WEBGL_FORCE_F16_TEXTURES")&&Dy.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Dy.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return _y(Dy.getNumber("WEBGL_VERSION"))}),Dy.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ty(Dy.getNumber("WEBGL_VERSION"))}),Dy.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Dy.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),fg=Oy;var Jy=Qy({complex_:function(e,t){var n=Wy(e,"real","complex"),r=Wy(t,"imag","complex");return xm(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),_g.runKernelFunc(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),Zy=Qy({real_:function(e){var t=Wy(e,"input","real");return _g.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),ex=Qy({imag_:function(e){var t=Wy(e,"input","imag");return _g.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function tx(e,t,n){return nx(e,t,By(e,n),n)}function nx(e,t,n,r){if(null==r&&(r=Vm(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Bm(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Jm(t);var o=Cm(t),a=Cm(n);ym(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==Cm(t.slice(i));ym(n[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return Bm(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Km(e,r,om().getBool("DEBUG")):wm(e,[],!0),_g.makeTensor(e,t,r)}function rx(e,t){if((Bm(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Bm(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return nx(e,[],[],t)}function ox(e,t){bm(e);var n=By(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return nx(e,null,n,t)}function ax(e,t,n){if(bm(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=By(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return nx(e,t,r,n)}function ix(e,t,n){if(bm(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=By(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return nx(e,t,r,n)}function sx(e,t,n){if(bm(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=By(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return nx(e,t,r,n)}function ux(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=ux(e,"float32"),r=lx(e,"float32");return Jy(n,r)}var o=$m(Cm(e),t);return _g.makeTensor(o,e,t)}function lx(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=lx(e,"float32"),r=lx(e,"float32");return Jy(n,r)}var o=Ym(Cm(e),t);return _g.makeTensor(o,e,t)}function cx(e,t,n){return _g.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function fx(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return lx([0],r);var o=Ym(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return ox(o,r)}var dx=Qy({onesLike_:function(e){var t=Wy(e,"x","onesLike");if("complex64"===t.dtype){var n=dx(Zy(t)),r=hx(ex(t));return Jy(n,r)}return _g.runKernelFunc(function(e){return e.onesLike(t)},{x:t},function(e,t){return{x:function(){return hx(e)}}},"OnesLike")}}),hx=Qy({zerosLike_:function(e){var t=Wy(e,"x","zerosLike");return _g.runKernelFunc(function(e){return e.zerosLike(t)},{x:t},function(e,t){return{x:function(){return hx(e)}}},"ZerosLike")}}),px=Qy({concat_:function(e,t){void 0===t&&(t=0),ym(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=zy(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")}),t=Tm(t,n[0].shape)[0];var r=Yy(n.map(function(e){return e.shape}),t);if(0===Cm(r))return tx([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});$y(o,t);var a=n,i={axis:t};return _g.runKernelFunc(function(e){return e.concat(n,t)},a,function(e){var n=o.map(function(e){return e[t]});return xx(e,n,t).map(function(e){return function(){return e}})},"Concat",i)}}),vx=Qy({concat1d_:function(e){return px(e,0)}}),mx=Qy({concat2d_:function(e,t){return px(e,t)}}),gx=Qy({concat3d_:function(e,t){return px(e,t)}}),yx=Qy({concat4d_:function(e,t){return px(e,t)}}),xx=Qy({split_:function(e,t,n){void 0===n&&(n=0);var r,o=Wy(e,"x","split");return n=Tm(n,o.shape)[0],"number"==typeof t?(ym(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(ym(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),_g.runKernelFunc(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return px(e,n)}}})}});function bx(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",Jm(e),new ug(e,t,n)}var wx=Qy({batchToSpaceND_:function(e,t,n){var r=Wy(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return ym(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),ym(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),ym(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),_g.runKernelFunc(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),Cx=Qy({cast_:function(e,t){var n=Wy(e,"x","cast");if(!Pm(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return _g.runKernelFunc(function(e){return e.cast(n,t)},{x:n},function(e){return{x:function(){return e.clone()}}},"Cast",r)}}),Ex=Qy({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=Wy(e,"x","cumsum"),a=qy([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=Xy(1,o.rank)[0],u=_g.runKernelFunc(function(e){return e.cumsum(i,s,n,r)},{permutedX:i},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=a&&(u=u.transpose(a)),u}}),kx=Qy({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=Wy(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return ym(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),ym(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),ym(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),_g.runKernelFunc(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),Sx=Qy({expandDims_:function(e,t){void 0===t&&(t=0);var n=Wy(e,"x","expandDims",null);ym(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(ym(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Rx(n,r)}}),Rx=Qy({reshape_:function(e,t){var n=Wy(e,"x","reshape",null);t=Nm(t,n.size),ym(n.size===Cm(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return _g.runKernelFunc(function(e){return e.reshape(n,t)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}},"Reshape",r)}}),Ix=Qy({spaceToBatchND_:function(e,t,n){var r=Wy(e,"x","spaceToBatchND");return ym(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),ym(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),ym(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),_g.runKernelFunc(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),_x=Qy({squeeze_:function(e,t){var n=Wy(e,"x","squeeze");return Rx(n,Am(n.shape,t).newShape)}}),Nx=Qy({stack_:function(e,t){void 0===t&&(t=0);var n=zy(e,"tensors","stack");if(ym(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;ym(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){xm(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){ym(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(e){return e.expandDims(t)});return px(i,t)}}),Tx=Qy({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=Wy(e,"x","unstack");ym(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return _g.runKernelFunc(function(e){return e.unstack(n,t)},{x:n},function(e){return{x:function(){return Nx(e,t)}}},"Unpack",r)}});function Ax(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function Dx(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function Ox(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function Fx(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Px(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}var Mx="Div",Bx="SquaredDifference",Lx="BroadcastTo",Wx="OneHot",zx="Identity",Ux="Tile",jx="PadV2",Vx=Qy({add_:function(e,t){var n,r=Wy(e,"a","add"),o=Wy(t,"b","add");n=Cg(r,o),r=n[0],o=n[1];var a={a:r,b:o};return _g.runKernelFunc(function(e,t){var n=e.add(r,o);return t([r,o]),n},a,null,"Add")}});function Hx(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function Gx(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function qx(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}var Kx=Qy({abs_:function(e){var t=Wy(e,"x","abs");return"complex64"===t.dtype?_g.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):_g.runKernelFunc(function(e,n){var r=e.abs(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}},"Abs")}}),Xx=Qy({acos_:function(e){var t=Wy(e,"x","acos");return _g.runKernelFunc(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(rx(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),$x=Qy({acosh_:function(e){var t=Wy(e,"x","acosh");return _g.runKernelFunc(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Yx=Qy({asin_:function(e){var t=Wy(e,"x","asin");return _g.runKernelFunc(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(rx(1).sub(n.toFloat().square()).sqrt())}}})}}),Qx=Qy({asinh_:function(e){var t=Wy(e,"x","asinh");return _g.runKernelFunc(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(rx(1).add(n.toFloat().square()).sqrt())}}})}}),Jx=Qy({atan_:function(e){var t=Wy(e,"x","atan");return _g.runKernelFunc(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),Zx=Qy({atanh_:function(e){var t=Wy(e,"x","atanh");return _g.runKernelFunc(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(rx(1).sub(n.toFloat().square()))}}})}}),eb=Qy({ceil_:function(e){var t=Wy(e,"x","ceil");return _g.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return hx(e)}}})}}),tb=Qy({clipByValue_:function(e,t,n){var r=Wy(e,"x","clipByValue");ym(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],a={min:t,max:n};return _g.runKernelFunc(function(e,o){var a=e.clip(r,t,n);return o([r]),a},{x:r},function(e,r){var o=r[0];return{x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),hx(e))}}},"ClipByValue",a,o)}}),nb=Qy({cos_:function(e){var t=Wy(e,"x","cos"),n=[t];return _g.runKernelFunc(function(e,n){var r=e.cos(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}},"Cos",{},n)}}),rb=Qy({cosh_:function(e){var t=Wy(e,"x","cosh");return _g.runKernelFunc(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),ob=Qy({erf_:function(e){var t=Wy(e,"x","erf");return ym("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),_g.runKernelFunc(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),ab=Qy({exp_:function(e){var t=Wy(e,"x","exp");return _g.runKernelFunc(function(e,n){var r=e.exp(t);return n([r]),r},{x:t},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),ib=Qy({expm1_:function(e){var t=Wy(e,"x","expm1");return _g.runKernelFunc(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),sb=Qy({floor_:function(e){var t=Wy(e,"x","floor");return _g.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return hx(e)}}})}}),ub=Qy({log_:function(e){var t=Wy(e,"x","log"),n=[t];return _g.runKernelFunc(function(e,n){var r=e.log(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}},"Log",{},n)}}),lb=Qy({log1p_:function(e){var t=Wy(e,"x","log1p");return _g.runKernelFunc(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),cb=Qy({logSigmoid_:function(e){var t=Wy(e,"x","logSigmoid");return _g.runKernelFunc(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),fb=Qy({neg_:function(e){var t=Wy(e,"x","neg"),n=[t];return _g.runKernelFunc(function(e){return e.neg(t)},{x:t},function(e){return{x:function(){return e.neg()}}},"Neg",{},n)}}),db=Qy({reciprocal_:function(e){var t=Wy(e,"x","reciprocal");return _g.runKernelFunc(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),hb=Qy({round_:function(e){var t=Wy(e,"x","round");return _g.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return hx(e)}}})}}),pb=Qy({rsqrt_:function(e){var t=Wy(e,"x","rsqrt"),n=[t];return _g.runKernelFunc(function(e,n){var r=e.rsqrt(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),vb=Qy({sigmoid_:function(e){var t=Wy(e,"x","sigmoid");return _g.runKernelFunc(function(e,n){var r=e.sigmoid(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(rx(1).sub(n)))}}},"Sigmoid")}}),mb=Qy({sign_:function(e){var t=Wy(e,"x","sign");return _g.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return hx(e)}}})}}),gb=Qy({isNaN_:function(e){var t=Wy(e,"x","isNaN");return _g.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return hx(e)}}})}}),yb=Qy({isInf_:function(e){var t=Wy(e,"x","isInf");return _g.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return hx(e)}}})}}),xb=Qy({isFinite_:function(e){var t=Wy(e,"x","isFinite");return _g.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return hx(e)}}})}}),bb=Qy({sin_:function(e){var t=Wy(e,"x","sin"),n=[t];return _g.runKernelFunc(function(e,n){var r=e.sin(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}},"Sin",{},n)}}),wb=Qy({sinh_:function(e){var t=Wy(e,"x","sinh");return _g.runKernelFunc(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),Cb=Qy({softplus_:function(e){var t=Wy(e,"x","softplus");return _g.runKernelFunc(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),Eb=Qy({sqrt_:function(e){var t=Wy(e,"x","sqrt");return _g.runKernelFunc(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),kb=Qy({step_:function(e,t){void 0===t&&(t=0);var n=Wy(e,"x","step");return _g.runKernelFunc(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return hx(e)}}})}}),Sb=Qy({tan_:function(e){var t=Wy(e,"x","tan");return _g.runKernelFunc(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),Rb=Qy({tanh_:function(e){var t=Wy(e,"x","tanh");return _g.runKernelFunc(function(e,n){var r=e.tanh(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return rx(1).sub(n.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}}),Ib=Qy({addStrict_:function(e,t){var n=Wy(e,"a","addStrict"),r=Wy(t,"b","addStrict");return xm(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),_b=Qy({atan2_:function(e,t){var n,r=Wy(e,"a","atan2"),o=Wy(t,"b","atan2");n=Cg(r,o),r=n[0],o=n[1];var a=qx(r.shape,o.shape);return _g.runKernelFunc(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Vx(n.square(),r.square()),o=e.mul(r.div(t)),i=Gx(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=Vx(n.square(),r.square()),o=fb(e.mul(n.div(t))),i=Gx(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),Nb=Qy({divStrict_:function(e,t){var n=Wy(e,"a","div"),r=Wy(t,"b","div");return xm(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Tb=Qy({floorDiv_:function(e,t){var n,r=Wy(e,"a","floorDiv"),o=Wy(t,"b","floorDiv");n=Cg(r,o),r=n[0],o=n[1];var a=qx(r.shape,o.shape);return _g.runKernelFunc(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=Gx(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Gx(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}},"FloorDiv")}}),Ab=Qy({maximum_:function(e,t){var n,r=Wy(e,"a","maximum"),o=Wy(t,"b","maximum");return n=Cg(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),qx(r.shape,o.shape),_g.runKernelFunc(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}},"Maximum")}}),Db=Qy({maximumStrict_:function(e,t){var n=Wy(e,"a","maximumStrict"),r=Wy(t,"b","maximumStrict");return xm(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Ob=Qy({minimum_:function(e,t){var n,r=Wy(e,"a","minimum"),o=Wy(t,"b","minimum");return n=Cg(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),qx(r.shape,o.shape),_g.runKernelFunc(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}},"Minimum")}}),Fb=Qy({minimumStrict_:function(e,t){var n=Wy(e,"a","minimumStrict"),r=Wy(t,"b","minimumStrict");return xm(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Pb=Qy({mod_:function(e,t){var n,r=Wy(e,"a","mod"),o=Wy(t,"b","mod");n=Cg(r,o),r=n[0],o=n[1];var a=qx(r.shape,o.shape);return _g.runKernelFunc(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Gx(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=Gx(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),Mb=Qy({modStrict_:function(e,t){var n=Wy(e,"a","modStrict"),r=Wy(t,"b","modStrict");return xm(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Bb=Qy({mul_:function(e,t){var n,r=Wy(e,"a","mul"),o=Wy(t,"b","mul");n=Cg(r,o),r=n[0],o=n[1];var a=qx(r.shape,o.shape);return _g.runKernelFunc(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),o=Gx(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Gx(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}},"Mul")}}),Lb=Qy({mulStrict_:function(e,t){var n=Wy(e,"a","mul"),r=Wy(t,"b","mul");return xm(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Wb=Qy({pow_:function(e,t){var n,r=Wy(e,"base","pow"),o=Wy(t,"exp","pow");n=Cg(r,o),r=n[0],o=n[1];var a=qx(r.shape,o.shape),i=[r,o];return _g.runKernelFunc(function(e,t){var n=e.pow(r,o);return t([r,o,n]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1],o=t[2];return{a:function(){var t=r.toFloat(),o=e.mul(t.mul(n.pow(t.sub(rx(1))))),i=Gx(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},b:function(){var t=n.greater(0),i=n.log().where(t,hx(n)),s=e.mul(o.mul(i)),u=Gx(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},i,[!0])}}),zb=Qy({powStrict_:function(e,t){return xm(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Ub=Qy({squaredDifferenceStrict_:function(e,t){var n=Wy(e,"a","squaredDifferenceStrict"),r=Wy(t,"b","squaredDifferenceStrict");return xm(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),jb=Qy({sub_:function(e,t){var n,r=Wy(e,"a","sub"),o=Wy(t,"b","sub");n=Cg(r,o),r=n[0],o=n[1];var a=qx(r.shape,o.shape);return _g.runKernelFunc(function(e){return e.subtract(r,o)},{a:r,b:o},function(e){return{a:function(){var t=e,n=Gx(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Gx(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}},"Sub")}}),Vb=Qy({subStrict_:function(e,t){var n=Wy(e,"a","subStrict"),r=Wy(t,"b","subStrict");return xm(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Hb=Qy({div_:function(e,t){var n,r=Wy(e,"a","div"),o=Wy(t,"b","div");if(n=Cg(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return Tb(r,o);var a={a:r,b:o};return _g.runKernelFunc(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},a,null,Mx,{})}});function Gb(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=qm(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,l]}Object.freeze({prepareAndValidate:Gb});function qb(e){return e<=30?e:Gm(e,Math.floor(Math.sqrt(e)))}function Kb(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}function Xb(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Kb(n,t,e)}function $b(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:Cm(t.shape)/u,sliceSize:i,strides:qm(n.slice(0,o)).concat([1]),outputSize:Cm(n)}}Object.freeze({validateUpdateShape:Kb,validateInput:Xb,calculateShapes:$b});function Yb(e,t,n){ym(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),ym(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){ym(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}function Qb(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Jb(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function Zb(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),vm(0,a,s-1)}function ew(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?vm(0,a,s):vm(-1,a,s-1)}function tw(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function nw(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:Yb,maskToAxes:Qb,computeOutShape:Jb,startForAxis:Zb,stopForAxis:ew,isSliceContinous:tw,computeFlatOffset:nw});function rw(e){return _g.customGrad(e)}var ow=Qy({softmax_:function(e,t){void 0===t&&(t=-1);var n=Wy(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return _g.runKernelFunc(function(e,r){var o=e.softmax(n,t);return r([o]),o},{logits:n},function(e,n){var r=n[0],o=e.mul(r);return{logits:function(){return o.sub(o.sum([t],!0).mul(r))}}},"Softmax",{dim:t},[],[!0])}}),aw=Qy({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=Wy(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return rw(function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),iw=Qy({transpose_:function(e,t){var n=Wy(e,"x","transpose");if(null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),ym(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){ym(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return _g.runKernelFunc(function(e){return e.transpose(n,t)},{x:n},null,"Transpose",r)}}),sw=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),uw=function(){function e(){}return e.prototype.time=function(e){return lw("time")},e.prototype.read=function(e){return lw("read")},e.prototype.readSync=function(e){return lw("readSync")},e.prototype.numDataIds=function(){return lw("numDataIds")},e.prototype.disposeData=function(e){return lw("disposeData")},e.prototype.write=function(e,t,n){return lw("write")},e.prototype.move=function(e,t,n,r){return lw("move")},e.prototype.memory=function(){return lw("memory")},e.prototype.floatPrecision=function(){return lw("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return lw("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,lw("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return lw("slice")},e.prototype.stridedSlice=function(e,t,n,r){return lw("stridedSlice")},e.prototype.unstack=function(e,t){return lw("unstack")},e.prototype.reverse=function(e,t){return lw("reverse")},e.prototype.concat=function(e,t){return lw("concat")},e.prototype.neg=function(e){return lw("neg")},e.prototype.add=function(e,t){return lw("add")},e.prototype.addN=function(e){return lw("addN")},e.prototype.subtract=function(e,t){return lw("subtract")},e.prototype.multiply=function(e,t){return lw("multiply")},e.prototype.realDivide=function(e,t){return lw("realDivide")},e.prototype.floorDiv=function(e,t){return lw("floorDiv")},e.prototype.sum=function(e,t){return lw("sum")},e.prototype.prod=function(e,t){return lw("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return lw("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return lw("argMin")},e.prototype.argMax=function(e,t){return lw("argMax")},e.prototype.equal=function(e,t){return lw("equal")},e.prototype.notEqual=function(e,t){return lw("notEqual")},e.prototype.less=function(e,t){return lw("less")},e.prototype.lessEqual=function(e,t){return lw("lessEqual")},e.prototype.greater=function(e,t){return lw("greater")},e.prototype.greaterEqual=function(e,t){return lw("greaterEqual")},e.prototype.logicalNot=function(e){return lw("logicalNot")},e.prototype.logicalAnd=function(e,t){return lw("logicalAnd")},e.prototype.logicalOr=function(e,t){return lw("logicalOr")},e.prototype.where=function(e){return lw("where")},e.prototype.select=function(e,t,n){return lw("select")},e.prototype.topk=function(e,t,n){return lw("topk")},e.prototype.min=function(e,t){return lw("min")},e.prototype.minimum=function(e,t){return lw("minimum")},e.prototype.mod=function(e,t){return lw("mod")},e.prototype.max=function(e,t){return lw("max")},e.prototype.maximum=function(e,t){return lw("maximum")},e.prototype.all=function(e,t){return lw("all")},e.prototype.any=function(e,t){return lw("any")},e.prototype.squaredDifference=function(e,t){return lw("squaredDifference")},e.prototype.ceil=function(e){return lw("ceil")},e.prototype.floor=function(e){return lw("floor")},e.prototype.round=function(e){return lw("round")},e.prototype.sign=function(e){return lw("sign")},e.prototype.isNaN=function(e){return lw("isNaN")},e.prototype.isInf=function(e){return lw("isInf")},e.prototype.isFinite=function(e){return lw("isFinite")},e.prototype.pow=function(e,t){return lw("pow")},e.prototype.exp=function(e){return lw("exp")},e.prototype.expm1=function(e){return lw("expm1")},e.prototype.softmax=function(e,t){return lw("softmax")},e.prototype.log=function(e){return lw("log")},e.prototype.log1p=function(e){return lw("log1p")},e.prototype.sqrt=function(e){return lw("sqrt")},e.prototype.rsqrt=function(e){return lw("rsqrt")},e.prototype.square=function(e){return lw("square")},e.prototype.reciprocal=function(e){return lw("reciprocal")},e.prototype.relu=function(e){return lw("relu")},e.prototype.relu6=function(e){return lw("relu6")},e.prototype.prelu=function(e,t){return lw("prelu")},e.prototype.elu=function(e){return lw("elu")},e.prototype.eluDer=function(e,t){return lw("eluDer")},e.prototype.selu=function(e){return lw("selu")},e.prototype.int=function(e){return lw("int")},e.prototype.clip=function(e,t,n){return lw("clip")},e.prototype.abs=function(e){return lw("abs")},e.prototype.complexAbs=function(e){return lw("complexAbs")},e.prototype.sigmoid=function(e){return lw("sigmoid")},e.prototype.softplus=function(e){return lw("softplus")},e.prototype.sin=function(e){return lw("sin")},e.prototype.cos=function(e){return lw("cos")},e.prototype.tan=function(e){return lw("tan")},e.prototype.asin=function(e){return lw("asin")},e.prototype.acos=function(e){return lw("acos")},e.prototype.atan=function(e){return lw("atan")},e.prototype.atan2=function(e,t){return lw("atan2")},e.prototype.sinh=function(e){return lw("sinh")},e.prototype.cosh=function(e){return lw("cosh")},e.prototype.tanh=function(e){return lw("tanh")},e.prototype.asinh=function(e){return lw("asinh")},e.prototype.acosh=function(e){return lw("acosh")},e.prototype.atanh=function(e){return lw("atanh")},e.prototype.erf=function(e){return lw("erf")},e.prototype.step=function(e,t){return lw("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,lw("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return lw("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return lw("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return lw("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,lw("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return lw("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return lw("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return lw("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return lw("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return lw("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return lw("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return lw("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return lw("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return lw("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return lw("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return lw("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return lw("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return lw("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return lw("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return lw("reshape")},e.prototype.cast=function(e,t){return lw("cast")},e.prototype.tile=function(e,t){return lw("tile")},e.prototype.pad=function(e,t,n){return lw("pad")},e.prototype.transpose=function(e,t){return lw("transpose")},e.prototype.gather=function(e,t,n){return lw("gather")},e.prototype.gatherND=function(e,t){return lw("gatherND")},e.prototype.scatterND=function(e,t,n){return lw("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return lw("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return lw("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return lw("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return lw("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return lw("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return lw("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,o,a){return lw("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){return lw("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){return lw("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return lw("multinomial")},e.prototype.oneHot=function(e,t,n,r){return lw("oneHot")},e.prototype.cumsum=function(e,t,n,r){return lw("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return lw("nonMaxSuppression")},e.prototype.fft=function(e){return lw("fft")},e.prototype.ifft=function(e){return lw("ifft")},e.prototype.complex=function(e,t){return lw("complex")},e.prototype.real=function(e){return lw("real")},e.prototype.imag=function(e){return lw("imag")},e.prototype.cropAndResize=function(e,t,n,r,o,a){return lw("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return lw("depthToSpace")},e.prototype.split=function(e,t,n){return lw("split")},e.prototype.sparseToDense=function(e,t,n,r){return lw("sparseToDense")},e.prototype.diag=function(e){return lw("diag")},e.prototype.fill=function(e,t,n){return lw("fill")},e.prototype.onesLike=function(e){return lw("onesLike")},e.prototype.zerosLike=function(e){return lw("zerosLike")},e.prototype.linspace=function(e,t,n){return lw("linspace")},e.prototype.dispose=function(){return lw("dispose")},e}();function lw(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function cw(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=vw(t),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return dw(e,s,n,r,o,a,!1,i)}function fw(e,t,n,r,o,a,i){void 0===i&&(i="NDHWC");var s,u,l=mw(t),c=l[0],f=l[1],d=l[2];if("NDHWC"===i)u="channelsLast",s=[c,f,d,e[4],e[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,f,d,e[1],e[1]]}return hw(e,s,n,r,o,!1,u,a)}function dw(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3];if("channelsLast"===s)l=e[0],c=e[1],f=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],d=e[1],c=e[2],f=e[3]}var h,p=t[0],v=t[1],m=t[3],g=vw(n),y=g[0],x=g[1],b=vw(r),w=b[0],C=b[1],E=gw(p,w),k=gw(v,C),S=function(e,t,n,r,o,a,i,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,o){null==r&&(r=pw(e,t,n));var a=e[1],i=yw((e[0]-t+2*r)/n+1,o);ym(km(i),function(){return"The output # of rows ("+i+") must be an integer. Change the stride and/or zero pad parameters"});var s=yw((a-t+2*r)/n+1,o);return ym(km(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[i,s]}([t,n],a,r,e,s);l=f[0],c=f[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/o);var d=Math.max(0,(l-1)*r+a-t),h=Math.max(0,(c-1)*o+i-n),p=Math.floor(d/2),v=d-p,m=Math.floor(h/2);u={top:p,bottom:v,left:m,right:h-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,f,y,x,E,k,a),R=S.padInfo,I=S.outHeight,_=S.outWidth,N=i?m*d:m;return"channelsFirst"===s?h=[l,N,I,_]:"channelsLast"===s&&(h=[l,I,_,N]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:f,inChannels:d,outHeight:I,outWidth:_,outChannels:N,padInfo:R,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:k,dilationHeight:w,dilationWidth:C,inShape:e,outShape:h,filterShape:t}}function hw(e,t,n,r,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],d=u[3],h=u[4];if("channelsLast"===i)l=e[0],c=e[1],f=e[2],d=e[3],h=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);l=e[0],h=e[1],c=e[2],f=e[3],d=e[4]}var p,v=t[0],m=t[1],g=t[2],y=t[4],x=mw(n),b=x[0],w=x[1],C=x[2],E=mw(r),k=E[0],S=E[1],R=E[2],I=gw(v,k),_=gw(m,S),N=gw(g,R),T=function(e,t,n,r,o,a,i,s,u,l,c){var f,d,h,p;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,o,a){null==o&&(o=pw(e,t,r));var i=e[1],s=e[2],u=yw((e[0]-t+2*o)/r+1,a);ym(km(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=yw((i-t+2*o)/r+1,a);ym(km(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var c=yw((s-t+2*o)/r+1,a);return ym(km(c),function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,c,1]}([t,n,r,1],s,0,o,e,c);d=v[0],h=v[1],p=v[2]}else if("same"===e){var m=((d=Math.ceil(t/o))-1)*o+s-t,g=((h=Math.ceil(n/a))-1)*a+u-n,y=((p=Math.ceil(r/i))-1)*i+l-r,x=Math.floor(m/2),b=m-x,w=Math.floor(g/2),C=g-w,E=Math.floor(y/2);f={top:w,bottom:C,left:E,right:y-E,front:x,back:b,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/o),h=Math.ceil((n-u+1)/a),p=Math.ceil((r-l+1)/i)}return{padInfo:f,outDepth:d,outHeight:h,outWidth:p}}(o,c,f,d,b,w,C,I,_,N,s),A=T.padInfo,D=T.outDepth,O=T.outHeight,F=T.outWidth,P=a?y*h:y;return"channelsFirst"===i?p=[l,P,D,O,F]:"channelsLast"===i&&(p=[l,D,O,F,P]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:f,inWidth:d,inChannels:h,outDepth:D,outHeight:O,outWidth:F,outChannels:P,padInfo:A,strideDepth:b,strideHeight:w,strideWidth:C,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:_,effectiveFilterWidth:N,dilationDepth:k,dilationHeight:S,dilationWidth:R,inShape:e,outShape:p,filterShape:t}}function pw(e,t,n,r){void 0===r&&(r=1);var o=gw(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function vw(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function mw(e){return"number"==typeof e?[e,e,e]:e}function gw(e,t){return t<=1?e:e+(e-1)*(t-1)}function yw(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function xw(e){var t=vw(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function bw(e,t){return xw(e)||xw(t)}function ww(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Cw(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=lx(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!Mm(e.dtype,t))return _g.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=rx(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Ew(e,t){return _g.makeTensorFromDataId(e.dataId,t,e.dtype)}function kw(e,t,n){var r=(t-e)/(n-1),o=Ym(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return ox(o,"float32")}Object.freeze({castTensor:Cw,reshapeTensor:Ew,linspaceImpl:kw,upcastType:bg,axesAreInnerMostDims:Uy,combineLocations:jy,computeOutAndReduceShapes:Vy,expandShapeToKeepDim:Hy,assertAxesAreInnerMostDims:Gy,getAxesPermutation:qy,getUndoAxesPermutation:Ky,getInnerMostAxes:Xy,getBroadcastDims:Hx,getReductionAxes:Gx,assertAndGetBroadcastShape:qx,assertParamsConsistent:$y,computeOutShape:Yy,computePool2DInfo:cw,computePool3DInfo:fw,computeConv2DInfo:dw,computeConv3DInfo:hw,computeDefaultPad:pw,tupleValuesAreOne:xw,eitherStridesOrDilationsAreOne:bw,convertConv2DDataFormat:ww,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:qb});function Sw(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Rw(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Iw(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function _w(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Nw(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,o=e.length,a=0,i=!1;r<o;){var s=n(t,e[a=r+(o-r>>>1)]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}(e,t,n||Tw)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function Tw(e,t){return e>t?1:e<t?-1:0}function Aw(e,t,n,r,o){return Ow(e,t,n,r,o,0).selectedIndices}function Dw(e,t,n,r,o,a){var i=Ow(e,t,n,r,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function Ow(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map(function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}}).filter(function(e){return e.score>o}).sort(Mw),l=a>0?-.5/a:0,c=[],f=[];c.length<n&&u.length>0;){var d=u.pop(),h=d.score,p=d.boxIndex,v=d.suppressBeginIndex;if(h<o)break;for(var m=!1,g=c.length-1;g>=v;--g){var y=Fw(e,p,c[g]);if(y>=r){m=!0;break}if(d.score=d.score*Pw(r,l,y),d.score<=o)break}d.suppressBeginIndex=c.length,m||(d.score===h?(c.push(p),f.push(d.score)):d.score>o&&Nw(u,d,Mw))}var x=c.length;return s&&(c.fill(0,x),f.fill(0,x)),{selectedIndices:ox(c,"int32"),selectedScores:ox(f,"float32"),numValidOutputs:rx(x,"int32")}}function Fw(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-a)*(u-i),p=(f-l)*(d-c);if(h<=0||p<=0)return 0;var v=Math.max(a,l),m=Math.max(i,c),g=Math.min(s,f),y=Math.min(u,d),x=Math.max(g-v,0)*Math.max(y-m,0);return x/(h+p-x)}function Pw(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Mw(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Bw(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a})}function Lw(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=bx(n,e.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(e.rank),s=0;s<i.length;s++)i[s]=a[s]%e.shape[s];var u=e.locToIndex(i);o.values[r]=e.values[u]}return o.toTensor()}function Ww(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=Dm(n,s*r),c=Dm("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=e.subarray(d,d+u),p=[],v=0;v<h.length;v++)p.push({value:h[v],index:v});p.sort(function(e,t){return t.value-e.value});var m=f*r,g=l.subarray(m,m+r),y=c.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var x=t.slice();return x[x.length-1]=r,[tx(l,x,n),tx(c,x,"int32")]}function zw(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=bx(e,"int32"),a=bx([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var Uw=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},jw=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Vw=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Hw(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function Gw(e,t){return 1===t?[e]:Hw(e,t)}function qw(){var e,t,n,r,o,a,i,s,u,l;return 2===om().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Kw(e,t,n){void 0===n&&(n="index");var r=qm(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function Xw(e){var t=qm(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var $w="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Yw(e,t,n,r){var o=[];e.forEach(function(e){var t=Cm(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var a,i,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Jw(e):Qw(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Hx(e.shapeInfo.logicalShape,t.logicalShape),l=aC(s),c=s-i,f=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+f[e+c]+" = 0;"}).join("\n");var d;d=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+c]}).join(", ");var h="return outputValue;",p=1===Cm(e.shapeInfo.logicalShape),v=1===Cm(t.logicalShape);if(1!==i||p||v){if(p&&!v)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=i-2,g=i-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?h="return vec4(outputValue.x);":u.indexOf(m)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Em(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l,c=aC(u),f=Hx(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,h=["x","y","z","w","u","v"];l=0===s?"":u<2&&f.length>=1?"coords = 0;":f.map(function(e){return"coords."+h[e+d]+" = 0;"}).join("\n");var p;return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+h[t+d]}).join(", "),"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+l+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,c=qw(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Zw+"\n    "+eC+"\n    "+tC+"\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Em(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,o,a,i}(t.logicalShape,l),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return Em(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=Kw(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=Kw(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=Kw(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=Kw(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,l),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(d+=nC),[d,f,i,s,a,u,n].join("\n")}function Qw(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+rC(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+oC(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=rC(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&Em(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=Am(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n      "+Qw(iC(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+sC(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+oC(e)+"\n      }\n    ";var c=o[0],f=o[1],d=rC(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+c+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=Am(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n        "+Qw(iC(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+sC(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+oC(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,f=c[0],d=c[1],h=e.shapeInfo.flatOffset;return d===o&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===a&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+rC(n)+";\n        vec2 uv = uvFromFlat("+f+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=Am(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return"\n      "+Qw(iC(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+sC(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+oC(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],h=f[1];return h===i&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===o&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+h+", index + "+rC(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=Am(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return"\n      "+Qw(iC(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+sC(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+oC(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1];return p===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+rC(n)+";\n      vec2 uv = uvFromFlat("+h+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Am(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+Qw(iC(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+sC(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,f=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+c+", "+l+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+oC(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],v=h[1];return v===f&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+l+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":v===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+rC(n)+";\n      vec2 uv = uvFromFlat("+p+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Jw(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+qw().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=qw();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=qw();if(null!=o&&Em(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+Jw(iC(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+sC(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+qw().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),f="int b, int row, int col",d="b * "+c+" + (row / 2) * "+l+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,d="b"+h+" * "+(c*=t[n-h-1])+" + "+d;return"\n    vec4 "+o+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+qw().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var Zw="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",eC="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",tC="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",nC="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function rC(e){return"offset"+e}function oC(e){var t=e.name,n=Cm(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function aC(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function iC(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function sC(e,t){return t.map(function(t){return e[t]}).join(", ")}var uC=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ym(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=aC(l),f=Gw("coords",l);if(1===a){var d=aC(s=l+1);i="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[l-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[l-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[l-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+f[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+f[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+f[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+f[l-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],v=h.map(function(e){return"int "+e}),m=Gw("sourceLocR",s-1).concat("inIdx.r"),g=Gw("sourceLocG",s-1).concat("inIdx.g"),y=Gw("sourceLocB",s-1).concat("inIdx.b"),x=Gw("sourceLocA",s-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+")));",C="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+x.join()+") : 0.)",E=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+E+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+f[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+f[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+C+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+C+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},lC=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},cC=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=c-1-e.padInfo.front,p=f-1-e.padInfo.top,v=d-1-e.padInfo.left,m=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+p+", "+v+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+l+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fC=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],qx(e,t),qx(e,n);var i="0.0";null!=r&&(qx(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(qx(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},dC=function(e,t,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],qx(e,t),qx(e,n);var i="vec4(0.0)";null!=r&&(qx(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(qx(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},hC=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=qx(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},pC="return a + b;",vC="return a - b;",mC="return a * b;",gC="return (a < 0.) ? b * a : a;",yC=function(e,t,n){this.variableNames=["A","B"],this.outputShape=qx(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},xC="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",bC=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=qx(t,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===Cm(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+aC(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=Gw("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},wC=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),CC=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),EC=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},kC=function(e){this.outputShape=[],this.outputShape=Yy(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},SC=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Yy(e,t);var n=this.outputShape,r=n.length,o=aC(r),a=Gw("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c=i.slice(-2),f=i.join(),d="if ("+l+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+c.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];d+="\n        if ("+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+RC(i,l,h)+"),\n            vec2("+RC(c,l,h)+"));\n        }"}var p=s.length,v=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+RC(i,l,v)+"),\n          vec2("+RC(c,l,v)+"));",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function RC(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?e+" - "+n:e}).join()}var IC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_C=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a="channelsLast"===e.dataFormat,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+c+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+l+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},NC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},TC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},AC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},DC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},OC=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,a=e.padInfo.left,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p="channelsLast"===e.dataFormat,v=p?1:2,m=p?2:3,g=p?3:1,y="",x="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",x="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+x+"\n        setOutput(result);\n      }\n    "},FC=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},PC=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},MC=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h,v="int xR; int xC; int xCOffset;",m=0;m<d;m++)for(var g=0;g<h;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<d;m++)for(var y=0;y<p;y++){if(v+="\n          xR = xRCorner + "+m*c+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===l){if(g<h&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+m+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<h)){var x=s%2==0?mm(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<h&&(v+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<h&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<h&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<h&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<h&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<d;m++)for(g=0;g<h;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var b="",w="";n&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+C+"\n        "+w+"\n        setOutput(result);\n      }\n    "},BC=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],f=n[1];this.outputShape=[l,c,f,u];var d="bilinear"===r?1:0,h=[i-1+".0",s-1+".0"],p=h[0],v=h[1],m=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],y=m[1],x=m[2],b=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=b[0],C=b[1],E=b[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+C+";\n\n        float in_y = "+x+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+E+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},LC=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+aC(r)+" coords = getOutputCoords();\n        int end = "+WC(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+WC(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function WC(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var zC=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ag.DENSE;var t=Wg(e),n=qw();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Kw(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},UC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ag.DENSE;var t=Wg(e),n=qw();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Kw(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},jC=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),VC=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},HC=function(e){this.variableNames=["A"],this.outTexUsage=Dg.DOWNLOAD;var t=qw();this.outputShape=e,this.userCode="\n      "+$w+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},GC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Dg.DOWNLOAD;var t=qw();this.outputShape=e,this.userCode="\n      "+$w+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},qC=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=qw(),o=t[0],a=t[1];this.outputShape=e;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+Xw(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},KC=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=qw(),o=t[0],a=t[1];this.outputShape=e;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+e[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Xw(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},XC=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},$C=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),YC=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=aC(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},QC=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=aC(t.length),o=aC(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function JC(e,t){var n=qw();return qg(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function ZC(e,t){return ey(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function eE(e,t){return ty(e,t,new Uint16Array([0,1,2,2,1,3]))}function tE(e,t,n,r,o,a,i){ry(n,r);var s=ny(e,t),u=e.TEXTURE_2D;return jg(e,t,function(){return e.bindTexture(u,s)}),jg(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),jg(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),jg(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),jg(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),jg(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),jg(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function nE(e,t,n,r,o){var a=Lg(n,r);return tE(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function rE(e,t,n,r,o){var a=Lg(n,r);return tE(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function oE(e,t,n,r,o){var a=Lg(n,r);return tE(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function aE(e,t,n,r,o){var a=zg(n,r);return tE(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function iE(e,t,n,r,o){var a=zg(n,r);return tE(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function sE(e,t,n,r){return jg(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),ay(e,t,n,"clipSpacePos",r,3,20,0)&&ay(e,t,n,"uv",r,2,20,12)}function uE(e,t,n,r,o,a,i){var s,u,l;jg(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),jg(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),jg(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function lE(e,t,n,r){jg(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?jg(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):jg(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),jg(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function cE(e,t,n,r,o){var a=e.createBuffer();jg(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*n*r;return jg(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),jg(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),jg(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}function fE(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function dE(e,t,n,r,o){var a=Lg(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return jg(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function hE(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(function(e,t){var n=zg(e,t);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function pE(e,t,n,r){var o=new Float32Array(n*r*4);return jg(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var vE=Object.freeze({createVertexShader:JC,createVertexBuffer:ZC,createIndexBuffer:eE,createFloat32MatrixTexture:nE,createFloat16MatrixTexture:rE,createUnsignedBytesMatrixTexture:oE,createPackedMatrixTexture:aE,createFloat16PackedMatrixTexture:iE,bindVertexProgramAttributeStreams:sE,uploadDenseMatrixToTexture:uE,uploadPixelDataToTexture:lE,createBufferFromOutputTexture:cE,downloadFloat32MatrixFromBuffer:fE,downloadByteEncodedFloatMatrixFromOutputTexture:dE,downloadPackedMatrixFromBuffer:hE,downloadMatrixFromPackedOutputTexture:pE}),mE=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=om().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,Mg(t,e)):this.gl=Bg(t);var n="WEBGL_color_buffer_float";if(1===om().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Gg(this.gl,this.debug,"OES_texture_float"),Sy(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Gg(this.gl,this.debug,"OES_texture_half_float");else if(om().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Sy(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Gg(this.gl,this.debug,"EXT_color_buffer_half_float");else if(om().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Sy(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Sy(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=ZC(this.gl,this.debug),this.indexBuffer=eE(this.gl,this.debug),this.framebuffer=oy(this.gl,this.debug),this.textureConfig=Ug(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return om().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;jg(t,this.debug,function(){return t.finish()}),jg(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),jg(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),jg(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),jg(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),jg(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),nE(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),rE(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),oE(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),lE(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),uE(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),iE(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),aE(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(fy(this.gl,this.debug,this.framebuffer),this.outputTexture=null),jg(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return dE(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return hE(this.gl,e,0,0,0,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return fE(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=cE(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(om().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return pE(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=Kg(t,this.debug,e),r=JC(t,this.debug),o=Qg(t,this.debug);return jg(t,this.debug,function(){return t.attachShader(o,r)}),jg(t,this.debug,function(){return t.attachShader(o,n)}),Jg(t,this.debug,o),this.debug&&Zg(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=sE(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&jg(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Zg(this.gl,this.debug,this.program),jg(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?sy(this.gl,this.debug,e,t):uy(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),jg(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),ly(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=zg(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&Zg(this.gl,this.debug,this.program),dy(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),jg(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),jg(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Gg(this.gl,this.debug,2===om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return tm(this,void 0,void 0,function(){var t=this;return nm(this,function(n){switch(n.label){case 0:return[4,_m(function(){return t.disposed||t.isQueryAvailable(e,om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||_m(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),cy(this.gl,this.debug,e,this.framebuffer),this.debug&&dy(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(cy(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&dy(this.gl)):fy(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;cy(r,this.debug,e,this.framebuffer),this.debug&&dy(r),this.outputTexture=e,jg(r,this.debug,function(){return r.viewport(0,0,t,n)}),jg(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),jg(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function gE(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!Em(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!Em(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var yE=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,f=n.dataFormat,d=s.left,h=s.top,p=o*r,v=qw(),m="channelsLast"===f,g=m?0:1,y=m?1:2,x="",b=0;b<=1;b++)for(var w=0;w<=1;w++)x+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+h+";\n            d0 = offsetY + "+c+" * (pos / "+p+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+d+".);\n              d1 = offsetX + "+l+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+x+"\n\n        "+v.output+" = result;\n      }\n    "},xE=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},bE=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},wE=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},CE=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},EE=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,f=u-1-e.padInfo.top,d=l-1-e.padInfo.left,h=s*u*l-1;this.userCode="\n      const ivec3 pads = ivec3("+c+", "+f+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+l+" +\n                  wR * "+l+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},kE=function(e,t,n,r,o,a,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";a&&(h=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+l+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+d[0]+");\n          result += ("+f[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},SE=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),RE=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},IE=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Gw("rc",t),r=aC(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},_E=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=aC(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},NE=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=aC(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=Gw("rc",r),u=Gw("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,v=1===r?2:4;p<v;p++)h+="\n        "+f[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},TE=function(e,t,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var p="avg"===t,v="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",m="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="0.0";if(p||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+s+");\n        const ivec2 pads = ivec2("+d+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+l+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?o?v:m:"wR * "+f+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var x=4*Math.floor(a/4),b=a%4,w="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+d+", "+h+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+u+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+x+"; wC += 4) {\n            int xC = xCCorner + wC * "+l+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              getValue(batch, xR, xC + 3 * "+l+", d)\n            );\n\n            "+w+"\n          }\n\n          int xC = xCCorner + "+x+";\n          if ("+(1===b)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(2===b)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(3===b)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              initializationValue\n            );\n\n            "+w+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},AE=function(e,t,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,i=e.strideDepth,s=e.strideHeight,u=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,v=e.padInfo.front,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;var y="avg"===t,x="0.0";if(y||(x="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+s+", "+u+");\n        const ivec3 pads = ivec3("+v+", "+m+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+l+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+c+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+f+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?o?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+h+" * "+p+" +\n                      wR * "+p+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / count");var w=4*Math.floor(a/4),C=a%4,E="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+s+", "+u+");\n      const ivec3 pads = ivec3("+v+", "+m+", "+g+");\n      const float initializationValue = "+x+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+x+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+l+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+f+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+f+", ch)\n              );\n\n              "+E+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+E+"\n            } else if ("+(2===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+E+"\n            } else if ("+(3===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                initializationValue\n              );\n\n              "+E+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},DE=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},OE=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Kw(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Xw(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},FE=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],h=1/f,p=1/d,v=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},PE=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},ME=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},BE=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],d=l[1]/c[1],h=1/f,p=1/d,v=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},LE=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},WE=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=aC(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},zE=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Gw("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=aC(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},UE=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=aC(o.length),u=aC(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices("+l+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var d="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},jE=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},VE=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=aC(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},HE=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=aC(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return GE.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+GE[t]+" = start["+t+"] + coords."+GE[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),GE=["x","y","z","w","u","v"],qE=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=aC(this.rank),n=Gw("coords",this.rank),r=Gw("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),KE=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=aC(n.length),a=aC(n.length),i="";if(1===r)i="coords * strides + begin";else{var s=0;i=n.map(function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},XE=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=$E(t,n),a=YE(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Og.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Og.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Og.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Og.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Og.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=YE(t,$E(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function $E(e,t){if(e===Dg.UPLOAD)return Og.PACKED_2X2_FLOAT32;if(e===Dg.RENDER||null==e)return function(e){return om().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Og.PACKED_2X2_FLOAT32:Og.UNPACKED_FLOAT32:e?Og.PACKED_2X2_FLOAT16:Og.UNPACKED_FLOAT16}(t);if(e===Dg.DOWNLOAD||e===Dg.PIXELS)return Og.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function YE(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var QE=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=aC(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},JE=1.7580993408473768,ZE=1.0507009873554805,ek=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},tk="if (isnan(x)) return x;",nk="return abs(x);",rk=tk+"\n  return (x < 0.0) ? 0.0 : x;\n",ok=tk+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",ak="return (x >= 0.0) ? x : (exp(x) - 1.0);",ik="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+JE+";\n  float scale = "+ZE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",sk="return -x;",uk="return ceil(x);",lk="return floor(x);",ck="return exp(x);",fk="return exp(x) - 1.0;",dk=tk+"\n  return sin(x);\n",hk=tk+"\n  return cos(x);\n",pk=tk+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",vk=tk+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",mk=tk+"\n  return atan(x);\n",gk=tk+"return log(x + sqrt(x * x + 1.0));",yk=tk+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",xk=tk+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",bk="return x;",wk="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ck="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ek="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",kk=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Sk=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=Gw("rc",t),r=aC(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},Rk={};function Ik(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?wk:rk;if("elu"===e)return t?Ek:ak;if("relu6"===e)return t?Ck:ok;if("prelu"===e)return t?xC:gC;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var _k=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!om().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=Bg(om().getNumber("WEBGL_VERSION"));r.binaryCache=((n=om().getNumber("WEBGL_VERSION"))in Rk||(Rk[n]={}),Rk[n]),r.gpgpu=new mE(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new XE(r.gpgpu),r.numMBBeforeWarning=null==om().global.screen?1024:om().global.screen.height*om().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new sw(r,_g),r}return em(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(om().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Dg.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(om().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Dg.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new kk(i,bk):new ek(i,bk);var l=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:r}],r),c=this.readSync(l.dataId);return this.disposeData(l.dataId),c}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,d,h=null!=this.activeTimers;return h&&(f=Qm()),d="complex64"===r?Sw(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=Qm()-f),this.convertAndCacheOnCPU(e,d)},t.prototype.read=function(e){return tm(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f,d,h,p,v,m,g,y,x,b,w,C;return nm(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(n=this.texData.get(e),r=n.values,o=n.shape,a=n.slice,i=n.dtype,s=n.complexTensors,u=n.isPacked,null!=a)return void 0,l=u?new kk(o,bk):new ek(o,bk),c=this.runWebGLProgram(l,[{dataId:e,shape:o,dtype:i}],i),f=this.read(c.dataId),this.disposeData(c.dataId),[2,f];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!om().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===om().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==i&&om().get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(e),p=this.texData.get(h.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,[p.texture].concat(Wg(o)))),this.pendingRead.set(e,[]),"complex64"===i?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return"complex64"!==i?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return m=E.sent(),g=m[0],y=m[1],v=Sw(g,y),[3,5];case 4:null==d?v=this.getValuesFromTexture(e):(x=Cm(o),v=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),E.label=5;case 5:return null!=h&&this.disposeData(h.dataId),b=this.convertAndCacheOnCPU(e,v),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach(function(e){return e(b)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,b]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Vg(n)){if(om().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.isPacked,i=Cm(r);if(om().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Wg(r))).subarray(0,i);return this.disposeData(s.dataId),l}var c=om().getBool("WEBGL_PACK")&&!0===a,f=c?yy(r):r,d=c?new GC(f):new HC(f),h=this.runWebGLProgram(d,[{shape:f,dtype:o,dataId:e}],"float32"),p=this.texData.get(h.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeData(h.dataId),v},t.prototype.time=function(e){return tm(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return nm(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=wm(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),a=wm(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return s=u.sent(),i.kernelMs=gm(s),i.getExtraProfileInfo=function(){return s.map(function(e,t){return{name:a[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:i.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Qm(),endMs:null}},t.prototype.endTimer=function(e){return om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Qm(),e)},t.prototype.getQueryTime=function(e){return tm(this,void 0,void 0,function(){var t;return nm(this,function(n){return om().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.isPacked,s=t.slice,u=s&&s.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return om().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=_g.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&Cm(e.shape)<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:_g.keep(e.clone()),imag:_g.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===Cm(n))return tx([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,o=tw(e.shape,t,n);if(r||!o){var a=om().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qE(n):new HE(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=this.makeOutput(n,e.dtype),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=nw(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var o=Jb(t,n,r);if(o.some(function(e){return 0===e}))return tx([],o);var a=new KE(t,r,o);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=om().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zE(e.shape,t):new WE(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map(function(e){return Zy(e)}),r=e.map(function(e){return ex(e)});return Jy(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>om().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),a=this.concat(e.slice(0,o),t),i=this.concat(e.slice(o),t);return this.concat([a,i],t)}if(om().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new SC(e.map(function(e){return e.shape}),t);return this.compileAndRun(s,e)}var u=Yy(e.map(function(e){return e.shape}),t),l=e.map(function(e){return e.as2D(-1,Cm(e.shape.slice(t)))}),c=new kC(l.map(function(e){return e.shape}));return this.compileAndRun(c,l).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sk,e.dtype);var t=new ek(e.shape,sk);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=iw(e,[0,2,1])),r&&(t=iw(t,[0,2,1]));var u=1===a?e:e.as3D(s,i,1),l=1===a?2:1,c=1===a?t.as3D(s,1,i):t;return this.multiply(u,c).sum(l,!0)}var f=bg(e.dtype,t.dtype),d=new kE(e.shape,[s,o,a],n,r);return this.compileAndRun(d,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],l=o?n.shape[1]:n.shape[2],c=t.shape[0],f=bg(t.dtype,n.dtype),d=null!=a,h=null!=s,p=i?Ik(i,!0):null,v=new kE(t.shape,[c,u,l],r,o,d,p,h),m=[t,n];return a&&m.push(a),s&&m.push(s),this.compileAndRun(v,m,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new hC("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new hC("return areal * bimag + aimag * breal;",e.shape,t.shape),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,mC,e.dtype);var c=new yC(mC,e.shape,t.shape);return this.compileAndRun(c,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),om().getBool("WEBGL_PACK_NORMALIZATION")){var l=new dC(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)}var c=new fC(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=om().getBool("WEBGL_PACK_NORMALIZATION")?new wE(e.shape,t,n,r,o):new xE(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new bE(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map(function(e){return eg(e)});return Lw(bx(e.shape,e.dtype,n),t)}var r=new QE(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=om().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new NE(e.shape,t,n):new _E(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new YC(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){ym(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=Ax(e.shape,t,r),a=Dx(o.length,t.length),i=Ox(e.shape,t,r),s=Fx(n,t.length),u=Px(i,n,t.length);return iw(e.reshape(o),a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){ym(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Ax(i.shape,t,r,!1),u=Dx(s.length,t.length,!1),l=Ox(i.shape,t,r,!1);return iw(i.reshape(s),u).reshape(l)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=qb(o),i=new DE({windowSize:a,inSize:o,batchSize:r},t),s=this.compileAndRun(i,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=qb(o),i=new Vw({windowSize:a,inSize:o,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=qb(r[r.length-1]),a=new uC(r,o,t,null==n),i=null==n?[e]:[e,n],s=this.compileAndRun(a,i,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){Gy("sum",t,e.rank);var n=Vy(e.shape,t),r=n[0],o=Cm(n[1]),a=e.as2D(-1,o),i=wg(e.dtype);return this.reduce(a,"sum",i).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=Vy(e.shape,t),r=n[0],o=Cm(n[1]),a=e.as2D(-1,o),i=wg(e.dtype);return this.reduce(a,"prod",i).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=qy([r],e.rank),a=e;null!=o&&(a=iw(e,o),r=Xy(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=Cm([a.shape[r]]),u=a.as2D(-1,s),l=wg(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(i);return null!=o&&(c=iw(c,Ky(o))),c},t.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Gm(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Gm(e,n+1);return n}(i,o),u=new jE({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),l=this.compileAndRun(u,[e,n],r);return l.shape[1]===o?l:(n=fx(0,o).tile([i/s]),this.segOpCompute(l,t,n,r,o))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Gy("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!om().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Vy(e.shape,r),a=o[0],i=Cm(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new LC(e.shape,n,r);return this.compileAndRun(o,[e])},t.prototype.equal=function(e,t){if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new yC("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new yC("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new yC("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new yC("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new yC("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new yC("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new ek(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new yC("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new yC("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new VE(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],bg(t.dtype,n.dtype))},t.prototype.where=function(e){My("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return zw(e.shape,t)},t.prototype.topk=function(e,t,n){return Ww(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Gy("min",t,e.rank);var n=Vy(e.shape,t),r=n[0],o=Cm(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yC("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yC("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Gy("max",t,e.rank);var n=Vy(e.shape,t),r=n[0],o=Cm(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yC("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){Gy("all",t,e.rank);var n=Vy(e.shape,t),r=n[0],o=Cm(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){Gy("any",t,e.rank);var n=Vy(e.shape,t),r=n[0],o=Cm(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.floorDiv=function(e,t){if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new yC("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,pC);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=bg(e.dtype,t.dtype);if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,pC,n);var r=new yC(pC,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new kk(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,o){void 0===o&&(o=!1);var a=new bC(n,e.shape,t.shape,o);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,i),l=new yC(n,e.shape,t.shape);return r.compileAndRun(l,[s,u],bg(a.dtype,i.dtype))}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>om().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var o=e.map(function(e){return e.dtype}).reduce(function(e,t){return bg(e,t)}),a=e.map(function(e){return e.shape}),i=om().getBool("WEBGL_PACK")?new jw(e[0].shape,a):new Uw(e[0].shape,a);return this.compileAndRun(i,e,o)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,vC);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=bg(e.dtype,t.dtype);if(om().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,vC,e.dtype);var r=new yC(vC,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yC("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=bg(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,uk,e.dtype);var t=new ek(e.shape,uk);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,lk,e.dtype);var t=new ek(e.shape,lk);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new ek(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new ek(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new ek(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new ek(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new ek(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ck,e.dtype);var t=new ek(e.shape,ck);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,fk,e.dtype);var t=new ek(e.shape,fk);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=Tm([t],e.shape),r=this.max(e,n),o=Hy(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return Hb(i,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new ek(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new ek(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new ek(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new ek(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new ek(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=om().getBool("WEBGL_PACK")?new kk(e.shape,wk):new ek(e.shape,rk),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=om().getBool("WEBGL_PACK")?new kk(e.shape,Ck):new ek(e.shape,ok),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC(xC,e.shape,t.shape):new yC(gC,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ek,e.dtype);var t=new ek(e.shape,ak);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new yC("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new ek(e.shape,ik);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new ek(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,o=(r=om().getBool("WEBGL_PACK_CLIP")?new CC(e.shape):new wC(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(om().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,nk,e.dtype);var t=new ek(e.shape,nk);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new EC(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new ek(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new ek(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new ek(e.shape,dk);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new ek(e.shape,hk);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new ek(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new ek(e.shape,pk);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new ek(e.shape,vk);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new ek(e.shape,mk);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new yC("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new ek(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new ek(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new ek(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new ek(e.shape,gk);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new ek(e.shape,yk);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new ek(e.shape,xk);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new ek(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new ek(e.shape,function(e){return void 0===e&&(e=0),tk+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,o,a){var i=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,l=i[0]*i[1]*i[2],c=n.outChannels,f="channelsLast"===n.dataFormat,d=(1===l||1===c)&&u>1e3,h=i[2]%2!=0&&!!s.isPacked;if(d||!om().getBool("WEBGL_LAZILY_UNPACK")||!om().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!h){var p=f?i[0]*i[1]*i[2]:i[0]*i[2]*i[3],v=this.reshape(e,[1,p,n.inChannels]),m=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:m,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),n.outShape)}var g=f?i[0]*i[1]*(i[2]+1):i[0]*i[2]*(i[3]+1),y={dataId:e.dataId,shape:[1,g,n.inChannels],dtype:e.dtype},x=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,ym(wy(s.shape,y.shape),function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"});var b=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:y,b:b,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),C=this.texData.get(w.dataId);return ym(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=x,C.shape=n.outShape,_g.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,o,a){var i=n.filterWidth,s=n.filterHeight,u=n.inChannels,l=n.outWidth,c=n.outHeight,f="channelsLast"===n.dataFormat,d=i*s*u,h=c*l,p=[d,h],v=e.squeeze([0]),m=t.reshape([1,d,-1]),g=new yE(p,v.shape,n),y=this.compileAndRun(g,[v]).reshape([1,p[0],p[1]]),x=null!=r,b=null!=a,w=o?Ik(o,!0):null,C=new kE(y.shape,[1,h,n.outChannels],!0,!1,x,w,b),E=[y,m];r&&E.push(r),b&&E.push(a);var k=this.compileAndRun(C,E);return f?k.reshape([1,c,l,n.outChannels]):k.reshape([1,n.outChannels,c,l])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,o,a,i);if(om().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,o,a,i);var s=null!=o,u=null!=i,l=a?Ik(a,!1):null,c=new OC(r,s,l,u),f=[t,n];return o&&f.push(o),i&&f.push(i),this.compileAndRun(c,f)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(om().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new OC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new _C(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new IC(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,o=e.convInfo,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=om().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=i?Ik(i,u):null,c=[n,r],f=null!=a,d=null!=s;return f&&c.push(a),d&&c.push(s),u?(t=new MC(o,f,l,d),this.compileAndRun(t,c)):(t=new PC(o,f,l,d),this.compileAndRun(t,c))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return om().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new MC(n),this.compileAndRun(r,[e,t])):(r=new PC(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new DC(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new AC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new FC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new TC(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new NC(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new TE(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new TE(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var o=new TE(r,"max",!0),a=this.compileAndRun(o,[t]),i=new CE(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new lC(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return Cw(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new AE(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new cC(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new AE(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var o=new AE(r,"max",!0),a=this.compileAndRun(o,[t]),i=new EE(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!wy(e.shape,t)&&(null===n.texture||!wy(n.shape,t))){var r=this.packedReshape(e,t);return _g.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Ew(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var o=om().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ME(e.shape,t,n,r):new PE(e.shape,t,n,r);return this.compileAndRun(o,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new FE(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new LE(e.shape,t,n,r);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new BE(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var o=t?e:ow(e),a=o.shape[0],i=o.shape[1],s=new SE(a,i,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var o=new RE(e.size,t,n,r);return this.compileAndRun(o,[e])},t.prototype.diag=function(e){var t=new VC(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return My("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Aw(e.dataSync(),t.dataSync(),n,r,o)},t.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new BC(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){ym(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,l=i/(t*t),c=new jC("NHWC"===n?[r,s,u,l]:[r,l,s,u],t,n);return this.compileAndRun(c,[e])},t.prototype.split=function(e,t,n){return Bw(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=$b(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/i,i],c=e.reshape([a,o]),f=t.reshape([a,i]);if(0===u)return Ew(tx([]),n);var d=rx(0),h=new UE(a,o,c.rank,f.rank,s,l);return this.compileAndRun(h,[f,c,d]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var o=$b(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new UE(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new XC("return real * expR - imag * expI;",e.shape,t),o=new XC("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=Gb(e,t),a=o[0],i=o[1],s=o[2],u=o[3],l=t.reshape([i,r]),c=e.reshape([e.size/s,s]),f=new QC(r,u,[i,s]);return this.compileAndRun(f,[c,l]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Vm(t))){var r=Om(n,Cm(e));return r.fill(t),_g.makeTensor(r,e,n,this)}var o=new $C(e,t),a=o.getCustomSetupFunc(t);return this.compileAndRun(o,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return kw(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return _g.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new Sk(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new IE(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[my(e.shape)].concat(gy(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[my(t)].concat(gy(t)),a=new OE(o,n),i=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,o=n.shape,a=n.dtype,i=yy(o);return t=r?new UC(i):new zC(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(t,[{shape:i,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,o){var a=this;void 0===o&&(o=!1);var i=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(i.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Ag.DENSE){var u=Wg(e.outputShape);s.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===Cm(i.shape))return s.values=Dm(i.dtype,0),i;var l=[],c=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Cm(t.shape)<=om().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!wy(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),l.push(t),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(i.dataId);var f,d={shape:i.shape,texData:s,isUniform:!1},h=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,c,d),p=this.getAndSaveBinary(h,function(){return function(e,t,n,r){var o=t.userCode,a=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Yw(a,s,o,t.packedInputs),l=e.createProgram(u),c=null,f=e.getUniformLocation(l,"NAN",!1);1===om().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var d={},h=0;h<t.variableNames.length;h++){var p=t.variableNames[h];d[p]=e.getUniformLocation(l,p,!1),d["offset"+p]=e.getUniformLocation(l,"offset"+p,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:d,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:f}}(a.gpgpu,e,c,d)}),v=null!=this.activeTimers;if(v&&(f=this.startTimer()),function(e,t,n,r,o){gE(t.inShapeInfos,n),gE([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===om().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(Cm(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,c,d,r),l.forEach(function(e){return a.disposeData(e.dataId)}),v&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!om().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var m=this.unpackTensor(i);return this.disposeData(i.dataId),m}return i},t.prototype.compileAndRun=function(e,t,n,r,o){void 0===o&&(o=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,o);return _g.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(om().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Fy(function(){if(!om().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=om().getBool("DEBUG");om().set("DEBUG",!1);var n=e.abs(rx(1e-8)).dataSync()[0];if(om().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=Qm());var f=n.texShape;if(null==f&&(f=xy(r,u),n.texShape=f),null!=a){var d=yy(r),h=void 0,p=f[1],v=f[0],m=a instanceof Uint8Array;u?(p=(t=zg(f[0],f[1]))[0],v=t[1],h=new KC(d,[v,p],m)):h=new qC(d,[v,p],m);var g=this.makeTensorInfo([v,p],o);this.texData.get(g.dataId).usage=m?Dg.PIXELS:Dg.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,v,a);var y=this.runWebGLProgram(h,[g],o,null,!0),x=this.texData.get(y.dataId);n.texture=x.texture,n.texShape=x.texShape,n.isPacked=x.isPacked,n.usage=x.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,c&&(this.uploadWaitMs+=Qm()-l)}else{var b=this.acquireTexture(f,s,o,u);n.texture=b}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*Lm(t)},t}(uw);function Nk(e,t){return e(t={exports:{}},t.exports),t.exports}Ng()&&_g.registerBackend("webgl",function(){return new _k},2),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var Tk=Nk(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var o=new n(e),a=t&&t.state,i=o.next;return i.int32=function(){return 4294967296*o.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.alea=o}(0,e)}),Ak=Nk(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor128=o}(0,e)}),Dk=Nk(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)}),Ok=Nk(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.x&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)}),Fk=Nk(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.X&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)}),Pk=Nk(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.tychei=o}(0,e)}),Mk=Nk(function(e){!function(t,r){var o,a=this,i=256,s="random",u=r.pow(i,6),l=r.pow(2,52),c=2*l,f=255;function d(e,n,f){var d=[],g=v(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,m(t)]}}():e,3),d),y=new h(d),x=function(){for(var e=y.g(6),t=u,n=0;e<l;)e=(e+n)*i,t*=i,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,v(m(y.S),t),(n.pass||f||function(e,t,n,o){return o&&(o.S&&p(o,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(x,g,"global"in n?n.global:this==r,n.state)}function h(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=f&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=f&o+1],n=n*i+s[f&(s[o]=s[a=f&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){for(var n,r=e+"",o=0;o<r.length;)t[f&o]=f&(n^=19*t[f&o])+r.charCodeAt(o++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=d,v(r.random(),t),e.exports){e.exports=d;try{o=n(367)}catch(e){}}}([],Math)});Mk.alea=Tk,Mk.xor128=Ak,Mk.xorwow=Dk,Mk.xorshift7=Ok,Mk.xor4096=Fk,Mk.tychei=Pk;var Bk=Mk.alea,Lk=Qy({addN_:function(e){ym(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),ym(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return Wy(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Em(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return _g.runKernelFunc(function(e,n){return e.addN(t)},r,null,"AddN")}});function Wk(){Oy("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function zk(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Uk(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u=Wy(e,"x","batchNorm"),l=Wy(t,"mean","batchNorm"),c=Wy(n,"variance","batchNorm");null!=o&&(i=Wy(o,"scale","batchNorm")),null!=r&&(s=Wy(r,"offset","batchNorm")),ym(l.rank===c.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),ym(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),ym(null==i||l.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f={x:u,scale:i,offset:s,mean:l,variance:c},d={varianceEpsilon:a};return _g.runKernelFunc(function(e,t){var n=zk(u),r=e.batchNormalization(n,jk(l),jk(c),a,jk(i),jk(s));return t([u,l,c,i]),r},f,null,"FusedBatchNorm",d).reshape(u.shape)}function jk(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var Vk=Qy({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Wk(),Uk(e,t,n,a,o,r)}}),Hk=Qy({batchNorm_:Uk});function Gk(e,t,n,r,o,a){var i,s,u=Wy(e,"x","batchNorm"),l=Wy(t,"mean","batchNorm"),c=Wy(n,"variance","batchNorm");return null!=o&&(i=Wy(o,"scale","batchNorm")),null!=r&&(s=Wy(r,"offset","batchNorm")),ym(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ym(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),ym(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&ym(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&ym(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Hk(u,l,c,s,i,a)}var qk=Qy({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Wk(),Gk(e,t,n,a,o,r)}}),Kk=Qy({batchNorm2d_:Gk});function Xk(e,t,n,r,o,a){var i,s,u=Wy(e,"x","batchNorm"),l=Wy(t,"mean","batchNorm"),c=Wy(n,"variance","batchNorm");return null!=o&&(i=Wy(o,"scale","batchNorm")),null!=r&&(s=Wy(r,"offset","batchNorm")),ym(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ym(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),ym(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&ym(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&ym(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Hk(u,l,c,s,i,a)}var $k=Qy({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Wk(),Xk(e,t,n,a,o,r)}}),Yk=Qy({batchNorm3d_:Xk});function Qk(e,t,n,r,o,a){var i,s,u=Wy(e,"x","batchNorm"),l=Wy(t,"mean","batchNorm"),c=Wy(n,"variance","batchNorm");return null!=o&&(i=Wy(o,"scale","batchNorm")),null!=r&&(s=Wy(r,"offset","batchNorm")),ym(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),ym(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),ym(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&ym(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&ym(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Hk(u,l,c,s,i,a)}var Jk=Qy({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),Wk(),Qk(e,t,n,a,o,r)}}),Zk=Qy({batchNorm4d_:Qk}),eS=Qy({broadcastTo_:function(e,t){var n=Wy(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var a=n.shape,i=Array.from(t),s=t.length-1;s>=0;s--)if(a[s]===t[s])i[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var u=i.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0});if(0===u.length)return n.clone();var l={x:n},c={shape:t,inputShape:a};return _g.runKernelFunc(function(e){return e.tile(n,i)},l,function(e){return{x:function(){return e.sum(u,!0)}}},Lx,c)}}),tS=Qy({clone_:function(e){var t=Wy(e,"x","clone",null);return _g.runKernelFunc(function(){return _g.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{x:t},null,zx)}}),nS=Qy({logicalAnd_:function(e,t){var n=Wy(e,"a","logicalAnd","bool"),r=Wy(t,"b","logicalAnd","bool");return qx(n.shape,r.shape),_g.runKernelFunc(function(e){return e.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),rS=Qy({logicalNot_:function(e){var t=Wy(e,"x","logicalNot","bool");return _g.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),oS=Qy({logicalOr_:function(e,t){var n=Wy(e,"a","logicalOr","bool"),r=Wy(t,"b","logicalOr","bool");return qx(n.shape,r.shape),_g.runKernelFunc(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),aS=Qy({logicalXor_:function(e,t){var n=Wy(e,"a","logicalXor","bool"),r=Wy(t,"b","logicalXor","bool");return qx(n.shape,r.shape),oS(e,t).logicalAnd(nS(e,t).logicalNot())}}),iS=Qy({where_:function(e,t,n){var r=Wy(t,"a","where"),o=Wy(n,"b","where"),a=Wy(e,"condition","where","bool");return xm(r.shape,o.shape,"Error in where: "),1===a.rank?ym(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):xm(a.shape,o.shape,"Error in where: "),_g.runKernelFunc(function(e,t){var n=e.select(a,r,o);return t([a]),n},{$condition:a,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return hx(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),sS=function(e){return tm(this,void 0,void 0,function(){var t,n,r;return nm(this,function(o){switch(o.label){case 0:return[4,(t=Wy(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=zw(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},uS=Qy({divNoNan_:function(e,t){var n,r=Wy(e,"a","div"),o=Wy(t,"b","div");r=(n=Cg(r,o))[0],o=n[1];var a=Hb(r,o),i=hx(a),s=o.equal(i);return iS(s,i,a)}}),lS=Qy({tile_:function(e,t){var n=Wy(e,"x","tile",null);ym(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={x:n},a={reps:t};return _g.runKernelFunc(function(e,r){var o=e.tile(n,t);return r([n]),o},o,null,Ux,a,r)}}),cS=Qy({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=bx([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return lS(Sx(s,0),[n[0],1,1]);if(2===n.length)return lS(Sx(Sx(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return lS(Sx(Sx(Sx(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),fS=Qy({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=Wy(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=_g.runKernelFunc(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===i?u.as1D():u}}),dS=Qy({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=Wy(e,"indices","oneHot","int32"),a=o.shape.concat([t]),i={indices:o=o.flatten()},s={depth:t,onValue:n,offValue:r};return _g.runKernelFunc(function(e,a){return a([o]),e.oneHot(o,t,n,r)},i,null,Wx,s).reshape(a)}}),hS=Qy({pad_:function(e,t,n){void 0===n&&(n=0);var r=Wy(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n},a={x:r};return _g.runKernelFunc(function(e,o){return o([r]),e.pad(r,t,n)},a,null,jx,o)}}),pS=Qy({pad1d_:function(e,t,n){return void 0===n&&(n=0),ym(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),hS(e,[t],n)}}),vS=Qy({pad2d_:function(e,t,n){return void 0===n&&(n=0),ym(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),hS(e,t,n)}}),mS=Qy({pad3d_:function(e,t,n){return void 0===n&&(n=0),ym(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),hS(e,t,n)}}),gS=Qy({pad4d_:function(e,t,n){return void 0===n&&(n=0),ym(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),hS(e,t,n)}}),yS=Qy({rand_:function(e,t,n){var r=Cm(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return _g.makeTensor(o,e,n)}});function xS(){return 32===_g.backend.floatPrecision()?.001:.1}function bS(e,t,n){var r=!0;if((Bm(e)||Bm(t))&&(r=!1),Bm(e)&&Bm(t)&&(r=!0),r){var o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var i=By(e),s=By(t);if(!Em(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=Bm(e)?e:wm(e),l=Bm(t)?t:wm(t);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var f=u[c],d=l[c];if(!n(f,d))throw new Error("Arrays differ: actual["+c+"] = "+f+", expected["+c+"] = "+d+".\nActual:   "+u+".\nExpected: "+l+".")}}function wS(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=xS()),bS(e,t,function(e,t){return wS(e,t,n)})},testEpsilon:xS,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return zm(e)||zm(e[0])||zm(t)||zm(t[0])?bS(e,n,function(e,t){return e==t}):bS(e,t,function(e,t){return wS(e,t,0)})},expectNumbersClose:function(e,t,n){if(null==n&&(n=xS()),!wS(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}});var CS=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Bk(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),ES=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var o=r||Math.random();this.randu=Bk(o.toString()),this.randn=new CS(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,o,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),kS=function(){function e(e,t,n,r){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Bk(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}(),SS=Qy({randomGamma_:function(e,t,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new ES(t,n,r,o),i=bx(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),RS=Qy({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new CS(t,n,r,!1,o),i=bx(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),IS=Qy({randomUniform_:function(e,t,n,r,o){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=bx(e,r),i=new kS(t,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),_S=Qy({square_:function(e){var t=Wy(e,"x","square"),n=[t];return _g.runKernelFunc(function(e,n){return n([t]),e.square(t)},{x:t},null,"Square",{},n,[])}}),NS=Qy({squaredDifference_:function(e,t){var n,r=Wy(e,"a","squaredDifference"),o=Wy(t,"b","squaredDifference");n=Cg(r,o),r=n[0],o=n[1],qx(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return _g.runKernelFunc(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},a,function(e,t){var n=t[0],r=t[1],o=rx(2);return{a:function(){return e.mul(n.sub(r).mul(o))},b:function(){return e.mul(r.sub(n).mul(o))}}},Bx,{},i,[])}}),TS=Qy({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var a=new CS(t,n,r,!0,o),i=bx(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),AS=Qy({equal_:function(e,t){var n,r=Wy(e,"a","equal"),o=Wy(t,"b","equal");return n=Cg(r,o),r=n[0],o=n[1],qx(r.shape,o.shape),_g.runKernelFunc(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),DS=Qy({equalStrict_:function(e,t){var n=Wy(e,"a","equalStrict"),r=Wy(t,"b","equalStrict");return xm(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),OS=Qy({greater_:function(e,t){var n,r=Wy(e,"a","greater"),o=Wy(t,"b","greater");return n=Cg(r,o),r=n[0],o=n[1],qx(r.shape,o.shape),_g.runKernelFunc(function(e){return e.greater(r,o)},{a:r,b:o},null,"Greater")}}),FS=Qy({greaterEqual_:function(e,t){var n,r=Wy(e,"a","greaterEqual"),o=Wy(t,"b","greaterEqual");return n=Cg(r,o),r=n[0],o=n[1],qx(r.shape,o.shape),_g.runKernelFunc(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return hx(n)},b:function(){return hx(r)}}},"GreaterEqual")}}),PS=Qy({greaterEqualStrict_:function(e,t){var n=Wy(e,"a","greaterEqualStrict"),r=Wy(t,"b","greaterEqualStrict");return xm(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),MS=Qy({greaterStrict_:function(e,t){var n=Wy(e,"a","greaterStrict"),r=Wy(t,"b","greaterStrict");return xm(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),BS=Qy({less_:function(e,t){var n,r=Wy(e,"a","less"),o=Wy(t,"b","less");return n=Cg(r,o),r=n[0],o=n[1],qx(r.shape,o.shape),_g.runKernelFunc(function(e){return e.less(r,o)},{a:r,b:o},null,"Less")}}),LS=Qy({lessEqual_:function(e,t){var n,r=Wy(e,"a","lessEqual"),o=Wy(t,"b","lessEqual");return n=Cg(r,o),r=n[0],o=n[1],qx(r.shape,o.shape),_g.runKernelFunc(function(e,t){var n=e.lessEqual(r,o);return t([r,o]),n},{a:r,b:o},null,"LessEqual")}}),WS=Qy({lessEqualStrict_:function(e,t){var n=Wy(e,"a","lessEqualStrict"),r=Wy(t,"b","lessEqualStrict");return xm(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),zS=Qy({lessStrict_:function(e,t){var n=Wy(e,"a","lessStrict"),r=Wy(t,"b","lessStrict");return xm(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),US=Qy({notEqual_:function(e,t){var n,r=Wy(e,"a","notEqual"),o=Wy(t,"b","notEqual");return n=Cg(r,o),r=n[0],o=n[1],qx(r.shape,o.shape),_g.runKernelFunc(function(e){return e.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),jS=Qy({notEqualStrict_:function(e,t){var n=Wy(e,"a","notEqualStrict"),r=Wy(t,"b","notEqualStrict");return xm(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function VS(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function HS(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var GS=Qy({gather_:function(e,t,n){void 0===n&&(n=0);var r=Wy(e,"x","gather"),o=Wy(t,"indices","gather","int32");n=Tm(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return _g.runKernelFunc(function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a},{x:r,indices:o},function(e,t){var o=t[0];return{x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),l=u.length,c=VS(0,s),f=VS(s+1,s+1+l),d=HS([i,[a],u]),h=e.reshape(d),p=o.reshape([a]),v=HS([[s],c,f]),m=h.transpose(v),g=qS(m,p,r.shape[n]),y=Ky(v);return g.transpose(y)},indices:function(){return o}}},"Gather",{axis:n}).reshape(a.outputShape)}}),qS=Qy({unsortedSegmentSum_:function(e,t,n){var r=Wy(e,"x","unsortedSegmentSum"),o=Wy(t,"segmentIds","unsortedSegmentSum","int32");return ym(km(n),function(){return"numSegments must be of dtype int"}),_g.runKernelFunc(function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Ab(t,hx(t)),r=GS(e,n),o=FS(t,rx(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=Sx(o,i+1);o=nS(o,ux(r.shape,"bool"));var s=hx(r);return iS(o,r,s)}(e,n)}}})}});function KS(e,t,n,r,o,a,i){void 0===a&&(a="NHWC"),ym(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;3===t.rank&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),ym(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),ym(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),ym(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];ym(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),ym(f===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."}),null!=i&&ym(km(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var d=ww(a),h=dw(s,n.shape,r,1,o,i,!1,d),p=_g.runKernelFunc(function(e,t){var r=e.conv2dDerInput(u,n,h);return t([n,u]),r},{dy4D:u,filter:n},function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return QS(e,n,r,o,a,1,i)},filter:function(){return ZS(e,s,n.shape,r,o,a,i)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function XS(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function $S(e,t,n,r,o){ym(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];ym(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),ym(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),ym(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),ym(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),ym(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=hw(a,n.shape,r,1,o),f=_g.runKernelFunc(function(e){return e.conv3dDerInput(i,n,c)},{dy5D:i});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var YS=Qy({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=Wy(e,"x","conv1d"),u=Wy(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),ym(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),ym(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&ym(km(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),ym(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),ym(bw(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),ym("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),h=QS(d,f,[1,n],r,"NHWC",[1,a],i);return c?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),QS=Qy({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Wy(e,"x","conv2d"),u=Wy(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ym(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),ym(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&ym(km(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f="NHWC"===o?l.shape[3]:l.shape[1];ym(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."}),ym(bw(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"});var d=ww(o),h=dw(l.shape,u.shape,n,a,r,i,!1,d),p=[u,l],v=_g.runKernelFunc(function(e,t){var n=e.conv2d(l,u,h);return t([u,l]),n},{x:l,filter:u},function(e,t){var i=t,s=i[0],u=i[1];return ym(xw(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return eR(u.shape,e,s,n,r,o)},filter:function(){return ZS(u,e,s.shape,n,r,o)}}},"Conv2D",h,p);return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),JS=Qy({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=Wy(e,"x","conv3d"),s=Wy(t,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),ym(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),ym(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),ym(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),ym(function(e,t){return XS(e)||XS(t)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),ym("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=hw(u.shape,s.shape,n,a,r),f=_g.runKernelFunc(function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n},{x:u,$filter:s},function(e,t){ym(XS(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=t[0],i=t[1];return{x:function(){return $S(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),ym(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),ym(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),ym(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),ym(a.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."}),ym(i.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=hw(a.shape,n,r,1,o);return _g.runKernelFunc(function(e){return e.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),ZS=Qy({conv2dDerFilter_:function(e,t,n,r,o,a,i){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),ym(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),ym(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),ym(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];ym(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),ym(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),null!=i&&ym(km(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=ww(a),d=dw(s.shape,n,r,1,o,i,!1,f);return _g.runKernelFunc(function(e){return e.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),eR=Qy({conv2dDerInput_:KS}),tR=Qy({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Wy(e,"x","depthwiseConv2d"),u=Wy(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ym(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),ym(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),ym(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),ym(bw(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&ym(km(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f=dw(l.shape,u.shape,n,a,r,i,!0),d=[l,u],h=_g.runKernelFunc(function(e,t){var n=e.depthwiseConv2D(l,u,f);return t([l,u]),n},{x:l,filter:u},function(e,t){ym(xw(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var n=t[0],r=t[1];return{x:function(){return nR(n.shape,e,r,f)},filter:function(){return rR(n,e,r.shape,f)}}},"DepthwiseConv2dNative",f,d);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),nR=Qy({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=_g.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),rR=Qy({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),_g.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}}),oR=Qy({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=Wy(e,"x","separableConv2d"),u=Wy(t,"depthwiseFilter","separableConv2d"),l=Wy(n,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(3===s.rank&&(f=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ym(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),ym(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),ym(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),ym(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),ym(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var d=u.shape[2],h=u.shape[3];ym(l.shape[2]===d*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+l.shape[2]+"."});var p=tR(c,u,r,o,i,a),v=QS(p,l,1,"valid",i);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),aR=Qy({conv2dTranspose_:function(e,t,n,r,o,a){return KS(n,Wy(e,"x","conv2dTranspose"),Wy(t,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),iR=Qy({conv3dTranspose_:function(e,t,n,r,o){return $S(n,Wy(e,"x","conv3dTranspose"),Wy(t,"filter","conv3dTranspose"),r,o)}}),sR=Qy({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=Wy(e,"a","matMul"),i=Wy(t,"b","matMul");o=Cg(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],f=a.shape.slice(0,-2),d=i.shape.slice(0,-2),h=Cm(f),p=Cm(d);ym(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),ym(Em(f,d),function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),ym(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=a.shape.slice(0,-2).concat([l,c]),m=n?a.as3D(h,s,l):a.as3D(h,l,s),g=r?i.as3D(p,c,u):i.as3D(p,u,c),y={transposeA:n,transposeB:r};return _g.runKernelFunc(function(e,t){var o=e.batchMatMul(m,g,n,r);return t([m,g]),o},{a:m,b:g},function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{a:function(){return e.matMul(i,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return i.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return i.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(i,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}},"BatchMatMul",y).reshape(v)}}),uR=Qy({dot_:function(e,t){var n=Wy(e,"t1","dot"),r=Wy(t,"t2","dot");ym(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return ym(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),lR=Qy({outerProduct_:function(e,t){var n=Wy(e,"v1","outerProduct"),r=Wy(t,"v2","outerProduct");return ym(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),cR=Qy({reverse_:function(e,t){var n=Wy(e,"x","reverse");if(0===n.rank)return n.clone();var r=Tm(t,n.shape);return _g.runKernelFunc(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),fR=Qy({reverse1d_:function(e){var t=Wy(e,"x","reverse");return ym(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),cR(t,0)}}),dR=Qy({reverse2d_:function(e,t){var n=Wy(e,"x","reverse");return ym(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),cR(n,t)}}),hR=Qy({reverse3d_:function(e,t){var n=Wy(e,"x","reverse");return ym(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),cR(n,t)}}),pR=Qy({reverse4d_:function(e,t){var n=Wy(e,"x","reverse");return ym(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),cR(n,t)}});function vR(e,t,n,r,o,a){var i=Wy(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),ym(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),ym(bw(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=a&&ym(km(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=cw(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&Em(l.inShape,l.outShape))return i.clone();var c=[s],f=_g.runKernelFunc(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=Wy(e,"dy","maxPoolBackprop"),l=Wy(t,"input","maxPoolBackprop"),c=Wy(n,"output","maxPoolBackprop");ym(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),ym(bw(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),ym(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),ym(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var f=cw(l.shape,r,o,a,i,s);return _g.runKernelFunc(function(e){return e.maxPoolBackprop(u,l,c,f)},{$dy:u,$input:l})}(e,i,s,t,n,r,o)}}},"MaxPool",l,c);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function mR(e,t,n,r,o,a){var i=Wy(e,"x","avgPool","float32");null==r&&(r=[1,1]),ym(bw(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ym(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&ym(km(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=cw(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&Em(l.inShape,l.outShape))return i.clone();var c=_g.runKernelFunc(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,a){var i=Wy(e,"dy","avgPoolBackprop"),s=Wy(t,"input","avgPoolBackprop");ym(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),ym(bw(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ym(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),ym(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var f=cw(u.shape,n,r,o,a),d=_g.runKernelFunc(function(e){return e.avgPoolBackprop(l,u,f)},{dy4D:l,input4D:u});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var gR=Qy({maxPool_:function(e,t,n,r,o){return vR(e,t,n,1,r,o)}}),yR=Qy({avgPool_:function(e,t,n,r,o){return mR(e,t,n,1,r,o)}}),xR=Qy({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=Wy(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ym(bw(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=cw(s.shape,t,a,o,r),f=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([c.filterHeight,c.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),a=e.concat(r,o),i=t.map(function(e,t){return(e-a[t]%e)%e}),s=o.map(function(e,t){return e+i[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,i[t]]})]}([c.inHeight,c.inWidth],f,l),p=h[0],v=h[1],m=d?r:"valid",g=d?s:Ix(s,f,p),y=("avg"===n?function(){return mR(g,t,a,1,m)}:function(){return vR(g,t,a,1,m)})(),x=d?y:wx(y,f,v);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),bR=Qy({maxPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=Wy(e,"x","maxPool3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),ym(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),ym("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),ym(bw(n,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&ym(km(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=fw(u.shape,t,n,i,r,o,a),f=_g.runKernelFunc(function(e,t){var n=e.maxPool3d(u,c);return t([u,n]),n},{x:u},function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=Wy(e,"dy","maxPool3dBackprop"),l=Wy(t,"input","maxPool3dBackprop"),c=Wy(n,"output","maxPool3dBackprop"),f=u,d=l,h=c,p=!1;4===l.rank&&(p=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),h=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),ym(5===f.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."}),ym(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),ym(5===h.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."}),null==a&&(a=[1,1,1]),ym(bw(o,a),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),null!=s&&ym(km(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var v=fw(d.shape,r,o,a,i,s),m=_g.runKernelFunc(function(e){return e.maxPool3dBackprop(f,d,h,v)},{dy5D:f,input5D:d});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(e,s,u,t,n,i,r,o)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),wR=Qy({avgPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=Wy(e,"x","avgPool3d","float32"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),ym(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),ym("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),ym(bw(n,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&ym(km(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=fw(u.shape,t,n,i,r,o,a),f=_g.runKernelFunc(function(e){return e.avgPool3d(u,c)},{x:u},function(e){return{x:function(){return function(e,t,n,r,o,a,i){var s=Wy(e,"dy","avgPool3dBackprop"),u=Wy(t,"input","avgPool3dBackprop"),l=s,c=u,f=!1;4===u.rank&&(f=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),ym(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),ym(5===c.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),null==o&&(o=[1,1,1]),ym(bw(r,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=i&&ym(km(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var d=fw(c.shape,n,r,o,a,i),h=_g.runKernelFunc(function(e){return e.avgPool3dBackprop(l,c,d)},{dy5D:l,input5D:c});return f?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,u,t,n,i,r,o)}}});return f=f.cast(u.dtype),l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),CR=Qy({maxPoolWithArgmax_:function(e,t,n,r,o){void 0===o&&(o=!1);var a=Wy(e,"x","maxPoolWithArgmax"),i={filterSize:t,strides:n,pad:r,includeBatchInIndex:o},s=_g.runKernel("MaxPoolWithArgmax",{x:a},i);return{result:s[0],indexes:s[1]}}}),ER=Qy({slice_:function(e,t,n){var r,o,a=Wy(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach(function(e){ym(-1!==e,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(ym(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."}),a.shape[t]-r[t])}),Yb(a,r,o);var i=a.shape,s={begin:r,size:o};return _g.runKernelFunc(function(e){return e.slice(a,r,o)},{x:a},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{x:function(){return hS(e,t)}}},"Slice",s)}}),kR=Qy({slice1d_:function(e,t,n){var r=Wy(e,"x","slice1d");return ym(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),ER(r,[t],[n])}}),SR=Qy({slice2d_:function(e,t,n){var r=Wy(e,"x","slice2d");return ym(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),ER(r,t,n)}}),RR=Qy({slice3d_:function(e,t,n){var r=Wy(e,"x","slice3d");return ym(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),ER(r,t,n)}}),IR=Qy({slice4d_:function(e,t,n){var r=Wy(e,"x","slice4d");return ym(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),ER(r,t,n)}});function _R(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(Hy(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Hy(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var NR=Qy({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","all","bool"),o=Tm(t,r.shape),a=o,i=qy(a,r.rank);null!=i&&(r=r.transpose(i),a=Xy(a.length,r.rank));var s=_g.runKernelFunc(function(e){return e.all(r,a)},{$x:r});if(n){var u=Hy(s.shape,o);return s.reshape(u)}return s}}),TR=Qy({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","any","bool"),o=Tm(t,r.shape),a=o,i=qy(a,r.rank);null!=i&&(r=r.transpose(i),a=Xy(a.length,r.rank));var s=_g.runKernelFunc(function(e){return e.any(r,a)},{$x:r});if(n){var u=Hy(s.shape,o);return s.reshape(u)}return s}}),AR=Qy({argMax_:function(e,t){void 0===t&&(t=0);var n=Wy(e,"x","argMax");null==t&&(t=0);var r=Tm(t,n.shape),o=qy(r,n.rank);null!=o&&(n=n.transpose(o),r=Xy(r.length,n.rank));var a={axis:r[0]},i=[n];return _g.runKernelFunc(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{x:n},function(e,t){var n=t[0];return{x:function(){return hx(n)}}},"ArgMax",a,i)}}),DR=Qy({argMin_:function(e,t){void 0===t&&(t=0);var n=Wy(e,"x","argMin");null==t&&(t=0);var r=Tm(t,n.shape),o=qy(r,n.rank);return null!=o&&(n=n.transpose(o),r=Xy(r.length,n.rank)),_g.runKernelFunc(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return hx(n)}}})}}),OR=Qy({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","logSumExp"),o=Tm(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=Hy(s.shape,o);return s.reshape(u)}return s}}),FR=Qy({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","max"),o=r,a=Tm(t,r.shape),i=a,s=qy(i,r.rank);null!=s&&(r=r.transpose(s),i=Xy(i.length,r.rank));var u=[r],l=_g.runKernelFunc(function(e,t){var n=e.max(r,i);return t([o,n]),n},{x:r},function(e,t){return _R(e,t[1],t[0],a,s)},"Max",{axes:i},u,[!0]);if(n){var c=Hy(l.shape,a);l=l.reshape(c)}return l}}),PR=Qy({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","mean"),o=Tm(t,r.shape),a=Cm(Vy(r.shape,o)[1]);return rw(function(e){var r=rx(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(ux(e.shape,"float32")).div(a)}}})(r)}}),MR=Qy({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","min"),o=r,a=Tm(t,r.shape),i=a,s=qy(i,r.rank);null!=s&&(r=r.transpose(s),i=Xy(i.length,r.rank));var u=[r],l=_g.runKernelFunc(function(e,t){var n=e.min(r,i);return t([o,n]),n},{x:r},function(e,t){return _R(e,t[1],t[0],a,s)},"Min",{axes:i},u,[!0]);if(n){var c=Hy(l.shape,a);l=l.reshape(c)}return l}}),BR=Qy({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Tm(t,(e=Wy(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;n||(a=Hy(o.shape,r));var i=e.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),LR=Qy({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=Tm(t,r.shape);return rw(function(e){var t=qy(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=Xy(r.length,e.rank));var i=function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(ux(e.shape,"float32"))},s={axes:r},u=_g.runKernelFunc(function(e){return e.sum(a,r)},{x:a},function(e){return{x:function(){return i(e)}}},"Sum",s);if(n){var l=Hy(u.shape,o);u=u.reshape(l)}return{value:u,gradFunc:i}})(r)}}),WR=Qy({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wy(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=Tm(t,r.shape),a=qy(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=Xy(i.length,r.rank));var u=_g.runKernelFunc(function(e){return e.prod(s,i)},{permutedX:s});if(n){var l=Hy(u.shape,o);u=u.reshape(l)}return u}}),zR=Qy({elu_:function(e){var t=Wy(e,"x","elu");return _g.runKernelFunc(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return _g.runKernelFunc(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),UR=Qy({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=Wy(e,"x","leakyRelu");return Ab(rx(t).mul(n),n)}}),jR=Qy({prelu_:function(e,t){var n=Wy(e,"x","prelu"),r=Wy(t,"alpha","prelu");return _g.runKernelFunc(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{x:n,alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{x:function(){return iS(o,e,e.mul(r))},alpha:function(){var t=iS(o,hx(e),e.mul(n)),a=Gx(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}},"Prelu")}}),VR=Qy({relu_:function(e){var t=Wy(e,"x","relu");return"bool"===t.dtype?t.toInt():_g.runKernelFunc(function(e,n){var r=e.relu(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}}),HR=Qy({relu6_:function(e){var t=Wy(e,"x","relu6");return"bool"===t.dtype?t.toInt():_g.runKernelFunc(function(e,n){var r=e.relu6(t);return n([t]),r},{x:t},function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}},"Relu6")}}),GR=Qy({selu_:function(e){var t=Wy(e,"x","selu");return _g.runKernelFunc(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(rx(0)),r=rx(JE),o=rx(ZE),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return iS(t,a,i)}}})}}),qR=Qy({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=Wy(e,"x","localResponseNormalization");ym(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),ym(km(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=_g.runKernelFunc(function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return _g.runKernelFunc(function(a){return a.LRNGrad(e,i,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),KR=Qy({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(rx(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Wy(e,"x","norm"),t,n),a=o.shape;if(r){var i=Tm(n,e.shape);a=Hy(o.shape,i)}return o.reshape(a)}}),XR=Qy({basicLSTMCell_:function(e,t,n,r,o,a){var i=Wy(e,"forgetBias","basicLSTMCell"),s=Wy(t,"lstmKernel","basicLSTMCell"),u=Wy(n,"lstmBias","basicLSTMCell"),l=Wy(r,"data","basicLSTMCell"),c=Wy(o,"c","basicLSTMCell"),f=Wy(a,"h","basicLSTMCell"),d=l.concat(f,1).matMul(s).add(u),h=d.shape[0],p=d.shape[1]/4,v=[h,p],m=d.slice([0,0],v),g=d.slice([0,p],v),y=d.slice([0,2*p],v),x=d.slice([0,3*p],v),b=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(i.add(y).sigmoid())),w=b.tanh().mulStrict(x.sigmoid());return[b,w]}}),$R=Qy({multiRNNCell_:function(e,t,n,r){for(var o=Wy(t,"data","multiRNNCell"),a=zy(n,"c","multiRNNCell"),i=zy(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var f=[],d=[];for(l=0;l<u.length;l+=2)f.push(u[l]),d.push(u[l+1]);return[f,d]}}),YR=Qy({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=Wy(e,"v","movingAverage"),i=Wy(t,"x","movingAverage"),s=Wy(n,"decay","movingAverage");Eg(a,i),ym(Em(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=rx(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){ym(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=Wy(r,"step","movingAverage");c=c.div(u.sub(Wb(s,f)))}return a.add(c)}}),QR=Qy({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var l=Wy(e,"x","stridedSlice"),c=Qb(s),f=l.shape.slice();c.forEach(function(e){t[e]=0,n[e]=1,f.splice(e,0,1)}),l=l.reshape(f);for(var d=0;d<l.rank;d++)t[d]=Zb(o,t,r,l.shape,d),n[d]=ew(a,n,r,l.shape,d),r[d]=r[d]||1;var h=Qb(u);h.forEach(function(e){n[e]=t[e]+1,r[e]=1});var p=Jb(t,n,r),v=p.filter(function(e,t){return-1===h.indexOf(t)});return r.every(function(e){return 1===e})?ER(l,t,p).reshape(v):_g.runKernelFunc(function(e){return e.stridedSlice(l,t,n,r)},{$x:l}).reshape(v)}}),JR=Qy({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=Wy(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=_g.runKernelFunc(function(e){return e.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}}),ZR=Qy({scatterND_:function(e,t,n){var r=Wy(e,"indices","scatterND","int32"),o=Wy(t,"updates","scatterND");return Xb(o,r,n),_g.runKernelFunc(function(e){return e.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),eI=Qy({fft_:function(e){ym("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return _g.runKernelFunc(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),tI=Qy({ifft_:function(e){ym("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return _g.runKernelFunc(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),nI=Qy({rfft_:function(e,t){ym("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(null!=t&&t<r){var a=e.shape.map(function(e){return 0}),i=e.shape.map(function(e){return e});i[e.shape.length-1]=t,n=e.slice(a,i),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(lx(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=Jy(n,u).as2D(o,r),c=eI(l),f=Math.floor(r/2)+1,d=Zy(c),h=ex(c),p=d.split([f,r-f],d.shape.length-1),v=h.split([f,r-f],h.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,Jy(p[0],v[0]).reshape(m)}}),rI=Qy({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=tI(r);return Zy(o)}var a=[n,2*(t-1)],i=Zy(e).as2D(n,t),s=ex(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(rx(-1)),c=i.concat(u,1),f=s.concat(l,1);return r=Jy(c,f).as2D(a[0],a[1]),o=tI(r),Zy(o)}}),oI=Object.freeze({fft:eI,ifft:tI,rfft:nI,irfft:rI}),aI=Qy({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=Wy(e,"sparseIndices","sparseToDense","int32"),a=Wy(t,"sparseValues","sparseToDense"),i=Wy(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),_g.runKernelFunc(function(e){return e.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),iI=Qy({gatherND_:function(e,t){var n=Wy(t,"indices","gatherND","int32"),r=Wy(e,"x","gatherND");return _g.runKernelFunc(function(e){return e.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),sI=Qy({diag_:function(e){var t=Wy(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return _g.runKernelFunc(function(e){return e.diag(t)},{$x:t}).reshape(n)}}),uI=Qy({dropout_:function(e,t,n,r){var o=Wy(e,"x","dropout");if(ym("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),ym(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof dg?o.clone():o;var a=function(e,t){if(null==t)return e.shape.slice();if(Em(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(o,n),i=1-t,s=IS(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function lI(e,t,n){for(var r=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var i=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(i)}return ox(o,"float32")}var cI,fI=Qy({hannWindow_:function(e){return lI(e,.5,.5)}}),dI=Qy({hammingWindow_:function(e){return lI(e,.54,.46)}}),hI=Qy({frame_:function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+t<=e.size;)i.push(ER(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=px([ER(e,a,t-s),cx([s],o)]);i.push(u),a+=n}return 0===i.length?ax([],[0,t]):px(i).as2D(i.length,t)}}),pI=Qy({stft_:function(e,t,n,r,o){var a;void 0===o&&(o=fI),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=hI(e,t,n),s=Bb(i,o(t)),u=[],l=0;l<i.shape[0];l++)u.push(nI(s.slice([l,0],[1,t]),r));return px(u)}}),vI=Object.freeze({hannWindow:fI,hammingWindow:dI,frame:hI,stft:pI});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(cI||(cI={}));var mI=Qy({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=cI.SUM_BY_NONZERO_WEIGHTS);var o=Wy(e,"labels","absoluteDifference"),a=Wy(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=Wy(n,"weights","absoluteDifference")),xm(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return gI(s,i,r)}}),gI=Qy({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=cI.SUM_BY_NONZERO_WEIGHTS);var r=Wy(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=Wy(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===cI.NONE)return a;if(n===cI.SUM)return a.sum();if(n===cI.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(rx(i)):s}if(n===cI.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(rx(r.size));var u=o.mul(ux(r.shape)).notEqual(rx(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),yI=Qy({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=cI.SUM_BY_NONZERO_WEIGHTS);var a=Wy(e,"labels","cosineDistance"),i=Wy(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Wy(r,"weights","cosineDistance")),xm(a.shape,i.shape,"Error in cosineDistance: ");var u=rx(1).sub(a.mul(i).sum(n,!0));return gI(u,s,o)}}),xI=Qy({hingeLoss_:function(e,t,n,r){void 0===r&&(r=cI.SUM_BY_NONZERO_WEIGHTS);var o=Wy(e,"labels","hingeLoss"),a=Wy(t,"predictions","hingeLoss"),i=null;null!=n&&(i=Wy(n,"weights","hingeLoss")),xm(o.shape,a.shape,"Error in hingeLoss: ");var s=rx(1);o=rx(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return gI(u,i,r)}}),bI=Qy({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=cI.SUM_BY_NONZERO_WEIGHTS);var a=Wy(e,"labels","huberLoss"),i=Wy(t,"predictions","huberLoss"),s=null;null!=n&&(s=Wy(n,"weights","huberLoss")),xm(a.shape,i.shape,"Error in huberLoss: ");var u=rx(r),l=i.sub(a).abs(),c=Ob(l,u),f=l.sub(c),d=rx(.5).mul(c.square()).add(u.mul(f));return gI(d,s,o)}}),wI=Qy({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=cI.SUM_BY_NONZERO_WEIGHTS);var a=Wy(e,"labels","logLoss"),i=Wy(t,"predictions","logLoss"),s=null;null!=n&&(s=Wy(n,"weights","logLoss")),xm(a.shape,i.shape,"Error in logLoss: ");var u=rx(1),l=rx(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return gI(c,s,o)}}),CI=Qy({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=cI.SUM_BY_NONZERO_WEIGHTS);var o=Wy(e,"labels","meanSquaredError"),a=Wy(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=Wy(n,"weights","meanSquaredError")),xm(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return gI(s,i,r)}}),EI=Qy({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=cI.SUM_BY_NONZERO_WEIGHTS);var a=Wy(e,"multiClassLabels","sigmoidCrossEntropy"),i=Wy(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Wy(n,"weights","sigmoidCrossEntropy")),xm(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=rx(r),l=rx(1),c=rx(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var f=function(e,t){var n=Wy(e,"labels","sigmoidCrossEntropyWithLogits"),r=Wy(t,"logits","sigmoidCrossEntropyWithLogits");xm(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return gI(f,s,o)}}),kI=Qy({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=cI.SUM_BY_NONZERO_WEIGHTS);var a=Wy(e,"onehotLabels","softmaxCrossEntropy"),i=Wy(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Wy(n,"weights","softmaxCrossEntropy")),xm(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=rx(r),l=rx(1),c=rx(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return rw(function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=Hy(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(a,i);return gI(f,s,o)}}),SI=Object.freeze({get Reduction(){return cI},absoluteDifference:mI,computeWeightedLoss:gI,cosineDistance:yI,hingeLoss:xI,huberLoss:bI,logLoss:wI,meanSquaredError:CI,sigmoidCrossEntropy:EI,softmaxCrossEntropy:kI});function RI(e,t){return void 0===t&&(t=!1),_g.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=cS(n),a=e.clone(),i=ax([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=o;t=_g.tidy(function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=ax([[-1]]).where(l.greater(0),ax([[1]])),f=l.sub(c.mul(u)),d=t.div(f);s=1===d.shape[0]?i.clone():i.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var h=c.matMul(f).div(u).neg(),p=a.slice([e,0],[n-e,r]),v=h.mul(s),m=s.transpose();if(0===e)a=p.sub(v.matMul(m.matMul(p)));else{var g=p.sub(v.matMul(m.matMul(p)));a=a.slice([0,0],[e,r]).concat(g,0)}var y=v.transpose(),x=o.slice([0,e],[n,o.shape[1]-e]);if(0===e)o=x.sub(x.matMul(s).matMul(y));else{var b=x.sub(x.matMul(s).matMul(y));o=o.slice([0,0],[n,e]).concat(b,1)}return[s,a,o]}),s=t[0],a=t[1],o=t[2],Py([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var II=Qy({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=Wy(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),n<0&&(n=s);var u=fx(0,i,1,"int32").reshape([-1,1]),l=fx(0,s,1,"int32"),c=jb(u,l),f=nS(c.lessEqual(rx(+t,"int32")),c.greaterEqual(rx(-n,"int32"))),d=lx([i,s],r.dtype);return Nx(Tx(r.reshape([-1,i,s])).map(function(e){return iS(f,e,d)})).reshape(o)}}),_I=Qy({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,ym(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){ym(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=xx(e,e.shape[0],0).map(function(e){return _x(e,[0])});ym(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(e){a.push(_g.tidy(function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=LR(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(KR(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?Nx(a,0):a}}),NI=Qy({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return RI(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=Tx(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return r.forEach(function(e){var n=RI(e,t),r=n[0],i=n[1];o.push(r),a.push(i)}),[Nx(o,0).reshape(e.shape),Nx(a,0).reshape(e.shape)]}}),TI=Object.freeze({bandPart:II,gramSchmidt:_I,qr:NI});function AI(e,t,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=e.shape[0];return n=Math.min(n,i),ym(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),ym(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),ym(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),ym(1===t.rank,function(){return"scores must be a 1D tensor"}),ym(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),ym(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var DI=Qy({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=Wy(e,"images","resizeBilinear");ym(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),ym(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=_g.runKernelFunc(function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)},{x:o},function(e,t){return{x:function(){return _g.runKernelFunc(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),OI=Qy({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=Wy(e,"images","resizeNearestNeighbor");ym(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),ym(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),ym("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=_g.runKernelFunc(function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return _g.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),FI=Qy({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=Wy(e,"boxes","nonMaxSuppression"),i=Wy(t,"scores","nonMaxSuppression"),s=AI(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return _g.runKernelFunc(function(e){return e.nonMaxSuppression(a,i,n,r,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),PI=Qy({nonMaxSuppressionWithScore_:function(e,t,n,r,o,a){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=Wy(e,"boxes","nonMaxSuppression"),s=Wy(t,"scores","nonMaxSuppression"),u=AI(i,s,n,r,o,a),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=_g.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),MI=Qy({cropAndResize_:function(e,t,n,r,o,a){var i=Wy(e,"image","cropAndResize"),s=Wy(t,"boxes","cropAndResize","float32"),u=Wy(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return ym(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),ym(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),ym(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),ym(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),ym(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),ym("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),_g.runKernelFunc(function(e,t){return e.cropAndResize(i,s,u,r,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),BI=Object.freeze({resizeBilinear:DI,resizeNearestNeighbor:OI,nonMaxSuppression:FI,nonMaxSuppressionAsync:function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),tm(this,void 0,void 0,function(){var a,i,s,u,l,c,f;return nm(this,function(d){switch(d.label){case 0:return a=Wy(e,"boxes","nonMaxSuppressionAsync"),i=Wy(t,"scores","nonMaxSuppressionAsync"),s=AI(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=d.sent(),l=u[0],c=u[1],f=Aw(l,c,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,f]}})})},nonMaxSuppressionWithScore:PI,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,o,a){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),tm(this,void 0,void 0,function(){var i,s,u,l,c,f,d;return nm(this,function(h){switch(h.label){case 0:return i=Wy(e,"boxes","nonMaxSuppressionAsync"),s=Wy(t,"scores","nonMaxSuppressionAsync"),u=AI(i,s,n,r,o,a),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=h.sent(),c=l[0],f=l[1],d=Dw(c,f,n,r,o,a),i!==e&&i.dispose(),s!==t&&s.dispose(),[2,d]}})})},cropAndResize:MI}),LI=function(e,t){return!(e>0)||"linear"===t},WI=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},zI=function(e,t){var n=t,r=Gx(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},UI=function(e,t,n){if("linear"===t)return e;if("relu"===t)return VR(e);if("elu"===t)return zR(e);if("relu6"===t)return HR(e);if("prelu"===t)return jR(e,n);throw new Error("Unknown fused activation "+t+".")},jI=Qy({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,a=void 0!==o&&o,i=e.transposeB,s=void 0!==i&&i,u=e.bias,l=e.activation,c=void 0===l?"linear":l,f=e.preluActivationWeights;if(!1===LI(_g.state.gradientDepth,c)){var d=sR(n,r,a,s);return null!=u&&(d=Vx(d,u)),UI(d,c,f)}var h=Wy(n,"a","fused matMul"),p=Wy(r,"b","fused matMul");t=Cg(h,p),h=t[0],p=t[1];var v=a?h.shape[h.rank-2]:h.shape[h.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=a?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=h.shape.slice(0,-2),b=p.shape.slice(0,-2),w=Cm(x),C=Cm(b);ym(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),ym(Em(x,b),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+b+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),ym(v===m,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var E,k,S=h.shape.slice(0,-2).concat([g,y]),R=a?h.as3D(w,v,g):h.as3D(w,g,v),I=s?p.as3D(C,y,m):p.as3D(C,m,y);null!=u&&qx(S,(E=Cg(E=Wy(u,"bias","fused matMul"),h)[0]).shape),null!=f&&(k=Wy(f,"prelu weights","fused matMul"));var _={a:R,b:I};null!=u&&(_.bias=E),null!=f&&(_.preluActivationWeights=k);var N=[R,I];return _g.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:R,b:I,transposeA:a,transposeB:s,bias:E,activation:c,preluActivationWeights:k});return t([R,I,n]),n},_,function(e,t){var n=t[0],r=t[1],o=t[2],i=WI(e,o,c),l={};return null!=u&&(l={bias:function(){return zI(E,i)}}),a||s?!a&&s?Object.assign({a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}},l):a&&!s?Object.assign({a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}},l):Object.assign({a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}},l):Object.assign({a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},l)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:c},N,[!0]).reshape(S)}}),VI=Qy({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(d=d||"linear",!1===LI(_g.state.gradientDepth,d)){var p=QS(t,n,r,o,i,u,l);return null!=c&&(p=Vx(p,c)),UI(p,d,h)}var v=Wy(t,"x","conv2d"),m=Wy(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),ym(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),ym(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=l&&ym(km(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),ym(g.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),ym(bw(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),ym("NHWC"===i,function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var x,b,w=dw(g.shape,m.shape,r,u,o,l);null!=c&&(x=Cg(x=Wy(c,"bias","fused conv2d"),v)[0],qx(w.outShape,x.shape)),null!=h&&(b=Wy(h,"prelu weights","fused conv2d"));var C={x:g,filter:m};null!=c&&(C.bias=x),null!=h&&(C.preluActivationWeights=b);var E=[m,g],k=_g.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:g,filter:m,convInfo:w,bias:x,activation:d,preluActivationWeights:b});return t([m,g,n]),n},C,function(e,t){var n=t,a=n[0],i=n[1],s=n[2],l=WI(e,s,d);ym(xw(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var f={};return null!=c&&(f={bias:function(){return zI(x,l)}}),Object.assign({x:function(){return eR(i.shape,l,a,r,o)},filter:function(){return ZS(i,l,a.shape,r,o)}},f)},"FusedConv2D",{convInfo:w,activation:d},E,[!0]);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),HI=Qy({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(!1===LI(_g.state.gradientDepth,d)){var p=tR(t,n,r,o,i,u,l);return null!=c&&(p=Vx(p,c)),UI(p,d,h)}var v=Wy(t,"x","depthwiseConv2d"),m=Wy(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),ym(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),ym(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),ym(g.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==u&&(u=[1,1]),ym(bw(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=l&&ym(km(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var x,b,w=dw(g.shape,m.shape,r,u,o,l,!0);null!=c&&(x=Cg(x=Wy(c,"bias","fused conv2d"),v)[0],qx(w.outShape,x.shape)),null!=h&&(b=Wy(h,"prelu weights","fused depthwiseConv2d"));var C={x:g,filter:m};null!=c&&(C.bias=x),null!=h&&(C.preluActivationWeights=b);var E=[m,g],k=_g.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:x,activation:d,preluActivationWeights:b});return t([m,g,n]),n},C,function(e,t){ym(xw(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=t[0],r=t[1],o=t[2],a=WI(e,o,d),i={};return null!=c&&(i={bias:function(){return zI(x,a)}}),Object.assign({x:function(){return nR(r.shape,a,n,w)},filter:function(){return rR(r,a,n.shape,w)}},i)},"FusedDepthwiseConv2D",{convInfo:w,activation:d},E,[!0]);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),GI=Object.freeze({matMul:jI,conv2d:VI,depthwiseConv2d:HI}),qI=Object.freeze({image:BI,linalg:TI,losses:SI,spectral:oI,fused:GI,signal:vI,add:Vx,addN:Lk,batchNorm:Hk,batchNormalization:Vk,batchNorm2d:Kk,batchNormalization2d:qk,batchNorm3d:Yk,batchNormalization3d:$k,batchNorm4d:Zk,batchNormalization4d:Jk,broadcastTo:eS,clone:tS,div:Hb,divNoNan:uS,eye:cS,multinomial:fS,oneHot:dS,pad:hS,pad1d:pS,pad2d:vS,pad3d:mS,pad4d:gS,rand:yS,randomGamma:SS,randomNormal:RS,randomUniform:IS,square:_S,squaredDifference:NS,tile:lS,truncatedNormal:TS,conv1d:YS,conv2d:QS,conv3d:JS,depthwiseConv2d:tR,separableConv2d:oR,conv2dTranspose:aR,conv3dTranspose:iR,op:Qy,booleanMaskAsync:function(e,t,n){return tm(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,d,h,p,v;return nm(this,function(m){switch(m.label){case 0:for(r=Wy(e,"tensor","boolMask"),o=Wy(t,"mask","boolMask","bool"),a=null==n?0:n,i=o.rank,s=r.shape,ym(i>0,function(){return"mask cannot be scalar"}),xm(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+i;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+i)),f=r.reshape(c),d=o.reshape([-1]),[4,sS(d)];case 1:return h=m.sent(),p=h.squeeze([1]),v=GS(f,p,a),e!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),f.dispose(),d.dispose(),h.dispose(),[2,v]}})})},complex:Jy,real:Zy,imag:ex,concat:px,concat1d:vx,concat2d:mx,concat3d:gx,concat4d:yx,split:xx,matMul:sR,dot:uR,outerProduct:lR,reverse:cR,reverse1d:fR,reverse2d:dR,reverse3d:hR,reverse4d:pR,maxPool:gR,avgPool:yR,pool:xR,maxPool3d:bR,avgPool3d:wR,maxPoolWithArgmax:CR,slice:ER,slice1d:kR,slice2d:SR,slice3d:RR,slice4d:IR,abs:Kx,acos:Xx,acosh:$x,asin:Yx,asinh:Qx,atan:Jx,atanh:Zx,ceil:eb,clipByValue:tb,cos:nb,cosh:rb,erf:ob,exp:ab,expm1:ib,floor:sb,log:ub,log1p:lb,logSigmoid:cb,neg:fb,reciprocal:db,round:hb,rsqrt:pb,sigmoid:vb,sign:mb,isNaN:gb,isInf:yb,isFinite:xb,sin:bb,sinh:wb,softplus:Cb,sqrt:Eb,step:kb,tan:Sb,tanh:Rb,all:NR,any:TR,argMax:AR,argMin:DR,logSumExp:OR,max:FR,mean:PR,min:MR,moments:BR,sum:LR,prod:WR,equal:AS,equalStrict:DS,greater:OS,greaterEqual:FS,greaterEqualStrict:PS,greaterStrict:MS,less:BS,lessEqual:LS,lessEqualStrict:WS,lessStrict:zS,notEqual:US,notEqualStrict:jS,addStrict:Ib,atan2:_b,divStrict:Nb,floorDiv:Tb,maximum:Ab,maximumStrict:Db,minimum:Ob,minimumStrict:Fb,mod:Pb,modStrict:Mb,mul:Bb,mulStrict:Lb,pow:Wb,powStrict:zb,squaredDifferenceStrict:Ub,sub:jb,subStrict:Vb,elu:zR,leakyRelu:UR,prelu:jR,relu:VR,relu6:HR,selu:GR,logicalAnd:nS,logicalNot:rS,logicalOr:oS,logicalXor:aS,where:iS,whereAsync:sS,buffer:bx,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:wx,cast:Cx,cumsum:Ex,depthToSpace:kx,expandDims:Sx,reshape:Rx,spaceToBatchND:Ix,squeeze:_x,stack:Nx,unstack:Tx,setdiff1dAsync:function(e,t){return tm(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f;return nm(this,function(d){switch(d.label){case 0:return n=Wy(e,"x","setdiff1d"),r=Wy(t,"y","setdiff1d"),ym(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),ym(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),ym(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(a=d.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new ug([s],n.dtype),l=new ug([s],"int32"),c=0,f=0;c<o.length;c++)i.has(o[c])||(u.values[f]=o[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})},fill:cx,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return _g.runKernelFunc(function(r){return r.linspace(e,t,n)},{})},ones:ux,range:fx,scalar:rx,tensor:tx,tensor1d:ox,tensor2d:ax,tensor3d:ix,tensor4d:sx,tensor5d:function(e,t,n){if(bm(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=By(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return nx(e,t,r,n)},tensor6d:function(e,t,n){if(bm(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=By(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return nx(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),_g.makeVariable(e,t,n,r)},zeros:lx,onesLike:dx,zerosLike:hx,transpose:iw,softmax:ow,logSoftmax:aw,localResponseNormalization:qR,norm:KR,gather:GS,unsortedSegmentSum:qS,basicLSTMCell:XR,multiRNNCell:$R,movingAverage:YR,stridedSlice:QR,topk:JR,scatterND:ZR,fft:eI,ifft:tI,rfft:nI,irfft:rI,sparseToDense:aI,gatherND:iI,diag:sI,dropout:uI,hannWindow:fI,hammingWindow:dI,frame:hI,stft:pI,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),tm(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,d,h,p,v,m;return nm(this,function(g){switch(g.label){case 0:return r=Wy(e,"predictions","inTopK"),o=Wy(t,"targets","inTopK"),ym(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),ym(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),xm(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],ym(n>0&&n<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n}),[4,r.data()];case 1:return i=g.sent(),[4,o.data()];case 2:for(s=g.sent(),u=[i.length/a,a],c=u[1],f=Dm("bool",l=u[0]),d=0;d<l;d++){for(h=d*c,p=i.subarray(h,h+c),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(e,t){return t.value-e.value}),f[d]=0,m=0;m<n;m++)if(v[m].index===s[d]){f[d]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,tx(f,o.shape,"bool")]}})})}});function KI(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&ym("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function XI(e,t,n,r,o,a){for(var i=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,l=o.dilationWidth,c=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=o.padInfo.top,h=o.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=bx(o.outShape,n),m=v.values,g=o.outShape[1]*o.outShape[2]*o.outShape[3],y=o.outShape[2]*o.outShape[3],x=o.outShape[3],b=0;b<o.batchSize;++b)for(var w=b*g,C=b*r[0],E=0;E<o.inChannels;++E)for(var k=0;k<o.outHeight;++k)for(var S=k*i-d,R=Math.max(0,S),I=Math.min(o.inHeight,c+S),_=w+k*y,N=0;N<o.outWidth;++N){for(var T=N*s-h,A=Math.max(0,T),D=Math.min(o.inWidth,f+T),O=p,F=0,P=0,M=R;M<I;M+=u){for(var B=C+M*r[1],L=A;L<D;L+=l){var W=e[B+L*r[2]+E];"max"===a&&W>O?O=W:"avg"===a&&(F+=W,P++)}if(isNaN(O))break}m[_+N*x+E]="avg"===a?F/P:O}return v}function $I(e,t,n,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);for(var i=bx(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,v=bx(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var x=y*s-h,b=x;b<0;)b+=l;for(var w=Math.min(r.inHeight,f+x),C=0;C<r.outWidth;++C){for(var E=C*u-p,k=E;k<0;)k+=c;for(var S=Math.min(r.inWidth,d+E),R=Number.NEGATIVE_INFINITY,I=-1,_=b;_<w;_+=l)for(var N=_-x,T=k;T<S;T+=c){var A=T-E,D=v.get(m,_,T,g);D>R&&(R=D,I=o?a?((m*r.inHeight+_)*r.inWidth+T)*r.inChannels+g:(_*r.inWidth+T)*r.inChannels+g:N*d+A)}i.set(I,m,y,C,g)}}return i}function YI(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var QI=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new sw(t,_g),t}return em(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,om().get("IS_NODE")&&My("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Sw(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return eg(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return bx(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return _g.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return tm(this,void 0,void 0,function(){var t;return nm(this,function(n){return t=Qm(),e(),[2,{kernelMs:Qm()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:_g.keep(e.clone()),imag:_g.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(KI(e,"slice"),tw(e.shape,t,n)){var r=nw(t,e.strides),o=Cm(n);return tx(this.readSync(e.dataId).subarray(r,r+o),n,e.dtype)}for(var a=bx(n,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(e,n){return e+t[n]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){KI(e,"stridedSlice");var o=Jb(t,n,r);if(o.some(function(e){return 0===e}))return tx([],o);for(var a=bx(o,e.dtype),i=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[c]*r[c]+t[c];a.set.apply(a,[i.get.apply(i,l)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=bx([e.size,e.size],e.dtype),r=n.values,o=0;o<t.length;o++)r[o*e.size+o]=t[o];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.reverse=function(e,t){KI(e,"reverse");for(var n=bx(e.shape,e.dtype),r=this.bufferSync(e),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map(function(e){return Zy(e)}),o=e.map(function(e){return ex(e)});return Jy(this.concat(r,t),this.concat(o,t))}var a=e.map(function(e){var n=Cm(e.shape.slice(t));return e.as2D(-1,n)}),i=Yy(a.map(function(e){return e.shape}),1),s=bx(i,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach(function(e){s.set(n.readSync(e.dataId),u),u+=e.size})}else{var l=0;a.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,o=0;o<e.shape[0];++o)for(var a=o*i[1]+l,u=0;u<e.shape[1];++u)s[a+u]=t[r++];l+=e.shape[1]})}var c=Yy(e.map(function(e){return e.shape}),t);return tx(s,c,e[0].dtype)},t.prototype.neg=function(e){return KI(e,"neg"),this.multiply(rx(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,bg(e.dtype,t.dtype),function(e,t){return e+t})},t.prototype.addN=function(e){var t=this;KI(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=bx(e[0].shape,e[0].dtype),o=r.values,a=0;a<e.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=Tm([t],e.shape),r=this.max(e,n),o=Hy(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return Hb(i,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,bg(e.dtype,t.dtype),function(e,t){return e-t})},t.prototype.pow=function(e,t){return KI([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,n,r){KI([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=c[0],d=c[1],h=c[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=p[0],m=p[1],g=p[2],y=a*i,x=bx([s,a,i],e.dtype),b=x.values,w=this.blockSize,C=0;C<s;C++)for(var E=0;E<a;E+=w)for(var k=0;k<i;k+=w)for(var S=0;S<o;S+=w)for(var R=Math.min(E+w,a),I=Math.min(k+w,i),_=Math.min(S+w,o),N=E;N<R;N++)for(var T=k;T<I;T++){for(var A=0,D=S;D<_;D++)A+=u[C*f+N*d+D*h]*l[D*v+T*m+C*g];b[C*y+(N*i+T)]+=A}return x.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,o);return a&&(u=this.add(u,a)),i&&(u=YI(this,u,i,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,bg(e.dtype,t.dtype),function(e,t){return e*t})},t.prototype.floorDiv=function(e,t){return KI([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){KI(e,"sum"),Gy("sum",t,e.rank);for(var n=Vy(e.shape,t),r=n[0],o=n[1],a=lx(r,bg(e.dtype,"int32")),i=Cm(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=0,d=0;d<i;++d)f+=u[c+d];s[l]=f}return a},t.prototype.prod=function(e,t){KI(e,"sum");for(var n=Vy(e.shape,t),r=n[0],o=n[1],a=lx(r,bg(e.dtype,"int32")),i=Cm(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=1,d=0;d<i;++d)f*=u[c+d];s[l]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){KI(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=rx(a,"int32"),s=AS(i,t).asType("float32").mul(e).sum(0);r.push(s)}return Nx(r)},t.prototype.argMin=function(e,t){KI(e,"argMin");var n=[t];Gy("argMin",n,e.rank);for(var r=Vy(e.shape,n),o=r[0],a=r[1],i=lx(o,"int32"),s=Cm(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,d=l[f],h=0,p=0;p<s;++p){var v=l[f+p];v<d&&(d=v,h=p)}u[c]=h}return i},t.prototype.argMax=function(e,t){KI(e,"argMax");var n=[t];Gy("argMax",n,e.rank);for(var r=Vy(e.shape,n),o=r[0],a=r[1],i=lx(o,"int32"),s=Cm(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,d=l[f],h=0,p=0;p<s;++p){var v=l[f+p];v>d&&(d=v,h=p)}u[c]=h}return i},t.prototype.cumsum=function(e,t,n,r){if(KI(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=bg(e.dtype,"int32"),a=lx(e.shape,o),i=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var f=0;f<u;f++){var d=l(c,f);if(0===f)i[d]=n?0:s[d];else{var h=l(c,f-1);i[d]=n?s[h]+i[h]:s[d]+i[h]}}return a},t.prototype.equal=function(e,t){return KI([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return KI([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return KI([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return KI([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return KI([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return KI([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalNot=function(e){KI(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return KI([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return KI([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,n){KI([e,t,n],"select");for(var r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(n.dataId),i=lx(t.shape,bg(t.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:Cm(t.shape.slice(1)),c=0;c<r.length;c++)for(var f=0;f<l;f++)1===r[c]?s[u++]=o[c]:s[u++]=a[c];return i},t.prototype.where=function(e){KI([e],"where");var t=this.readSync(e.dataId);return zw(e.shape,t)},t.prototype.topk=function(e,t,n){return KI(e,"topk"),Ww(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){KI(e,"min"),Gy("min",t,e.rank);for(var n=Vy(e.shape,t),r=n[0],o=n[1],a=lx(r,e.dtype),i=Cm(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];h<f&&(f=h)}s[l]=f}return a},t.prototype.minimum=function(e,t){return KI([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return KI([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},t.prototype.max=function(e,t){KI(e,"max"),Gy("max",t,e.rank);for(var n=Vy(e.shape,t),r=n[0],o=n[1],a=lx(r,e.dtype),i=Cm(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];h>f&&(f=h)}s[l]=f}return a},t.prototype.maximum=function(e,t){return KI([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){KI(e,"all"),Gy("all",t,e.rank);for(var n=Vy(e.shape,t),r=n[0],o=n[1],a=lx(r,e.dtype),i=Cm(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];f=f&&h}s[l]=f}return a},t.prototype.any=function(e,t){KI(e,"any"),Gy("any",t,e.rank);for(var n=Vy(e.shape,t),r=n[0],o=n[1],a=lx(r,e.dtype),i=Cm(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],d=0;d<i;++d){var h=u[c+d];f=f||h}s[l]=f}return a},t.prototype.squaredDifference=function(e,t){return KI([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},t.prototype.ceil=function(e){KI(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){KI(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){KI(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){KI(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){KI(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){KI(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){KI(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){KI(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){KI(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){KI(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){KI(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){KI(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){KI(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){KI(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){KI(e,"relu");for(var t=lx(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},t.prototype.relu6=function(e){KI(e,"relu");for(var t=lx(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return t},t.prototype.prelu=function(e,t){return KI([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.elu=function(e){KI(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){KI([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){KI(e,"selu");for(var t=JE,n=ZE,r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?n*i:t*(Math.exp(i)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){KI(e,"clip");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){KI(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){KI(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){KI(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){KI(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){KI(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){KI(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){KI(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){KI(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){KI(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return KI([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.sinh=function(e){KI(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){KI(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){KI(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Sm(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){KI(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){KI(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){KI(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){KI(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),a=Math.abs(n[r]),i=1/(1+.3275911*a);t[r]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),KI(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.conv2d(t,n,r);return o&&(s=this.add(s,o)),a&&(s=YI(this,s,a,i)),s},t.prototype.conv2d=function(e,t,n){KI([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l="channelsLast"===n.dataFormat,c=bx(n.outShape,e.dtype),f=e.strides[0],d=l?e.strides[1]:e.strides[2],h=l?e.strides[2]:1,p=l?1:e.strides[1],v=c.strides[0],m=l?c.strides[1]:c.strides[2],g=l?c.strides[2]:1,y=l?1:c.strides[1],x=this.readSync(e.dataId),b=this.readSync(t.dataId),w=c.values,C=0;C<n.batchSize;++C)for(var E=C*f,k=C*v,S=0;S<n.outHeight;++S)for(var R=k+S*m,I=S*n.strideHeight-u,_=0;_<r;_++){var N=I+_*a;if(!(N<0||N>=n.inHeight))for(var T=_*t.strides[0],A=E+N*d,D=0;D<n.outWidth;++D)for(var O=R+D*g,F=D*n.strideWidth-s,P=0;P<o;P++){var M=F+P*i;if(!(M<0||M>=n.inWidth))for(var B=A+M*h,L=T+P*t.strides[1],W=0;W<n.inChannels;++W){for(var z=x[B+W*p],U=0;U<n.outChannels;++U)w[O+U*y]+=z*b[L+U];L+=n.outChannels}}}return c.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,f=n.padInfo.top,d=bx(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),v=d.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*d.strides[0],x=0;x<n.outDepth;++x)for(var b=y+x*d.strides[1],w=x*n.strideDepth-l,C=0;C<r;C++){var E=w+C*i;if(!(E<0||E>=n.inDepth))for(var k=C*t.strides[0],S=g+E*e.strides[1],R=0;R<n.outHeight;++R)for(var I=b+R*d.strides[2],_=R*n.strideHeight-f,N=0;N<o;N++){var T=_+N*s;if(!(T<0||T>=n.inHeight))for(var A=k+N*t.strides[1],D=S+T*e.strides[2],O=0;O<n.outWidth;++O)for(var F=I+O*n.outChannels,P=O*n.strideWidth-c,M=0;M<a;M++){var B=P+M*u;if(!(B<0||B>=n.inWidth))for(var L=A+M*t.strides[2],W=D+B*n.inChannels,z=L,U=0;U<n.inChannels;++U){for(var j=h[W+U],V=0;V<n.outChannels;++V)v[F+V]+=j*p[z+V];z+=n.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){KI([e,t],"conv2dDerInput");for(var r=bx(n.inShape,"float32"),o=r.values,a=this.readSync(e.dataId),i=this.readSync(t.dataId),s=t.strides,u=s[0],l=s[1],c=s[2],f=n.batchSize,d=n.filterHeight,h=n.filterWidth,p=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,x=n.outWidth,b=n.strideHeight,w=n.strideWidth,C=n.dataFormat,E=d-1-n.padInfo.top,k=h-1-n.padInfo.left,S="channelsLast"===C,R=r.strides[0],I=S?r.strides[1]:r.strides[2],_=S?r.strides[2]:1,N=S?1:r.strides[1],T=e.strides[0],A=S?e.strides[1]:e.strides[2],D=S?e.strides[2]:1,O=S?1:e.strides[1],F=0;F<f;++F)for(var P=0;P<p;++P)for(var M=0;M<v;++M)for(var B=M-E,L=Math.max(0,Math.ceil(B/b)),W=Math.min(y,(d+B)/b),z=0;z<m;++z){for(var U=z-k,j=Math.max(0,Math.ceil(U/w)),V=Math.min(x,(h+U)/w),H=0,G=L;G<W;++G)for(var q=G*b-B,K=j;K<V;++K)for(var X=T*F+A*G+D*K,$=u*(d-1-q)+l*(h-1-(K*w-U))+c*P,Y=0;Y<g;++Y)H+=a[X+O*Y]*i[$+Y];o[R*F+I*M+_*z+N*P]=H}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=bx(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=this.readSync(e.dataId),f=e.strides,d=f[0],h=f[1],p=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],x=g[1],b=g[2],w=g[3],C=n.batchSize,E=n.filterDepth,k=n.filterHeight,S=n.filterWidth,R=n.inChannels,I=n.inDepth,_=n.inHeight,N=n.inWidth,T=n.outChannels,A=n.outDepth,D=n.outHeight,O=n.outWidth,F=n.strideDepth,P=n.strideHeight,M=n.strideWidth,B=E-1-n.padInfo.front,L=k-1-n.padInfo.top,W=S-1-n.padInfo.left,z=0;z<C;++z)for(var U=0;U<R;++U)for(var j=0;j<I;++j)for(var V=j-B,H=Math.max(0,Math.ceil(V/F)),G=Math.min(A,(E+V)/F),q=0;q<_;++q)for(var K=q-L,X=Math.max(0,Math.ceil(K/P)),$=Math.min(D,(k+K)/P),Y=0;Y<N;++Y){for(var Q=Y-W,J=Math.max(0,Math.ceil(Q/M)),Z=Math.min(O,(S+Q)/M),ee=0,te=H;te<G;++te)for(var ne=te*F-V,re=X;re<$;++re)for(var oe=re*P-K,ae=J;ae<Z;++ae)for(var ie=d*z+h*te+p*re+v*ae,se=y*(E-1-ne)+x*(k-1-oe)+b*(S-1-(ae*M-Q))+w*U,ue=0;ue<T;++ue)ee+=c[ie+ue]*m[se+ue];o[i*z+s*j+u*q+l*Y+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){KI([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s="channelsLast"===n.dataFormat,u=bx(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((c-h)/r)),v=Math.min(n.outHeight,(n.inHeight+c-h)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((l-m)/o)),y=Math.min(n.outWidth,(n.inWidth+l-m)/o),x=0;x<n.inChannels;++x)for(var b=0;b<n.outChannels;++b){for(var w=0,C=0;C<n.batchSize;++C)for(var E=p;E<v;++E)for(var k=h+E*r-c,S=g;S<y;++S){var R=m+S*o-l;w+=s?f.get(C,k,R,x)*d.get(C,E,S,b):f.get(C,x,k,R)*d.get(C,b,E,S)}u.set(w,h,m,x,b)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=bx(n.filterShape,"float32"),c=l.values,f=l.strides,d=f[0],h=f[1],p=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],x=g[1],b=g[2],w=g[3],C=this.readSync(e.dataId),E=e.strides,k=E[0],S=E[1],R=E[2],I=E[3],_=n.padInfo.front,N=n.padInfo.left,T=n.padInfo.top,A=0;A<i;++A)for(var D=Math.max(0,Math.ceil((_-A)/r)),O=Math.min(n.outDepth,(n.inDepth+_-A)/r),F=A*d,P=0;P<s;++P)for(var M=Math.max(0,Math.ceil((T-P)/o)),B=Math.min(n.outHeight,(n.inHeight+T-P)/o),L=P*h+F,W=0;W<u;++W)for(var z=Math.max(0,Math.ceil((N-W)/a)),U=Math.min(n.outWidth,(n.inWidth+N-W)/a),j=W*p+L,V=0;V<n.inChannels;++V)for(var H=V*v+j,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*k,$=K*y,Y=D;Y<O;++Y)for(var Q=(A+Y*r-_)*S+X,J=Y*x+$,Z=M;Z<B;++Z)for(var ee=(P+Z*o-T)*R+Q,te=Z*b+J,ne=z;ne<U;++ne){var re=ne*w+te;q+=C[(W+ne*a-N)*I+ee+V]*m[re+G]}c[H+G]=q}return l.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return o&&(s=this.add(s,o)),a&&(s=YI(this,s,a,i)),s},t.prototype.depthwiseConv2D=function(e,t,n){KI([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=bx(n.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),h=c.values,p=0;p<n.batchSize;++p)for(var v=p*e.strides[0],m=p*c.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*c.strides[1],x=g*n.strideHeight-s,b=0;b<r;++b){var w=x+b*a;if(!(w<0||w>=n.inHeight))for(var C=b*t.strides[0],E=v+w*e.strides[1],k=0;k<n.outWidth;++k)for(var S=y+k*c.strides[2],R=k*n.strideWidth-u,I=0;I<o;++I){var _=R+I*i;if(!(_<0||_>=n.inWidth))for(var N=C+I*t.strides[1],T=E+_*n.inChannels,A=S,D=N,O=0;O<n.inChannels;++O){for(var F=f[T+O],P=0;P<l;++P)h[A+P]+=F*d[D+P];A+=l,D+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){KI([e,t],"depthwiseConv2DDerInput");for(var r=bx(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=this.readSync(e.dataId),c=e.strides,f=c[0],d=c[1],h=c[2],p=this.readSync(t.dataId),v=t.strides,m=v[0],g=v[1],y=v[2],x=n.batchSize,b=n.filterHeight,w=n.filterWidth,C=n.inChannels,E=n.inHeight,k=n.inWidth,S=n.outChannels,R=n.outHeight,I=n.outWidth,_=n.strideHeight,N=n.strideWidth,T=b-1-n.padInfo.top,A=w-1-n.padInfo.left,D=S/C,O=0;O<x;++O)for(var F=0;F<C;++F)for(var P=0;P<E;++P)for(var M=P-T,B=Math.max(0,Math.ceil(M/_)),L=Math.min(R,(b+M)/_),W=0;W<k;++W){for(var z=W-A,U=Math.max(0,Math.ceil(z/N)),j=Math.min(I,(w+z)/N),V=0,H=B;H<L;++H)for(var G=H*_-M,q=U;q<j;++q)for(var K=f*O+d*H+h*q,X=m*(b-1-G)+g*(w-1-(q*N-z))+y*F,$=0;$<D;++$)V+=l[K+(F*D+$)]*p[X+$];o[i*O+s*P+u*W+F]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){KI([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=bx(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((l-h)/r)),v=Math.min(n.outHeight,(n.inHeight+l-h)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),x=0;x<n.outChannels;++x){for(var b=Math.trunc(x/c),w=x%c,C=0,E=0;E<n.batchSize;++E)for(var k=p;k<v;++k)for(var S=h+k*r-l,R=g;R<y;++R){var I=m+R*o-u;C+=f.get(E,S,I,b)*d.get(E,k,R,x)}s.set(C,h,m,b,w)}return s.toTensor()},t.prototype.tile=function(e,t){return KI(e,"tile"),Lw(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){KI(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),a=this.bufferSync(e),i=bx(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map(function(e,t){return e+o[t]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},t.prototype.gather=function(e,t,n){KI([e,t],"gather");var r=e.shape.slice(),o=this.readSync(t.dataId);r[n]=o.length;for(var a=bx(r,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){KI([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=Ax(e.shape,t,r),a=Dx(o.length,t.length),i=Ox(e.shape,t,r),s=Fx(n,t.length),u=Px(i,n,t.length);return iw(e.reshape(o),a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){KI([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Ax(i.shape,t,r,!1),u=Dx(s.length,t.length,!1),l=Ox(i.shape,t,r,!1);return iw(i.reshape(s),u).reshape(l)},t.prototype.maxPool=function(e,t){return KI(e,"maxPool"),XI(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){KI([t,n],"maxPoolBackprop");for(var o=this.readSync(t.dataId),a=bx(r.outShape,t.dtype,$I(o,t.shape,t.dtype,r).values),i=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=f-1-r.padInfo.left,h=c-1-r.padInfo.top,p=bx(t.shape,"float32"),v=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var x=0;x<r.inWidth;++x){for(var b=y-h,w=x-d,C=0,E=0;E<c;E+=u){var k=(b+E)/i;if(!(k<0||k>=r.outHeight||Math.floor(k)!==k))for(var S=0;S<f;S+=l){var R=(w+S)/s;if(!(R<0||R>=r.outWidth||Math.floor(R)!==R)){var I=c*f-1-a.get(m,k,R,g)===E*f+S?1:0;0!==I&&(C+=v.get(m,k,R,g)*I)}}}p.set(C,m,y,x,g)}return p.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){KI([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,f=c-1-n.padInfo.left,d=l-1-n.padInfo.top,h=bx(t.shape,"float32"),p=1/(a*i),v=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var x=0;x<n.inWidth;++x){for(var b=y-d,w=x-f,C=0,E=0;E<l;E+=s){var k=(b+E)/r;if(!(k<0||k>=n.outHeight||Math.floor(k)!==k))for(var S=0;S<c;S+=u){var R=(w+S)/o;R<0||R>=n.outWidth||Math.floor(R)!==R||(C+=v.get(m,k,R,g))}}h.set(C*p,m,y,x,g)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){KI(e,"pool3d");for(var r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=bx(t.outShape,e.dtype),y=g.values,x=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],b=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],C=t.outShape[4],E=0;E<t.batchSize;++E)for(var k=E*x,S=E*e.strides[0],R=0;R<t.inChannels;++R)for(var I=0;I<t.outDepth;++I){for(var _=I*r-d,N=_;N<0;)N+=i;for(var T=Math.min(t.inDepth,l+_),A=k+I*b,D=0;D<t.outHeight;++D){for(var O=D*o-h,F=O;F<0;)F+=s;for(var P=Math.min(t.inHeight,c+O),M=A+D*w,B=0;B<t.outWidth;++B){for(var L=B*a-p,W=L;W<0;)W+=u;for(var z=Math.min(t.inWidth,f+L),U=M+B*C,j=v,V=0,H=0,G=N;G<T;G+=i){for(var q=S+G*e.strides[1],K=F;K<P;K+=s){for(var X=q+K*e.strides[2],$=W;$<z;$+=u){var Y=m[X+$*e.strides[3]+R];if("max"===n&&Y>j?j=Y:"avg"===n&&(V+=Y,H++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}y[U+R]="avg"===n?V/H:j}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return KI(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){KI([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=d-1-n.padInfo.front,m=p-1-n.padInfo.left,g=h-1-n.padInfo.top,y=bx(t.shape,"float32"),x=1/(i*s*u),b=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var C=0;C<n.inChannels;++C)for(var E=0;E<n.inDepth;++E)for(var k=0;k<n.inHeight;++k)for(var S=0;S<n.inWidth;++S){for(var R=E-v,I=k-g,_=S-m,N=0,T=0;T<d;T+=l){var A=(R+T)/r;if(!(A<0||A>=n.outDepth||Math.floor(A)!==A))for(var D=0;D<h;D+=c){var O=(I+D)/o;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var F=0;F<p;F+=f){var P=(_+F)/a;P<0||P>=n.outWidth||Math.floor(P)!==P||(N+=b.get(w,A,O,P,C))}}}y.set(N*x,w,E,k,S,C)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return KI(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=bx(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,v=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var x=y*r-d,b=x;b<0;)b+=i;for(var w=Math.min(t.inDepth,l+x),C=0;C<t.outHeight;++C){for(var E=C*o-h,k=E;k<0;)k+=s;for(var S=Math.min(t.inHeight,c+E),R=0;R<t.outWidth;++R){for(var I=R*a-p,_=I;_<0;)_+=u;for(var N=Math.min(t.inWidth,f+I),T=Number.NEGATIVE_INFINITY,A=-1,D=b;D<w;D+=i)for(var O=D-x,F=k;F<S;F+=s)for(var P=F-E,M=_;M<N;M+=u){var B=M-I,L=v.get(m,D,F,M,g);L>=T&&(T=L,A=O*c*f+P*c+B)}n.set(A,m,y,C,R,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){KI([t,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(t,r),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=f-1-r.padInfo.front,v=h-1-r.padInfo.left,m=d-1-r.padInfo.top,g=bx(t.shape,"float32"),y=this.bufferSync(o),x=this.bufferSync(e),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var C=0;C<r.inDepth;++C)for(var E=0;E<r.inHeight;++E)for(var k=0;k<r.inWidth;++k){for(var S=C-p,R=E-m,I=k-v,_=0,N=0;N<f;N+=u){var T=(S+N)/a;if(!(T<0||T>=r.outDepth||Math.floor(T)!==T))for(var A=0;A<d;A+=l){var D=(R+A)/i;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var O=0;O<h;O+=c){var F=(I+O)/s;if(!(F<0||F>=r.outWidth||Math.floor(F)!==F)){var P=f*d*h-1-y.get(b,T,D,F,w)===N*d*h+A*h+O?1:0;0!==P&&(_+=x.get(b,T,D,F,w)*P)}}}}g.set(_,b,C,E,k,w)}return g.toTensor()},t.prototype.cast=function(e,t){return Cw(e,t,this)},t.prototype.reshape=function(e,t){return Ew(e,t)},t.prototype.avgPool=function(e,t){return KI(e,"avgPool"),KI(e,"maxPool"),XI(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){KI(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(Cm([a,t,n,u])),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,p=f[0]/d[0],v=f[1]/d[1],m=0;m<a;m++)for(var g=0;g<t;g++)for(var y=p*g,x=Math.floor(y),b=y-x,w=Math.min(i-1,Math.ceil(y)),C=m*e.strides[0]+x*e.strides[1],E=m*e.strides[0]+w*e.strides[1],k=0;k<n;k++)for(var S=v*k,R=Math.floor(S),I=S-R,_=Math.min(s-1,Math.ceil(S)),N=C+R*e.strides[2],T=E+R*e.strides[2],A=C+_*e.strides[2],D=E+_*e.strides[2],O=0;O<u;O++){var F=l[N+O],P=l[T+O],M=F+(l[A+O]-F)*I,B=M+(P+(l[D+O]-P)*I-M)*b;c[h++]=B}return tx(c,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){KI([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=[n&&l>1?a-1:a,n&&c>1?i-1:i],h=[n&&l>1?l-1:l,n&&c>1?c-1:c],p=d[0]/h[0],v=d[1]/h[1],m=this.readSync(e.dataId),g=0,y=0;y<o;y++)for(var x=y*t.strides[0],b=0;b<l;b++)for(var w=b*p,C=Math.floor(w),E=Math.min(Math.ceil(w),a-1),k=x+C*t.strides[1],S=x+E*t.strides[1],R=w-C,I=1-R,_=0;_<c;_++)for(var N=_*v,T=Math.floor(N),A=Math.min(Math.ceil(N),i-1),D=N-T,O=1-D,F=k+T*t.strides[2],P=k+A*t.strides[2],M=S+T*t.strides[2],B=S+A*t.strides[2],L=I*O,W=I*D,z=R*O,U=R*D,j=0;j<s;j++){var V=m[g++];f[F+j]+=V*L,f[P+j]+=V*W,f[M+j]+=V*z,f[B+j]+=V*U}return sx(f,[o,i,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){KI(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(a*t*n*u),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/d[0],p=f[1]/d[1],v=0,m=0;m<a;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var x=h*y,b=g+Math.min(i-1,r?Math.round(x):Math.floor(x))*e.strides[1],w=0;w<n;w++)for(var C=p*w,E=b+Math.min(s-1,r?Math.round(C):Math.floor(C))*e.strides[2],k=0;k<u;k++){var S=l[E+k];c[v++]=S}return tx(c,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){KI([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),d=this.readSync(e.dataId),h=[n&&l>1?a-1:a,n&&c>1?i-1:i],p=[n&&l>1?l-1:l,n&&c>1?c-1:c],v=h[0]/p[0],m=h[1]/p[1],g=1/v,y=1/m,x=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2,w=0;w<o;w++)for(var C=w*t.strides[0],E=0;E<a;E++)for(var k=C+E*t.strides[1],S=Math.floor(E*g),R=Math.floor(S-x/2),I=0;I<i;I++)for(var _=k+I*t.strides[2],N=Math.floor(I*y),T=Math.floor(N-b/2),A=0;A<s;A++){for(var D=0,O=0;O<x;O++){var F=O+R;if(!(F<0||F>=l)){var P=C+F*e.strides[1],M=F*v;if(E===Math.min(a-1,n?Math.round(M):Math.floor(M)))for(var B=0;B<b;B++){var L=B+T;if(!(L<0||L>=c)){var W=P+L*e.strides[2],z=L*m;I===Math.min(i-1,n?Math.round(z):Math.floor(z))&&(D+=d[W+A])}}}}f[_+A]=D}return sx(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){KI([e,t,n,o,a],"batchNorm");for(var i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(i.length),d=c.length,h=l.length,p=u.length,v=s.length,m=0,g=0,y=0,x=0,b=0;b<i.length;++b)f[b]=c[m++]+(i[b]-s[g++])*l[y++]/Math.sqrt(u[x++]+r),m>=d&&(m=0),g>=v&&(g=0),y>=h&&(y=0),x>=p&&(x=0);return sx(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){KI(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=this.readSync(e.dataId),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var f=0;f<u;f++){var d=c(f),h=s[f]*Math.pow(n+r*d,-o);l[f]=h}return sx(l,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){KI(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=this.readSync(n.dataId),f=new Float32Array(e.size),d=e.size,h=0;h<d;h++){for(var p=h%s,v=h-p+Math.max(0,p-r),m=h-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(l[y],2);for(g=a*g+o,y=v;y<m;y++){var x=-2*a*i*l[y]*c[h]/g;h===y&&(x+=Math.pow(g,-i)),x*=u[h],f[y]+=x}}return sx(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){KI(e,"multinomial");for(var o=t?e:ow(e),a=o.shape[0],i=o.shape[1],s=lx([a,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<a;++c){var f=c*i,d=new Float32Array(i-1);d[0]=l[f];for(var h=1;h<d.length;++h)d[h]=d[h-1]+l[f+h];for(var p=Bk(r.toString()),v=c*n,m=0;m<n;++m){var g=p();u[v+m]=d.length;for(var y=0;y<d.length;y++)if(g<d[y]){u[v+m]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){KI(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=this.readSync(e.dataId),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return ax(o,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return KI(e,"nonMaxSuppression"),Aw(this.readSync(e.dataId),this.readSync(t.dataId),n,r,o)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=bx(e.shape,"float32"),a=bx(e.shape,"float32"),i=Zy(e).as2D(n,r),s=ex(e).as2D(n,r),u=0;u<n;u++)for(var l=i.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),f=Jy(l,c),d=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var p=Rw(d,h);o.values[u*r+h]=p.real,a.values[u*r+h]=p.imag}return Jy(o.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=Jy(Zy(o).div(rx(r)),ex(o).div(rx(r)))),o}var a=this.readSync(e.dataId),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return Jy(i.real,i.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=Jy(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=Jy(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=Jy(l.real,l.imag).mul(u),f=i.add(c),d=i.sub(c),h=Zy(f).concat(Zy(d)),p=ex(f).concat(ex(d));return Jy(h,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=_w(o*s,t,n),l=Rw(e,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}n&&(a/=t,i/=t),Iw(r,a,i,o)}return r},t.prototype.depthToSpace=function(e,t,n){ym("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),ym(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,l=i/(t*t),c=this.readSync(e.dataId),f=new Float32Array(r*s*u*l),d=0,h=0;h<r;++h)for(var p=0;p<s;++p)for(var v=Math.floor(p/t),m=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),x=(m*t+g%t)*l,b=0;b<l;++b){var w=b+x+i*(y+a*(v+o*h));f[d++]=c[w]}return sx(f,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=qx(e.shape,t.shape),a=bx(o,n),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Hx(e.shape,o),l=Hx(t.shape,o),c=a.values;if(u.length+l.length===0)for(var f=0;f<c.length;++f)c[f]=r(i[f%i.length],s[f%s.length]);else{var d=this.bufferSync(e),h=this.bufferSync(t),p=function(n){var o=a.indexToLoc(n),f=o.slice(-e.rank);u.forEach(function(e){return f[e]=0});var p=d.locToIndex(f),v=o.slice(-t.rank);l.forEach(function(e){return v[e]=0});var m=h.locToIndex(v);c[n]=r(i[p],s[m])};for(f=0;f<c.length;++f)p(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=qx(e.shape,t.shape),o=bx(r,"float32"),a=bx(r,"float32"),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Hx(e.shape,r),l=Hx(t.shape,r),c=o.values,f=a.values;if(u.length+l.length===0)for(var d=0;d<c.length;d++){var h=d%i.length,p=d%s.length,v=n(i[2*h],i[2*h+1],s[2*p],s[2*p+1]);c[d]=v.real,f[d]=v.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),d=a.slice(-e.rank);u.forEach(function(e){return d[e]=0});var h=m.locToIndex(d),p=a.slice(-t.rank);l.forEach(function(e){return p[e]=0});var v=g.locToIndex(p),y=n(i[2*h],i[2*h+1],s[2*v],s[2*v+1]);c[r]=y.real,f[r]=y.imag};for(d=0;d<c.length;d++)y(d)}return this.complex(o.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return Bw(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],f=t.shape[0],d=r[0],h=r[1],p=bx([f,d,h,c],"float32"),v=this.readSync(t.dataId),m=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,x=p.strides,b=0;b<f;b++){var w=4*b,C=v[w],E=v[w+1],k=v[w+2],S=v[w+3],R=m[b];if(!(R>=s))for(var I=d>1?(k-C)*(u-1)/(d-1):0,_=h>1?(S-E)*(l-1)/(h-1):0,N=0;N<d;N++){var T=d>1?C*(u-1)+N*I:.5*(C+k)*(u-1);if(T<0||T>u-1)for(var A=0;A<h;A++)for(var D=0;D<c;D++){var O=D+A*x[2]+N*x[1]+b*x[0];p.values[O]=a}else if("bilinear"===o){var F=Math.floor(T),P=Math.ceil(T),M=T-F;for(A=0;A<h;A++)if((G=h>1?E*(l-1)+A*_:.5*(E+S)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*x[2]+N*x[1]+b*x[0],p.values[O]=a;else{var B=Math.floor(G),L=Math.ceil(G),W=G-B;for(D=0;D<c;D++){var z=g[O=D+B*y[2]+F*y[1]+R*y[0]],U=g[O=D+L*y[2]+F*y[1]+R*y[0]],j=g[O=D+B*y[2]+P*y[1]+R*y[0]],V=z+(U-z)*W,H=j+(g[O=D+L*y[2]+P*y[1]+R*y[0]]-j)*W;O=D+A*x[2]+N*x[1]+b*x[0],p.values[O]=V+(H-V)*M}}}else for(A=0;A<h;++A){var G;if((G=h>1?E*(l-1)+A*_:.5*(E+S)*(l-1))<0||G>l-1)for(D=0;D<c;D++)O=D+A*x[2]+N*x[1]+b*x[0],p.values[O]=a;else{var q=Math.round(G),K=Math.round(T);for(D=0;D<c;D++){var X=D+q*y[2]+K*y[1]+R*y[0],$=D+A*x[2]+N*x[1]+b*x[0];p.values[$]=g[X]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var o=$b(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(e,t,n,l,s,i,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=Gb(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return tx([],a,e.dtype);for(var l=new ug([i,s],e.dtype),c=this.readSync(t.dataId),f=this.readSync(e.dataId),d=0;d<i;d++){for(var h=[],p=0,v=0;v<r;v++){var m=c[d*r+v];p+=m*u[v],h.push(m)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[d*s+g]=f[p*s+g]}return l.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=$b(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=rx(0);return this.scatter(e,t,n,u,i,a,o,s,l,!0)},t.prototype.fill=function(e,t,n){var r=Om(n=n||Vm(t),Cm(e));return r.fill(t),_g.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=Om(e.dtype,Cm(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return kw(e,t,n)},t.prototype.scatter=function(e,t,n,r,o,a,i,s,u,l){var c=[r/o,o],f=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return tx([],n,t.dtype);var h=new ug(c,t.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var v=[],m=0,g=0;g<i;g++){var y=f[p*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var x=0;x<o;x++)l?h.values[m*o+x]+=d[p*o+x]:h.values[m*o+x]=0===t.rank?d[0]:d[p*o+x]}return h.toTensor().reshape(n)},t}(uw);function JI(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,o=n.backend,a=r,i=a.a,s=a.b,u=o;KI([i,s],e);var l=u.data.get(i.dataId).values,c=u.data.get(s.dataId).values,f=t(i.shape,s.shape,l,c,i.dtype),d=f[0],h=f[1];return{dataId:u.write(d,h,i.dtype),shape:h,dtype:i.dtype}}}}function ZI(e){return function(t,n,r,o,a){var i=qx(t,n),s=i.length,u=qm(i),l=Dm(a,Cm(i)),c=t.length,f=n.length,d=qm(t),h=qm(n),p=Hx(t,i),v=Hx(n,i);if(p.length+v.length===0)for(var m=0;m<l.length;++m)l[m]=e(r[m%r.length],o[m%o.length]);else{var g=function(t){var n=ng(t,s,u),a=n.slice(-c);p.forEach(function(e){return a[e]=0});var i=tg(a,c,d),m=n.slice(-f);v.forEach(function(e){return m[e]=0});var g=tg(m,f,h);l[t]=e(r[i],o[g])};for(m=0;m<l.length;++m)g(m)}return[l,i]}}_g.registerBackend("cpu",function(){return new QI},1);var e_=ZI(function(e,t){return e/t}),t_=JI(Mx,e_),n_={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;KI(o,"MaxPoolWithArgmax");var f=c.data.get(o.dataId).values,d=cw(o.shape,i,s,[1,1],u),h=function(e,t,n,r,o){var a=XI(e,0,n,qm(t),o,"max"),i=$I(e,t,n,o,!0,r);return[a.values,i.values]}(f,o.shape,o.dtype,l,d),p=h[0],v=h[1],m=c.write(p,d.outShape,o.dtype),g=c.write(v,d.outShape,o.dtype);return[{dataId:m,shape:d.outShape,dtype:o.dtype},{dataId:g,shape:d.outShape,dtype:"int32"}]}},r_={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,d=n;KI(a,"NonMaxSuppressionWithScore");var h=Dw(d.data.get(a.dataId).values,d.data.get(i.dataId).values,u,l,c,f);return[h.selectedIndices,h.selectedScores]}},o_={kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;KI(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},a_=ZI(function(e,t){var n=e-t;return n*n});function i_(e,t,n,r,o){for(var a=Cm(t),i=t.length,s=qm(t),u=qm(o),l=Dm(n,Cm(o)),c=0;c<a;++c){for(var f=ng(c,i,s),d=new Array(f.length),h=0;h<d.length;h++)d[h]=f[r[h]];l[tg(d,i,u)]=e[c]}return l}for(var s_=0,u_=[r_,o_,JI(Bx,a_),t_,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n.perm,i=r;KI(o,"transpose");for(var s=o.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=o.shape[a[l]];var c=i_(i.data.get(o.dataId).values,o.shape,o.dtype,a,u);return{dataId:i.write(c,u,o.dtype),shape:u,dtype:o.dtype}}},n_];s_<u_.length;s_++)fm(u_[s_]);for(var l_,c_=function(e){this.variableNames=["A"];var t=qw(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},f_=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=qw(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},d_=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=aC(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},h_=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=aC(this.rank),a=Hw("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},p_=0,v_=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,a=r.numChannels,i="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],f=[c,l],d=[c,l,a];(s||i)&&(null==l_&&(l_=document.createElement("canvas").getContext("2d")),l_.canvas.width=l,l_.canvas.height=c,l_.drawImage(o,0,0,l,c),o=l_.canvas);var h=n.makeTensorInfo(f,"int32");n.texData.get(h.dataId).usage=Dg.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),o);var p=om().getBool("WEBGL_PACK")?new f_(d):new c_(d),v=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),v}},{kernelName:Mx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;return function(e,t,n){var r=new yC("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return om().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new bC("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",e.shape,t.shape,!0)),n.runWebGLProgram(r,[e,t],"float32")}(r.a,r.b,n)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;My("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,d=n,h=Dw(d.readSync(a.dataId),d.readSync(i.dataId),u,l,c,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,a=new ek(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Bx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n,s=om().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bC("return (a - b) * (a - b);",o.shape,a.shape):new yC("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,o=e.backend,a=n.x,i=r.perm,s=o,u=a.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=a.shape[i[c]];if(s.shouldExecuteOnCPU([a])){var f=i_(s.texData.get(a.dataId).values,a.shape,a.dtype,i,l);t=s.makeTensorInfo(l,a.dtype),s.texData.get(t.dataId).values=f}else t=function(e,t,n){var r=om().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new h_(e.shape,t):new d_(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}(a,i,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;ym(4===o.shape.length,function(){return"Error in maxPool: input must be rank 4 but got rank "+o.shape.length+"."});var f=[1,1];ym(bw(s,f),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+f+"'"});var d=cw(o.shape,i,s,f,u),h=function(e,t,n,r){var o=new TE(n,"max",!1),a=r.runWebGLProgram(o,[e],"float32");return o=new TE(n,"max",!0,!0,t),[a,r.runWebGLProgram(o,[e],"float32")]}(o,l,d,c);return[h[0],h[1]]}}];p_<v_.length;p_++)fm(v_[p_]);for(var m_=0,g_=[{kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=qx(n.shape,r.shape);return{a:function(){var t=e,r=Gx(n.shape,o);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},b:function(){var t=e,n=Gx(r.shape,o);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n}},{kernelName:Lx,gradFunc:function(e,t,n){for(var r=n,o=r.inputShape,a=r.shape,i=Array.from(a),s=o.length-1;s>=0;s--)if(o[s]===a[s])i[s]=1;else if(1!==o[s])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<i.length;s++)i[s]>1&&u.push(s);return{x:function(){return e.sum(u,!0)}}}},{kernelName:Mx,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=qx(n.shape,r.shape);return{a:function(){var t=Hb(e,r.toFloat()),a=Gx(n.shape,o);return a.length>0?LR(t,a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=Gx(r.shape,o);a.length>0&&(t=LR(t,a).reshape(r.shape));var i=_S(r);return fb(Hb(t,i.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,o=t[0],a=t[1],i=t[2],s=t[3],u=zk(o),l=null==s?rx(1):s,c=Gx(a.shape,u.shape),f=[];if(1===a.rank){for(var d=0;d<u.shape.length-1;++d)f.push(u.shape[d]);f.push(1)}var h=jb(o,a),p=Bb(e,l),v=pb(Vx(i,rx(r))),m=Bb(Bb(Bb(v,v),v),rx(-.5));return{x:function(){return 1===a.rank?Rx(Bb(Bb(e,lS(v.as4D(1,1,1,a.shape[0]),f)),l),o.shape):Rx(Bb(Bb(e,v),l),o.shape)},mean:function(){var e=Bb(Bb(v,rx(-1)),p);return 1===a.rank&&(e=LR(e,c)),Rx(e,a.shape)},variance:function(){var e=Bb(Bb(m,h),p);return 1===a.rank&&(e=LR(e,c)),Rx(e,a.shape)},scale:function(){var t=Bb(h,v),n=Bb(e,t);return 1===a.rank&&(n=LR(n,c)),Rx(n,a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=LR(t,c)),Rx(t,a.shape)}}}},{kernelName:zx,gradFunc:function(e){return{x:function(){return e.toFloat()}}}},{kernelName:Wx,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return lx(n.shape,"float32")}}}},{kernelName:jx,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],o=n.paddings.map(function(e){return e[0]});return{x:function(){return e.slice(o,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Bx,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=rx(2);return{a:function(){return Bb(e,Bb(o,jb(n,r)))},b:function(){return Bb(e,Bb(o,jb(r,n)))}}}},{kernelName:Ux,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],o=n.reps;return{x:function(){var t=hx(r);if(1===r.rank)for(var n=0;n<o[0];++n)t=t.add(e.slice([n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<o[0];++n)for(var a=0;a<o[1];++a)t=t.add(e.slice([n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(var i=0;i<o[2];++i)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(i=0;i<o[2];++i)for(var s=0;s<o[3];++s)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=Ky(n.perm);return{x:function(){return iw(e,r)}}}}];m_<g_.length;m_++)dm(g_[m_]);var y_=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();om().get("IS_BROWSER")&&om().setPlatform("browser",new y_);var x_,b_=function(){function e(){this.util=n(184),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=om().global.fetch?om().global.fetch(e,t):(null==x_&&(x_=n(531)),x_(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();om().get("IS_NODE")&&om().setPlatform("node",new b_);var w_={float32:4,int32:4,uint16:2,uint8:1,bool:1};function C_(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=Cm(i),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=w_[l.dtype],f=e.slice(r,r+s*c),d="uint8"===l.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(d,function(e){return e*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(d,function(e){return Math.round(e*l.scale+l.min)})}r+=s*c}else if("string"===a){var h=Cm(t.shape);u=[];for(var p=0;p<h;p++){var v=new Uint32Array(e.slice(r,r+4))[0];r+=4;var m=new Uint8Array(e.slice(r,r+v));u.push(m),r+=v}}else{var g=w_[a];if(f=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(f)}r+=s*g}n[o]=tx(u,i,a)},a=0,i=t;a<i.length;a++)o(i[a]);return n}function E_(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var k_="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function S_(e){return k_?Buffer.byteLength(e):new Blob([e]).size}function R_(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function I_(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function __(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:S_(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:S_(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var N_=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),T_="://",A_=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){ym(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(T_)&&(t=t.slice(0,t.indexOf(T_))),ym(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();ym(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function D_(e){if(-1===e.indexOf(T_))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+A_.getSchemes().join(","));return{scheme:e.split(T_)[0],path:e.split(T_)[1]}}function O_(e,t,n){return void 0===n&&(n=!1),tm(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f;return nm(this,function(d){switch(d.label){case 0:return ym(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),ym((r=N_.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),ym(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],ym((a=N_.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),ym(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=D_(e).scheme,u=D_(e).path,l=s===D_(e).scheme,[4,o.load()];case 1:return c=d.sent(),n&&l?[4,A_.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,i.save(c)];case 4:return f=d.sent(),!n||l?[3,6]:[4,A_.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var F_="models_store",P_="model_info_store";function M_(){if(!om().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function B_(e){var t=e.result;t.createObjectStore(F_,{keyPath:"modelPath"}),t.createObjectStore(P_,{keyPath:"modelPath"})}var L_=function(){function e(e){if(this.indexedDB=M_(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return B_(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(F_,"readonly"),s=i.objectStore(F_).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=__(t),c=a.transaction(P_,"readwrite"),f=c.objectStore(P_),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:l});d.onsuccess=function(){var o=(u=a.transaction(F_,"readwrite")).objectStore(F_).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});o.onsuccess=function(){return e({modelArtifactsInfo:l})},o.onerror=function(e){var t=(f=c.objectStore(P_)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},d.onerror=function(e){return a.close(),r(d.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),W_=function(e){return om().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(L_.URL_SCHEME)?(t=e.slice(L_.URL_SCHEME.length),new L_(t)):null;var t};N_.registerSaveRouter(W_),N_.registerLoadRouter(W_);var z_=function(){function e(){this.indexedDB=M_()}return e.prototype.listModels=function(){return tm(this,void 0,void 0,function(){var e=this;return nm(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return B_(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(P_,"readonly"),a=o.objectStore(P_).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return tm(this,void 0,void 0,function(){var t=this;return nm(this,function(n){var r;return e=(r=e).startsWith(L_.URL_SCHEME)?r.slice(L_.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return B_(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(P_,"readwrite"),s=i.objectStore(P_),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(F_,"readwrite")).objectStore(F_).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if(om().getBool("IS_BROWSER"))try{A_.registerManager(L_.URL_SCHEME,new z_)}catch(po){}var U_="/",j_="tensorflowjs_models",V_="info",H_="model_topology",G_="weight_specs",q_="weight_data",K_="model_metadata";function X_(e){return{info:[j_,e,V_].join(U_),topology:[j_,e,H_].join(U_),weightSpecs:[j_,e,G_].join(U_),weightData:[j_,e,q_].join(U_),modelMetadata:[j_,e,K_].join(U_)}}function $_(e){var t=e.split(U_);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(U_)}var Y_=function(){function e(e){if(!om().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=X_(this.modelPath)}return e.prototype.save=function(e){return tm(this,void 0,void 0,function(){var t,n,r;return nm(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=__(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(k_)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return tm(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return nm(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(k_){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),Q_=function(e){return om().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Y_.URL_SCHEME)?(t=e.slice(Y_.URL_SCHEME.length),new Y_(t)):null;var t};N_.registerSaveRouter(Q_),N_.registerLoadRouter(Q_);var J_=function(){function e(){ym(om().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),ym("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return tm(this,void 0,void 0,function(){var e,t,n,r,o,a;return nm(this,function(i){for(e={},t=j_+U_,n=U_+V_,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=$_(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return tm(this,void 0,void 0,function(){var t,n;return nm(this,function(r){var o;if(e=(o=e).startsWith(Y_.URL_SCHEME)?o.slice(Y_.URL_SCHEME.length):o,t=X_(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(om().getBool("IS_BROWSER"))try{A_.registerManager(Y_.URL_SCHEME,new J_)}catch(po){}function Z_(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var eN=function(){function e(t){if(!om().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return tm(this,void 0,void 0,function(){var t,n,r,o,a,i;return nm(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,Z_(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,Z_(function(){return i.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:__(e)}]}})})},e.URL_SCHEME="downloads://",e}(),tN=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return tm(this,void 0,void 0,function(){var e,t,n=this;return nm(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var c=[],f=[],d=[];u.forEach(function(e){e.paths.forEach(function(e){f.push(e),d.push(null)}),c.push.apply(c,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=f.indexOf(e);d[o]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:R_(d),format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,userDefinedMetadata:i.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return I_(e.name)}),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach(function(e){var a=I_(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function nN(e,t,n,r){!function(e){ym(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){ym(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),ym(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),ym(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var i=n+ ++o/e.length*(r-n);return t(i),a}),a}))}function rN(e,t){return tm(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return nm(this,function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?om().platform.fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit,{isBinary:!0})}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=f.sent(),[3,4];case 2:return[4,nN(r,t.onProgress,o,a)];case 3:i=f.sent(),f.label=4;case 4:return s=i.map(function(e){return e.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=f.sent(),[3,8];case 6:return[4,nN(s,t.onProgress,u,l)];case 7:c=f.sent(),f.label=8;case 8:return[2,c]}})})}function oN(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),tm(t,void 0,void 0,function(){var t,a,i,s,u,l,c,f,d,h;return nm(this,function(p){switch(p.label){case 0:if(t=n.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,l=w_[u]*Cm(e.shape),c=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=o?o.forEach(function(t,n){t===e.name&&(c(),i[n]=!0)}):c(),s.push(e.name),r+=l})}),!i.every(function(e){return e}))throw u=o.filter(function(e,t){return!i[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),c=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)})}),[4,e(c)];case 1:return f=p.sent(),d={},h=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=f[h+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,l=0;l<t;l++){var c=new Uint8Array(f[h+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(e){var t=C_(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]}),h+=t}),[2,d]}})})}}N_.registerSaveRouter(function(e){return om().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(eN.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new eN(e)}(e.slice(eN.URL_SCHEME.length)):null});var aN=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(ym("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=om().platform.fetch,ym(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&ym(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return tm(this,void 0,void 0,function(){var t,n,r,o;return nm(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:__(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return tm(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s,u,l,c,f;return nm(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,e.json()];case 3:return t=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,i=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:f=d.sent(),l=f[0],c=f[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:c,userDefinedMetadata:u,generatedBy:a,convertedBy:i,format:s}]}})})},e.prototype.loadWeights=function(e){return tm(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f;return nm(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,u=e;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],e.forEach(function(e){e.paths.forEach(function(e){c.push(a+e+o)})}),[4,rN(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[i,R_(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function iN(e){return null!=e.match(aN.URL_SCHEME_REGEX)}var sN=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return iN(e)}):iN(e))?uN(e,{onProgress:t}):null};function uN(e,t){return new aN(e,t)}N_.registerSaveRouter(sN),N_.registerLoadRouter(sN);var lN,cN=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){return[2,this.modelArtifacts]})})},e}(),fN=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(t){return[2,this.saveHandler(e)]})})},e}(),dN=Object.freeze({browserFiles:function(e){return new tN(e)},browserHTTPRequest:function(e,t){return uN(e,t)},concatenateArrayBuffers:R_,decodeWeights:C_,encodeWeights:function(e,t){return tm(this,void 0,void 0,function(){var n,r,o,a,i,s=this;return nm(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),a=function(a){var i=o[a],u=Array.isArray(e)?e[a].tensor:e[i];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+u.dtype);var l={name:i,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(e){return tm(s,void 0,void 0,function(){var t,n,r,o,a,i,s;return nm(this,function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(t=l.sent(),n=t.reduce(function(e,t){return e+t.length},0)+4*t.length,r=new Uint8Array(n),o=0,a=0;a<t.length;a++)i=t[a],s=new Uint8Array(new Uint32Array([i.length]).buffer),r.set(s,o),o+=4,r.set(i,o),o+=i.length;return e(r),[2]}})})});r.push(c)}else r.push(u.data());null!=t&&(l.group=t),n.push(l)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:E_(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new cN(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cN({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cN({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return N_.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:__,getSaveHandlers:function(e){return N_.getSaveHandlers(e)},http:uN,isHTTPScheme:iN,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),tm(this,void 0,void 0,function(){return nm(this,function(o){return[2,oN(function(e){return rN(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return N_.registerLoadRouter(e)},registerSaveRouter:function(e){return N_.registerSaveRouter(e)},weightsLoaderFactory:oN,withSaveHandler:function(e){return new fN(e)},copyModel:function(e,t){return tm(this,void 0,void 0,function(){return nm(this,function(n){return[2,O_(e,t,!1)]})})},listModels:function(){return tm(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return nm(this,function(s){switch(s.label){case 0:e=A_.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,A_.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+T_+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return tm(this,void 0,void 0,function(){return nm(this,function(n){return[2,O_(e,t,!0)]})})},removeModel:function(e){return tm(this,void 0,void 0,function(){var t;return nm(this,function(n){return t=D_(e),[2,A_.getManager(t.scheme).removeModel(t.path)]})})}}),hN=Qy({confusionMatrix_:function(e,t,n){var r=Wy(e,"labels","confusionMatrix"),o=Wy(t,"predictions","confusionMatrix");ym(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),ym(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),ym(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),ym(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),ym(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=dS(r.asType("int32"),n),i=dS(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}}),pN=(Object.freeze({confusionMatrix:hN}),Qy({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);i=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=um("FromPixels",_g.backendName))return _g.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],f=l[1];if(i?s=e.getContext("2d").getImageData(0,0,c,f).data:r||n?s=e.data:(a||o)&&(null==lN&&(lN=document.createElement("canvas").getContext("2d")),lN.canvas.width=c,lN.canvas.height=f,lN.drawImage(e,0,0,c,f),s=lN.getImageData(0,0,c,f).data),4===t)u=new Int32Array(s);else{var d=c*f;u=new Int32Array(d*t);for(var h=0;h<d;h++)for(var p=0;p<t;++p)u[h*t+p]=s[4*h+p]}return ix(u,[f,c,t],"int32")}})),vN=Object.freeze({toPixels:function(e,t){return tm(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,h,p,v,m,g,y,x,b,w,C,E,k;return nm(this,function(S){switch(S.label){case 0:if(n=Wy(e,"img","toPixels"),e instanceof dg||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,n.data()];case 1:return s=S.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=S.sent(),f=c[0],d=c[1],h=f[0],p=d[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(v="float32"===n.dtype?255:1,m=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)y=void 0,x=void 0,b=void 0,w=void 0,1===i?(y=s[g]*v,x=s[g]*v,b=s[g]*v,w=255):3===i?(y=s[3*g]*v,x=s[3*g+1]*v,b=s[3*g+2]*v,w=255):4===i&&(y=s[4*g]*v,x=s[4*g+1]*v,b=s[4*g+2]*v,w=s[4*g+3]*v),m[0+(C=4*g)]=Math.round(y),m[C+1]=Math.round(x),m[C+2]=Math.round(b),m[C+3]=Math.round(w);return null!=t&&(t.width=a,t.height=o,E=t.getContext("2d"),k=new ImageData(m,a,o),E.putImageData(k,0,0)),n!==e&&n.dispose(),[2,m]}})})},fromPixels:pN}),mN=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),gN=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function yN(e){ym(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),ym("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),ym(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),gN.register(e)}Object.freeze({Serializable:mN,SerializationMap:gN,registerClass:yN}),Object.freeze({gpgpu_util:vE,webgl_util:Ay,forceHalfFloat:function(){om().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:_k,setWebGLContext:Mg,GPGPUContext:mE});var xN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return em(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;if(null!=n){var i=n.map(function(e){return{name:e.name,tensor:a[e.name]}});this.applyGradients(i)}else this.applyGradients(a);return Py(a),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){ym(Hm(e),function(){return"The f passed in variableGrads(f) must be a function"}),ym(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof yg}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],_g.registeredVariables)t.push(_g.registeredVariables[r]);var o=n?t.filter(function(e){return!e.trainable}):null,a=t.length;ym((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=_g.gradients(e,t,null,!0),s=i.value,u=i.grads;ym(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),ym(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(e,t){null!=u[t]&&(l[e.name]=u[t])}),null!=o&&o.forEach(function(e){return l[e.name]=null}),{value:s,grads:l}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Py(this.iterations_)},t.prototype.saveIterations=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:rx(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return tm(this,void 0,void 0,function(){var t;return nm(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(mN);Object.defineProperty(xN,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var bN=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=_g.backend.epsilon()),o}return em(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=_g.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Fy(function(){return hx(o).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Fy(function(){return hx(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Fy(function(){var e=i.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(i.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));i.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Py(this.accumulatedGrads.map(function(e){return e.variable})),Py(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){var e;return nm(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){var t;return nm(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(xN);yN(bN);var wN=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return em(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=_g.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Fy(function(){return cx(o.shape,t.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable;Fy(function(){var e=i.add(a.square());i.assign(e);var n=a.div(e.add(_g.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Py(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(xN);yN(wN);var CN=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Fy(function(){a.accBeta1=rx(n).variable(),a.accBeta2=rx(r).variable()}),null==o&&(a.epsilon=_g.backend.epsilon()),a}return em(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Fy(function(){var r=jb(1,t.accBeta1),o=jb(1,t.accBeta2);n.forEach(function(n,a){var i=_g.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Fy(function(){return hx(i).variable(!1)})}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Fy(function(){return hx(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedSecondMoment[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=c.div(r),h=f.div(o);u.assign(c),l.assign(f);var p=d.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(i);i.assign(p)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Py(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Py(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){var e;return nm(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){var t,n=this;return nm(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Fy(function(){n.accBeta1.assign(Wb(n.beta1,n.iterations_+1)),n.accBeta2.assign(Wb(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(xN);yN(CN);var EN=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Fy(function(){i.iteration=rx(0).variable(),i.accBeta1=rx(n).variable()}),null==o&&(i.epsilon=_g.backend.epsilon()),i}return em(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Fy(function(){var r=jb(1,t.accBeta1),o=Hb(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,a){var i=_g.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:hx(i).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:hx(i).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedWeightedInfNorm[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2),d=s.abs(),h=f.maximum(d);u.assign(c),l.assign(h);var p=o.div(r).mul(c.div(h.add(t.epsilon))).add(i);i.assign(p)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Py(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Py(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(xN);yN(EN);var kN=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return em(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=_g.registeredVariables[n];Fy(function(){var e=t.c.mul(o).add(a);a.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return _g.keep(e)}(rx(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(xN);yN(kN);var SN=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=rx(o.momentum),o}return em(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=_g.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Fy(function(){return hx(o).variable(!1)})});var a=t.accumulations[r].variable,i=Array.isArray(e)?e[r].tensor:e[n];null!=i&&Fy(function(){var e,n=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(n.mul(t.m))).add(o):t.c.mul(n).add(o),a.assign(n),o.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Py(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){return nm(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){return nm(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(kN);yN(SN);var RN=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;if(i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=_g.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return em(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=_g.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Fy(function(){return hx(o).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Fy(function(){return hx(o).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Fy(function(){return hx(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Fy(function(){var e=i.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),l=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));i.assign(e),n.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var f=i.mul(t.decay).add(a.square().mul(1-t.decay));l=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),i.assign(f),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Py(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Py(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Py(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return tm(this,void 0,void 0,function(){var e;return nm(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return tm(this,void 0,void 0,function(){var t;return nm(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(xN);yN(RN);var IN=function(){function e(){}return e.sgd=function(e){return new kN(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new SN(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new RN(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new CN(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new bN(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new EN(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new wN(e,t)},e}();IN.sgd,IN.momentum,IN.adadelta,IN.adagrad,IN.rmsprop,IN.adamax,IN.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;dg.prototype.add=function(e){return Vx(this,e)},dg.prototype.broadcastTo=function(e){return eS(this,e)},dg.prototype.div=function(e){return Hb(this,e)},dg.prototype.divNoNan=function(e){return uS(this,e)},dg.prototype.squaredDifference=function(e){return NS(this,e)},dg.prototype.tile=function(e){return lS(this,e)},dg.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),dS(this,e,t,n)},dg.prototype.transpose=function(e){return iw(this,e)},dg.prototype.pad=function(e,t){return hS(this,e,t)},dg.prototype.batchNorm=function(e,t,n,r,o){return Hk(this,e,t,n,r,o)},cg=qI;var _N=function(){function e(e,t){if(!LN(e)||!LN(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}(),NN=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}();function TN(e,t){return e instanceof dg&&e.shape.length===t}function AN(e){return TN(e,3)}function DN(e){return TN(e,4)}function ON(e){return e%2===0}function FN(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function PN(e){return e&&e.width&&e.height}function MN(e){return e.reduce(function(e,t){return e.add(t)},new NN(0,0)).div(new NN(e.length,e.length))}function BN(e,t,n){return Array(e).fill(0).map(function(e,r){return t+r*n})}function LN(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function WN(e){return LN(e)&&0<=e&&e<=1}var zN,UN=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(LN),a=[r.x,r.y,r.width,r.height].every(LN);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],l=i[2],c=i[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(LN)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new NN(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new NN(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new NN(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new NN(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.round(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.floor(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(n-=i/2,o+=i),a<o&&(r-=i/2,a+=i),new e({x:n,y:r,width:o,height:a})},e.prototype.rescale=function(t){var n=PN(t)?t.width:t,r=PN(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,a=r.y,i=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(a,0),c=i-u,f=s-l;return new e({x:u,y:l,width:Math.min(c,t-u),height:Math.min(f,n-l)}).floor()},e.prototype.shift=function(t,n){var r=this.width,o=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:o})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,o=n,a=r,i=this.left,s=this.top,u=this.right,l=this.bottom;return u>t&&(o=-u+t+n,u=t),l>e&&(a=-l+e+r,l=e),i<1&&(a=2-i,i=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:o,y:s,ey:l,x:i,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),jN=function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:o},a)||this}return uo(t,e),t}(UN),VN=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return uo(t,e),t.assertIsValidLabeledBox=function(e,t){if(UN.assertIsValidBox(e,t),!LN(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(UN),HN=function(){function e(e,t,n,r,o){this._imageDims=new _N(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new UN(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new UN(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),GN=(function(e){function t(t,n,r,o){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=o,a}uo(t,e),t.assertIsValidPredictedBox=function(e,t){if(VN.assertIsValidLabeledBox(e,t),!WN(e.score)||!WN(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(VN),function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:o},a)||this}return uo(t,e),t}(UN));function qN(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function KN(e){var t="";if(!e)try{e=n(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(r){t=r.toString()}return{readFile:e?function(t){return new Promise(function(n,r){e.readFile(t,function(e,t){return e?r(e):n(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function XN(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=KN();return lo({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},o)}function $N(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}function YN(){return"object"===typeof n.g&&"undefined"!==typeof process&&!!process.version}function QN(e){zN=e}function JN(){$N()&&QN(qN()),YN()&&QN(XN())}var ZN,eT={getEnv:function(){if(!zN)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return zN},setEnv:QN,initialize:JN,createBrowserEnv:qN,createFileSystem:KN,createNodejsEnv:XN,monkeyPatch:function(e){if(zN||JN(),!zN)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?zN.Canvas:t,r=e.Image,o=void 0===r?zN.Image:r;zN.Canvas=n,zN.Image=o,zN.createCanvasElement=e.createCanvasElement||function(){return new n},zN.createImageElement=e.createImageElement||function(){return new o},zN.ImageData=e.ImageData||zN.ImageData,zN.Video=e.Video||zN.Video,zN.fetch=e.fetch||zN.fetch,zN.readFile=e.readFile||zN.readFile},isBrowser:$N,isNodejs:YN};function tT(e){return eT.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function nT(e){var t=eT.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=tT(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}JN(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(ZN||(ZN={}));var rT=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,o=e.fontSize,a=e.fontStyle,i=e.padding;this.anchorPosition=t||ZN.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=i||4},oT=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new rT(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(t){return e.measureText(t).width}).reduce(function(e,t){return e<t?t:e},0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===ZN.BOTTOM_RIGHT||n===ZN.TOP_RIGHT,o=n===ZN.BOTTOM_LEFT||n===ZN.BOTTOM_RIGHT,a=this.measureWidth(e),i=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,u=o?this.anchor.y-i:this.anchor.y;if(t){var l=t.width,c=t.height;return{x:Math.max(Math.min(s,l-a),0),y:Math.max(Math.min(u,c-i),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=tT(e),n=nT(t),r=this.options,o=r.backgroundColor,a=r.fontColor,i=r.fontSize,s=r.fontStyle,u=r.padding;n.font=i+"px "+s;var l=this.measureWidth(n),c=this.measureHeight();n.fillStyle=o;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,l,c),n.fillStyle=a,this.text.forEach(function(e,t){var r=u+f.x,o=u+f.y+(t+1)*i;n.fillText(e,r,o)})},e}(),aT=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:ZN.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new rT(Object.assign({},a,o))},iT=function(){function e(e,t){void 0===t&&(t={}),this.box=new UN(e),this.options=new aT(t)}return e.prototype.draw=function(e){var t=nT(e),n=this.options,r=n.boxColor,o=n.lineWidth,a=this.box,i=a.x,s=a.y,u=a.width,l=a.height;t.strokeStyle=r,t.lineWidth=o,t.strokeRect(i,s,u,l);var c=this.options.label;c&&new oT([c],{x:i-o/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function sT(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Fy(function(){var o=Vx(QS(e,t.filters,[1,1],n),t.bias);return r?VR(o):o})}function uT(e,t){Object.keys(e).forEach(function(n){t.some(function(e){return e.originalPath===n})||e[n].dispose()})}function lT(e,t){return function(n,r,o,a){var i=sx(e(n*r*o*o),[o,o,n,r]),s=ox(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function cT(e,t){return function(n,r,o){var a=ax(e(n*r),[n,r]),i=ox(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var fT=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function dT(e,t){return function(n,r,o){var a=sx(e(9*n),[3,3,n,1]),i=sx(e(n*r),[1,1,n,r]),s=ox(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new fT(a,i,s)}}function hT(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new fT(n,r,o)}}function pT(e,t){return function(n,r,o){var a=e[n];if(!TN(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:o||n}),a}}function vT(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function mT(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",o=(e=e.replace(r,"")).split("/").filter(function(e){return e}),a=e.endsWith(".json")?o[o.length-1]:n,i=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:i=e.startsWith("/")?"/"+i:i,manifestUri:"/"===i?"/"+a:i+"/"+a}}function gT(e){var t=eT.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function yT(e){var t=eT.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new _N(e.naturalWidth,e.naturalHeight):e instanceof r?new _N(e.videoWidth,e.videoHeight):new _N(e.width,e.height)}function xT(e){var t=e.width,n=e.height,r=(0,eT.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function bT(e,t){var n=eT.getEnv().ImageData;if(!(e instanceof n)&&!gT(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||yT(e),o=r.width,a=r.height,i=xT({width:o,height:a});return e instanceof n?nT(i).putImageData(e,0,0):nT(i).drawImage(e,0,0,o,a),i}function wT(e,t){return co(this,void 0,void 0,function(){var n;return fo(this,function(r){switch(r.label){case 0:return[4,(0,eT.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function CT(e){return co(this,void 0,void 0,function(){return fo(this,function(t){switch(t.label){case 0:return[4,wT(e)];case 1:return[2,t.sent().json()]}})})}function ET(e,t){return co(this,void 0,void 0,function(){var n,r,o,a,i,s;return fo(this,function(u){switch(u.label){case 0:return n=t||eT.getEnv().createCanvasElement(),r=e.shape.slice(DN(e)?1:0),o=r[0],a=r[1],i=r[2],s=Fy(function(){return e.as3D(o,a,i).toInt()}),[4,vN.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function kT(e){var t=eT.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function ST(e,t){return co(this,void 0,void 0,function(){var n,r,o,a;return fo(this,function(i){switch(i.label){case 0:return n=mT(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,CT(r)];case 1:return a=i.sent(),[2,dN.loadWeights(a,o)]}})})}var RT=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(AN(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(DN(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var o=e instanceof eT.getEnv().Canvas?e:bT(e);n._canvases[t]=o,n._inputDimensions[t]=[o.height,o.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return BN(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new _N(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Fy(function(){var r=BN(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof dg){var a=DN(o)?o:o.expandDims();return a=function(e,t){return void 0===t&&(t=!1),Fy(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var a=Math.abs(r-o),i=Math.round(a*(t?.5:1)),s=r>o?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,cx(n,0)},l=u(i),c=a-l.shape[s],f=[t&&c?u(c):null,e,l].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return px(f,s)})}(a,t),a.shape[1]===e&&a.shape[2]===e||(a=BI.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(o instanceof eT.getEnv().Canvas)return vN.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=eT.getEnv(),o=r.Image,a=r.Canvas;if(!(e instanceof o||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=yT(e),s=t/Math.max(i.height,i.width),u=s*i.width,l=s*i.height,c=xT({width:t,height:t}),f=e instanceof a?e:bT(e),d=Math.abs(u-l)/2,h=n&&u<l?d:0,p=n&&l<u?d:0;return nT(c).drawImage(f,h,p,u,l),c}(o,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)}),o=Nx(r.map(function(e){return e.toFloat()})).as4D(n.batchSize,e,e,3);return o})},e}();function IT(e){return co(this,void 0,void 0,function(){var t,n,r;return fo(this,function(o){switch(o.label){case 0:if(e instanceof RT)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(tT)).forEach(function(e,r){if(!kT(e)&&!AN(e)&&!DN(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(DN(e)){var o=e.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(e){return kT(e)&&(t=e,new Promise(function(e,n){if(t instanceof eT.getEnv().Canvas||gT(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),n(e))}t.addEventListener("load",r),t.addEventListener("error",o)}));var t}))];case 1:return o.sent(),[2,new RT(r,Array.isArray(e))]}})})}var _T=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof yg})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof yg)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,r=t.tensor,o=tx(r.dataSync());r.dispose(),e.reassignParamFromPath(n,o)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return co(this,void 0,void 0,function(){return fo(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,ST(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(e){return co(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c;return fo(this,function(f){switch(f.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=eT.getEnv().readFile,n=mT(e,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,a=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},i=dN.weightsLoaderFactory(a),l=(u=JSON).parse,[4,t(r)];case 1:return s=l.apply(u,[f.sent().toString()]),[4,i(s,o)];case 2:return c=f.sent(),this.loadFromWeightMap(c),[2]}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}},{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof dg))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function NT(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function TT(e,t,n,r){void 0===r&&(r=!0);for(var o=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),a=[],i=function(){var t=o.pop();a.push(t);for(var i=o,s=[],u=0;u<i.length;u++){var l=i[u],c=e[t],f=e[l];s.push(NT(c,f,r))}o=o.filter(function(e,t){return s[t]<=n})};o.length>0;)i();return a}function AT(e,t){return Fy(function(){var n=t[0],r=t[1],o=t[2],a=cx(ho(e.shape.slice(0,3),[1]),n),i=cx(ho(e.shape.slice(0,3),[1]),r),s=cx(ho(e.shape.slice(0,3),[1]),o),u=px([a,i,s],3);return jb(e,u)})}function DT(e){return 1/(1+Math.exp(-e))}var OT,FT=function(e){return"number"===typeof e};function PT(e){return Fy(function(){var t=Bb(e,rx(.10000000149011612));return Vx(VR(jb(e,t)),t)})}function MT(e,t){return Fy(function(){var n=hS(e,[[0,0],[1,1],[1,1],[0,0]]);return n=QS(n,t.conv.filters,[1,1],"valid"),n=jb(n,t.bn.sub),n=Bb(n,t.bn.truediv),PT(n=Vx(n,t.conv.bias))})}function BT(e,t){return Fy(function(){var n=hS(e,[[0,0],[1,1],[1,1],[0,0]]);return n=oR(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),PT(n=Vx(n,t.bias))})}function LT(e,t){var n=lT(e,t);var r=dT(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,a){var i=n(r,o,3,a+"/conv"),s=function(n,r){var o=ox(e(n)),a=ox(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:a}}(o,a+"/bn");return{conv:i,bn:s}},extractSeparableConvParams:r}}function WT(e,t){var n=pT(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),o=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:o}},extractSeparableConvParams:hT(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(OT||(OT={}));var zT=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),UT=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!FT(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"===typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return FT(e.x)&&FT(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(FT)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return uo(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=MT(e,t.conv0);return n=MT(n=gR(n,[2,2],[2,2],"same"),t.conv1),n=MT(n=gR(n,[2,2],[2,2],"same"),t.conv2),n=MT(n=gR(n,[2,2],[2,2],"same"),t.conv3),n=MT(n=gR(n,[2,2],[2,2],"same"),t.conv4),n=MT(n=gR(n,[2,2],[2,2],"same"),t.conv5),n=MT(n=gR(n,[2,2],[1,1],"same"),t.conv6),sT(n=MT(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?PT(sT(e,t.conv0,"valid",!1)):BT(e,t.conv0);return n=BT(n=gR(n,[2,2],[2,2],"same"),t.conv1),n=BT(n=gR(n,[2,2],[2,2],"same"),t.conv2),n=BT(n=gR(n,[2,2],[2,2],"same"),t.conv3),n=BT(n=gR(n,[2,2],[2,2],"same"),t.conv4),n=BT(n=gR(n,[2,2],[2,2],"same"),t.conv5),n=gR(n,[2,2],[1,1],"same"),n=t.conv6?BT(n,t.conv6):n,sT(n=t.conv7?BT(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Fy(function(){var o=e.toBatchTensor(t,!1).toFloat();return o=(o=n.config.meanRgb?AT(o,n.config.meanRgb):o).div(rx(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},t.prototype.forward=function(e,t){return co(this,void 0,void 0,function(){var n;return fo(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,IT(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),co(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,h,p,v=this;return fo(this,function(m){switch(m.label){case 0:return n=new zT(t),r=n.inputSize,o=n.scoreThreshold,[4,IT(e)];case 1:return a=m.sent(),[4,this.forwardInput(a,r)];case 2:return i=m.sent(),s=Fy(function(){return Tx(i)[0].expandDims()}),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),o)];case 3:return l=m.sent(),i.dispose(),s.dispose(),c=l.map(function(e){return e.box}),f=l.map(function(e){return e.score}),d=l.map(function(e){return e.classScore}),h=l.map(function(e){return v.config.classes[e.label]}),p=TT(c.map(function(e){return e.rescale(r)}),f,this.config.iouThreshold,!0),[2,p.map(function(e){return new HN(f[e],d[e],h[e],c[e],u)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],o=WT(e,r),a=o.extractConvParams,i=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:a("conv8")};return uT(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var o,a=vT(e),i=a.extractWeights,s=a.getRemainingWeights,u=[],l=LT(i,u),c=l.extractConvParams,f=l.extractConvWithBatchNormParams,d=l.extractSeparableConvParams;if(t.withSeparableConvs){var h=r[0],p=r[1],v=r[2],m=r[3],g=r[4],y=r[5],x=r[6],b=r[7],w=r[8];o={conv0:t.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,v,"conv1"),conv2:d(v,m,"conv2"),conv3:d(m,g,"conv3"),conv4:d(g,y,"conv4"),conv5:d(y,x,"conv5"),conv6:b?d(x,b,"conv6"):void 0,conv7:w?d(b,w,"conv7"):void 0,conv8:c(w||b||x,5*n,1,"conv8")}}else h=r[0],p=r[1],v=r[2],m=r[3],g=r[4],y=r[5],x=r[6],b=r[7],w=r[8],o={conv0:f(h,p,"conv0"),conv1:f(p,v,"conv1"),conv2:f(v,m,"conv2"),conv3:f(m,g,"conv3"),conv4:f(g,y,"conv4"),conv5:f(y,x,"conv5"),conv6:f(x,b,"conv6"),conv7:f(b,w,"conv7"),conv8:c(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:o,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return co(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,d,h,p,v,m,g,y,x,b,w,C,E,k,S,R,I,_,N,T,A,D=this;return fo(this,function(O){switch(O.label){case 0:return r=t.width,o=t.height,a=Math.max(r,o),i=a/r,s=a/o,u=e.shape[1],l=this.config.anchors.length,c=Fy(function(){var t=e.reshape([u,u,l,D.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,l,4]),t.slice([0,0,0,4],[u,u,l,1]),D.withClassScores?ow(t.slice([0,0,0,5],[u,u,l,D.config.classes.length]),3):rx(0)]}),f=c[0],d=c[1],h=c[2],p=[],[4,d.array()];case 1:return v=O.sent(),[4,f.array()];case 2:m=O.sent(),g=0,O.label=3;case 3:if(!(g<u))return[3,12];y=0,O.label=4;case 4:if(!(y<u))return[3,11];x=0,O.label=5;case 5:return x<l?(b=DT(v[g][y][x][0]),!n||b>n?(w=(y+DT(m[g][y][x][0]))/u*i,C=(g+DT(m[g][y][x][1]))/u*s,E=Math.exp(m[g][y][x][2])*this.config.anchors[x].x/u*i,k=Math.exp(m[g][y][x][3])*this.config.anchors[x].y/u*s,S=w-E/2,R=C-k/2,I={row:g,col:y,anchor:x},this.withClassScores?[4,this.extractPredictedClass(h,I)]:[3,7]):[3,9]):[3,10];case 6:return A=O.sent(),[3,8];case 7:A={classScore:1,label:0},O.label=8;case 8:N=(_=A).classScore,T=_.label,p.push(lo({box:new jN(S,R,S+E,R+k),score:b,classScore:b*N,label:T},I)),O.label=9;case 9:return x++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return f.dispose(),d.dispose(),h.dispose(),[2,p]}})})},t.prototype.extractPredictedClass=function(e,t){return co(this,void 0,void 0,function(){var n,r,o,a;return fo(this,function(i){switch(i.label){case 0:return n=t.row,r=t.col,o=t.anchor,[4,e.array()];case 1:return a=i.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return a[n][r][o][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(_T);function jT(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach(function(n,r){var o=n.x,a=n.y,i=t[r];e.moveTo(i.x,i.y),e.lineTo(o,a)}),n){var r=t[t.length-1],o=t[0];if(!r||!o)return;e.moveTo(r.x,r.y),e.lineTo(o.x,o.y)}e.stroke()}var VT=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return uo(t,e),t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r);return new t(o.score,o.relativeBox,o.imageDims)},t}(HN);function HT(e){return e.detection instanceof VT}function GT(e,t){var n={detection:t};return Object.assign({},e,n)}function qT(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof VT?t.score:HT(t)?t.detection.score:void 0,r=t instanceof VT?t.box:HT(t)?t.detection.box:new UN(t),o=n?""+FN(n):void 0;new iT(r,{label:o}).draw(e)})}function KT(e,t,n){return Di(function(){var r=kd(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=ph(r,t.bias)})}function XT(e,t,n){return void 0===n&&(n=!1),Di(function(){var r=Vh(n?ph(bd(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):KT(e,t.conv0,[2,2])),o=KT(r,t.conv1,[1,1]),a=KT(Vh(ph(r,o)),t.conv2,[1,1]);return Vh(ph(r,ph(o,a)))})}function $T(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Di(function(){var o=Vh(n?ph(bd(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):KT(e,t.conv0,r?[2,2]:[1,1])),a=KT(o,t.conv1,[1,1]),i=KT(Vh(ph(o,a)),t.conv2,[1,1]),s=KT(Vh(ph(o,ph(a,i))),t.conv3,[1,1]);return Vh(ph(o,ph(a,ph(i,s))))})}function YT(e,t){var n=lT(e,t),r=dT(e,t);function o(e,t,o,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,o+"/conv0"):r(e,t,o+"/conv0"),conv1:r(t,t,o+"/conv1"),conv2:r(t,t,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var i=o(e,t,n,a);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,n+"/conv3")}}}}function QT(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function JT(e,t){var n=pT(e,t),r=QT(n),o=hT(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2"),conv3:o(e+"/conv3")}}}}var ZT=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return uo(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Di(function(){var n=$T(AT(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ts(255)),t.dense0,!0);return n=$T(n,t.dense1),n=$T(n,t.dense2),n=$T(n,t.dense3),n=Bd(n,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=JT(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return uT(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=vT(e),r=n.extractWeights,o=n.getRemainingWeights,a=YT(r,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),l=a(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:l}}}(e)},t}(_T);function eA(e,t){return Di(function(){return ph(Rd(e,t.weights),t.bias)})}function tA(e){var t={},n={};return Object.keys(e).forEach(function(r){(r.startsWith("fc")?n:t)[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var nA=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return uo(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Di(function(){var r=e instanceof RT?t.faceFeatureExtractor.forwardInput(e):e;return eA(r.as2D(r.shape[0],-1),n.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],o=vT(e),a=o.extractWeights,i=o.getRemainingWeights,s=cT(a,r)(t,n,"fc");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=tA(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=pT(e,n),o={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return uT(e,n),{params:o,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,o=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(_T),rA=["neutral","happy","sad","angry","fearful","disgusted","surprised"],oA=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);rA.forEach(function(n,r){t[n]=e[r]})}return e.prototype.asSortedArray=function(){var e=this;return rA.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),aA=function(e){function t(t){return void 0===t&&(t=new ZT),e.call(this,"FaceExpressionNet",t)||this}return uo(t,e),t.prototype.forwardInput=function(e){var t=this;return Di(function(){return pu(t.runNet(e))})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictExpressions=function(e){return co(this,void 0,void 0,function(){var t,n,r,o,a=this;return fo(this,function(i){switch(i.label){case 0:return[4,IT(e)];case 1:return t=i.sent(),[4,this.forwardInput(t)];case 2:return n=i.sent(),[4,Promise.all(Zs(n).map(function(e){return co(a,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}})})}))];case 3:return r=i.sent(),n.dispose(),o=r.map(function(e){return new oA(e)}),[2,t.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(nA);function iA(e,t){var n={expressions:t};return Object.assign({},e,n)}function sA(e,t,n,r){void 0===n&&(n=.1),(Array.isArray(t)?t:[t]).forEach(function(t){var o=t instanceof oA?t:t.expressions instanceof oA?t.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=o.asSortedArray().filter(function(e){return e.probability>n}),i=HT(t)?t.detection.box.bottomLeft:r||new NN(0,0),s=new oT(a.map(function(e){return e.expression+" ("+FN(e.probability)+")"}),i);s.draw(e)})}var uA=function(){function e(e,t,n){void 0===n&&(n=new NN(0,0));var r=t.width,o=t.height;this._imgDims=new _N(r,o),this._shift=n,this._positions=e.map(function(e){return e.mul(new NN(r,o)).add(n)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new NN(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new NN(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new NN(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof VT?e.box.floor():new UN(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=r.useDlibAlignment,a=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],o=function(e){return r.sub(e).magnitude()},a=(o(t)+o(n))/2,i=Math.floor(a/.45),s=MN(e),u=Math.floor(Math.max(0,s.x-.5*i)),l=Math.floor(Math.max(0,s.y-.43*i));return new GN(u,l,Math.min(i,this.imageWidth+u),Math.min(i,this.imageHeight+l))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map(function(e){return e.x}),n=e.map(function(e){return e.y}),r=t.reduce(function(e,t){return t<e?t:e},1/0),o=n.reduce(function(e,t){return t<e?t:e},1/0),a=t.reduce(function(e,t){return e<t?t:e},0),i=n.reduce(function(e,t){return e<t?t:e},0);return new jN(r,o,a,i)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),lA=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(MN)},t}(uA);function cA(e){return HT(e)&&e.landmarks instanceof uA&&e.unshiftedLandmarks instanceof uA&&e.alignedRect instanceof VT}function fA(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),a=e.detection.imageDims,i={landmarks:r,unshiftedLandmarks:t,alignedRect:new VT(e.detection.score,o.rescale(a.reverse()),a)};return Object.assign({},e,i)}var dA=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,o=void 0===r||r,a=e.lineWidth,i=e.lineColor,s=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=s||2,this.lineColor=i||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"},hA=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new dA(t)}return e.prototype.draw=function(e){var t=nT(e),n=this.options,r=n.drawLines,o=n.drawPoints,a=n.lineWidth,i=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof lA&&(t.strokeStyle=i,t.lineWidth=a,jT(t,this.faceLandmarks.getJawOutline()),jT(t,this.faceLandmarks.getLeftEyeBrow()),jT(t,this.faceLandmarks.getRightEyeBrow()),jT(t,this.faceLandmarks.getNose()),jT(t,this.faceLandmarks.getLeftEye(),!0),jT(t,this.faceLandmarks.getRightEye(),!0),jT(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach(function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})}},e}();function pA(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof uA?t:cA(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new hA(n).draw(e)})}function vA(e,t){var n=[],r=vT(e),o=r.extractWeights,a=r.getRemainingWeights,i=function(e,t){var n=lT(e,t),r=dT(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,o){return{separable_conv0:r(e,t,o+"/separable_conv0"),separable_conv1:r(t,t,o+"/separable_conv1"),expansion_conv:n(e,t,1,o+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(o,n),s=i.extractConvParams,u=i.extractSeparableConvParams,l=i.extractReductionBlockParams,c=i.extractMainBlockParams,f={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:l(32,64,"entry_flow/reduction_block_0"),reduction_block_1:l(64,128,"entry_flow/reduction_block_1")},d={};BN(t,0,1).forEach(function(e){d["main_block_"+e]=c(128,"middle_flow/main_block_"+e)});var h={reduction_block:l(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:d,exit_flow:h}}}function mA(e,t){var n=[],r=function(e,t){var n=pT(e,t),r=QT(n),o=hT(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),separable_conv2:o(e+"/separable_conv2")}}}}(e,n),o=r.extractConvParams,a=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:o("entry_flow/conv_in"),reduction_block_0:i("entry_flow/reduction_block_0"),reduction_block_1:i("entry_flow/reduction_block_1")},l={};BN(t,0,1).forEach(function(e){l["main_block_"+e]=s("middle_flow/main_block_"+e)});var c={reduction_block:i("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return uT(e,n),{params:{entry_flow:u,middle_flow:l,exit_flow:c},paramMappings:n}}function gA(e,t,n){return ph(bd(e,t.filters,n,"same"),t.bias)}function yA(e,t,n){void 0===n&&(n=!0);var r=n?Vh(e):e;return r=KT(r,t.separable_conv0,[1,1]),r=KT(Vh(r),t.separable_conv1,[1,1]),r=Md(r,[3,3],[2,2],"same"),r=ph(r,gA(e,t.expansion_conv,[2,2]))}var xA,bA=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return uo(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Di(function(){var r=AT(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ts(256)),o=Vh(gA(r,n.entry_flow.conv_in,[2,2]));return o=yA(o,n.entry_flow.reduction_block_0,!1),o=yA(o,n.entry_flow.reduction_block_1),BN(t._numMainBlocks,0,1).forEach(function(e){o=function(e,t){var n=KT(Vh(e),t.separable_conv0,[1,1]);return n=KT(Vh(n),t.separable_conv1,[1,1]),n=KT(Vh(n),t.separable_conv2,[1,1]),ph(n,e)}(o,n.middle_flow["main_block_"+e])}),o=yA(o,n.exit_flow.reduction_block),o=Vh(KT(o,n.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return mA(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return vA(e,this._numMainBlocks)},t}(_T);!function(e){e.FEMALE="female",e.MALE="male"}(xA||(xA={}));var wA=function(e){function t(t){void 0===t&&(t=new bA(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return uo(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Di(function(){var r=e instanceof RT?t.faceFeatureExtractor.forwardInput(e):e,o=Bd(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:eA(o,n.fc.age).as1D(),gender:eA(o,n.fc.gender)}})},t.prototype.forwardInput=function(e){var t=this;return Di(function(){var n=t.runNet(e),r=n.age,o=n.gender;return{age:r,gender:pu(o)}})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return co(this,void 0,void 0,function(){var t,n,r,o,a,i,s=this;return fo(this,function(u){switch(u.label){case 0:return[4,IT(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=Zs(n.age),o=Zs(n.gender),a=r.map(function(e,t){return{ageTensor:e,genderTensor:o[t]}}),[4,Promise.all(a.map(function(e){var t=e.ageTensor,n=e.genderTensor;return co(s,void 0,void 0,function(){var e,r,o,a,i;return fo(this,function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(o=r>.5)?xA.MALE:xA.FEMALE,i=o?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:i}]}})})}))];case 3:return i=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=vT(e),r=n.extractWeights,o=n.getRemainingWeights,a=cT(r,t),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=tA(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=pT(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return uT(e,t),{params:o,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(_T),CA=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],MN([e[3],e[4]])]},t}(uA),EA=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+FN(this.distance)+")":"")},e}(),kA=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e}();function SA(e,t){return co(this,void 0,void 0,function(){var n,r,o,a,i,s;return fo(this,function(u){switch(u.label){case 0:return n=eT.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,IT(e)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=o.getInput(0))instanceof n?(i=a,[3,4]):[3,2];case 2:return[4,ET(a)];case 3:i=u.sent(),u.label=4;case 4:r=i,u.label=5;case 5:return s=nT(r),[2,t.map(function(e){return e instanceof VT?e.forSize(r.width,r.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(r.width,r.height)}).map(function(e){var t=e.x,n=e.y,r=e.width,o=e.height,a=xT({width:r,height:o});return nT(a).putImageData(s.getImageData(t,n,r,o),0,0),a})]}})})}function RA(e,t){return co(this,void 0,void 0,function(){return fo(this,function(n){if(!AN(e)&&!DN(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(DN(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Di(function(){var n=e.shape.slice(DN(e)?1:0),r=n[0],o=n[1],a=n[2],i=t.map(function(e){return e instanceof VT?e.forSize(o,r).box:e}).map(function(e){return e.clipAtImageBorders(o,r)}).map(function(t){var n=t.x,i=t.y,s=t.width,u=t.height;return jd(e.as3D(r,o,a),[i,n,0],[u,s,a])});return i})]})})}var IA=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map(function(e){var n=e.width,r=e.height,o=t/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return Di(function(){var n=function(e,t){return Ys([us([68],e),us([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],o=n.width,a=n.height;return t(o,a)?Math.abs(o-a)/2:0},i=e.mul(us([o,136],t)).sub(Ys(Array.from(Array(o),function(e,t){return n(function(e){return a(e,function(e,t){return e<t})}(t),function(e){return a(e,function(e,t){return t<e})}(t))}))).div(Ys(Array.from(Array(o),function(e,t){return n(r[t].width,r[t].height)})));return i})},t.prototype.forwardInput=function(e){var t=this;return Di(function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map(function(e){return{height:e[0],width:e[1]}}))})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.detectLandmarks=function(e){return co(this,void 0,void 0,function(){var t,n,r,o=this;return fo(this,function(a){switch(a.label){case 0:return[4,IT(e)];case 1:return t=a.sent(),n=Di(function(){return Zs(o.forwardInput(t))}),[4,Promise.all(n.map(function(e,n){return co(o,void 0,void 0,function(){var r,o,a,i,s;return fo(this,function(u){switch(u.label){case 0:return a=(o=Array).from,[4,e.data()];case 1:return r=a.apply(o,[u.sent()]),i=r.filter(function(e,t){return ON(t)}),s=r.filter(function(e,t){return!ON(t)}),[2,new lA(Array(68).fill(0).map(function(e,t){return new NN(i[t],s[t])}),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}})})}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(nA),_A=function(e){function t(t){return void 0===t&&(t=new ZT),e.call(this,"FaceLandmark68Net",t)||this}return uo(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(IA);var NA=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return uo(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Di(function(){var n=XT(AT(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ts(255)),t.dense0,!0);return n=XT(n,t.dense1),n=XT(n,t.dense2),n=Bd(n,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=JT(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return uT(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=vT(e),r=n.extractWeights,o=n.getRemainingWeights,a=YT(r,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}(e)},t}(_T),TA=function(e){function t(t){return void 0===t&&(t=new NA),e.call(this,"FaceLandmark68TinyNet",t)||this}return uo(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(IA);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}uo(t,e)}(_A);function AA(e,t,n,r,o){void 0===o&&(o="same");var a=t.conv,i=a.filters,s=a.bias,u=bd(e,i,n,o);return u=function(e,t){return ph(Ih(e,t.weights),t.biases)}(u=ph(u,s),t.scale),r?Vh(u):u}function DA(e,t){return AA(e,t,[1,1],!1)}function OA(e,t){return AA(e,t,[2,2],!0,"valid")}function FA(e,t){function n(n,r,o,a){var i=function(t,n,r){var o=e(t),a=o.length/(n*r*r);if(a%1!==0)throw new Error("depth has to be an integer: "+a+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return Di(function(){return Gh(as(o,[n,a,r,r]),[2,3,1,0])})}(n,r,o),s=ns(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}function r(r,o,a,i){var s=n(r,o,a,i+"/conv"),u=function(n,r){var o=ns(e(n)),a=ns(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:a}}(o,i+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,o,a){return void 0===a&&(a=!1),{conv1:r((a?.5:1)*e,t,n,o+"/conv1"),conv2:r(e,t,n,o+"/conv2")}}}}function PA(e,t){var n=pT(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),o=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:o}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function MA(e){var t=[],n=PA(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,a=r("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),f=o("conv64_2"),d=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),y=o("conv256_2"),x=o("conv256_down_out"),b=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!TN(b,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var w={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:f,conv64_3:d,conv128_down:h,conv128_1:p,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:y,conv256_down_out:x,fc:b};return uT(e,t),{params:w,paramMappings:t}}function BA(e,t){var n=function(e,t){return AA(e,t,[1,1],!0)}(e,t.conv1);return n=DA(n,t.conv2),n=ph(n,e),n=Vh(n)}function LA(e,t){var n=OA(e,t.conv1);n=DA(n,t.conv2);var r=Bd(e,2,2,"valid"),o=ss(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var i=n.shape.slice();i[1]=1;var s=ss(i),u=(n=ds([n,s],1)).shape.slice();u[2]=1;var l=ss(u);n=ds([n,l],2)}return r=a?ds([r,o],3):r,n=ph(r,n),n=Vh(n)}var WA=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return uo(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Di(function(){var n=OA(AT(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(ts(256)),t.conv32_down);n=BA(n=Md(n,3,2,"valid"),t.conv32_1),n=BA(n,t.conv32_2),n=BA(n,t.conv32_3),n=BA(n=LA(n,t.conv64_down),t.conv64_1),n=BA(n,t.conv64_2),n=BA(n,t.conv64_3),n=BA(n=LA(n,t.conv128_down),t.conv128_1),n=BA(n,t.conv128_2),n=BA(n=LA(n,t.conv256_down),t.conv256_1);var r=(n=LA(n=BA(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Rd(r,t.fc)})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return co(this,void 0,void 0,function(){var t,n,r,o=this;return fo(this,function(a){switch(a.label){case 0:return[4,IT(e)];case 1:return t=a.sent(),n=Di(function(){return Zs(o.forwardInput(t))}),[4,Promise.all(n.map(function(e){return e.data()}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return MA(e)},t.prototype.extractParams=function(e){return function(e){var t=vT(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=FA(n,o),i=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),C=s(589824,256,3,"conv256_down_out"),E=Di(function(){return Gh(rs(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:f,conv64_down:d,conv64_1:h,conv64_2:p,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:y,conv256_down:x,conv256_1:b,conv256_2:w,conv256_down_out:C,fc:E},paramMappings:o}}(e)},t}(_T);var zA=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,i=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=i,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!==typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function UA(e,t){function n(n,r,o,a,i){var s=as(e(n*r*o*o),[o,o,n,r]),u=ns(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(i?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,o){var a=n(e,t,r,o,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function o(n,o,a){var i=function(n,r){var o=as(e(9*n),[3,3,n,1]),a=ns(e(n)),i=ns(e(n)),s=ns(e(n)),u=ns(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:a,batch_norm_offset:i,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv");return{depthwise_conv:i,pointwise_conv:r(n,o,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function jA(e){var t=[],n=function(e,t){var n=pT(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(e){var t="mobilenetv1/conv_"+e,o="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",i=t+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,i)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function i(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:i(0),box_predictor_1:i(1),box_predictor_2:i(2),box_predictor_3:i(3),box_predictor_4:i(4),box_predictor_5:i(5)}}}}(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!AN(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:a}};return uT(e,t),{params:i,paramMappings:t}}function VA(e,t,n){return Di(function(){var r=bd(e,t.filters,n,"same");return r=ph(r,t.batch_norm_offset),Nf(r,0,6)})}function HA(e,t){return Di(function(){var n=null,r=VA(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(e,t){var o=t+1,a=function(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}(o);r=function(e,t,n){return Di(function(){var r=Ed(e,t.filters,n,"same");return r=dd(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Nf(r,0,6)})}(r,e.depthwise_conv,a),r=VA(r,e.pointwise_conv,[1,1]),11===o&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function GA(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),d=(i-o)*(s-a),h=(c-u)*(f-l);if(d<=0||h<=0)return 0;var p=Math.max(o,u),v=Math.max(a,l),m=Math.min(i,c),g=Math.min(s,f),y=Math.max(m-p,0)*Math.max(g-v,0);return y/(d+h-y)}function qA(e,t){var n=function(e){var t=Zs(Gh(e,[1,0])),n=[Oh(t[2],t[0]),Oh(t[3],t[1])];return{sizes:n,centers:[ph(t[0],yh(n[0],ts(2))),ph(t[1],yh(n[1],ts(2)))]}}(e),r=n.sizes,o=n.centers,a=Zs(Gh(t,[1,0])),i=yh(Ih(Of(yh(a[2],ts(5))),r[0]),ts(2)),s=ph(Ih(yh(a[0],ts(10)),r[0]),o[0]),u=yh(Ih(Of(yh(a[3],ts(5))),r[1]),ts(2)),l=ph(Ih(yh(a[1],ts(10)),r[1]),o[1]);return Gh(Ys([Oh(s,i),Oh(l,u),ph(s,i),ph(l,u)]),[1,0])}function KA(e,t){return Di(function(){var n=e.shape[0];return{boxPredictionEncoding:Ks(sT(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Ks(sT(e,t.class_predictor),[n,-1,3])}})}var XA=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),$A=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return uo(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Di(function(){var n=e.toBatchTensor(512,!1).toFloat(),r=HA(Oh(Ih(n,ts(.007843137718737125)),ts(1)),t.mobilenetv1),o=function(e,t,n){return Di(function(){var r=VA(e,n.conv_0,[1,1]),o=VA(r,n.conv_1,[2,2]),a=VA(o,n.conv_2,[1,1]),i=VA(a,n.conv_3,[2,2]),s=VA(i,n.conv_4,[1,1]),u=VA(s,n.conv_5,[2,2]),l=VA(u,n.conv_6,[1,1]),c=VA(l,n.conv_7,[2,2]),f=KA(t,n.box_predictor_0),d=KA(e,n.box_predictor_1),h=KA(o,n.box_predictor_2),p=KA(i,n.box_predictor_3),v=KA(u,n.box_predictor_4),m=KA(c,n.box_predictor_5);return{boxPredictions:ds([f.boxPredictionEncoding,d.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:ds([f.classPrediction,d.classPrediction,h.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1)}})}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Di(function(){var r=e.shape[0],o=qA(Ks(Qs(n.extra_dim,[r,1,1]),[-1,4]),Ks(e,[-1,4]));o=Ks(o,[r,o.shape[0]/r,4]);var a=Vf(Wd(t,[0,0,1],[-1,-1,-1])),i=Wd(a,[0,0,0],[-1,-1,1]);return i=Ks(i,[r,i.shape[1]]),{boxes:Zs(o),scores:Zs(i)}})}(o.boxPredictions,o.classPredictions,t.output_layer)})},t.prototype.forward=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,IT(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),co(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,h,p,v,m,g,y,x,b,w;return fo(this,function(C){switch(C.label){case 0:return n=new XA(t),r=n.maxResults,o=n.minConfidence,[4,IT(e)];case 1:for(a=C.sent(),i=this.forwardInput(a),s=i.boxes,u=i.scores,l=s[0],c=u[0],f=1;f<s.length;f++)s[f].dispose(),u[f].dispose();return p=(h=Array).from,[4,c.data()];case 2:return d=p.apply(h,[C.sent()]),v=function(e,t,n,r,o){var a=e.shape[0],i=Math.min(n,a),s=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),u=function(e){return e<=r?1:0},l=[];return s.forEach(function(t){if(!(l.length>=i)){for(var n=t.score,r=l.length-1;r>=0;--r){var a=GA(e,t.boxIndex,l[r]);if(0!==a&&(t.score*=u(a),t.score<=o))break}n===t.score&&l.push(t.boxIndex)}}),l}(l,d,r,.5,o),m=a.getReshapedInputDimensions(0),g=a.inputSize,y=g/m.width,x=g/m.height,b=l.arraySync(),w=v.map(function(e){var t=[Math.max(0,b[e][0]),Math.min(1,b[e][2])].map(function(e){return e*x}),n=t[0],r=t[1],o=[Math.max(0,b[e][1]),Math.min(1,b[e][3])].map(function(e){return e*y}),i=o[0],s=o[1];return new VT(d[e],new GN(i,n,s-i,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),l.dispose(),c.dispose(),[2,w]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return jA(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=vT(e),r=n.extractWeights,o=n.getRemainingWeights,a=UA(r,t),i=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=i(),l=s(),c={extra_dim:os(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:c},paramMappings:t}}(e)},t}(_T);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}uo(t,e)}($A);var YA=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return uo(t,e),t}(zT),QA=function(){function e(){}return e.prototype.then=function(e){return co(this,void 0,void 0,function(){var t;return fo(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},e.prototype.run=function(){return co(this,void 0,void 0,function(){return fo(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},e}();function JA(e,t){var n={descriptor:t};return Object.assign({},e,n)}function ZA(e,t,n,r,o){return void 0===o&&(o=function(e){return e.alignedRect}),co(this,void 0,void 0,function(){var a,i,s,u,l;return fo(this,function(c){switch(c.label){case 0:return a=e.map(function(e){return cA(e)?o(e):e.detection}),(s=r)?[3,5]:t instanceof xa?[4,RA(t,a)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,SA(t,a)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return[4,n(i=s)];case 6:return l=c.sent(),i.forEach(function(e){return e instanceof xa&&e.dispose()}),[2,l]}})})}function eD(e,t,n,r,o){return co(this,void 0,void 0,function(){var a=this;return fo(this,function(i){return[2,ZA([e],t,function(e){return co(a,void 0,void 0,function(){return fo(this,function(t){return[2,n(e[0])]})})},r,o)]})})}function tD(e){var t=vT(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=function(e,t){var n=lT(e,t),r=cT(e,t);function o(n,r){var o=ns(e(n));return t.push({paramPath:r}),o}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:o(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:o(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:o(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return lo({},e,{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),i=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return lo({},e,{fc1:t,prelu4_alpha:n,fc2_1:i,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),i=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),l=r(256,2,"onet/fc2_1"),c=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return lo({},e,{conv4:t,prelu4_alpha:i,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:c,fc2_3:f})}}}(n,o),i=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,l=i(),c=s(),f=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:f},paramMappings:o}}function nD(e){var t=[],n=function(e,t){var n=pT(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function o(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function i(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return lo({},e,{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=i("rnet"),t=o("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return lo({},e,{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=i("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=o("onet/fc1"),u=a("onet/prelu5_alpha"),l=o("onet/fc2_1"),c=o("onet/fc2_2"),f=o("onet/fc2_3");return lo({},e,{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:c,fc2_3:f})}}}(e,t),r=n.extractPNetParams,o=n.extractRNetParams,a=n.extractONetParams,i=r(),s=o(),u=a();return uT(e,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}function rD(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var oD=function(e){function t(t,n,r,o){return e.call(this,{left:t,top:n,right:r,bottom:o},!0)||this}return uo(t,e),t}(UN);function aD(e){return Di(function(){return Ih(Oh(e,ts(127.5)),ts(.0078125))})}function iD(e,t){return Di(function(){return ph(Vh(e),Ih(t,Wf(Vh(Wf(e)))))})}function sD(e,t,n){return void 0===n&&(n=!1),Di(function(){var r=sT(e,t.conv1,"valid");return r=iD(r,t.prelu1_alpha),r=iD(r=sT(r=Md(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=iD(r=sT(r=n?r:Md(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function uD(e,t,n,r,o){o.stage1=[];var a=t.map(function(t){return Di(function(){var n={scale:t},o=function(e,t){return Di(function(){var n=rD(t,e.shape.slice(1)),r=n.height,o=n.width,a=aD(Bp.resizeBilinear(e,[r,o]));return Gh(a,[0,2,1,3])})}(e,t),a=Date.now(),i=function(e,t){return Di(function(){var n=sD(e,t,!0),r=sT(n,t.conv4_1,"valid"),o=Ps(Yd(r,3),3);return{prob:pu(Oh(r,o),3),regions:sT(n,t.conv4_2,"valid")}})}(o,r),s=i.prob,u=i.regions;return n.pnet=Date.now()-a,{scoresTensor:Zs(Zs(s,3)[1])[0],regionsTensor:Zs(u)[0],scale:t,statsForScale:n}})}),i=a.map(function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,i=e.statsForScale,s=function(e,t,n,r){for(var o=[],a=e.arraySync(),i=0;i<e.shape[0];i++)for(var s=0;s<e.shape[1];s++)a[i][s]>=r&&o.push(new NN(s,i));return o.map(function(e){var r=new jN(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),o=a[e.y][e.x],i=t.arraySync();return{cell:r,score:o,region:new oD(i[e.y][e.x][0],i[e.y][e.x][1],i[e.y][e.x][2],i[e.y][e.x][3])}})}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return o.stage1.push(i),[];var u=Date.now(),l=TT(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.5);return i.nms=Date.now()-u,i.numBoxes=l.length,o.stage1.push(i),l.map(function(e){return s[e]})}),s=i.reduce(function(e,t){return e.concat(t)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),f=TT(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.7);o.stage1_nms=Date.now()-c,l=f.map(function(e){return s[e].score}),u=f.map(function(e){return s[e]}).map(function(e){var t=e.cell,n=e.region;return new jN(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()})}return{boxes:u,scores:l}}function lD(e,t,n){var r=n.width,o=n.height;return co(this,void 0,void 0,function(){var n,a,i,s=this;return fo(this,function(u){switch(u.label){case 0:return n=nT(e),[4,Promise.all(t.map(function(t){return co(s,void 0,void 0,function(){var r,o,a,i,s,u,l,c;return fo(this,function(f){return r=t.padAtBorders(e.height,e.width),o=r.y,a=r.ey,i=r.x,s=r.ex,u=i-1,l=o-1,c=n.getImageData(u,l,s-u,a-l),[2,eT.isNodejs()?bT(c):createImageBitmap(c)]})})}))];case 1:return a=u.sent(),i=[],a.forEach(function(e){var t=nT(xT({width:r,height:o}));t.drawImage(e,0,0,r,o);for(var n=t.getImageData(0,0,r,o).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);i.push(a)}),[2,i.map(function(e){return Di(function(){return aD(Gh(as(e,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function cD(e,t,n,r,o){return co(this,void 0,void 0,function(){var a,i,s,u,l,c,f,d,h,p,v,m,g,y;return fo(this,function(x){switch(x.label){case 0:return a=Date.now(),[4,lD(e,t,{width:24,height:24})];case 1:return i=x.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return Di(function(){var n=sD(e,t),r=iD(eA(Ks(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),o=eA(r,t.fc2_1),a=Ps(Yd(o,1),1),i=pu(Oh(o,a),1),s=eA(r,t.fc2_2);return{scores:Zs(i,1)[1],regions:s}})}(e,r);return e.dispose(),t}),o.stage2_rnet=Date.now()-a,u=s.length>1?ds(s.map(function(e){return e.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[x.sent()]),u.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),h=d.map(function(e){return t[e]}),p=d.map(function(e){return l[e]}),v=[],m=[],h.length>0&&(a=Date.now(),g=TT(h,p,.7),o.stage2_nms=Date.now()-a,y=g.map(function(e){var t=s[d[e]].regions.arraySync();return new oD(t[0][0],t[0][1],t[0][2],t[0][3])}),m=g.map(function(e){return p[e]}),v=g.map(function(e,t){return h[e].calibrate(y[t])})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:v,scores:m}]}})})}function fD(e,t,n,r,o){return co(this,void 0,void 0,function(){var a,i,s,u,l,c,f,d,h,p,v,m,g,y,x;return fo(this,function(b){switch(b.label){case 0:return a=Date.now(),[4,lD(e,t,{width:48,height:48})];case 1:return i=b.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return Di(function(){var n=sD(e,t);n=iD(n=sT(n=Md(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=iD(eA(Ks(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),o=eA(r,t.fc2_1),a=Ps(Yd(o,1),1),i=pu(Oh(o,a),1),s=eA(r,t.fc2_2),u=eA(r,t.fc2_3);return{scores:Zs(i,1)[1],regions:s,points:u}})}(e,r);return e.dispose(),t}),o.stage3_onet=Date.now()-a,u=s.length>1?ds(s.map(function(e){return e.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[b.sent()]),u.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),h=d.map(function(e){var t=s[e].regions.arraySync();return new oD(t[0][0],t[0][1],t[0][2],t[0][3])}),p=d.map(function(e,n){return t[e].calibrate(h[n])}),v=d.map(function(e){return l[e]}),m=[],g=[],y=[],p.length>0&&(a=Date.now(),x=TT(p,v,.7,!1),o.stage3_nms=Date.now()-a,m=x.map(function(e){return p[e]}),g=x.map(function(e){return v[e]}),y=x.map(function(e,t){return Array(5).fill(0).map(function(n,r){var o=s[e].points.arraySync();return new NN(o[0][r]*(m[t].width+1)+m[t].left,o[0][r+5]*(m[t].height+1)+m[t].top)})})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:m,scores:g,points:y}]}})})}var dD=function(e){function t(){return e.call(this,"Mtcnn")||this}return uo(t,e),t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),co(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,h,p,v,m,g,y,x,b,w,C;return fo(this,function(E){switch(E.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},a=Date.now(),i=Di(function(){return e=Ps(Bv.fromPixels(r)).toFloat(),Di(function(){return Ys(Zs(e,3).reverse(),3)});var e}),s=function(e){return i.dispose(),o.total=Date.now()-a,e},u=i.shape.slice(1),l=u[0],c=u[1],f=new zA(t),d=f.minFaceSize,h=f.scaleFactor,p=f.maxNumScales,v=f.scoreThresholds,m=f.scaleSteps,g=(m||function(e,t,n){for(var r=n[0],o=n[1],a=12/e,i=[],s=Math.min(r,o)*a,u=0;s>=12;)i.push(a*Math.pow(t,u)),s*=t,u+=1;return i}(d,h,[l,c])).filter(function(e){var t=rD(e,[l,c]);return Math.min(t.width,t.height)>12}).slice(0,p),o.scales=g,o.pyramid=g.map(function(e){return rD(e,[l,c])}),y=Date.now(),[4,uD(i,g,v[0],n.pnet,o)];case 1:return x=E.sent(),o.total_stage1=Date.now()-y,x.boxes.length?(o.stage2_numInputBoxes=x.boxes.length,y=Date.now(),[4,cD(r,x.boxes,v[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return b=E.sent(),o.total_stage2=Date.now()-y,b.boxes.length?(o.stage3_numInputBoxes=b.boxes.length,y=Date.now(),[4,fD(r,b.boxes,v[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return w=E.sent(),o.total_stage3=Date.now()-y,C=w.boxes.map(function(e,t){return fA(GT({},new VT(w.scores[t],new GN(e.left/c,e.top/l,e.width/c,e.height/l),{height:l,width:c})),new CA(w.points[t].map(function(t){return t.sub(new NN(e.left,e.top)).div(new NN(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,s({results:C,stats:o})]}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),co(this,void 0,void 0,function(){var n;return fo(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,IT(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),co(this,void 0,void 0,function(){var n;return fo(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,IT(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return nD(e)},t.prototype.extractParams=function(e){return tD(e)},t}(_T),hD=[new NN(1.603231,2.094468),new NN(6.041143,7.080126),new NN(2.882459,3.518061),new NN(4.266906,5.178857),new NN(9.041765,10.66308)],pD=[117.001,114.697,97.404],vD=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:hD,meanRgb:pD,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return uo(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return co(this,void 0,void 0,function(){return fo(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new VT(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(UT),mD=[new NN(.738768,.874946),new NN(2.42204,2.65704),new NN(4.30971,7.04493),new NN(10.246,4.59428),new NN(12.6868,11.8741)],gD=[new NN(1.603231,2.094468),new NN(6.041143,7.080126),new NN(2.882459,3.518061),new NN(4.266906,5.178857),new NN(9.041765,10.66308)],yD=[117.001,114.697,97.404],xD=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:gD,meanRgb:yD}:{anchors:mD,withClassScores:!0});return e.call(this,n)||this}return uo(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return co(this,void 0,void 0,function(){return fo(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new VT(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(UT);var bD={ssdMobilenetv1:new $A,tinyFaceDetector:new vD,tinyYolov2:new xD,mtcnn:new dD,faceLandmark68Net:new _A,faceLandmark68TinyNet:new TA,faceRecognitionNet:new WA,faceExpressionNet:new aA,ageGenderNet:new wA};function wD(e,t){var n={age:t};return Object.assign({},e,n)}function CD(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var ED=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return uo(t,e),t}(QA),kD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t,n=this;return fo(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,ZA(e=r.sent(),this.input,function(e){return co(n,void 0,void 0,function(){return fo(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return bD.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){return iA(e,t[n])})]}})})},t.prototype.withAgeAndGender=function(){return new ND(this,this.input)},t}(ED),SD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t;return fo(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,eD(e,this.input,function(e){return bD.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,iA(e,t)]}})})},t.prototype.withAgeAndGender=function(){return new TD(this,this.input)},t}(ED),RD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.withAgeAndGender=function(){return new AD(this,this.input)},t.prototype.withFaceDescriptors=function(){return new FD(this,this.input)},t}(kD),ID=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.withAgeAndGender=function(){return new DD(this,this.input)},t.prototype.withFaceDescriptor=function(){return new PD(this,this.input)},t}(SD),_D=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return uo(t,e),t}(QA),ND=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t,n=this;return fo(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,ZA(e=r.sent(),this.input,function(e){return co(n,void 0,void 0,function(){return fo(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return bD.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){var r=t[n],o=r.age;return wD(CD(e,r.gender,r.genderProbability),o)})]}})})},t.prototype.withFaceExpressions=function(){return new kD(this,this.input)},t}(_D),TD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t,n,r,o;return fo(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,eD(e,this.input,function(e){return bD.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,o=t.genderProbability,[2,wD(CD(e,r,o),n)]}})})},t.prototype.withFaceExpressions=function(){return new SD(this,this.input)},t}(_D),AD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.withFaceExpressions=function(){return new RD(this,this.input)},t.prototype.withFaceDescriptors=function(){return new FD(this,this.input)},t}(ND),DD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.withFaceExpressions=function(){return new ID(this,this.input)},t.prototype.withFaceDescriptor=function(){return new PD(this,this.input)},t}(TD),OD=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return uo(t,e),t}(QA),FD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e;return fo(this,function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,ZA(e=t.sent(),this.input,function(e){return Promise.all(e.map(function(e){return bD.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,t.sent().map(function(t,n){return JA(e[n],t)})]}})})},t.prototype.withFaceExpressions=function(){return new RD(this,this.input)},t.prototype.withAgeAndGender=function(){return new AD(this,this.input)},t}(OD),PD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t;return fo(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,eD(e,this.input,function(e){return bD.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=n.sent(),[2,JA(e,t)]}})})},t.prototype.withFaceExpressions=function(){return new ID(this,this.input)},t.prototype.withAgeAndGender=function(){return new DD(this,this.input)},t}(OD),MD=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=r,o}return uo(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?bD.faceLandmark68TinyNet:bD.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(QA),BD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t,n,r,o,a=this;return fo(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),t=e.map(function(e){return e.detection}),this.input instanceof xa?[4,RA(this.input,t)]:[3,3];case 2:return r=i.sent(),[3,5];case 3:return[4,SA(this.input,t)];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,Promise.all(n.map(function(e){return a.landmarkNet.detectLandmarks(e)}))];case 6:return o=i.sent(),n.forEach(function(e){return e instanceof xa&&e.dispose()}),[2,e.map(function(e,t){return fA(e,o[t])})]}})})},t.prototype.withFaceExpressions=function(){return new RD(this,this.input)},t.prototype.withAgeAndGender=function(){return new AD(this,this.input)},t.prototype.withFaceDescriptors=function(){return new FD(this,this.input)},t}(MD),LD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t,n,r,o;return fo(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof xa?[4,RA(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,SA(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=a.sent(),n.forEach(function(e){return e instanceof xa&&e.dispose()}),[2,fA(e,o)]}})})},t.prototype.withFaceExpressions=function(){return new ID(this,this.input)},t.prototype.withAgeAndGender=function(){return new DD(this,this.input)},t.prototype.withFaceDescriptor=function(){return new PD(this,this.input)},t}(MD),WD=function(e){function t(t,n){void 0===n&&(n=new XA);var r=e.call(this)||this;return r.input=t,r.options=n,r}return uo(t,e),t}(QA),zD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t,n,r;return fo(this,function(o){switch(o.label){case 0:return t=(e=this).input,(n=e.options)instanceof zA?[4,bD.mtcnn.forward(t,n)]:[3,2];case 1:return[2,o.sent().map(function(e){return e.detection})];case 2:if(r=n instanceof YA?function(e){return bD.tinyFaceDetector.locateFaces(e,n)}:n instanceof XA?function(e){return bD.ssdMobilenetv1.locateFaces(e,n)}:n instanceof zT?function(e){return bD.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return co(e,void 0,void 0,function(){var e;return fo(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map(function(e){return GT({},e)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new BD(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new kD(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new ND(this.runAndExtendWithFaceDetections(),this.input)},t}(WD),UD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uo(t,e),t.prototype.run=function(){return co(this,void 0,void 0,function(){var e,t;return fo(this,function(n){switch(n.label){case 0:return[4,new zD(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return co(e,void 0,void 0,function(){var e;return fo(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?GT({},e):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new LD(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new SD(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new TD(this.runAndExtendWithFaceDetection(),this.input)},t}(WD);!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map(function(e){if(e instanceof kA)return e;if(e instanceof Float32Array)return new kA(o(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new kA(o(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(e,t){return e-r[t]}).reduce(function(e,t){return e+Math.pow(t,2)},0))}(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,o=n.label;return new EA(o,t.computeMeanDistance(e,r))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new EA("unknown",t.distance)}}();lo({},t,r);ro.defaults.baseURL="https://Linkx1.pythonanywhere.com",ro.defaults.withCredentials=!0;const jD=[{key:"front",text:"Look straight \ud83d\ude10"},{key:"smile",text:"Smile \ud83d\ude42"},{key:"left",text:"Turn LEFT \ud83d\udc48"},{key:"right",text:"Turn RIGHT \ud83d\udc49"}];function VD(){const e=ie(),t=(0,a.useRef)(null),n=(0,a.useRef)(null),[r,o]=(0,a.useState)(0),[i,s]=(0,a.useState)([]),[u,l]=(0,a.useState)(!1),[c,f]=(0,a.useState)(!0),[d,h]=(0,a.useState)(0),[p,v]=(0,a.useState)("Initializing\u2026"),[m,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=!0;return async function(){try{const r="/LinkX/models";v("Loading face detector\u2026"),await bD.tinyFaceDetector.loadFromUri(r),h(30),v("Loading landmarks\u2026"),await bD.faceLandmark68Net.loadFromUri(r),h(60),v("Loading recognition model\u2026"),await bD.faceRecognitionNet.loadFromUri(r),h(90),v("Starting camera\u2026");const o=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});if(!e)return;n.current=o,t.current.srcObject=o,h(100),f(!1)}catch(r){console.error("INIT FAILED:",r),alert("Failed to initialize face verification")}}(),()=>{var t;e=!1,null===(t=n.current)||void 0===t||t.getTracks().forEach(e=>e.stop())}},[]);const y=async t=>{try{var r;g(!0),v("Submitting\u2026");const o=t.map(e=>e.embedding),a=(await ro.post("/api/accounts/complete-signup/",{embeddings:o})).data;a.access&&localStorage.setItem("accessToken",a.access),a.refresh&&localStorage.setItem("refreshToken",a.refresh),a.username&&localStorage.setItem("username",a.username),null===(r=n.current)||void 0===r||r.getTracks().forEach(e=>e.stop()),e("/")}catch(c){var o,a,i,s,u;console.error("FACE SUBMIT ERROR:",c),alert((null===(o=c.response)||void 0===o||null===(a=o.data)||void 0===a?void 0:a.error)||(null===(i=c.response)||void 0===i||null===(s=i.data)||void 0===s?void 0:s.message)||JSON.stringify(null===(u=c.response)||void 0===u?void 0:u.data)||c.message||"Face verification failed"),g(!1),l(!0)}};return(0,tt.jsxs)("div",{style:{padding:16},children:[(0,tt.jsx)("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!0,onLoadedData:()=>l(!0),style:{width:320,borderRadius:8,display:c?"none":"block"}}),c?(0,tt.jsxs)(tt.Fragment,{children:[(0,tt.jsx)("h3",{children:p}),(0,tt.jsx)("div",{style:{width:"100%",height:8,background:"#ddd",borderRadius:4},children:(0,tt.jsx)("div",{style:{width:"".concat(d,"%"),height:"100%",background:"#4caf50",borderRadius:4,transition:"width 0.4s"}})}),(0,tt.jsxs)("p",{children:[d,"%"]})]}):(0,tt.jsxs)(tt.Fragment,{children:[(0,tt.jsx)("h3",{children:m?"Submitting\u2026":jD[r].text}),(0,tt.jsx)("br",{}),(0,tt.jsx)("button",{onClick:async()=>{if(!m){l(!1);try{const a=await(e=t.current,n=new YA({inputSize:160,scoreThreshold:.5}),void 0===n&&(n=new XA),new UD(e,n)).withFaceLandmarks().withFaceDescriptor();if(!a)return alert("No face detected"),void l(!0);if(!function(e,t,n){const r=e.landmarks.getNose()[3].x,o=e.landmarks.getJawOutline(),a=(o[0].x+o[16].x)/2,i=(r-a)/n.videoWidth;return"front"===t?Math.abs(i)<.03:"left"===t?i<-.05:"right"!==t||i>.05}(a,jD[r].key,t.current))return alert("Please follow the instruction"),void l(!0);const u=[...i,{pose:jD[r].key,embedding:Array.from(a.descriptor)}];s(u),r<jD.length-1?(o(r+1),l(!0)):y(u)}catch(a){console.error("CAPTURE ERROR:",a),alert("Capture failed. Try again."),l(!0)}var e,n}},disabled:!u||m,children:m?"Please wait...":"Capture"})]})]})}function HD(){const e=ie(),t=sessionStorage.getItem("resetUsername"),n=sessionStorage.getItem("resetToken"),[r,o]=(0,a.useState)(""),[i,s]=(0,a.useState)(""),[u,l]=(0,a.useState)(""),[c,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{n&&t||e("/login")},[e,n,t]);return(0,tt.jsx)("div",{className:"reset-wrapper",children:(0,tt.jsxs)("div",{className:"reset-card",children:[(0,tt.jsx)("h2",{children:t}),(0,tt.jsx)("input",{type:"password",placeholder:"New password",value:r,onChange:e=>o(e.target.value)}),(0,tt.jsx)("input",{type:"password",placeholder:"Confirm password",value:i,onChange:e=>s(e.target.value)}),u&&(0,tt.jsx)("p",{className:"error",children:u}),(0,tt.jsx)("button",{onClick:async()=>{if(l(""),r.length<8)l("Password must be at least 8 characters");else if(r===i){f(!0);try{const t=await fetch("".concat("https://Linkx1.pythonanywhere.com","/api/accounts/reset-password/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reset_token:n,new_password:r})}),o=await t.json();if(!t.ok)return void l((null===o||void 0===o?void 0:o.message)||"Reset failed");sessionStorage.removeItem("resetToken"),sessionStorage.removeItem("resetEmail"),sessionStorage.removeItem("resetUsername"),e("/login")}catch(t){l("Server error. Try again.")}finally{f(!1)}}else l("Passwords do not match")},disabled:c,children:c?"Please wait...":"Reset Password"})]})})}function GD(){const e=ie(),t=sessionStorage.getItem("resetEmail"),[n,r]=(0,a.useState)(["","","",""]),[o,i]=(0,a.useState)(""),s=(0,a.useRef)([]);(0,a.useEffect)(()=>{t||e("/login")},[t,e]);const u=n.every(e=>""!==e);return(0,tt.jsx)("div",{className:"otp-wrapper",children:(0,tt.jsxs)("div",{className:"otp-card",children:[(0,tt.jsx)("h2",{children:"Enter OTP"}),(0,tt.jsx)("p",{children:t}),(0,tt.jsx)("div",{className:"otp-inputs",children:n.map((e,t)=>(0,tt.jsx)("input",{ref:e=>s.current[t]=e,value:e,onChange:e=>((e,t)=>{if(!/^\d?$/.test(e))return;const o=[...n];o[t]=e,r(o),e&&t<3&&s.current[t+1].focus()})(e.target.value,t),onKeyDown:e=>((e,t)=>{"Backspace"===e.key&&!n[t]&&t>0&&s.current[t-1].focus()})(e,t),maxLength:"1"},t))}),o&&(0,tt.jsx)("p",{className:"error",children:o}),(0,tt.jsx)("button",{onClick:async()=>{i("");try{const r=await fetch("https://Linkx1.pythonanywhere.com/api/accounts/verify-reset-otp/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,otp:n.join("")})}),o=await r.json();if(!r.ok)return void i(o.message||"Invalid OTP");sessionStorage.setItem("resetToken",o.reset_token),e("/reset-password")}catch(r){i("Server error")}},disabled:!u,className:u?"active":"",children:"Verify OTP"})]})})}function qD(){const{clientId:e}=function(){let{matches:e}=a.useContext(te),t=e[e.length-1];return t?t.params:{}}(),t=ie();return(0,tt.jsxs)("div",{style:KD.page,children:[(0,tt.jsxs)("div",{style:KD.header,children:[(0,tt.jsx)("div",{style:KD.back,onClick:()=>t(-1),children:"\u276e"}),(0,tt.jsxs)("div",{style:KD.user,children:[(0,tt.jsx)("div",{style:KD.avatar}),(0,tt.jsxs)("div",{children:[(0,tt.jsx)("div",{style:KD.name,children:e}),(0,tt.jsxs)("div",{style:KD.username,children:["@",e,"xyz"]})]})]}),(0,tt.jsx)("button",{style:KD.pay,children:"pay"})]}),(0,tt.jsx)("div",{style:KD.body}),(0,tt.jsxs)("div",{style:KD.inputBar,children:[(0,tt.jsx)("div",{style:KD.plus,children:"+"}),(0,tt.jsx)("input",{placeholder:"",style:KD.input}),(0,tt.jsx)("div",{style:KD.send,children:"^"})]})]})}const KD={page:{height:"100vh",background:"#fff",display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",padding:"10px",borderBottom:"1px solid #ddd"},back:{fontSize:28,marginRight:8,cursor:"pointer"},user:{display:"flex",alignItems:"center",flex:1},avatar:{width:42,height:42,borderRadius:"50%",background:"#ccc",marginRight:10},name:{fontWeight:"bold",fontSize:16},username:{fontSize:12,color:"#999"},pay:{background:"#000",color:"#fff",border:"none",padding:"6px 14px",borderRadius:20,cursor:"pointer"},body:{flex:1},inputBar:{display:"flex",alignItems:"center",padding:10,borderTop:"1px solid #ddd"},plus:{fontSize:26,marginRight:8,cursor:"pointer"},input:{flex:1,padding:"10px 14px",borderRadius:25,border:"1px solid #ccc",outline:"none"},send:{width:38,height:38,borderRadius:"50%",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:8,cursor:"pointer",fontSize:18}};function XD(){const e=ie();return(0,tt.jsxs)("div",{style:$D.page,children:[(0,tt.jsxs)("div",{style:$D.header,children:[(0,tt.jsx)("div",{style:$D.back,onClick:()=>e("/"),children:(0,tt.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,tt.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,tt.jsx)("div",{style:$D.title,children:"LinkBot"}),(0,tt.jsx)("div",{style:$D.avatar})]}),(0,tt.jsx)("div",{style:$D.messages}),(0,tt.jsxs)("div",{style:$D.inputBar,children:[(0,tt.jsx)("input",{placeholder:"start finding",style:$D.input}),(0,tt.jsx)("div",{style:$D.send,children:"^"})]})]})}const $D={page:{height:"100vh",background:"#fff"},header:{position:"fixed",top:0,left:0,right:0,height:56,display:"flex",alignItems:"center",padding:"0 14px",borderBottom:"1px solid #eee",background:"#fff",zIndex:10},back:{display:"flex",alignItems:"center",justifyContent:"center",marginRight:12,cursor:"pointer"},title:{flex:1,fontSize:18,fontWeight:"bold"},avatar:{width:32,height:32,borderRadius:"50%",background:"#000"},messages:{position:"absolute",top:56,bottom:60,left:0,right:0,overflowY:"auto",padding:14},inputBar:{position:"fixed",bottom:0,left:0,right:0,height:60,display:"flex",alignItems:"center",padding:"0 12px",borderTop:"1px solid #eee",background:"#fff"},input:{flex:1,height:40,borderRadius:20,border:"1px solid #ddd",padding:"0 14px",fontSize:16,outline:"none"},send:{width:40,height:40,marginLeft:10,borderRadius:"50%",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"}};function YD(){return(0,tt.jsxs)(Se,{children:[(0,tt.jsxs)(Ee,{element:(0,tt.jsx)(ot,{}),children:[(0,tt.jsx)(Ee,{path:"/",element:(0,tt.jsx)(ct,{})}),(0,tt.jsx)(Ee,{path:"/upload",element:(0,tt.jsx)(gt,{})}),(0,tt.jsx)(Ee,{path:"/profile",element:(0,tt.jsx)(xt,{})}),(0,tt.jsx)(Ee,{path:"/inbox",element:(0,tt.jsx)(Ct,{})}),(0,tt.jsx)(Ee,{path:"/notifications",element:(0,tt.jsx)(St,{})}),(0,tt.jsx)(Ee,{path:"/edit-profile",element:(0,tt.jsx)(At,{})}),(0,tt.jsx)(Ee,{path:"/search",element:(0,tt.jsx)(Ot,{})})]}),(0,tt.jsx)(Ee,{path:"/login",element:(0,tt.jsx)(Mt,{})}),(0,tt.jsx)(Ee,{path:"/signup",element:(0,tt.jsx)(ao,{})}),(0,tt.jsx)(Ee,{path:"/verify-otp",element:(0,tt.jsx)(io,{})}),(0,tt.jsx)(Ee,{path:"/faceVerification",element:(0,tt.jsx)(VD,{})}),(0,tt.jsx)(Ee,{path:"/resetpassword",element:(0,tt.jsx)(HD,{})}),(0,tt.jsx)(Ee,{path:"/forgot-password",element:(0,tt.jsx)(GD,{})}),(0,tt.jsx)(Ee,{path:"/chat/:clientId",element:(0,tt.jsx)(qD,{})}),(0,tt.jsx)(Ee,{path:"/chatbot",element:(0,tt.jsx)(XD,{})})]})}s.createRoot(document.getElementById("root")).render((0,tt.jsx)(Ae,{children:(0,tt.jsx)(YD,{})}))})()})();
//# sourceMappingURL=main.677d26c3.js.map